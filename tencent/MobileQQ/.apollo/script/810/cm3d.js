window = this;
var cm3d=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});!function(e,t,n){function i(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),Object.assign(i.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,i=n[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var i=n.slice(0),r=0,a=i.length;r<a;r++)i[r].call(this,e)}}}});var a,o,s,l,c,u,h,p,f,d="99",m=0,g=1,v=2,_=1,y=2,x=0,b=1,M=2,S=0,w=0,E=1,T=2,A=3,L=4,C=5,P=100,R=101,I=102,D=103,U=104,O=200,B=201,N=202,F=203,G=204,k=205,H=206,V=207,z=208,j=209,W=210,X=0,Y=1,q=2,K=3,Z=4,Q=5,J=6,$=7,ee=0,te=1,ne=2,ie=1,re=301,ae=302,oe=303,se=304,le=305,ce=306,ue=307,he=1e3,pe=1001,fe=1002,de=1003,me=1004,ge=1005,ve=1006,_e=1007,ye=1008,xe=1009,be=1010,Me=1011,Se=1012,we=1013,Ee=1014,Te=1015,Ae=1016,Le=1017,Ce=1018,Pe=1019,Re=1020,Ie=1021,De=1022,Ue=1023,Oe=1024,Be=1025,Ne=Ue,Fe=1026,Ge=1027,ke=1028,He=33776,Ve=33777,ze=33778,je=33779,We=35840,Xe=35841,Ye=35842,qe=35843,Ke=36196,Ze=37808,Qe=37809,Je=37810,$e=37811,et=37812,tt=37813,nt=37814,it=37815,rt=37816,at=37817,ot=37818,st=37819,lt=37820,ct=37821,ut=0,ht=1,pt=2,ft=3e3,dt=3001,mt=3007,gt=3002,vt=3004,_t=3005,yt=3006,xt=3200,bt=3201,Mt=0,St=1,wt=1,Et=2,Tt=1,At=2,Lt=4,Ct=8,Pt=16,Rt=32,It=64,Dt=128,Ut=256,Ot=512,Bt=1024,Nt=2048,Ft=4096,Gt=8192,kt=16384,Ht=32768,Vt=65536,zt=131072,jt=262144,Wt=524288,Xt=1048576,Yt=2097152,qt=4194304,Kt=8388608,Zt=16777216,Qt=33554432,Jt=67108864,$t=134217728,en=268435456,tn=536870912,nn=1,rn=4,an=8,on=16,sn=16,ln=32,cn=64,un=128,hn=256,pn=512,fn=1024,dn=2048,mn=4096,gn=8192,vn=16384,_n=32768,yn=65536,xn=131072,bn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255];return a.toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*bn.DEG2RAD},radToDeg:function(e){return e*bn.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Mn(e,t,n,i){void 0!==n?(this.xy=n,this.offset=i||0,Object.defineProperty(this,"x",{get:function(){return this.xy[this.offset]},set:function(e){this.xy[this.offset]=e}}),Object.defineProperty(this,"y",{get:function(){return this.xy[this.offset+1]},set:function(e){this.xy[this.offset+1]=e}})):(this.x=e||0,this.y=t||0)}function Sn(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function wn(e,t,n,i,r,a){void 0!==r?(this.xyzw=r,this.offset=a||0,Object.defineProperty(this,"_x",{get:function(){return this.xyzw[this.offset]},set:function(e){this.xyzw[this.offset]=e}}),Object.defineProperty(this,"_y",{get:function(){return this.xyzw[this.offset+1]},set:function(e){this.xyzw[this.offset+1]=e}}),Object.defineProperty(this,"_z",{get:function(){return this.xyzw[this.offset+2]},set:function(e){this.xyzw[this.offset+2]=e}}),Object.defineProperty(this,"_w",{get:function(){return this.xyzw[this.offset+3]},set:function(e){this.xyzw[this.offset+3]=e}})):(this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1)}function En(e,t,n,i,r){void 0!==i?(this.xyz=i,this.offset=r||0,Object.defineProperty(this,"x",{get:function(){return this.xyz[this.offset]},set:function(e){this.xyz[this.offset]=e}}),Object.defineProperty(this,"y",{get:function(){return this.xyz[this.offset+1]},set:function(e){this.xyz[this.offset+1]=e}}),Object.defineProperty(this,"z",{get:function(){return this.xyz[this.offset+2]},set:function(e){this.xyz[this.offset+2]=e}})):(this.x=e||0,this.y=t||0,this.z=n||0)}function Tn(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Mn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},negate:function(){return this.x=-this.x,this.y=-this.y,this},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this}}),Object.assign(Sn.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,a,o,s,l,c,u,h,p,f,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=f,g[11]=d,g[15]=m,this},clone:function(){return(new Sn).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractRotation:(f=new En,function(e){var t=this.elements,n=e.elements,i=1/f.setFromMatrixColumn(e,0).length(),r=1/f.setFromMatrixColumn(e,1).length(),a=1/f.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),c=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var h=a*c,p=a*u,f=o*c,d=o*u;t[0]=s*c,t[4]=-s*u,t[8]=l,t[1]=p+f*l,t[5]=h-d*l,t[9]=-o*s,t[2]=d-h*l,t[6]=f+p*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*c,g=s*u,v=l*c,_=l*u;t[0]=m+_*o,t[4]=v*o-g,t[8]=a*l,t[1]=a*u,t[5]=a*c,t[9]=-o,t[2]=g*o-v,t[6]=_+m*o,t[10]=a*s}else if("ZXY"===e.order){var m=s*c,g=s*u,v=l*c,_=l*u;t[0]=m-_*o,t[4]=-a*u,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*c,t[9]=_-m*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var h=a*c,p=a*u,f=o*c,d=o*u;t[0]=s*c,t[4]=f*l-p,t[8]=h*l+d,t[1]=s*u,t[5]=d*l+h,t[9]=p*l-f,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var y=a*s,x=a*l,b=o*s,M=o*l;t[0]=s*c,t[4]=M-y*u,t[8]=b*u+x,t[1]=u,t[5]=a*c,t[9]=-o*c,t[2]=-l*c,t[6]=x*u+b,t[10]=y-M*u}else if("XZY"===e.order){var y=a*s,x=a*l,b=o*s,M=o*l;t[0]=s*c,t[4]=-u,t[8]=l*c,t[1]=y*u+M,t[5]=a*c,t[9]=x*u-b,t[2]=b*u-x,t[6]=o*c,t[10]=M*u+y}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:(h=new En(0,0,0),p=new En(1,1,1),function(e){return this.compose(h,e,p)}),lookAt:(l=new En,c=new En,u=new En,function(e,t,n){var i=this.elements;return u.subVectors(e,t),0===u.lengthSq()&&(u.z=1),u.normalize(),l.crossVectors(n,u),0===l.lengthSq()&&(1===Math.abs(n.z)?u.x+=1e-4:u.z+=1e-4,u.normalize(),l.crossVectors(n,u)),l.normalize(),c.crossVectors(u,l),i[0]=l.x,i[4]=c.x,i[8]=u.x,i[1]=l.y,i[5]=c.y,i[9]=u.y,i[2]=l.z,i[6]=c.z,i[10]=u.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],c=n[1],u=n[5],h=n[9],p=n[13],f=n[2],d=n[6],m=n[10],g=n[14],v=n[3],_=n[7],y=n[11],x=n[15],b=i[0],M=i[4],S=i[8],w=i[12],E=i[1],T=i[5],A=i[9],L=i[13],C=i[2],P=i[6],R=i[10],I=i[14],D=i[3],U=i[7],O=i[11],B=i[15];return r[0]=a*b+o*E+s*C+l*D,r[4]=a*M+o*T+s*P+l*U,r[8]=a*S+o*A+s*R+l*O,r[12]=a*w+o*L+s*I+l*B,r[1]=c*b+u*E+h*C+p*D,r[5]=c*M+u*T+h*P+p*U,r[9]=c*S+u*A+h*R+p*O,r[13]=c*w+u*L+h*I+p*B,r[2]=f*b+d*E+m*C+g*D,r[6]=f*M+d*T+m*P+g*U,r[10]=f*S+d*A+m*R+g*O,r[14]=f*w+d*L+m*I+g*B,r[3]=v*b+_*E+y*C+x*D,r[7]=v*M+_*T+y*P+x*U,r[11]=v*S+_*A+y*R+x*O,r[15]=v*w+_*L+y*I+x*B,this},applyToBufferAttribute:function(){var e=new En;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],c=e[2],u=e[6],h=e[10],p=e[14],f=e[3],d=e[7],m=e[11],g=e[15];return f*(+r*s*u-i*l*u-r*o*h+n*l*h+i*o*p-n*s*p)+d*(+t*s*p-t*l*h+r*a*h-i*a*p+i*l*c-r*s*c)+m*(+t*l*u-t*o*p-r*a*u+n*a*p+r*o*c-n*l*c)+g*(-i*o*c-t*s*u+t*o*h+i*a*u-n*a*h+n*s*c)},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],l=i[4],c=i[5],u=i[6],h=i[7],p=i[8],f=i[9],d=i[10],m=i[11],g=i[12],v=i[13],_=i[14],y=i[15],x=f*_*h-v*d*h+v*u*m-c*_*m-f*u*y+c*d*y,b=g*d*h-p*_*h-g*u*m+l*_*m+p*u*y-l*d*y,M=p*v*h-g*f*h+g*c*m-l*v*m-p*c*y+l*f*y,S=g*f*u-p*v*u-g*c*d+l*v*d+p*c*_-l*f*_,w=r*x+a*b+o*M+s*S;if(0===w){var E="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(E);return console.warn(E),this.identity()}var T=1/w;return n[0]=x*T,n[1]=(v*d*s-f*_*s-v*o*m+a*_*m+f*o*y-a*d*y)*T,n[2]=(c*_*s-v*u*s+v*o*h-a*_*h-c*o*y+a*u*y)*T,n[3]=(f*u*s-c*d*s-f*o*h+a*d*h+c*o*m-a*u*m)*T,n[4]=b*T,n[5]=(p*_*s-g*d*s+g*o*m-r*_*m-p*o*y+r*d*y)*T,n[6]=(g*u*s-l*_*s-g*o*h+r*_*h+l*o*y-r*u*y)*T,n[7]=(l*d*s-p*u*s+p*o*h-r*d*h-l*o*m+r*u*m)*T,n[8]=M*T,n[9]=(g*f*s-p*v*s-g*a*m+r*v*m+p*a*y-r*f*y)*T,n[10]=(l*v*s-g*c*s+g*a*h-r*v*h-l*a*y+r*c*y)*T,n[11]=(p*c*s-l*f*s-p*a*h+r*f*h+l*a*m-r*c*m)*T,n[12]=S*T,n[13]=(p*v*o-g*f*o+g*a*d-r*v*d-p*a*_+r*f*_)*T,n[14]=(g*c*o-l*v*o-g*a*u+r*v*u+l*a*_-r*c*_)*T,n[15]=(l*f*o-p*c*o+p*a*u-r*f*u-l*a*d+r*c*d)*T,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,c=a+a,u=o+o,h=r*l,p=r*c,f=r*u,d=a*c,m=a*u,g=o*u,v=s*l,_=s*c,y=s*u,x=n.x,b=n.y,M=n.z;return i[0]=(1-(d+g))*x,i[1]=(p+y)*x,i[2]=(f-_)*x,i[3]=0,i[4]=(p-y)*b,i[5]=(1-(h+g))*b,i[6]=(m+v)*b,i[7]=0,i[8]=(f+_)*M,i[9]=(m-v)*M,i[10]=(1-(h+d))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:(o=new En,s=new Sn,function(e,t,n){var i=this.elements,r=o.set(i[0],i[1],i[2]).length(),a=o.set(i[4],i[5],i[6]).length(),l=o.set(i[8],i[9],i[10]).length(),c=this.determinant();c<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],s.copy(this);var u=1/r,h=1/a,p=1/l;return s.elements[0]*=u,s.elements[1]*=u,s.elements[2]*=u,s.elements[4]*=h,s.elements[5]*=h,s.elements[6]*=h,s.elements[8]*=p,s.elements[9]*=p,s.elements[10]*=p,t.setFromRotationMatrix(s),n.x=r,n.y=a,n.z=l,this}),makePerspective:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),l=2*r/(n-i),c=(t+e)/(t-e),u=(n+i)/(n-i),h=-(a+r)/(a-r),p=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),l=1/(n-i),c=1/(a-r),u=(t+e)*s,h=(n+i)*l,p=(a+r)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),Object.assign(wn,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,a,o){var s=n[i+0],l=n[i+1],c=n[i+2],u=n[i+3],h=r[a+0],p=r[a+1],f=r[a+2],d=r[a+3];if(u!==d||s!==h||l!==p||c!==f){var m=1-o,g=s*h+l*p+c*f+u*d,v=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){var y=Math.sqrt(_),x=Math.atan2(y,g*v);m=Math.sin(m*x)/y,o=Math.sin(o*x)/y}var b=o*v;if(s=s*m+h*b,l=l*m+p*b,c=c*m+f*b,u=u*m+d*b,m===1-o){var M=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=M,l*=M,c*=M,u*=M}}e[t]=s,e[t+1]=l,e[t+2]=c,e[t+3]=u}}),Object.defineProperties(wn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(wn.prototype,{isQuaternion:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e.x,i=e.y,r=e.z,a=e.order,o=Math.cos,s=Math.sin,l=o(n/2),c=o(i/2),u=o(r/2),h=s(n/2),p=s(i/2),f=s(r/2);return"XYZ"===a?(this._x=h*c*u+l*p*f,this._y=l*p*u-h*c*f,this._z=l*c*f+h*p*u,this._w=l*c*u-h*p*f):"YXZ"===a?(this._x=h*c*u+l*p*f,this._y=l*p*u-h*c*f,this._z=l*c*f-h*p*u,this._w=l*c*u+h*p*f):"ZXY"===a?(this._x=h*c*u-l*p*f,this._y=l*p*u+h*c*f,this._z=l*c*f+h*p*u,this._w=l*c*u-h*p*f):"ZYX"===a?(this._x=h*c*u-l*p*f,this._y=l*p*u+h*c*f,this._z=l*c*f-h*p*u,this._w=l*c*u+h*p*f):"YZX"===a?(this._x=h*c*u+l*p*f,this._y=l*p*u+h*c*f,this._z=l*c*f-h*p*u,this._w=l*c*u-h*p*f):"XZY"===a&&(this._x=h*c*u-l*p*f,this._y=l*p*u-h*c*f,this._z=l*c*f+h*p*u,this._w=l*c*u+h*p*f),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],a=n[8],o=n[1],s=n[5],l=n[9],c=n[2],u=n[6],h=n[10],p=i+s+h;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(u-l)*t,this._y=(a-c)*t,this._z=(o-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(u-l)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(a+c)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(a-c)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(l+u)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(o-r)/t,this._x=(a+c)/t,this._y=(l+u)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new En;return function(n,i){return void 0===t&&(t=new En),(e=n.dot(i)+1)<1e-6?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,i),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(bn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,c=t._w;return this._x=n*c+a*o+i*l-r*s,this._y=i*c+a*s+r*o-n*l,this._z=r*c+a*l+n*s-i*o,this._w=a*c-n*o-i*s-r*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*i+t*this._y,this._z=l*r+t*this._z,this.normalize()}var c=Math.sqrt(s),u=Math.atan2(c,o),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=a*h+this._w*p,this._x=n*h+this._x*p,this._y=i*h+this._y*p,this._z=r*h+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},multiplyFloat3:function(e){var t=new En(-2,2,-2),n=new En(-2,-2,2),i=new En(2,-2,-2),r=new En(this.y,this.x,this.w),a=new En(this.z,this.w,this.x),o=new En(this.w,this.z,this.y),s=t.clone().multiplyScalar(this.y).multiply(r).sub(i.clone().multiplyScalar(this.z).multiply(a)),l=n.clone().multiplyScalar(this.z).multiply(o).sub(t.clone().multiplyScalar(this.x).multiply(r)),c=i.clone().multiplyScalar(this.x).multiply(a).sub(n.clone().multiplyScalar(this.y).multiply(o));return e.clone().add(s.multiply(e.x)).add(l.multiply(e.y).add(c.multiply(e.z)))},inverseMultiplyFloat3:function(e){var t=this.inverse();return t.multiplyFloat3(e)}}),Object.assign(En.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,c=s*n+o*t-r*i,u=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=l*s+h*-r+c*-o-u*-a,this.y=c*s+h*-a+u*-r-l*-o,this.z=u*s+h*-o+l*-a-c*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new Sn;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divideScalar:function(e){return this.multiplyScalar(1/e)},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length()||1)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}}),Object.assign(Tn.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,a,o,s,l){var c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=r,c[5]=s,c[6]=n,c[7]=a,c[8]=l,this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new En;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8];return t*a*c-t*o*l-n*r*c+n*o*s+i*r*l-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],p=n[8],f=p*l-c*h,d=c*u-p*s,m=h*s-l*u,g=r*f+a*d+o*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var _=1/g;return i[0]=f*_,i[1]=(o*h-p*a)*_,i[2]=(c*a-o*l)*_,i[3]=d*_,i[4]=(p*r-o*u)*_,i[5]=(o*s-c*r)*_,i[6]=m*_,i[7]=(a*u-h*r)*_,i[8]=(l*r-a*s)*_,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},setUvTransform:function(e,t,n,i,r,a,o){var s=Math.cos(r),l=Math.sin(r);this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this}});var An={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===a&&(a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),a.width=e.width,a.height=e.height;var n=a.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=a}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Ln=0;function Cn(e,t,n,i,r,a,o,s,l,c){Object.defineProperty(this,"id",{value:Ln++}),this.uuid=bn.generateUUID(),this.name="",this.image=void 0!==e?e:Cn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Cn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:pe,this.wrapT=void 0!==i?i:pe,this.magFilter=void 0!==r?r:ve,this.minFilter=void 0!==a?a:ye,this.anisotropy=void 0!==l?l:1,this.format=void 0!==o?o:Ue,this.type=void 0!==s?s:xe,this.offset=new Mn(0,0),this.repeat=new Mn(1,1),this.center=new Mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Tn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=mt,this.version=0,this.onUpdate=null}function Pn(e,t,n,i,r,a){void 0!==r?(this.xyzw=r,this.offset=a||0,Object.defineProperty(this,"x",{get:function(){return this.xyzw[this.offset]},set:function(e){this.xyzw[this.offset]=e}}),Object.defineProperty(this,"y",{get:function(){return this.xyzw[this.offset+1]},set:function(e){this.xyzw[this.offset+1]=e}}),Object.defineProperty(this,"z",{get:function(){return this.xyzw[this.offset+2]},set:function(e){this.xyzw[this.offset+2]=e}}),Object.defineProperty(this,"w",{get:function(){return this.xyzw[this.offset+3]},set:function(e){this.xyzw[this.offset+3]=e}})):(this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1)}function Rn(e,t,n){this.width=e,this.height=t,this.scissor=new Pn(0,0,e,t),this.scissorTest=!1,this.viewport=new Pn(0,0,e,t),n=n||{},this.texture=new Cn(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:ve,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function In(e,t,n,i,r,a,o,s,l,c,u,h){Cn.call(this,null,a,o,s,l,c,i,r,u,h),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:de,this.minFilter=void 0!==c?c:de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}Cn.DEFAULT_IMAGE=void 0,Cn.DEFAULT_MAPPING=300,Cn.prototype=Object.assign(Object.create(i.prototype),{constructor:Cn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case pe:e.x=e.x<0?0:1;break;case fe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case pe:e.y=e.y<0?0:1;break;case fe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Cn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Pn.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}}),Rn.prototype=Object.assign(Object.create(i.prototype),{constructor:Rn,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),In.prototype=Object.create(Cn.prototype),In.prototype.constructor=In,In.prototype.isDataTexture=!0;var Dn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tvec2 aoMapUv = vUv2 ;\n\tfloat ambientOcclusion = ( texture2D( aoMap, aoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nuniform bool bDoubleSide;",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_textureSize (1024.0)\n\tint getFaceFromDirection(vec3 direction) {\n\t\tvec3 absDirection = abs(direction);\n\t\tint face = -1;\n\t\tif( absDirection.x > absDirection.z ) {\n\t\t\tif(absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t\t}\n\t\telse {\n\t\t\tif(absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t\t}\n\t\treturn face;\n\t}\n\t#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n\t#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\n\tvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\t\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\t\tfloat dxRoughness = dFdx(roughness);\n\t\tfloat dyRoughness = dFdy(roughness);\n\t\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\t\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\t\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\t\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\t\tfloat mipLevel = 0.5 * log2(d);\n\t\treturn vec2(floor(mipLevel), fract(mipLevel));\n\t}\n\t#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n\t#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\n\tvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\t\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\t\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\t\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\t\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\t\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\t\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\t\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\t\tbool bRes = mipLevel == 0.0;\n\t\tscale =  bRes && (scale < a) ? a : scale;\n\t\tvec3 r;\n\t\tvec2 offset;\n\t\tint face = getFaceFromDirection(direction);\n\t\tfloat rcpPowScale = 1.0 / powScale;\n\t\tif( face == 0) {\n\t\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t\t}\n\t\telse if( face == 1) {\n\t\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t\t}\n\t\telse if( face == 2) {\n\t\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t\t}\n\t\telse if( face == 3) {\n\t\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t\t}\n\t\telse if( face == 4) {\n\t\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t\t}\n\t\telse {\n\t\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t\t}\n\t\tr = normalize(r);\n\t\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\t\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\t\tvec2 base = offset + vec2( texelOffset );\n\t\treturn base + s * ( scale - 2.0 * texelOffset );\n\t}\n\t#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\n\tvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\t\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\t\tfloat r1 = floor(roughnessVal);\n\t\tfloat r2 = r1 + 1.0;\n\t\tfloat t = fract(roughnessVal);\n\t\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\t\tfloat s = mipInfo.y;\n\t\tfloat level0 = mipInfo.x;\n\t\tfloat level1 = level0 + 1.0;\n\t\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\t\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\t\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\t\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\t\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\t\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\t\tvec4 result = mix(color10, color20, t);\n\t\treturn vec4(result.rgb, 1.0);\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec2 emissiveMapUv = vUv ;\n\t#ifdef USE_ETC_EMISSIVEMAP\n\t\tvec4 emissiveColor = vec4( texture2D( emissiveMap, emissiveMapUv ).rgb, 1.0 );\n\t\t#ifdef EMISSIVE_MAP_HAS_ETC_ALPHA\n\t\t\temissiveColor.a = texture2D( emissiveMap_etc_alpha, emissiveMapUv ).r;\n\t\t#endif\n\t#else\n\t\tvec4 emissiveColor = texture2D( emissiveMap, emissiveMapUv );\n\t#endif\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n\t#ifdef EMISSIVE_MAP_HAS_ETC_ALPHA\n\t\tuniform sampler2D emissiveMap_etc_alpha;\n\t#endif\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n#ifdef UNITY_PBS\n\tvec3 sRGB = value.rgb;\n\tsRGB =  sRGB * (sRGB * (sRGB * 0.305306011 + 0.682171111) + 0.012522878);\t\n\treturn vec4(sRGB,value.a);\n#else\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n#endif\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n#ifdef UNITY_PBS\n\tvec3 linRGB = value.rgb;\n\tlinRGB = max(linRGB, vec3(0.0, 0.0, 0.0));\n\t vec3 gamma;\n\tgamma.r = 1.055 * pow(linRGB.r, 0.416666667)  - 0.055;\n\tgamma.g = 1.055 * pow(linRGB.g, 0.416666667)  - 0.055;\n\tgamma.b = 1.055 * pow(linRGB.b, 0.416666667)  - 0.055;\n\tgamma = max( gamma,   vec3(0.0, 0.0, 0.0) );\n\treturn vec4(gamma,value.a);\n#else\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n#endif\n}\n// }",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvLightBack = vec3( 0.0 );\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n        if (bDoubleSide) {\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n        }\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n        if (bDoubleSide) {\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n        }\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n        if (bDoubleSide) {\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n        }\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n        if (bDoubleSide) {\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n        }\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n#ifdef PHYSICAL\nif(specular.x > 0.0 || specular.y > 0.0 || specular.z > 0.0){\n material.specularColor = specular;\n}\nelse{\n material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n}\n#else\n material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#else\n#ifdef PHYSICAL\nif(specular.x > 0.0 || specular.y > 0.0 || specular.z > 0.0){\n material.specularColor = specular;\n}\nelse{\n material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n}\n#else\n material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#endif\nmaterial.clearCoat = saturate( clearCoat );\nmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"vec4 unityAlbedoColor = vec4(1.0, 1.0, 1.0, 1.0);\n#ifdef USE_MAP\n\tvec2 mapUv = vUv ;\n    #ifdef USE_MASK_MAP\n        if (deltaHSV.x == 0.0 && deltaHSV.y == 0.0 && deltaHSV.z == 0.0) {\n            unityAlbedoColor = texMap(mapUv);\n        }\n        else {\n            if (texture2D(maskMap, mapUv).r > 0.1) {\n                unityAlbedoColor = applyHSV(texSkin(mapUv));\n            }\n            else {\n                unityAlbedoColor = texMap(mapUv);\n            }\n        }\n    #else\n        unityAlbedoColor = texMap(mapUv);\n    #endif\n\t\n\tdiffuseColor *= unityAlbedoColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n    uniform sampler2D map;\n#ifdef MAP_HAS_ETC_ALPHA\n    uniform sampler2D map_etc_alpha;\n#endif\n    vec4 texMap(in vec2 uv) {\n#ifdef USE_ETC_MAP\n        vec4 texelColor = vec4(texture2D(map, uv).rgb, 1.0);\n    #ifdef MAP_HAS_ETC_ALPHA\n        texelColor.a = texture2D(map_etc_alpha, uv).r;\n    #endif\n#else\n        vec4 texelColor = texture2D(map, uv);\n#endif\n        return mapTexelToLinear(texelColor);\n    }\n#ifdef USE_SKIN_MAP\n    uniform sampler2D skinMap;\n#endif\n#ifdef USE_MASK_MAP\n    uniform sampler2D maskMap;\n    uniform vec3 deltaHSV;\n    vec4 texSkin(in vec2 uv) {\n        #ifdef USE_SKIN_MAP\n            return mapTexelToLinear(texture2D(skinMap, uv));\n        #else\n            return texMap(uv);\n        #endif\n    }\n    vec3 rgb2hsv(vec3 c) {\n        vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n        vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n        float d = q.x - min(q.w, q.y);\n        float e = 0.0001;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n    }\n    vec3 hsv2rgb(vec3 c) {\n        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n    }\n    vec4 applyHSV(vec4 color) {\n        if (deltaHSV.x != 0.0) {\n            vec3 hsv = rgb2hsv(color.rgb);\n            hsv.x += deltaHSV.x;\n            if (hsv.x > 6.0) {\n                hsv.x = hsv.x - 6.0;\n            } else if (hsv.x < 0.0) {\n                hsv.x = hsv.x + 6.0;\n            }\n            color.rgb = hsv2rgb(hsv);\n        }\n        if (deltaHSV.y != 0.0) {\n            float c_max = max(color.r, max(color.g, color.b));\n            float c_min = min(color.r, min(color.g, color.b));\n            float delta = c_max - c_min;\n            if (delta != 0.0) {\n                float v = c_max + c_min;\n                float l = v * 0.5;\n                float s = l < 0.5 ? (delta / v) : ((delta) / (2.0 - v));\n                if (deltaHSV.y >= 0.0) {\n                    float alpha = (deltaHSV.y + s) >= 1.0 ? s : (1.0 - deltaHSV.y);\n                    alpha = 1.0 / alpha - 1.0;\n                    color.rgb = color.rgb + (color.rgb - l) * alpha;\n                }\n                else {\n                    float alpha = deltaHSV.y;\n                    color.rgb = l + (color.rgb - l) * (1.0 + alpha);\n                }\n            }\n        }\n        if (deltaHSV.z != 0.0) {\n            color.rgb = deltaHSV.z > 0.0 ? (color.rgb * (1.0 - deltaHSV.z) + deltaHSV.z) : (color.rgb + color.rgb * deltaHSV.z);\n        }\n        return color;\n    }\n#endif\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\nfloat unityMetalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec2 metalUv = vUv ;\n\t#ifdef USE_ETC_METALNESSMAP\n\t\tvec4 texelMetalness = vec4( texture2D( metalnessMap, metalUv ).rgb, 1.0 );\n\t\t#ifdef METALNESS_MAP_HAS_ETC_ALPHA\n\t\t\ttexelMetalness.a = texture2D( metalnessMap_etc_alpha, metalUv ).r;\n\t\t#endif\n\t#else\n\t\tvec4 texelMetalness = texture2D( metalnessMap, metalUv );\n\t#endif\n\tmetalnessFactor *= texelMetalness.r;\n\tunityMetalnessFactor = texelMetalness.r;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n\t#ifdef METALNESS_MAP_HAS_ETC_ALPHA\n\t\tuniform sampler2D metalnessMap_etc_alpha;\n\t#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\tvec2 normalMapUv = vUv;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, normalMapUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n        if (bDoubleSide) {\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n        }\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, normalMapUv );\n        if (bDoubleSide) {\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n        }\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(normalMapUv));\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( uv.st );\n\t\t\tvec2 st1 = dFdy( uv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = ( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = ( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = ( surf_norm );\n\t\t\tvec3 S_ = normalize(S - dot(N, S) * N);\n\t\t\tvec3 T_ = normalize(T - dot(N, T) * N - dot(S_, T) * S_);\n\t\t\tmat3 tsn = mat3( S_, T_, N );\n\t\t\tvec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tvec2 dHdxy_fwd(vec2 uv) {\n\t\tvec2 dSTdx = dFdx( uv );\n\t\tvec2 dSTdy = dFdy( uv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, uv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, uv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, uv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\nfloat unityRoughness = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec2 roughnessMapUv = vUv ;\n\t#ifdef USE_ETC_ROUGHNESSMAP\n\t\tvec4 texelRoughness = vec4( texture2D( roughnessMap, roughnessMapUv ).rgb, 1.0 );\n\t\t#ifdef ROUGHNESS_MAP_HAS_ETC_ALPHA\n\t\t\ttexelRoughness.a = texture2D( roughnessMap_etc_alpha, roughnessMapUv ).r;\n\t\t#endif\n\t#else\n\t\tvec4 texelRoughness = texture2D( roughnessMap, roughnessMapUv );\n\t#endif\n\troughnessFactor *= texelRoughness.r;\n\tunityRoughness = texelRoughness.r;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n\t\n\t#ifdef ROUGHNESS_MAP_HAS_ETC_ALPHA\n\t\tuniform sampler2D roughnessMap_etc_alpha;\n\t#endif\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength = 1.0;\n#ifdef UNITY_PBS\n\t#ifdef UNITY_COLORSPACE_GAMMA\n\t\tvec4 specularRGBA = vec4(specular.rgb, 1.0);\n\t#else\n\t\tvec4 specularRGBA = GammaToLinear(vec4(specular.rgb,1.0), 1.0);\n\t#endif\n#endif\n#ifdef USE_SPECULARMAP\n\tvec2 specularMapUv = vUv ;\n\t#ifdef USE_ETC_SPECULARSSMAP\n\t\tspecularRGBA = vec4( texture2D( specularMap, specularMapUv ).rgb, 1.0 );\n\t\t#ifdef UNITY_COLORSPACE_GAMMA\n\t\t\tspecularRGBA = GammaToLinear(specularRGBA,1.0);\n\t\t#endif\n\t#else\n\t\t#ifdef UNITY_PBS\n\t\t\tspecularRGBA = texture2D( specularMap, specularMapUv );\n\t\t\t#ifdef UNITY_COLORSPACE_GAMMA\n\t\t\t#else\n\t\t\t\tspecularRGBA = GammaToLinear(specularRGBA,1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n#endif\n#ifdef UNITY_PBS\n\tspecularStrength = SpecularStrength(specularRGBA.rgb);\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_pars_vertex:"\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n// #endif",uv_vertex:"\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n// #endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vLightBack;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n    if (bDoubleSide) {\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n    }\n\telse {\n\t\treflectedLight.directDiffuse = vLightFront;\n    }\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vLightBack;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#ifndef PHYSICAL\n    #define PHYSICAL\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#ifndef PHYSICAL\n    #define PHYSICAL\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",unity_meshphysical_vert:"#ifndef PHYSICAL\n    #define PHYSICAL\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n   \n \nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}",unity_meshphysical_frag:"#ifndef PHYSICAL\n    #define PHYSICAL\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <unity_bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <unity_lights_physical_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <unity_custom_multiworkflow_map_par_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef UNITY_COLORSPACE_GAMMA\n\t#else\n\t\tdiffuseColor = GammaToLinear(diffuseColor,1.0);\n\t#endif\n\t#include <specularmap_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <unity_custom_multiworkflow_map_fragment>\n\t#include <unity_lights_physical_fragment>\n\t#include <unity_lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",unity_bsdfs:"#ifdef UNITY_COLORSPACE_GAMMA\n#define unity_ColorSpaceDielectricSpec vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301)\n#else\n#define unity_ColorSpaceDielectricSpec vec4(0.04, 0.04, 0.04, 1.0 - 0.04)\n#endif\nfloat OneMinusReflectivityFromMetallic(float metallic)\n{\n\tfloat oneMinusDielectricSpec = unity_ColorSpaceDielectricSpec.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\nvec3 DiffuseAndSpecularFromMetallic (vec3 albedo, float metallic, out vec3 specColor, out float oneMinusReflectivity)\n{\n\tspecColor = mix (unity_ColorSpaceDielectricSpec.rgb, albedo, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn albedo * oneMinusReflectivity;\n}\nfloat SpecularStrength(vec3 specular)\n{\n        return max (max (specular.r, specular.g), specular.b);\n}\nvec3 EnergyConservationBetweenDiffuseAndSpecular (vec3 albedo, vec3 specColor, out float oneMinusReflectivity)\n{\n    oneMinusReflectivity = 1.0 - SpecularStrength(specColor);\n        return albedo * oneMinusReflectivity;\n}\nfloat SmoothnessToPerceptualRoughness(float smoothness)\n{\n    return (1.0 - smoothness);\n}\nfloat Pow5 (float x)\n{\n    return x*x * x*x * x;\n}\nfloat Pow4 (float x)\n{\n    return x*x*x*x;\n}\nfloat DisneyDiffuse(float NdotV, float NdotL, float LdotH, float perceptualRoughness)\n{\n    float fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n    float lightScatter   = (1.0 + (fd90 - 1.0) * Pow5(1.0 - NdotL));\n    float viewScatter    = (1.0 + (fd90 - 1.0) * Pow5(1.0 - NdotV));\n    return lightScatter * viewScatter;\n}\nfloat PerceptualRoughnessToRoughness(float perceptualRoughness)\n{\n    return perceptualRoughness * perceptualRoughness;\n}\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n    float lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n    float lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\treturn 0.5/ (lambdaV + lambdaL + 1e-5);\n}\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat UNITY_INV_PI   = 0.31830988618;\n    float a2 = roughness * roughness;\n    float d = (NdotH * a2 - NdotH) * NdotH + 1.0;    return UNITY_INV_PI * a2 / (d * d + 1e-7);}\nvec3 FresnelTerm (vec3 F0, float cosA)\n{\n    float t = Pow5 (1.0- cosA);    return F0 + (1.0-F0) * t;\n}\nfloat lerp(float x,float y,float a)\n{\n\treturn mix(x,y,a);\n}\nvec3 lerp(vec3 x,vec3 y,float a)\n{\n\treturn mix(x,y,a);\n}\nvec3 FresnelLerp (vec3 F0, vec3 F90, float cosA)\n{\n    float t = Pow5(1.0- cosA);    return lerp(F0, F90, t);\n}\nvec3 FresnelLerpFast (vec3 F0, vec3 F90, float cosA)\n{\n    float t = Pow4 (1.0 - cosA);\n    return lerp (F0, F90, t);\n}\nvec3 Unity_SafeNormalize(vec3 inVec)\n{\n    float dp3 = max(0.001, dot(inVec, inVec));\n    return inVec * inversesqrt(dp3);\n}\nvec4 LightColorGammaToLinear( in vec4 value ) {\n\tvec3 sRGB = value.rgb;\n\tsRGB =  sRGB * (sRGB * (sRGB * 0.305306011 + 0.682171111) + 0.012522878);\t\n\treturn vec4(sRGB,value.a);\n}\nvec3 BRDF2_Unity_PBS( const in IncidentLight incidentLight, const in vec3 ambientColor, const in GeometricContext geometry, const in vec3 specularColor,const in vec3 diffColor, const in float smoothness ,const in float oneMinusReflectivity)\n{\n\tvec3 halfDir = Unity_SafeNormalize( incidentLight.direction + geometry.viewDir );\n\tvec3 normal = geometry.normal;\n\tvec3 viewDir = geometry.viewDir;\n\tvec3 lightDir = incidentLight.direction;\n\tfloat nl = saturate(dot(normal, lightDir));\n    float nh = saturate(dot(normal, halfDir));\n\tfloat nv = saturate(dot(normal, viewDir));    float lh = saturate(dot(lightDir, halfDir));\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness (smoothness);\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat a = roughness;\n    float a2 = a*a;\n\tfloat d = nh * nh * (a2 - 1.0) + 1.00001;\n#ifdef UNITY_COLORSPACE_GAMMA\n    float specularTerm = a / (max(0.32, lh) * (1.50 + roughness) * d);\n#else\n    float specularTerm = a2 / (max(0.1, lh*lh) * (roughness + 0.5) * (d * d) * 4.0);\n#endif\n#ifdef UNITY_COLORSPACE_GAMMA\n\tfloat surfaceReduction = 0.28;\n#else\n\tfloat surfaceReduction = (0.6-0.08*perceptualRoughness);\n#endif\n\tvec3 gidiffuse = ambientColor;\n\tvec3 gispecular = vec3(0.0,0.0,0.0);\n\tvec3 lightcolor = incidentLight.color;\n\tvec3 specColor = specularColor;\n#ifndef UNITY_COLORSPACE_GAMMA\n\tlightcolor = LightColorGammaToLinear( vec4(lightcolor,1.0)).rgb;\n#endif\n\tsurfaceReduction = 1.0 - roughness*perceptualRoughness*surfaceReduction;\n\tfloat grazingTerm = saturate(smoothness + (1.0-oneMinusReflectivity));\n\tvec3 color = (diffColor + specularTerm * specColor) * lightcolor * nl \n\t + gidiffuse * diffColor \n\t + gispecular * surfaceReduction *  FresnelLerpFast (specColor, vec3(grazingTerm,0.0,0.0), nv);\n\t \n\treturn color;\n}\nvec3 BRDF1_Unity_PBS( const in IncidentLight incidentLight, const in vec3 ambientColor,const in GeometricContext geometry, const in vec3 specularColor,const in vec3 diffColor, const in float smoothness ,const in float oneMinusReflectivity)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness (smoothness);\n\tvec3 halfDir = Unity_SafeNormalize( incidentLight.direction + geometry.viewDir );\n\tvec3 normal = geometry.normal;\n\tvec3 viewDir = geometry.viewDir;\n\tvec3 lightDir = incidentLight.direction;\n    float nv = abs(dot(normal, viewDir));\n\tfloat nl = saturate(dot(normal, lightDir));\n    float nh = saturate(dot(normal, halfDir));\n    float lv = saturate(dot(lightDir, viewDir));\n    float lh = saturate(dot(lightDir, halfDir));\n    float diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n    roughness = max(roughness, 0.002);\n    float V = SmithJointGGXVisibilityTerm (nl, nv, roughness);\n\tfloat D = GGXTerm (nh, roughness);\n\tfloat specularTerm = V*D * PI;\n#ifdef UNITY_COLORSPACE_GAMMA\n    specularTerm = sqrt(max(1e-4, specularTerm));\n#endif\n\tspecularTerm = max(0.0, specularTerm * nl);\n\tfloat surfaceReduction;\n#ifdef UNITY_COLORSPACE_GAMMA\n \tsurfaceReduction = 1.0-0.28*roughness*perceptualRoughness;\n#else\n\tsurfaceReduction = 1.0 / (roughness*roughness + 1.0);\n#endif\n\tif(specularColor.x > 0.0 || specularColor.y > 0.0 || specularColor.z > 0.0)\n\t{\n\t\tspecularTerm *= 1.0;\n\t}else{\n\t\tspecularTerm *= 0.0;\n\t}\n\tfloat grazingTerm = saturate(smoothness + (1.0-oneMinusReflectivity));\n\tvec3 gidiffuse = ambientColor;\n\tvec3 gispecular = vec3(0.0,0.0,0.0);\n\tvec3  lightcolor = incidentLight.color;\n\tvec3 specColor = specularColor;\n#ifndef UNITY_COLORSPACE_GAMMA\n\tlightcolor = LightColorGammaToLinear( vec4(lightcolor,1.0)).rgb;\n#endif\n\tvec3 color =   diffColor * (gidiffuse + lightcolor * diffuseTerm)\n\t+  lightcolor * specularTerm *FresnelTerm (specColor, lh)\n\t+ gispecular * surfaceReduction *  FresnelLerp (specColor, vec3(grazingTerm,0.0,0.0), nv);\n\treturn color;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 Unity_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float smoothness )\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness (smoothness);\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tvec3 normal = geometry.normal;\n\tvec3 viewDir = geometry.viewDir;\n\tvec3 lightDir = incidentLight.direction;\n    float nv = abs(dot(normal, viewDir));\n\tfloat nl = saturate(dot(normal, lightDir));\n    float nh = saturate(dot(normal, halfDir));\n    float lv = saturate(dot(lightDir, viewDir));\n    float lh = saturate(dot(lightDir, halfDir));\n    float diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n    roughness = max(roughness, 0.002);\n    float V = SmithJointGGXVisibilityTerm (nl, nv, roughness);\n\tfloat D = GGXTerm (nh, roughness);\n\tfloat UNITY_PI = 3.14159265359;\n\tfloat specularTerm = V*D * UNITY_PI;\n\tspecularTerm = max(0.0, specularTerm * nl);\n\tfloat surfaceReduction;\n\tsurfaceReduction = 1.0 / (roughness*roughness + 1.0);\n\tif(specularColor.x > 0.0 || specularColor.y > 0.0 || specularColor.z > 0.0)\n\t{\n\t\tspecularTerm *= 1.0;\n\t}else{\n\t\tspecularTerm *= 0.0;\n\t}\n\tfloat oneMinusReflectivity = 0.0;\n\tfloat grazingTerm = saturate(smoothness + (1.0-oneMinusReflectivity));\n\tvec3 gidiffuse = vec3(0.0,0.0,0.0);\n\tvec3 gispecular = vec3(0.0,0.0,0.0);\n\tvec3  diffColor = vec3(1.0,0.0,0.0);\n\tvec3  lightcolor = incidentLight.color;\n\tvec3 specColor = specularColor;\n\tvec3 color =   diffColor * (gidiffuse + lightcolor * diffuseTerm)\n\t+  lightcolor * specularTerm *FresnelTerm (specColor, lh)\n\t+ gispecular * surfaceReduction *  FresnelLerp (specColor, vec3(grazingTerm,0.0,0.0), nv);\n\treturn color;\n}\nvec3 Unity_BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float smoothness ) {\n\treturn Unity_Specular_GGX(incidentLight,geometry, specularColor,smoothness );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",unity_lights_physical_pars_fragment:"struct UnityPhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat oneMinusReflectivity;\n\tfloat smoothness;\n\tfloat metallic;\n};\nvoid Unity_RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in UnityPhysicalMaterial material, inout ReflectedLight reflectedLight )\n{\n}\nstruct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * Unity_BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * Unity_BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",unity_lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\treflectedLight.directSpecular +=  BRDF2_Unity_PBS( directLight,ambientLightColor, geometry, unityMaterial.specularColor, unityMaterial.diffuseColor,unityMaterial.smoothness ,unityMaterial.oneMinusReflectivity );\n\t#ifdef USE_EMISSIVEMAP\n\t\treflectedLight.directDiffuse += emissiveColor.rgb;\n\t#endif\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",unity_lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n    #ifdef PHYSICAL\n        if(specularRGBA.x > 0.0 || specularRGBA.y > 0.0 || specularRGBA.z > 0.0){\n            material.specularColor = specularRGBA.rgb;\n        }\n        else{\n            material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n        }\n    #else\n        material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n    #endif\n#else\n    #ifdef PHYSICAL\n        if(specularRGBA.x > 0.0 || specularRGBA.y > 0.0 || specularRGBA.z > 0.0){\n            material.specularColor = specularRGBA.rgb;\n        }\n        else{\n            material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n        }\n    #else\n        material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n    #endif\n#endif\n#ifdef PHYSICAL\n    #ifdef UNITY_PBS\n        UnityPhysicalMaterial unityMaterial;\n        if(setup_type == 0)\n        {            unityMaterial.smoothness = 1.0 - unityRoughness;\n            float oneMinusReflectivity;\n            float metallic = unityMetalnessFactor;\n            vec3 specColor;\n            unityMaterial.diffuseColor = DiffuseAndSpecularFromMetallic(diffuseColor.rgb, metallic, specColor, oneMinusReflectivity);\n            unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;\n            unityMaterial.specularColor = specColor;\n        }\n        if(setup_type == 1)\n        {            float oneMinusReflectivity;\n            float metallic = unityMetalnessFactor;\n            #ifdef USE_METALNESSMAP\n                if( smoothnessTextureChannel == 0){\n                    unityMaterial.smoothness = smoothnessScale * unityMetalnessFactor;\n                }\n                else\n                {\n                    unityMaterial.smoothness = smoothnessScale *  unityAlbedoColor.a;\n                }\n            #else\n                if( smoothnessTextureChannel == 0){\n                    unityMaterial.smoothness = unityRoughness;\n                }\n                else\n                {\n                    unityMaterial.smoothness = smoothnessScale *  unityAlbedoColor.a;\n                }\n            #endif\n            vec3 specColor;\n            unityMaterial.diffuseColor = DiffuseAndSpecularFromMetallic(diffuseColor.rgb, metallic, specColor, oneMinusReflectivity);\n            unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;\n            unityMaterial.specularColor = specColor;\n        }\n        if(setup_type == 2)\n        {   \n            float oneMinusReflectivity;\n            #ifdef USE_SPECULARMAP\n                if( smoothnessTextureChannel == 0){\n                    unityMaterial.smoothness = smoothnessScale * specularRGBA.a;\n                }\n                else\n                {\n                    unityMaterial.smoothness = smoothnessScale * unityAlbedoColor.a;\n                }\n            #else\n                if( smoothnessTextureChannel == 0){\n                    unityMaterial.smoothness = unityRoughness ;\n                }\n                else\n                {\n                    unityMaterial.smoothness = smoothnessScale * unityAlbedoColor.a;\n                }\n            #endif\n            if (otherPartWorkflow > 0.0) {\n                float workflowMask = 0.0;\n                #ifdef USE_MASK_MAP\n                    vec2 maskUv = vUv ;\n                    workflowMask = texture2D(maskMap, maskUv).r;\n                #endif\n                if (workflowMask > 0.0) {\n                    vec3 specColor = specularRGBA.rgb;\n                    unityMaterial.diffuseColor = EnergyConservationBetweenDiffuseAndSpecular(diffuseColor.rgb, specColor, oneMinusReflectivity);\n                    unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;          \n                    unityMaterial.specularColor = specColor;\n                }\n                else {\n                    if (otherPartWorkflow > 2.0) {                        vec3 specColor = m_specular.rgb;\n                        unityMaterial.diffuseColor = EnergyConservationBetweenDiffuseAndSpecular(diffuseColor.rgb, specColor, oneMinusReflectivity);\n                        unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;          \n                        unityMaterial.specularColor = specColor;\n                        unityMaterial.smoothness = m_specularSmoothness;                            \n                    }\n                    else if (otherPartWorkflow > 1.0) {                        float oneMinusReflectivity;\n                        float metallic = m_standardMetallic;\n                        vec3 specColor;\n                        unityMaterial.diffuseColor = DiffuseAndSpecularFromMetallic(diffuseColor.rgb, metallic, specColor, oneMinusReflectivity);\n                        unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;\n                        unityMaterial.specularColor = specColor;\n                        unityMaterial.smoothness = m_standardSmoothness;\n                    }\n                    else {                        float oneMinusReflectivity;\n                        vec3 specColor;\n                        unityMaterial.diffuseColor = DiffuseAndSpecularFromMetallic(diffuseColor.rgb, m_standardMetallic, specColor, oneMinusReflectivity);\n                        unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;\n                        unityMaterial.specularColor = specColor;\n                        unityMaterial.smoothness = 1.0 - m_autodeskRoughness;\n                    }\n                }\n            }\n            else {\n                vec3 specColor = specularRGBA.rgb;\n                unityMaterial.diffuseColor = EnergyConservationBetweenDiffuseAndSpecular(diffuseColor.rgb, specColor, oneMinusReflectivity);\n                unityMaterial.oneMinusReflectivity =  oneMinusReflectivity;          \n                unityMaterial.specularColor = specColor;\n            }\n        }\n    #endif\n#endif",unity_meshskybox_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float exposure;\nuniform vec3 tintColor;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t\n#ifdef UNITY_COLORSPACE_GAMMA\n\tvec3 doubleColor = vec3(2.0, 2.0, 2.0);\n#else \n\tvec3 doubleColor = vec3(4.59479380, 4.59479380, 4.59479380);\n#endif\n\tvec3 c = texelColor.rgb * tintColor * doubleColor;  \n\tc = c * exposure;\n\tgl_FragColor = vec4( c, 1.0 );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",unity_custom_multiworkflow_map_par_fragment:"uniform float otherPartWorkflow;\n#ifdef  UNITY_CUSTOM_AUTODESK_SPEC_GLOSS_MAP\n    uniform sampler2D autodeskSpecGlossMap;\n#else\n    uniform float autodeskGlossiness;\n#endif\n#ifdef  UNITY_CUSTOM_AUTODESK_METALLIC_GLOSS_MAP\n    uniform sampler2D autodeskMetallicGlossMap;\n#else\n    uniform float autodeskMetallic;\n#endif\nuniform float customStandardGlossMapScale;\nuniform float customStandardSmoothnessTextureChannel;\n#ifdef UNITY_CUSTOM_STANDARD_METALLIC_GLOSS_MAP\n    uniform sampler2D customStandardMetallicGlossMap;\n#else\n    uniform float customStandardMetallic;\n    uniform float customStandardGlossiness;\n#endif\nuniform float customSpecularGlossMapScale;\nuniform float customSpecularSmoothnessTextureChannel;\n#ifdef UNITY_CUSTOM_SPECULAR_GLOSS_MAP\n    uniform sampler2D customSpecularGlossMap;\n#else\n    uniform vec3 customSpecularColor;\n    uniform float customSpecularGlossiness;\n#endif",unity_custom_multiworkflow_map_fragment:"float m_autodeskMetallic = 0.0;\nfloat m_autodeskRoughness = 0.0;\nfloat m_standardMetallic = 0.0;\nfloat m_standardSmoothness = 0.0;\nvec3 m_specular = vec3( 0.0,0.0,0.0);\nfloat m_specularSmoothness = 0.0;\nif (otherPartWorkflow > 0.0) {\n#ifdef  UNITY_CUSTOM_AUTODESK_METALLIC_GLOSS_MAP\n    m_autodeskMetallic = texture2D( autodeskMetallicGlossMap, vUv ).r;\n#else\n    m_autodeskMetallic = autodeskMetallic;\n#endif\n#ifdef  UNITY_CUSTOM_AUTODESK_SPEC_GLOSS_MAP\n    m_autodeskRoughness = 1.0 - texture2D(autodeskSpecGlossMap,vUv).r;\n#else\n    m_autodeskRoughness = 1.0 - autodeskGlossiness;\n#endif\n#ifdef UNITY_CUSTOM_STANDARD_METALLIC_GLOSS_MAP\n    vec4 csTmpColor = texture2D(customStandardMetallicGlossMap, vUv);\n    m_standardMetallic = csTmpColor.r;\n    if(customStandardSmoothnessTextureChannel > 0.0) {\n        m_standardSmoothness = unityAlbedoColor.a;\n    }\n    else {\n        m_standardSmoothness = csTmpColor.g;\n    }\n    m_standardSmoothness *= customStandardGlossMapScale;\n#else\n    m_standardMetallic = customStandardMetallic;\n    if(customStandardSmoothnessTextureChannel > 0.0) {\n        m_standardSmoothness = unityAlbedoColor.a * customStandardGlossMapScale;\n    }\n    else {\n        m_standardSmoothness = customStandardGlossiness;\n    }\n#endif\n#ifdef UNITY_CUSTOM_SPECULAR_GLOSS_MAP\n    vec4 tmpSpecColor = texture2D(customSpecularGlossMap, vUv);\n    m_specular = tmpSpecColor.rgb;\n    if (customSpecularSmoothnessTextureChannel > 0.0) {\n        m_specularSmoothness = unityAlbedoColor.a;\n    }\n    else {\n        m_specularSmoothness = tmpSpecColor.a;\n    }\n    #ifdef UNITY_COLORSPACE_GAMMA\n    #else\n        m_specular = GammaToLinear(vec4(m_specular, 1.0), 1.0).rgb;\n    #endif\n    m_specularSmoothness = m_specularSmoothness * customSpecularGlossMapScale;\n#else\n    \n    #ifdef UNITY_COLORSPACE_GAMMA\n        m_specular = customSpecularColor.rgb;\n\t#else\n        m_specular = GammaToLinear(vec4(customSpecularColor.rgb, 1.0), 1.0).rgb;\n    #endif\n    if (customSpecularSmoothnessTextureChannel > 0.0) {\n        m_specularSmoothness = unityAlbedoColor.a * customSpecularGlossMapScale;\n    }\n    else {\n        m_specularSmoothness = customSpecularGlossiness;\n    }\n#endif\n}"};function Un(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function On(e){for(var t={},n=0;n<e.length;n++){var i=Un(e[n]);for(var r in i)t[r]=i[r]}return t}var Bn,Nn,Fn={clone:Un,merge:On};function Gn(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}Object.assign(Gn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,l=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,l)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var c=n[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}if(e&&e.length>0){var c=ColorKeywords[e];void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:(Bn={h:0,s:0,l:0},Nn={h:0,s:0,l:0},function(e,t){this.getHSL(Bn),e.getHSL(Nn);var n=bn.lerp(Bn.h,Nn.h,t),i=bn.lerp(Bn.s,Nn.s,t),r=bn.lerp(Bn.l,Nn.l,t);return this.setHSL(n,i,r),this}),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var kn,Hn,Vn,zn,jn={common:{bDoubleSide:{value:!1},diffuse:{value:new Gn(15658734)},opacity:{value:1},map:{value:null},map_etc_alpha:{value:null},uvTransform:{value:new Tn},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null},emissiveMap_etc_alpha:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Mn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null},roughnessMap_etc_alpha:{value:null}},metalnessmap:{metalnessMap:{value:null},metalnessMap_etc_alpha:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Gn(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Gn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Tn}},sprite:{diffuse:{value:new Gn(15658734)},opacity:{value:1},center:{value:new Mn(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new Tn}},unitySkin:{deltaHSV:{value:new En},skinMap:{value:null},maskMap:{value:null}},unityCustomMultiWorkflow:{otherPartWorkflow:{value:0},autodeskGlossiness:{value:0},autodeskSpecGlossMap:{value:null},autodeskMetallic:{value:0},autodeskMetallicGlossMap:{value:null},customStandardGlossiness:{value:0},customStandardGlossMapScale:{value:0},customStandardMetallic:{value:0},customStandardMetallicGlossMap:{value:null},customStandardSmoothnessTextureChannel:{value:0},customSpecularGlossiness:{value:0},customSpecularGlossMapScale:{value:0},customSpecularSmoothnessTextureChannel:{value:0},customSpecularColor:{value:new Gn(0)},customSpecularGlossMap:{value:null}}},Wn={basic:{uniforms:On([jn.common,jn.specularmap,jn.envmap,jn.aomap,jn.lightmap,jn.fog]),vertexShader:Dn.meshbasic_vert,fragmentShader:Dn.meshbasic_frag},lambert:{uniforms:On([jn.common,jn.specularmap,jn.envmap,jn.aomap,jn.lightmap,jn.emissivemap,jn.fog,jn.lights,{emissive:{value:new Gn(0)}}]),vertexShader:Dn.meshlambert_vert,fragmentShader:Dn.meshlambert_frag},phong:{uniforms:On([jn.common,jn.specularmap,jn.envmap,jn.aomap,jn.lightmap,jn.emissivemap,jn.bumpmap,jn.normalmap,jn.displacementmap,jn.gradientmap,jn.fog,jn.lights,{emissive:{value:new Gn(0)},specular:{value:new Gn(1118481)},shininess:{value:30}}]),vertexShader:Dn.meshphong_vert,fragmentShader:Dn.meshphong_frag},standard:{uniforms:On([jn.common,jn.envmap,jn.aomap,jn.lightmap,jn.emissivemap,jn.bumpmap,jn.normalmap,jn.displacementmap,jn.roughnessmap,jn.metalnessmap,jn.fog,jn.lights,{emissive:{value:new Gn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Dn.meshphysical_vert,fragmentShader:Dn.meshphysical_frag},matcap:{uniforms:On([jn.common,jn.bumpmap,jn.normalmap,jn.displacementmap,jn.fog,{matcap:{value:null}}]),vertexShader:Dn.meshmatcap_vert,fragmentShader:Dn.meshmatcap_frag},points:{uniforms:On([jn.points,jn.fog]),vertexShader:Dn.points_vert,fragmentShader:Dn.points_frag},dashed:{uniforms:On([jn.common,jn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Dn.linedashed_vert,fragmentShader:Dn.linedashed_frag},depth:{uniforms:On([jn.common,jn.displacementmap]),vertexShader:Dn.depth_vert,fragmentShader:Dn.depth_frag},normal:{uniforms:On([jn.common,jn.bumpmap,jn.normalmap,jn.displacementmap,{opacity:{value:1}}]),vertexShader:Dn.normal_vert,fragmentShader:Dn.normal_frag},sprite:{uniforms:On([jn.sprite,jn.fog]),vertexShader:Dn.sprite_vert,fragmentShader:Dn.sprite_frag},background:{uniforms:{uvTransform:{value:new Tn},t2D:{value:null}},vertexShader:Dn.background_vert,fragmentShader:Dn.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Dn.cube_vert,fragmentShader:Dn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Dn.equirect_vert,fragmentShader:Dn.equirect_frag},distanceRGBA:{uniforms:On([jn.common,jn.displacementmap,{referencePosition:{value:new En},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Dn.distanceRGBA_vert,fragmentShader:Dn.distanceRGBA_frag},shadow:{uniforms:On([jn.lights,jn.fog,{color:{value:new Gn(0)},opacity:{value:1}}]),vertexShader:Dn.shadow_vert,fragmentShader:Dn.shadow_frag}};function Xn(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);var i=t.get(n);i&&(e.deleteBuffer(i.buffer),t.delete(n))},update:function(n,i){if(!0!==n.cpuSkinning){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);void 0===r?t.set(n,function(t,n){var i=t.array,r=t.dynamic?35048:35044,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,i,r),t.dynamic||(t.array=void 0),t.onUploadCallback();var o=5126;return i instanceof Float32Array?o=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=5123:i instanceof Int16Array?o=5122:i instanceof Uint32Array?o=5125:i instanceof Int32Array?o=5124:i instanceof Int8Array?o=5120:i instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(n,i)):r.version<n.version&&(function(t,n,i){var r=n.array,a=n.updateRange;e.bindBuffer(i,t),!1===n.dynamic?e.bufferData(i,r,35044):-1===a.count?e.bufferSubData(i,0,r):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,n,i),r.version=n.version)}}}}function Yn(e,t,n,i,r,a){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new En,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new Gn,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}function qn(e,t){this.min=void 0!==e?e:new En(1/0,1/0,1/0),this.max=void 0!==t?t:new En(-1/0,-1/0,-1/0)}function Kn(e,t){this.center=void 0!==e?e:new En,this.radius=void 0!==t?t:0}function Zn(e,t,n,i,r,a){void 0!==r?(this.xyz=r,this.offset=a||0,Object.defineProperty(this,"x",{get:function(){return this.xyz[this.offset]},set:function(e){this.xyz[this.offset]=e,this.onChangeCallback()}}),Object.defineProperty(this,"y",{get:function(){return this.xyz[this.offset+1]},set:function(e){this.xyz[this.offset+1]=e,this.onChangeCallback()}}),Object.defineProperty(this,"z",{get:function(){return this.xyz[this.offset+2]},set:function(e){this.xyz[this.offset+2]=e,this.onChangeCallback()}}),Object.defineProperty(this,"_x",{get:function(){return this.xyz[this.offset]},set:function(e){this.xyz[this.offset]=e}}),Object.defineProperty(this,"_y",{get:function(){return this.xyz[this.offset+1]},set:function(e){this.xyz[this.offset+1]=e}}),Object.defineProperty(this,"_z",{get:function(){return this.xyz[this.offset+2]},set:function(e){this.xyz[this.offset+2]=e}})):(this._x=e||0,this._y=t||0,this._z=n||0,Object.defineProperty(this,"x",{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}}),Object.defineProperty(this,"y",{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}}),Object.defineProperty(this,"z",{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}})),this._order=i||Zn.DefaultOrder,Object.defineProperty(this,"order",{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}})}function Qn(){this.mask=1}Wn.physical={uniforms:On([Wn.standard.uniforms,{specular:{value:new Gn(0)},clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Dn.meshphysical_vert,fragmentShader:Dn.meshphysical_frag},Wn.physicalCPUSkinning={uniforms:On([Wn.standard.uniforms,{specular:{value:new Gn(0)},clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Dn.meshphysical_vert,fragmentShader:Dn.meshphysical_frag},Wn.unityPBS={uniforms:On([Wn.standard.uniforms,{specular:{value:new Gn(0)},specularMap:{value:null},smoothnessTextureChannel:{value:0},setup_type:{value:0},smoothnessScale:{value:1}}]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBS_etc={uniforms:On([Wn.standard.uniforms,{specular:{value:new Gn(0)},specularMap:{value:null},smoothnessTextureChannel:{value:0},setup_type:{value:0},smoothnessScale:{value:1}}]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBSSkin={uniforms:On([Wn.unityPBS.uniforms,jn.unitySkin,jn.unityCustomMultiWorkflow]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBSSkin_png_gpu_skinning={uniforms:On([Wn.unityPBS.uniforms,jn.unitySkin,jn.unityCustomMultiWorkflow]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBSSkin_etc_gpu_skinning={uniforms:On([Wn.unityPBS.uniforms,jn.unitySkin,jn.unityCustomMultiWorkflow]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBSSkin_png_cpu_skinning={uniforms:On([Wn.unityPBS.uniforms,jn.unitySkin,jn.unityCustomMultiWorkflow]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unityPBSSkin_etc_cpu_skinning={uniforms:On([Wn.unityPBS.uniforms,jn.unitySkin,jn.unityCustomMultiWorkflow]),vertexShader:Dn.unity_meshphysical_vert,fragmentShader:Dn.unity_meshphysical_frag},Wn.unitySkybox={uniforms:On([Wn.basic.uniforms,{tintColor:{value:new Gn(8355711)},exposure:{value:1},rotation:{value:0}}]),vertexShader:Dn.meshbasic_vert,fragmentShader:Dn.unity_meshskybox_frag},Wn.unitySkybox_etc={uniforms:On([Wn.basic.uniforms,{tintColor:{value:new Gn(8355711)},exposure:{value:1},rotation:{value:0}}]),vertexShader:Dn.meshbasic_vert,fragmentShader:Dn.unity_meshskybox_frag},Object.assign(Yn.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),Object.assign(qn.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var c=e[s],u=e[s+1],h=e[s+2];c<t&&(t=c),u<n&&(n=u),h<i&&(i=h),c>r&&(r=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var c=e.getX(s),u=e.getY(s),h=e.getZ(s);c<t&&(t=c),u<n&&(n=u),h<i&&(i=h),c>r&&(r=c),u>a&&(a=u),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new En;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new En),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new En),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,n,i=new En;function r(r){var a=r.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(t=0,n=o.length;t<n;t++)i.copy(o[t]),i.applyMatrix4(r.matrixWorld),e.expandByPoint(i)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(t=0,n=s.count;t<n;t++)i.fromBufferAttribute(s,t).applyMatrix4(r.matrixWorld),e.expandByPoint(i)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(r),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new En),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(zn=new En,function(e){return this.clampPoint(e.center,zn),zn.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(){var e=new En,t=new En,n=new En,i=new En,r=new En,a=new En,o=new En,s=new En,l=new En,c=new En;function u(i){var r,a;for(r=0,a=i.length-3;r<=a;r+=3){o.fromArray(i,r);var s=l.x*Math.abs(o.x)+l.y*Math.abs(o.y)+l.z*Math.abs(o.z),c=e.dot(o),u=t.dot(o),h=n.dot(o);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}return function(o){if(this.isEmpty())return!1;this.getCenter(s),l.subVectors(this.max,s),e.subVectors(o.a,s),t.subVectors(o.b,s),n.subVectors(o.c,s),i.subVectors(t,e),r.subVectors(n,t),a.subVectors(e,n);var h=[0,-i.z,i.y,0,-r.z,r.y,0,-a.z,a.y,i.z,0,-i.x,r.z,0,-r.x,a.z,0,-a.x,-i.y,i.x,0,-r.y,r.x,0,-a.y,a.x,0];return!!u(h)&&!!u(h=[1,0,0,0,1,0,0,0,1])&&(c.crossVectors(i,r),u(h=[c.x,c.y,c.z]))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new En),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new En;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new En;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Kn),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(Vn=[new En,new En,new En,new En,new En,new En,new En,new En],function(e){return this.isEmpty()?this:(Vn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Vn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Vn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Vn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Vn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Vn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Vn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Vn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Vn),this)}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Kn.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(Hn=new qn,function(e,t){var n=this.center;void 0!==t?n.copy(t):Hn.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new En),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new qn),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Zn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Zn.DefaultOrder="XYZ",Object.assign(Zn.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=bn.clamp,r=e.elements,a=r[0],o=r[4],s=r[8],l=r[1],c=r[5],u=r[9],h=r[2],p=r[6],f=r[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(p,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,a))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(p,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Sn;return function(t,n,i){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(kn=new wn,function(e){return kn.setFromEuler(this),this.setFromQuaternion(kn,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new En(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Qn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var Jn=0;function $n(){var e,t,n,i;Object.defineProperty(this,"id",{value:Jn++}),this.uuid=bn.generateUUID(),this.type="Object3D",this.parent=null,this.children=[],this.up=$n.DefaultUp.clone(),this._name="",Object.defineProperty(this,"name",{get:function(){return this._name},set:function(e){this._name=e,void 0!==this._native_object3d&&this._native_object3d.setName(e)}}),this.matrix=new Sn,this.matrixWorld=new Sn,void 0===this._native_object3d&&(this._bufferInt32=new Int32Array([0,1]),this._bufferFloat32=new Float32Array([0,0,0,0,0,0,0,0,0,1,1,1,1]),this._native_object3d=new BK.TObject3D(this._bufferInt32,this._bufferFloat32)),this._native_object3d.setUUID(this.uuid),this._native_object3d.setMatrix(this.matrix.elements,this.matrixWorld.elements),e=new En(void 0,void 0,void 0,this._bufferFloat32,0),t=new Zn(void 0,void 0,void 0,void 0,this._bufferFloat32,3),n=new wn(void 0,void 0,void 0,void 0,this._bufferFloat32,6),i=new En(void 0,void 0,void 0,this._bufferFloat32,10),t.onChange(function(){n.setFromEuler(t,!1)}),n.onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Sn},normalMatrix:{value:new Tn}}),this.matrixAutoUpdate=$n.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Qn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}$n.DefaultUp=new En(0,1,0),$n.DefaultMatrixAutoUpdate=!0;var ei,ti,ni,ii,ri={constructor:$n,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},updateSelf:function(e){this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)},update:function(e){this._native_object3d.update(e)},enableDynamicBone:function(e,t){},disableDynamicBone:function(e){},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(ii=new wn,function(e,t){return ii.setFromAxisAngle(e,t),this.quaternion.multiply(ii),this}),rotateOnWorldAxis:function(){var e=new wn;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new En(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new En(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new En(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new En;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new En(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new En(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new En(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(ni=new Sn,function(e){return e.applyMatrix4(ni.getInverse(this.matrixWorld))}),lookAt:function(){var e=new wn,t=new Sn,n=new En,i=new En;return function(r,a,o){r.isVector3?n.copy(r):n.set(r,a,o);var s=this.parent;this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(i,n,this.up):t.lookAt(n,i,this.up),this.quaternion.setFromRotationMatrix(t),s&&(t.extractRotation(s.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e),this._native_object3d.add(e._native_object3d)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1),this._native_object3d.remove(e._native_object3d)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n],a=r.getObjectByProperty(e,t);if(void 0!==a)return a}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new En),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(ei=new En,ti=new En,function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new wn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ei,e,ti),e}),getWorldScale:function(){var e=new En,t=new wn;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new En),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new En),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this._native_object3d.updateMatrix()},updateMatrixWorld:function(e){this._native_object3d.updateMatrixWorld(e)},updateWorldMatrix:function(e,t){this._native_object3d.updateWorldMatrix(e,t)},clone:function(e){throw new TypeError("native not support Object3D clone")},copy:function(e,t){throw new TypeError("native not support Object3D copy")}};$n.prototype=Object.assign(Object.create(i.prototype),ri);var ai,oi,si=0;function li(){Object.defineProperty(this,"id",{value:si+=2}),this.uuid=bn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function ci(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function ui(e,t,n){ci.call(this,new Int8Array(e),t,n)}function hi(e,t,n){ci.call(this,new Uint8Array(e),t,n)}function pi(e,t,n){ci.call(this,new Uint8ClampedArray(e),t,n)}function fi(e,t,n){ci.call(this,new Int16Array(e),t,n)}function di(e,t,n){ci.call(this,new Uint16Array(e),t,n)}function mi(e,t,n){ci.call(this,new Int32Array(e),t,n)}function gi(e,t,n){ci.call(this,new Uint32Array(e),t,n)}function vi(e,t,n){ci.call(this,new Float32Array(e),t,n)}function _i(e,t,n){ci.call(this,new Float64Array(e),t,n)}function yi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function xi(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}li.prototype=Object.assign(Object.create(i.prototype),{constructor:li,isGeometry:!0,applyMatrix:function(e){for(var t=(new Tn).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){var r=this.vertices[n];r.applyMatrix4(e)}for(var n=0,i=this.faces.length;n<i;n++){var a=this.faces[n];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Sn;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Sn;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Sn;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Sn;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new Sn;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:(oi=new $n,function(e){oi.lookAt(e),oi.updateMatrix(),this.applyMatrix(oi.matrix)}),fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,i=e.attributes,r=i.position.array,a=void 0!==i.normal?i.normal.array:void 0,o=void 0!==i.color?i.color.array:void 0,s=void 0!==i.uv?i.uv.array:void 0,l=void 0!==i.uv2?i.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0,u=0;c<r.length;c+=3,u+=2)t.vertices.push((new En).fromArray(r,c)),void 0!==o&&t.colors.push((new Gn).fromArray(o,c));function h(e,n,i,r){var c=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[i].clone()],u=void 0===a?[]:[(new En).fromArray(a,3*e),(new En).fromArray(a,3*n),(new En).fromArray(a,3*i)],h=new Yn(e,n,i,u,c,r);t.faces.push(h),void 0!==s&&t.faceVertexUvs[0].push([(new Mn).fromArray(s,2*e),(new Mn).fromArray(s,2*n),(new Mn).fromArray(s,2*i)]),void 0!==l&&t.faceVertexUvs[1].push([(new Mn).fromArray(l,2*e),(new Mn).fromArray(l,2*n),(new Mn).fromArray(l,2*i)])}var p=e.groups;if(p.length>0)for(var c=0;c<p.length;c++)for(var f=p[c],d=f.start,m=f.count,u=d,g=d+m;u<g;u+=3)void 0!==n?h(n[u],n[u+1],n[u+2],f.materialIndex):h(u,u+1,u+2,f.materialIndex);else if(void 0!==n)for(var c=0;c<n.length;c+=3)h(n[c],n[c+1],n[c+2]);else for(var c=0;c<r.length/3;c+=3)h(c,c+1,c+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:(ai=new En,function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ai).negate(),this.translate(ai.x,ai.y,ai.z),this}),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new Sn;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new En,t=new En,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],a=this.vertices[r.a],o=this.vertices[r.b],s=this.vertices[r.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,n,i,r,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new En;if(e){var s,l,c,u=new En,h=new En;for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],s=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),o[a.a].add(u),o[a.b].add(u),o[a.c].add(u)}else for(this.computeFaceNormals(),i=0,r=this.faces.length;i<r;i++)a=this.faces[i],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(i=0,r=this.faces.length;i<r;i++){var p=(a=this.faces[i]).vertexNormals;3===p.length?(p[0].copy(o[a.a]),p[1].copy(o[a.b]),p[2].copy(o[a.c])):(p[0]=o[a.a].clone(),p[1]=o[a.b].clone(),p[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(n=this.faces[e]).vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for((r=this.faces[n]).__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var a=new li;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)l=new En,c={a:new En,b:new En,c:new En},o.push(l),s.push(c)}var l,c,u=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,i=this.faces.length;n<i;n++)r=this.faces[n],l=u.faceNormals[n],c=u.vertexNormals[n],l.copy(r.normal),c.a.copy(r.vertexNormals[0]),c.b.copy(r.vertexNormals[1]),c.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)(r=this.faces[n]).normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Kn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var i,r=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,l=e.faces,c=this.faceVertexUvs[0],u=e.faceVertexUvs[0],h=this.colors,p=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new Tn).getNormalMatrix(t));for(var f=0,d=o.length;f<d;f++){var m=o[f],g=m.clone();void 0!==t&&g.applyMatrix4(t),a.push(g)}for(var f=0,d=p.length;f<d;f++)h.push(p[f].clone());for(f=0,d=l.length;f<d;f++){var v,_,y,x=l[f],b=x.vertexNormals,M=x.vertexColors;(v=new Yn(x.a+r,x.b+r,x.c+r)).normal.copy(x.normal),void 0!==i&&v.normal.applyMatrix3(i).normalize();for(var S=0,w=b.length;S<w;S++)_=b[S].clone(),void 0!==i&&_.applyMatrix3(i).normalize(),v.vertexNormals.push(_);v.color.copy(x.color);for(var S=0,w=M.length;S<w;S++)y=M[S],v.vertexColors.push(y.clone());v.materialIndex=x.materialIndex+n,s.push(v)}for(f=0,d=u.length;f<d;f++){var E=u[f],T=[];if(void 0!==E){for(var S=0,w=E.length;S<w;S++)T.push(E[S].clone());c.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,a,o,s,l={},c=[],u=[],h=Math.pow(10,4);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h),void 0===l[t]?(l[t]=n,c.push(this.vertices[n]),u[n]=c.length-1):u[n]=u[l[t]];var p=[];for(n=0,i=this.faces.length;n<i;n++){(r=this.faces[n]).a=u[r.a],r.b=u[r.b],r.c=u[r.c],a=[r.a,r.b,r.c];for(var f=0;f<3;f++)if(a[f]===a[(f+1)%3]){p.push(n);break}}for(n=p.length-1;n>=0;n--){var d=p[n];for(this.faces.splice(d,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(d,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.vertices.push(new En(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var i,r,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(i=[]),o&&o.length===t&&(r=[]);for(var n=0;n<t;n++){var s=e[n]._id;i&&i.push(a[s]),r&&r.push(o[s])}i&&(this.faceVertexUvs[0]=i),r&&(this.faceVertexUvs[1]=r)},clone:function(){return(new li).copy(this)},copy:function(e){var t,n,i,r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());var c=e.faces;for(t=0,n=c.length;t<n;t++)this.faces.push(c[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var u=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,r=u.length;i<r;i++){var h=u[i],p=[];for(a=0,o=h.length;a<o;a++){var f=h[a];p.push(f.clone())}this.faceVertexUvs[t].push(p)}}var d=e.morphTargets;for(t=0,n=d.length;t<n;t++){var m={};if(m.name=d[t].name,void 0!==d[t].vertices)for(m.vertices=[],i=0,r=d[t].vertices.length;i<r;i++)m.vertices.push(d[t].vertices[i].clone());if(void 0!==d[t].normals)for(m.normals=[],i=0,r=d[t].normals.length;i<r;i++)m.normals.push(d[t].normals[i].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,r=g[t].vertexNormals.length;i<r;i++){var _=g[t].vertexNormals[i],y={};y.a=_.a.clone(),y.b=_.b.clone(),y.c=_.c.clone(),v.vertexNormals.push(y)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,r=g[t].faceNormals.length;i<r;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());var b=e.skinIndices;for(t=0,n=b.length;t<n;t++)this.skinIndices.push(b[t].clone());var M=e.lineDistances;for(t=0,n=M.length;t<n;t++)this.lineDistances.push(M[t]);var S=e.boundingBox;null!==S&&(this.boundingBox=S.clone());var w=e.boundingSphere;return null!==w&&(this.boundingSphere=w.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(ci.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ci.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Gn),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new Mn),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new En),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new Pn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),ui.prototype=Object.create(ci.prototype),ui.prototype.constructor=ui,hi.prototype=Object.create(ci.prototype),hi.prototype.constructor=hi,pi.prototype=Object.create(ci.prototype),pi.prototype.constructor=pi,fi.prototype=Object.create(ci.prototype),fi.prototype.constructor=fi,di.prototype=Object.create(ci.prototype),di.prototype.constructor=di,mi.prototype=Object.create(ci.prototype),mi.prototype.constructor=mi,gi.prototype=Object.create(ci.prototype),gi.prototype.constructor=gi,vi.prototype=Object.create(ci.prototype),vi.prototype.constructor=vi,_i.prototype=Object.create(ci.prototype),_i.prototype.constructor=_i,Object.assign(yi.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,r=e.faces,a=0;a<r.length;a++){var o=r[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,i=e.vertices,r=e.faceVertexUvs,a=r[0]&&r[0].length>0,o=r[1]&&r[1].length>0,s=e.morphTargets,l=s.length;if(l>0){t=[];for(var c=0;c<l;c++)t[c]={name:s[c].name,data:[]};this.morphTargets.position=t}var u,h=e.morphNormals,p=h.length;if(p>0){u=[];for(var c=0;c<p;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var f=e.skinIndices,d=e.skinWeights,m=f.length===i.length,g=d.length===i.length;i.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var c=0;c<n.length;c++){var v=n[c];this.vertices.push(i[v.a],i[v.b],i[v.c]);var _=v.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var y=v.normal;this.normals.push(y,y,y)}var x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var b=v.color;this.colors.push(b,b,b)}if(!0===a){var M=r[0][c];void 0!==M?this.uvs.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Mn,new Mn,new Mn))}if(!0===o){var M=r[1][c];void 0!==M?this.uvs2.push(M[0],M[1],M[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Mn,new Mn,new Mn))}for(var S=0;S<l;S++){var w=s[S].vertices;t[S].data.push(w[v.a],w[v.b],w[v.c])}for(var S=0;S<p;S++){var E=h[S].vertexNormals[c];u[S].data.push(E.a,E.b,E.c)}m&&this.skinIndices.push(f[v.a],f[v.b],f[v.c]),g&&this.skinWeights.push(d[v.a],d[v.b],d[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var bi=1;function Mi(){Object.defineProperty(this,"id",{value:bi+=2}),this.uuid=bn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}function Si(e,t,n,i,r,a){li.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new wi(e,t,n,i,r,a)),this.mergeVertices()}function wi(e,t,n,i,r,a){Mi.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var s=[],l=[],c=[],u=[],h=0,p=0;function f(e,t,n,i,r,a,f,d,m,g,v){var _,y,x=a/m,b=f/g,M=a/2,S=f/2,w=d/2,E=m+1,T=g+1,A=0,L=0,C=new En;for(y=0;y<T;y++){var P=y*b-S;for(_=0;_<E;_++){var R=_*x-M;C[e]=R*i,C[t]=P*r,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=d>0?1:-1,c.push(C.x,C.y,C.z),u.push(_/m),u.push(1-y/g),A+=1}}for(y=0;y<g;y++)for(_=0;_<m;_++){var I=h+_+E*y,D=h+_+E*(y+1),U=h+(_+1)+E*(y+1),O=h+(_+1)+E*y;s.push(I,D,O),s.push(D,U,O),L+=6}o.addGroup(p,L,v),p+=L,h+=A}f("z","y","x",-1,-1,n,t,e,a,r,0),f("z","y","x",1,-1,n,t,-e,a,r,1),f("x","z","y",1,1,e,n,t,i,a,2),f("x","z","y",1,-1,e,n,-t,i,a,3),f("x","y","z",1,-1,e,t,n,i,r,4),f("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.addAttribute("position",new vi(l,3)),this.addAttribute("normal",new vi(c,3)),this.addAttribute("uv",new vi(u,2))}function Ei(e,t,n,i){li.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Ti(e,t,n,i)),this.mergeVertices()}function Ti(e,t,n,i){Mi.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var r,a,o=(e=e||1)/2,s=(t=t||1)/2,l=Math.floor(n)||1,c=Math.floor(i)||1,u=l+1,h=c+1,p=e/l,f=t/c,d=[],m=[],g=[],v=[];for(a=0;a<h;a++){var _=a*f-s;for(r=0;r<u;r++){var y=r*p-o;m.push(y,-_,0),g.push(0,0,1),v.push(r/l),v.push(1-a/c)}}for(a=0;a<c;a++)for(r=0;r<l;r++){var x=r+u*a,b=r+u*(a+1),M=r+1+u*(a+1),S=r+1+u*a;d.push(x,b,S),d.push(b,M,S)}this.setIndex(d),this.addAttribute("position",new vi(m,3)),this.addAttribute("normal",new vi(g,3)),this.addAttribute("uv",new vi(v,2))}Mi.prototype=Object.assign(Object.create(i.prototype),{constructor:Mi,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(xi(e)>65535?gi:di)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new ci(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new Tn).getNormalMatrix(e);i.applyToBufferAttribute(n),n.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Sn;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Sn;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Sn;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Sn;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new Sn;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new $n;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new En;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new vi(3*t.vertices.length,3),i=new vi(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new vi(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new vi(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var i=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(i=void 0,n.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(n);i.verticesNeedUpdate=n.verticesNeedUpdate,i.normalsNeedUpdate=n.normalsNeedUpdate,i.colorsNeedUpdate=n.colorsNeedUpdate,i.uvsNeedUpdate=n.uvsNeedUpdate,i.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=i}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new yi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new ci(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new ci(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new ci(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new ci(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new ci(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],l=e.morphTargets[o],c=0,u=l.length;c<u;c++){var h=l[c],p=new vi(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var f=new vi(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var d=new vi(4*e.skinWeights.length,4);this.addAttribute("skinWeight",d.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new qn);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new qn,t=new En;return function(){null===this.boundingSphere&&(this.boundingSphere=new Kn);var n=this.attributes.position;if(n){var i=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(i);for(var r=0,a=0,o=n.count;a<o;a++)t.x=n.getX(a),t.y=n.getY(a),t.z=n.getZ(a),r=Math.max(r,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new ci(new Float32Array(n.length),3));else for(var i=t.normal.array,r=0,a=i.length;r<a;r++)i[r]=0;var o,s,l,c=t.normal.array,u=new En,h=new En,p=new En,f=new En,d=new En;if(e)for(var m=e.array,r=0,a=e.count;r<a;r+=3)o=3*m[r+0],s=3*m[r+1],l=3*m[r+2],u.fromArray(n,o),h.fromArray(n,s),p.fromArray(n,l),f.subVectors(p,h),d.subVectors(u,h),f.cross(d),c[o]+=f.x,c[o+1]+=f.y,c[o+2]+=f.z,c[s]+=f.x,c[s+1]+=f.y,c[s+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z;else for(var r=0,a=n.length;r<a;r+=9)u.fromArray(n,r),h.fromArray(n,r+3),p.fromArray(n,r+6),f.subVectors(p,h),d.subVectors(u,h),f.cross(d),c[r]=f.x,c[r+1]=f.y,c[r+2]=f.z,c[r+3]=f.x,c[r+4]=f.y,c[r+5]=f.z,c[r+6]=f.x,c[r+7]=f.y,c[r+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i],a=r.array,o=e.attributes[i],s=o.array,l=o.itemSize,c=0,u=l*t;c<s.length;c++,u++)a[u]=s[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new En;return function(){for(var t=this.attributes.normal,n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Mi,t=this.index.array,n=this.attributes;for(var i in n){for(var r=n[i],a=r.array,o=r.itemSize,s=new a.constructor(t.length*o),l=0,c=0,u=0,h=t.length;u<h;u++){l=t[u]*o;for(var p=0;p<o;p++)s[c++]=a[l++]}e.addAttribute(i,new ci(s,o))}for(var f=this.groups,u=0,h=f.length;u<h;u++){var d=f[u];e.addGroup(d.start,d.count,d.materialIndex)}return e},clone:function(){return(new Mi).copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var l=[],c=s[t];for(n=0,i=c.length;n<i;n++)l.push(c[n].clone());this.morphAttributes[t]=l}var u=e.groups;for(n=0,i=u.length;n<i;n++){var h=u[n];this.addGroup(h.start,h.count,h.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Si.prototype=Object.create(li.prototype),Si.prototype.constructor=Si,wi.prototype=Object.create(Mi.prototype),wi.prototype.constructor=wi,Ei.prototype=Object.create(li.prototype),Ei.prototype.constructor=Ei,Ti.prototype=Object.create(Mi.prototype),Ti.prototype.constructor=Ti;var Ai,Li,Ci,Pi,Ri,Ii,Di,Ui,Oi,Bi,Ni,Fi,Gi=0;function ki(){Object.defineProperty(this,"id",{value:Gi++}),this.uuid=bn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=E,this.side=x,this.flatShading=!1,this.vertexColors=S,this.opacity=1,this.transparent=!1,this.blendSrc=G,this.blendDst=k,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=K,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function Hi(e){ki.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Vi(e,t){this.origin=void 0!==e?e:new En,this.direction=void 0!==t?t:new En}function zi(e,t,n){this.a=void 0!==e?e:new En,this.b=void 0!==t?t:new En,this.c=void 0!==n?n:new En}function ji(e){ki.call(this),this.type="MeshBasicMaterial",this.color=new Gn(16777215),this.map=null,this.map_etc_alpha=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Wi(e,t){$n.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Mi,this.material=void 0!==t?t:new ji({color:16777215*Math.random()}),this.drawMode=ut,this.updateMorphTargets()}function Xi(e,t,n,i){var r,a,o=new Gn(0),s=0,l=null,c=0;function u(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),u(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){u(o,s=e)},render:function(t,i,h,p){var f=i.background;if(null===f?(u(o,s),l=null,c=0):f&&f.isColor&&(u(f,1),p=!0,l=null,c=0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLRenderTargetCube)){void 0===a&&((a=new Wi(new wi(1,1,1),new Hi({type:"BackgroundCubeMaterial",uniforms:Un(Wn.cube.uniforms),vertexShader:Wn.cube.vertexShader,fragmentShader:Wn.cube.fragmentShader,side:b,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),a.geometry.removeAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.tCube.value}}),n.update(a));var d=f.isWebGLRenderTargetCube?f.texture:f;a.material.uniforms.tCube.value=d,a.material.uniforms.tFlip.value=f.isWebGLRenderTargetCube?1:-1,l===f&&c===d.version||(a.material.needsUpdate=!0,l=f,c=d.version),t.unshift(a,a.geometry,a.material,0,null)}else f&&f.isTexture&&(void 0===r&&((r=new Wi(new Ti(2,2),new Hi({type:"BackgroundMaterial",uniforms:Un(Wn.background.uniforms),vertexShader:Wn.background.vertexShader,fragmentShader:Wn.background.fragmentShader,side:x,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(r.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(r)),r.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),r.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&c===f.version||(r.material.needsUpdate=!0,l=f,c=f.version),t.unshift(r,r.geometry,r.material,0,null))}}}function Yi(e,t,n,i){var r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r)},this.renderInstances=function(a,o,s){var l;if(i.isWebGL2)l=e;else if(null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[i.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](r,o,s,a.maxInstancedCount),n.update(s,r,a.maxInstancedCount)}}function qi(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),u=e.getParameter(35660),h=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),d=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),v=u>0,_=a||!!t.get("OES_texture_float"),y=v&&_;return{isWebGL2:a,getMaxAnisotropy:function(){return void 0!==i?i:i=null!==t.get("EXT_texture_filter_anisotropic")?e.getParameter(34047):0},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:d,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:_,floatVertexTextures:y}}function Ki(e,t){this.normal=void 0!==e?e:new En(1,0,0),this.constant=void 0!==t?t:0}function Zi(){var e=this,t=null,n=0,i=!1,r=!1,a=new Ki,o=new Tn,s={value:null,needsUpdate:!1};function l(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,n,i,r){var l=null!==t?t.length:0,c=null;if(0!==l){if(c=s.value,!0!==r||null===c){var u=i+4*l,h=n.matrixWorldInverse;o.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var p=0,f=i;p!==l;++p,f+=4)a.copy(t[p]).applyMatrix4(h,o),a.normal.toArray(c,f),c[f+3]=a.constant}s.value=c,s.needsUpdate=!0}return e.numPlanes=l,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,r,a){var o=0!==e.length||r||0!==n||i;return i=r,t=c(e,a,0),n=e.length,o},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(e,a,o,u,h,p){if(!i||null===e||0===e.length||r&&!o)r?c(null):l();else{var f=r?0:n,d=4*f,m=h.clippingState||null;s.value=m,m=c(e,u,d,p);for(var g=0;g!==d;++g)m[g]=t[g];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=f}}}function Qi(e){var t={},n={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(i)}return null==r&&void 0===n[i]&&(n[i]={},console.warn("THREE.WebGLRenderer: "+i+" extension not supported.")),t[i]=r,r}}}function Ji(e,t,n){var i={},r={};function a(e){var o=e.target,s=i[o.id];for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);o.removeEventListener("dispose",a),delete i[o.id];var c=r[s.id];c&&(t.remove(c),delete r[s.id]),n.memory.geometries--}return{get:function(e,t){var r=i[t.id];return r||(t.addEventListener("dispose",a),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Mi).setFromObject(e)),r=t._bufferGeometry),i[t.id]=r,n.memory.geometries++,r)},update:function(e){var n=e.index,i=e.attributes;for(var r in null!==n&&t.update(n,34963),i)t.update(i[r],34962);var a=e.morphAttributes;for(var r in a)for(var o=a[r],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var n=r[e.id];if(n)return n;var i=[],a=e.index,o=e.attributes;if(null!==a)for(var s=a.array,l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],p=s[l+2];i.push(u,h,h,p,p,u)}else for(var s=o.position.array,l=0,c=s.length/3-1;l<c;l+=3){var u=l+0,h=l+1,p=l+2;i.push(u,h,h,p,p,u)}return n=new(xi(i)>65535?gi:di)(i,1),t.update(n,34963),r[e.id]=n,n}}}function $i(e,t,n,i){var r,a,o;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r)},this.renderInstances=function(s,l,c){if(i.isWebGL2)u=e;else{var u=t.get("ANGLE_instanced_arrays");if(null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}u[i.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](r,c,a,l*o,s.maxInstancedCount),n.update(c,r,s.maxInstancedCount)}}function er(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(i=i||1,t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 5:case 6:t.triangles+=i*(e-2);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function tr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function nr(e){var t={},n=new Float32Array(8);return{update:function(i,r,a,o){var s=i.morphTargetInfluences,l=s.length,c=t[r.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];t[r.id]=c}for(var h=a.morphTargets&&r.morphAttributes.position,p=a.morphNormals&&r.morphAttributes.normal,u=0;u<l;u++){var f=c[u];0!==f[1]&&(h&&r.removeAttribute("morphTarget"+u),p&&r.removeAttribute("morphNormal"+u))}for(var u=0;u<l;u++){var f=c[u];f[0]=u,f[1]=s[u]}c.sort(tr);for(var u=0;u<8;u++){var f=c[u];if(f){var d=f[0],m=f[1];if(m){h&&r.addAttribute("morphTarget"+u,h[d]),p&&r.addAttribute("morphNormal"+u,p[d]),n[u]=m;continue}}n[u]=0}o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function ir(e,t){var n={};return{update:function(i){var r=t.render.frame,a=i.geometry,o=e.get(i,a);return n[o.id]!==r&&(a.isGeometry&&o.updateFromObject(i),e.update(o),n[o.id]=r),o},dispose:function(){n={}}}}function rr(e,t,n,i,r,a,o,s,l,c){e=void 0!==e?e:[],t=void 0!==t?t:re,Cn.call(this,e,t,n,i,r,a,o,s,l,c),this.flipY=!1}function ar(e,t,n,i){Cn.call(this,null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=de,this.minFilter=de,this.generateMipmaps=!1,this.flipY=!1}ki.prototype=Object.assign(Object.create(i.prototype),{constructor:ki,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Hi.prototype=Object.create(ki.prototype),Hi.prototype.constructor=Hi,Hi.prototype.isShaderMaterial=!0,Hi.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Un(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Object.assign(Vi.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new En),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new En;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new En),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new En;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(Bi=new En,Ni=new En,Fi=new En,function(e,t,n,i){Bi.copy(e).add(t).multiplyScalar(.5),Ni.copy(t).sub(e).normalize(),Fi.copy(this.origin).sub(Bi);var r,a,o,s,l=.5*e.distanceTo(t),c=-this.direction.dot(Ni),u=Fi.dot(this.direction),h=-Fi.dot(Ni),p=Fi.lengthSq(),f=Math.abs(1-c*c);if(f>0)if(a=c*u-h,s=l*f,(r=c*h-u)>=0)if(a>=-s)if(a<=s){var d=1/f;o=(r*=d)*(r+c*(a*=d)+2*u)+a*(c*r+a+2*h)+p}else a=l,r=Math.max(0,-(c*a+u)),o=-r*r+a*(a+2*h)+p;else a=-l,r=Math.max(0,-(c*a+u)),o=-r*r+a*(a+2*h)+p;else a<=-s?(r=Math.max(0,-(-c*l+u)),a=r>0?-l:Math.min(Math.max(-l,-h),l),o=-r*r+a*(a+2*h)+p):a<=s?(r=0,a=Math.min(Math.max(-l,-h),l),o=a*(a+2*h)+p):(r=Math.max(0,-(c*l+u)),a=r>0?l:Math.min(Math.max(-l,-h),l),o=-r*r+a*(a+2*h)+p);else a=c>0?-l:l,r=Math.max(0,-(c*a+u)),o=-r*r+a*(a+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Ni).multiplyScalar(a).add(Bi),o}),intersectSphere:function(){var e=new En;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,a=t.radius*t.radius;if(r>a)return null;var o=Math.sqrt(a-r),s=i-o,l=i+o;return s<0&&l<0?null:s<0?this.at(l,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var n=e.normal.dot(this.direction);return n*t<0},intersectBox:function(e,t){var n,i,r,a,o,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,a=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,a=(e.min.y-h.y)*c),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),u>=0?(o=(e.min.z-h.z)*u,s=(e.max.z-h.z)*u):(o=(e.max.z-h.z)*u,s=(e.min.z-h.z)*u),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectsBox:(Oi=new En,function(e){return null!==this.intersectBox(e,Oi)}),intersectTriangle:function(){var e=new En,t=new En,n=new En,i=new En;return function(r,a,o,s,l){t.subVectors(a,r),n.subVectors(o,r),i.crossVectors(t,n);var c,u=this.direction.dot(i);if(u>0){if(s)return null;c=1}else{if(!(u<0))return null;c=-1,u=-u}e.subVectors(this.origin,r);var h=c*this.direction.dot(n.crossVectors(e,n));if(h<0)return null;var p=c*this.direction.dot(t.cross(e));if(p<0)return null;if(h+p>u)return null;var f=-c*e.dot(i);return f<0?null:this.at(f/u,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(zi,{getNormal:(Ui=new En,function(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new En),i.subVectors(n,t),Ui.subVectors(e,t),i.cross(Ui);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}),getBarycoord:function(){var e=new En,t=new En,n=new En;return function(i,r,a,o,s){e.subVectors(o,r),t.subVectors(a,r),n.subVectors(i,r);var l=e.dot(e),c=e.dot(t),u=e.dot(n),h=t.dot(t),p=t.dot(n),f=l*h-c*c;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new En),0===f)return s.set(-2,-1,-1);var d=1/f,m=(h*u-c*p)*d,g=(l*p-c*u)*d;return s.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new En;return function(t,n,i,r){return zi.getBarycoord(t,n,i,r,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}(),getUV:(Di=new En,function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Di),s.set(0,0),s.addScaledVector(r,Di.x),s.addScaledVector(a,Di.y),s.addScaledVector(o,Di.z),s})}),Object.assign(zi.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new En,t=new En;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new En),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return zi.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new En),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return zi.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return zi.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,n,i,r){return zi.getUV(e,this.a,this.b,this.c,t,n,i,r)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:(Ai=new En,Li=new En,Ci=new En,Pi=new En,Ri=new En,Ii=new En,function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new En);var n,i,r=this.a,a=this.b,o=this.c;Ai.subVectors(a,r),Li.subVectors(o,r),Pi.subVectors(e,r);var s=Ai.dot(Pi),l=Li.dot(Pi);if(s<=0&&l<=0)return t.copy(r);Ri.subVectors(e,a);var c=Ai.dot(Ri),u=Li.dot(Ri);if(c>=0&&u<=c)return t.copy(a);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(r).addScaledVector(Ai,n);Ii.subVectors(e,o);var p=Ai.dot(Ii),f=Li.dot(Ii);if(f>=0&&p<=f)return t.copy(o);var d=p*l-s*f;if(d<=0&&l>=0&&f<=0)return i=l/(l-f),t.copy(r).addScaledVector(Li,i);var m=c*f-p*u;if(m<=0&&u-c>=0&&p-f>=0)return Ci.subVectors(o,a),i=(u-c)/(u-c+(p-f)),t.copy(a).addScaledVector(Ci,i);var g=1/(m+d+h);return n=d*g,i=h*g,t.copy(r).addScaledVector(Ai,n).addScaledVector(Li,i)}),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),ji.prototype=Object.create(ki.prototype),ji.prototype.constructor=ji,ji.prototype.isMeshBasicMaterial=!0,ji.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Wi.prototype=Object.assign(Object.create($n.prototype),{constructor:Wi,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return $n.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}},raycast:function(){var e=new Sn,t=new Vi,n=new Kn,i=new En,r=new En,a=new En,o=new En,s=new En,l=new En,c=new Mn,u=new Mn,h=new Mn,p=new En,f=new En;function d(e,t,n,i,r,a,o,s){if(null===(t.side===b?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side!==M,s)))return null;f.copy(s),f.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(f);return l<n.near||l>n.far?null:{distance:l,point:f.clone(),object:e}}function m(e,t,n,o,s,l,f,m,g){i.fromBufferAttribute(s,f),r.fromBufferAttribute(s,m),a.fromBufferAttribute(s,g);var v=d(e,t,n,o,i,r,a,p);if(v){l&&(c.fromBufferAttribute(l,f),u.fromBufferAttribute(l,m),h.fromBufferAttribute(l,g),v.uv=zi.getUV(p,i,r,a,c,u,h,new Mn));var _=new Yn(f,m,g);zi.getNormal(i,r,a,_.normal),v.face=_}return v}return function(f,g){var v,_=this.geometry,y=this.material,x=this.matrixWorld;if(void 0!==y&&(null===_.boundingSphere&&_.computeBoundingSphere(),n.copy(_.boundingSphere),n.applyMatrix4(x),!1!==f.ray.intersectsSphere(n)&&(e.getInverse(x),t.copy(f.ray).applyMatrix4(e),null===_.boundingBox||!1!==t.intersectsBox(_.boundingBox))))if(_.isBufferGeometry){var b,M,S,w,E,T,A,L,C,P,R,I=_.index,D=_.attributes.position,U=_.attributes.uv,O=_.groups,B=_.drawRange;if(null!==I)if(Array.isArray(y))for(w=0,T=O.length;w<T;w++)for(L=O[w],C=y[L.materialIndex],P=Math.max(L.start,B.start),R=Math.min(L.start+L.count,B.start+B.count),E=P,A=R;E<A;E+=3)b=I.getX(E),M=I.getX(E+1),S=I.getX(E+2),(v=m(this,C,f,t,D,U,b,M,S))&&(v.faceIndex=Math.floor(E/3),g.push(v));else for(P=Math.max(0,B.start),R=Math.min(I.count,B.start+B.count),w=P,T=R;w<T;w+=3)b=I.getX(w),M=I.getX(w+1),S=I.getX(w+2),(v=m(this,y,f,t,D,U,b,M,S))&&(v.faceIndex=Math.floor(w/3),g.push(v));else if(void 0!==D)if(Array.isArray(y))for(w=0,T=O.length;w<T;w++)for(L=O[w],C=y[L.materialIndex],P=Math.max(L.start,B.start),R=Math.min(L.start+L.count,B.start+B.count),E=P,A=R;E<A;E+=3)(v=m(this,C,f,t,D,U,b=E,M=E+1,S=E+2))&&(v.faceIndex=Math.floor(E/3),g.push(v));else for(P=Math.max(0,B.start),R=Math.min(D.count,B.start+B.count),w=P,T=R;w<T;w+=3)(v=m(this,y,f,t,D,U,b=w,M=w+1,S=w+2))&&(v.faceIndex=Math.floor(w/3),g.push(v))}else if(_.isGeometry){var N,F,G,k,H=Array.isArray(y),V=_.vertices,z=_.faces,j=_.faceVertexUvs[0];j.length>0&&(k=j);for(var W=0,X=z.length;W<X;W++){var Y=z[W],q=H?y[Y.materialIndex]:y;if(void 0!==q){if(N=V[Y.a],F=V[Y.b],G=V[Y.c],!0===q.morphTargets){var K=_.morphTargets,Z=this.morphTargetInfluences;i.set(0,0,0),r.set(0,0,0),a.set(0,0,0);for(var Q=0,J=K.length;Q<J;Q++){var $=Z[Q];if(0!==$){var ee=K[Q].vertices;i.addScaledVector(o.subVectors(ee[Y.a],N),$),r.addScaledVector(s.subVectors(ee[Y.b],F),$),a.addScaledVector(l.subVectors(ee[Y.c],G),$)}}i.add(N),r.add(F),a.add(G),N=i,F=r,G=a}if(v=d(this,q,f,t,N,F,G,p)){if(k&&k[W]){var te=k[W];c.copy(te[0]),u.copy(te[1]),h.copy(te[2]),v.uv=zi.getUV(p,N,F,G,c,u,h,new Mn)}v.face=Y,v.faceIndex=W,g.push(v)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Ki.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new En,t=new En;return function(n,i,r){var a=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new En),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new En;return function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new En);var i=t.delta(e),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(t.start)?n.copy(t.start):void 0;var a=-(t.start.dot(this.normal)+this.constant)/r;return a<0||a>1?void 0:n.copy(i).multiplyScalar(a).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new En),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new En,t=new Tn;return function(n,i){var r=i||t.getNormalMatrix(n),a=this.coplanarPoint(e).applyMatrix4(n),o=this.normal.applyMatrix3(r).normalize();return this.constant=-a.dot(o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),rr.prototype=Object.create(Cn.prototype),rr.prototype.constructor=rr,rr.prototype.isCubeTexture=!0,Object.defineProperty(rr.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),ar.prototype=Object.create(Cn.prototype),ar.prototype.constructor=ar,ar.prototype.isDataTexture3D=!0;var or=new Cn,sr=new ar,lr=new rr;function cr(){this.seq=[],this.map={}}var ur=[],hr=new Float32Array(16),pr=new Float32Array(9),fr=new Float32Array(4);function dr(e,t,n){var i=e[0];if(i<=0||i>0)return e}function mr(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function gr(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function vr(e,t){var n=ur[t];void 0===n&&(n=new Int32Array(t),ur[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocTextureUnit();return n}function _r(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function yr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function xr(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(mr(n,t))return;e.uniform2fv(this.addr,t),gr(n,t)}}function br(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(mr(n,t))return;e.uniform3fv(this.addr,t),gr(n,t)}}function Mr(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(mr(n,t))return;e.uniform4fv(this.addr,t),gr(n,t)}}function Sr(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(mr(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),gr(n,t)}else{if(mr(n,i))return;fr.set(i),e.uniformMatrix2fv(this.addr,!1,fr),gr(n,i)}}function wr(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(mr(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),gr(n,t)}else{if(mr(n,i))return;pr.set(i),e.uniformMatrix3fv(this.addr,!1,pr),gr(n,i)}}function Er(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(mr(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),gr(n,t)}else{if(mr(n,i))return;hr.set(i),e.uniformMatrix4fv(this.addr,!1,hr),gr(n,i)}}function Tr(e,t,n){var i=this.cache,r=n.allocTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||or,r)}function Ar(e,t,n){var i=this.cache,r=n.allocTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||sr,r)}function Lr(e,t,n){var i=this.cache,r=n.allocTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||lr,r)}function Cr(e,t){var n=this.cache;mr(n,t)||(e.uniform2iv(this.addr,t),gr(n,t))}function Pr(e,t){var n=this.cache;mr(n,t)||(e.uniform3iv(this.addr,t),gr(n,t))}function Rr(e,t){var n=this.cache;mr(n,t)||(e.uniform4iv(this.addr,t),gr(n,t))}function Ir(e,t){var n=this.cache;mr(n,t)||(e.uniform1fv(this.addr,t),gr(n,t))}function Dr(e,t){var n=this.cache;mr(n,t)||(e.uniform1iv(this.addr,t),gr(n,t))}function Ur(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniform2fv(this.addr,i),this.updateCache(i))}function Or(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniform3fv(this.addr,i),this.updateCache(i))}function Br(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniform4fv(this.addr,i),this.updateCache(i))}function Nr(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniformMatrix2fv(this.addr,!1,i),this.updateCache(i))}function Fr(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniformMatrix3fv(this.addr,!1,i),this.updateCache(i))}function Gr(e,t){var n=this.cache,i=dr(t,this.size);mr(n,i)||(e.uniformMatrix4fv(this.addr,!1,i),this.updateCache(i))}function kr(e,t,n){var i=this.cache,r=t.length,a=vr(n,r);!1===mr(i,a)&&(e.uniform1iv(this.addr,a),gr(i,a));for(var o=0;o!==r;++o)n.setTexture2D(t[o]||or,a[o])}function Hr(e,t,n){var i=this.cache,r=t.length,a=vr(n,r);!1===mr(i,a)&&(e.uniform1iv(this.addr,a),gr(i,a));for(var o=0;o!==r;++o)n.setTextureCube(t[o]||lr,a[o])}function Vr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return _r;case 35664:return xr;case 35665:return br;case 35666:return Mr;case 35674:return Sr;case 35675:return wr;case 35676:return Er;case 35678:case 36198:return Tr;case 35679:return Ar;case 35680:return Lr;case 5124:case 35670:return yr;case 35667:case 35671:return Cr;case 35668:case 35672:return Pr;case 35669:case 35673:return Rr}}(t.type)}function zr(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ir;case 35664:return Ur;case 35665:return Or;case 35666:return Br;case 35674:return Nr;case 35675:return Fr;case 35676:return Gr;case 35678:return kr;case 35680:return Hr;case 5124:case 35670:return Dr;case 35667:case 35671:return Cr;case 35668:case 35672:return Pr;case 35669:case 35673:return Rr}}(t.type)}function jr(e){this.id=e,cr.call(this)}zr.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),gr(t,e)},jr.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var Wr=/([\w\d_]+)(\])?(\[|\.)?/g;function Xr(e,t){e.seq.push(t),e.map[t.id]=t}function Yr(e,t,n){var i=e.name,r=i.length;for(Wr.lastIndex=0;;){var a=Wr.exec(i),o=Wr.lastIndex,s=a[1],l="]"===a[2],c=a[3];if(l&&(s|=0),void 0===c||"["===c&&o+2===r){Xr(n,void 0===c?new Vr(s,e,t):new zr(s,e,t));break}var u=n.map,h=u[s];void 0===h&&(h=new jr(s),Xr(n,h)),n=h}}function qr(e,t,n){cr.call(this),this.renderer=n;for(var i=e.getProgramParameter(t,35718),r=0;r<i;++r){var a=e.getActiveUniform(t,r),o=e.getUniformLocation(t,a.name);Yr(a,o,this)}}function Kr(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),!1===e.getShaderParameter(i,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),i}qr.prototype.setValue=function(e,t,n){var i=this.map[t];void 0!==i&&i.setValue(e,n,this.renderer)},qr.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},qr.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},qr.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var Zr=0;function Qr(e){switch(e){case ft:return["Linear","( value )"];case dt:return["sRGB","( value )"];case gt:return["RGBE","( value )"];case vt:return["RGBM","( value, 7.0 )"];case _t:return["RGBM","( value, 16.0 )"];case yt:return["RGBD","( value, 256.0 )"];case mt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Jr(e,t){var n=Qr(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function $r(e){return""!==e}function ea(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function ta(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function na(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){var n=Dn[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return na(n)})}function ia(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[ i \]/g,"[ "+a+" ]");return r})}function ra(e,t,n,i,r,a,o){var s=e.context,l=i.defines,c=r.vertexShader,u=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";a.shadowMapType===_?h="SHADOWMAP_TYPE_PCF":a.shadowMapType===y&&(h="SHADOWMAP_TYPE_PCF_SOFT");var p="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",d="ENVMAP_BLENDING_MULTIPLY";if(a.textureBitFlag&Nt){switch(i.envMap.mapping){case re:case ae:p="ENVMAP_TYPE_CUBE";break;case ce:case ue:p="ENVMAP_TYPE_CUBE_UV";break;case oe:case se:p="ENVMAP_TYPE_EQUIREC";break;case le:p="ENVMAP_TYPE_SPHERE"}switch(i.envMap.mapping){case ae:case se:f="ENVMAP_MODE_REFRACTION"}switch(i.combine){case ee:d="ENVMAP_BLENDING_MULTIPLY";break;case te:d="ENVMAP_BLENDING_MIX";break;case ne:d="ENVMAP_BLENDING_ADD"}}var m=e.gammaFactor>0?e.gammaFactor:1,g=o.isWebGL2?"":function(e,t,n){return[((e=e||{}).fragDepth||t.otherBitFlag&un)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.textureBitFlag&Nt)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter($r).join("\n")}(i.extensions,a,t),v=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(l),x="";(t.derivatives||a.textureBitFlag&Ft||a.textureBitFlag&Pt||a.textureBitFlag&qt&&!(a.textureBitFlag&Kt)||a.otherBitFlag&rn)&&(t.get("OES_standard_derivatives")?g+="\n#extension GL_OES_standard_derivatives : enable":x="\n#define dFdx dFd_\n#define dFdy dFd_\n#define fwidth(p) (dFd_(p) + dFd_(p))\nfloat dFd_(float p) {return 0.001953125;}\nvec2 dFd_(vec2 p) {return vec2(0.001953125);}\nvec3 dFd_(vec3 p) {return vec3(0.001953125);}\nvec4 dFd_(vec4 p) {return vec4(0.001953125);}");var b,M,S,w,E,T=s.createProgram();if(i.isRawShaderMaterial?((b=[v].filter($r).join("\n")).length>0&&(b+="\n"),(M=[g,x,v].filter($r).join("\n")).length>0&&(M+="\n")):(b=["precision "+a.precision+" float;","precision "+a.precision+" int;",v,a.otherBitFlag&_n?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+a.maxBones,a.otherBitFlag&(yn|on)?"#define USE_FOG":"",a.otherBitFlag&(yn|sn)?"#define FOG_EXP2":"",a.textureBitFlag&Nt?"#define "+f:"",a.textureBitFlag&kt?"#define USE_LIGHTMAP":"",a.textureBitFlag&At?"#define USE_AOMAP":"",a.textureBitFlag&Ut?"#define USE_EMISSIVEMAP":"",a.vertexColors?"#define USE_COLOR":"",a.otherBitFlag&rn?"#define FLAT_SHADED":"",a.otherBitFlag&vn?"#define USE_SKINNING":"",a.otherBitFlag&xn?"#define BONE_TEXTURE":"",a.otherBitFlag&fn?"#define USE_MORPHTARGETS":"",a.otherBitFlag&pn&&!(a.otherBitFlag&rn)?"#define USE_MORPHNORMALS":"",a.otherBitFlag&an?"#define FLIP_SIDED":"",a.otherBitFlag&gn?"#define USE_SHADOWMAP":"",a.otherBitFlag&gn?"#define "+h:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.otherBitFlag&un?"#define USE_LOGDEPTHBUF":"",a.otherBitFlag&un&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","#if defined(PHYSICAL) || defined(STANDARD)\nuniform vec3 specular;\n#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($r).join("\n"),M=[g,"precision "+a.precision+" float;","precision "+a.precision+" int;","#define SHADER_NAME "+r.name,x,v,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+m,a.otherBitFlag&yn&&a.otherBitFlag&on?"#define USE_FOG":"",a.otherBitFlag&yn&&a.otherBitFlag&sn?"#define FOG_EXP2":"",a.textureBitFlag&Ht?"#define USE_MAP":"",a.textureBitFlag&Vt?"#define USE_ETC_MAP":"",a.textureBitFlag&zt?"#define MAP_HAS_ETC_ALPHA":"",a.textureBitFlag&$t?"#define USE_SKIN_MAP":"",a.textureBitFlag&jt?"#define USE_MASK_MAP":"",a.otherBitFlag&hn?"#define USE_MATCAP":"",a.textureBitFlag&Nt?"#define USE_ENVMAP":"",a.textureBitFlag&Nt?"#define "+p:"",a.textureBitFlag&Nt?"#define "+f:"",a.textureBitFlag&Nt?"#define "+d:"",a.textureBitFlag&kt?"#define USE_LIGHTMAP":"",a.textureBitFlag&At?"#define USE_AOMAP":"",a.textureBitFlag&Ut?"#define USE_EMISSIVEMAP":"",a.textureBitFlag&Ot?"#define USE_ETC_EMISSIVEMAP":"",a.textureBitFlag&Bt?"#define EMISSIVE_MAP_HAS_ETC_ALPHA":"",a.textureBitFlag&Pt?"#define USE_BUMPMAP":"",a.textureBitFlag&qt?"#define USE_NORMALMAP":"",a.textureBitFlag&qt&&a.textureBitFlag&Kt?"#define OBJECTSPACE_NORMALMAP":"",a.textureBitFlag&en?"#define USE_SPECULARMAP":"",a.textureBitFlag&tn?"#define USE_ETC_SPECULARSSMAP":"",a.textureBitFlag&Zt?"#define USE_ROUGHNESSMAP":"",a.textureBitFlag&Qt?"#define USE_ETC_ROUGHNESSMAP":"",a.textureBitFlag&Jt?"#define ROUGHNESS_MAP_HAS_ETC_ALPHA":"",a.textureBitFlag&Wt?"#define USE_METALNESSMAP":"",a.textureBitFlag&Xt?"#define USE_ETC_METALNESSMAP":"",a.textureBitFlag&Yt?"#define METALNESS_MAP_HAS_ETC_ALPHA":"",a.textureBitFlag&Tt?"#define USE_ALPHAMAP":"",a.vertexColors?"#define USE_COLOR":"",a.textureBitFlag&Gt?"#define USE_GRADIENTMAP":"",a.otherBitFlag&rn?"#define FLAT_SHADED":"",a.otherBitFlag&an?"#define FLIP_SIDED":"",a.otherBitFlag&gn?"#define USE_SHADOWMAP":"",a.otherBitFlag&gn?"#define "+h:"",a.otherBitFlag&mn?"#define PREMULTIPLIED_ALPHA":"",a.otherBitFlag&dn?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.otherBitFlag&un?"#define USE_LOGDEPTHBUF":"",a.otherBitFlag&un&&(o.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",a.textureBitFlag&Nt&&(o.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","#if defined(PHYSICAL) || defined(STANDARD)\nuniform vec3 specular;\n#endif",a.otherBitFlag&nn?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding?Dn.encodings_pars_fragment:"",a.mapEncoding?Jr("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?Jr("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?Jr("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?Jr("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.outputEncoding?(S="linearToOutputTexel",w=a.outputEncoding,E=Qr(w),"vec4 "+S+"( vec4 value ) { return LinearTo"+E[0]+E[1]+"; }"):"",a.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","#ifdef UNITY_PBS","uniform int setup_type;","uniform int smoothnessTextureChannel;","uniform float smoothnessScale;","#endif",a.otherBitFlag&ln?"#define GAMMA_INPUT ":"",a.otherBitFlag&cn?"#define GAMMA_OUTPUT ":"","#ifdef UNITY_PBS",1===a.unityColorSpace?"#define UNITY_COLORSPACE_GAMMA":"","#endif",a.textureBitFlag&Ct?"#define UNITY_CUSTOM_AUTODESK_SPEC_GLOSS_MAP":"",a.textureBitFlag&Lt?"#define UNITY_CUSTOM_AUTODESK_METALLIC_GLOSS_MAP":"",a.textureBitFlag&It?"#define UNITY_CUSTOM_STANDARD_METALLIC_GLOSS_MAP":"",a.textureBitFlag&Rt?"#define UNITY_CUSTOM_SPECULAR_GLOSS_MAP":"","\n"].filter($r).join("\n")),c=ta(c=ea(c=na(c),a),a),u=ta(u=ea(u=na(u),a),a),c=ia(c),u=ia(u),o.isWebGL2&&!i.isRawShaderMaterial){var A=!1,L=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&null!==c.match(L)&&null!==u.match(L)&&(A=!0,c=c.replace(L,""),u=u.replace(L,"")),b=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,M=["#version 300 es\n","#define varying in",A?"":"out highp vec4 pc_fragColor;",A?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+M}var C=b+c,P=M+u,R=Kr(s,35633,C),I=Kr(s,35632,P);s.attachShader(T,R),s.attachShader(T,I),void 0!==i.index0AttributeName?s.bindAttribLocation(T,0,i.index0AttributeName):a.otherBitFlag&fn&&s.bindAttribLocation(T,0,"position"),s.linkProgram(T);var D,U,O=s.getProgramInfoLog(T).trim(),B=s.getShaderInfoLog(R).trim(),N=s.getShaderInfoLog(I).trim(),F=!0,G=!0;return!1===s.getProgramParameter(T,35714)?(F=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"35715",s.getProgramParameter(T,35715),"gl.getProgramInfoLog",O,B,N)):""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==B&&""!==N||(G=!1),G&&(this.diagnostics={runnable:F,material:i,programLog:O,vertexShader:{log:B,prefix:b},fragmentShader:{log:N,prefix:M}}),s.deleteShader(R),s.deleteShader(I),this.getUniforms=function(){return void 0===D&&(D=new qr(s,T,e)),D},this.getAttributes=function(){return void 0===U&&(U=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name;n[o]=e.getAttribLocation(t,o)}return n}(s,T)),U},this.destroy=function(){s.deleteProgram(T),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=r.name,this.id=Zr++,this.code=n,this.usedTimes=1,this.program=T,this.vertexShader=R,this.fragmentShader=I,this}function aa(e,t,n){var i=[],r={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite",MeshPhysicalCPUSkinningMaterial:"physicalCPUSkinning",MeshUnityPBSMaterial:"unityPBS",MeshUnityPBSMaterial_png:"unityPBS",MeshUnityPBSMaterial_etc:"unityPBS_etc",MeshUnityPBSSkinMaterial:"unityPBSSkin",MeshUnityPBSSkinMaterial_png_gpu_skinning:"unityPBSSkin_png_gpu_skinning",MeshUnityPBSSkinMaterial_etc_gpu_skinning:"unityPBSSkin_etc_gpu_skinning",MeshUnityPBSSkinMaterial_png_cpu_skinning:"unityPBSSkin_png_cpu_skinning",MeshUnityPBSSkinMaterial_etc_cpu_skinning:"unityPBSSkin_etc_cpu_skinning",MeshUnitySkyBoxMaterial:"unitySkybox",MeshUnitySkyBoxMaterial_png:"unitySkybox",MeshUnitySkyBoxMaterial_etc:"unitySkybox_etc"},a=["precision","mapEncoding","matcapEncoding","envMapMode","envMapEncoding","emissiveMapEncoding","combine","vertexColors","sizeAttenuation","maxBones","maxMorphTargets","maxMorphNormals","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapType","toneMapping","alphaTest","numClippingPlanes","numClipIntersection","depthPacking"];if(n.floatVertexTextures)window.max_bones=1024,console.warn("floatVertexTextures MaxBones : "+window.max_bones);else{var o=n.maxVertexUniforms;window.max_bones=Math.floor((o-20)/4),window.max_bones>200&&(window.max_bones=200),console.warn("nVertexUniforms : "+o+", MaxBones : "+window.max_bones)}var s="cs.report_data_2_compass.local",l={cmd:s,actionName:"skinning_overview",enter:0,result:0,r2:""+(n.floatVertexTextures?1:0),r3:""+n.maxVertexUniforms,r4:""+window.max_bones,r5:""};function c(e,t,n){var i;if(n&&n>0){if(1===n)return i=!e||e.isTexture?ft:e.isWebGLRenderTarget?e.texture.encoding:ft;if(2===n)return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=mt,i}return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=ft,i===ft&&t&&(i=mt),i}BK.MQQ.SsoRequest.send(l,s),this.getParameters=function(t,i,a,o,s,l,u){var h=r[t.sub_type||t.type],p=0;p=!0===t.isCPUSkinning?0:!0===u.isSkinnedMesh?window.max_bones:0;var f=n.precision;null!==t.precision&&(f=n.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead.");var d=0;t.alphaMap&&(d|=Tt),t.aoMap&&(d|=At),t.autodeskMetallicGlossMap&&(d|=Lt),t.autodeskSpecGlossMap&&(d|=Ct),t.bumpMap&&(d|=Pt),t.customSpecularGlossMap&&(d|=Rt),t.customStandardMetallicGlossMap&&(d|=It),t.displacementMap&&(d|=Dt),t.emissiveMap&&(d|=Ut,t.emissiveMap.isEtc1&&(d|=Ot)),t.emissiveMap_etc_alpha&&(d|=Bt),t.envMap&&(d|=Nt,t.envMap.mapping!==ce&&t.envMap.mapping!==ue||(d|=Ft)),t.gradientMap&&(d|=Gt),t.lightMap&&(d|=kt),t.map&&(d|=Ht,t.map.isEtc1&&(d|=Vt)),t.map_etc_alpha&&(d|=zt),t.maskMap&&(d|=jt),t.metalnessMap&&(d|=Wt,t.metalnessMap.isEtc1&&(d|=Xt)),t.metalnessMap_etc_alpha&&(d|=Yt),t.normalMap&&(d|=qt),t.normalMapType===St&&(d|=Kt),t.roughnessMap&&(d|=Zt,t.roughnessMap.isEtc1&&(d|=Qt)),t.roughnessMap_etc_alpha&&(d|=Jt),t.skinMap&&(d|=$t),t.specularMap&&(d|=en,t.specularMap.isEtc1&&(d|=tn));var m=0;t.dithering&&(m|=nn),t.flatShading&&(m|=rn),t.side===b&&(m|=an),o&&(m|=on),t.fog&&(m|=yn),o&&o.isFogExp2&&(m|=sn),e.gammaInput&&(m|=ln),e.gammaOutput&&(m|=cn),n.logarithmicDepthBuffer&&(m|=un),t.matcap&&(m|=hn),t.morphNormals&&(m|=pn),t.morphTargets&&(m|=fn),e.physicallyCorrectLights&&(m|=dn),t.premultipliedAlpha&&(m|=mn),e.shadowMap.enabled&&u.receiveShadow&&a.length>0&&(m|=gn),t.skinning&&p>0&&(m|=vn),n.vertexTextures&&(m|=_n),n.floatVertexTextures&&(m|=xn);var g=e.getRenderTarget(),v={shaderID:h,precision:f,outputEncoding:c(g?g.texture:null,e.gammaOutput,e.unityColorSpace),mapEncoding:c(t.map,e.gammaInput,e.unityColorSpace),matcapEncoding:c(t.matcap,e.gammaInput,e.unityColorSpace),envMapEncoding:c(t.envMap,e.gammaInput,e.unityColorSpace),emissiveMapEncoding:c(t.emissiveMap,e.gammaInput,e.unityColorSpace),vertexColors:t.vertexColors,sizeAttenuation:t.sizeAttenuation,maxBones:p,numDirLights:i.directional.length,numPointLights:i.point.length,numSpotLights:i.spot.length,numRectAreaLights:i.rectArea.length,numHemiLights:i.hemi.length,numClippingPlanes:s,numClipIntersection:l,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,alphaTest:t.alphaTest,unityColorSpace:e.unityColorSpace,textureBitFlag:d,otherBitFlag:m};return v},this.getProgramCode=function(e,t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);for(var r=0;r<a.length;r++)n.push(t[a[r]]);return n.push(e.onBeforeCompile.toString()),n.push(t.textureBitFlag),n.push(t.otherBitFlag),n.join()},this.acquireProgram=function(r,a,o,s){for(var l,c=0,u=i.length;c<u;c++){var h=i[c];if(h.code===s){++(l=h).usedTimes;break}}return void 0===l&&(l=new ra(e,t,s,r,a,o,n),i.push(l)),l},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=i.indexOf(e);i[t]=i[i.length-1],i.pop(),e.destroy()}},this.programs=i}function oa(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function sa(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function la(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ca(){var e=[],t=0,n=[],i=[];function r(n,i,r,a,o){var s=e[t];return void 0===s?(s={id:n.id,object:n,geometry:i,material:r,program:r.program,renderOrder:n.renderOrder,z:a,group:o},e[t]=s):(s.id=n.id,s.object=n,s.geometry=i,s.material=r,s.program=r.program,s.renderOrder=n.renderOrder,s.z=a,s.group=o),t++,s}return{opaque:n,transparent:i,init:function(){t=0,n.length=0,i.length=0},push:function(e,t,a,o,s){var l=r(e,t,a,o,s);(!0===a.transparent?i:n).push(l)},unshift:function(e,t,a,o,s){var l=r(e,t,a,o,s);(!0===a.transparent?i:n).unshift(l)},sort:function(){n.length>1&&n.sort(sa),i.length>1&&i.sort(la)}}}function ua(){var e={};return{get:function(t,n){var i,r=e[t.id];return void 0===r?(i=new ca,e[t.id]={},e[t.id][n.id]=i):void 0===(i=r[n.id])&&(i=new ca,r[n.id]=i),i},dispose:function(){e={}}}}function ha(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new En,color:new Gn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Mn};break;case"SpotLight":n={position:new En,direction:new En,color:new Gn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Mn};break;case"PointLight":n={position:new En,color:new Gn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Mn,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new En,skyColor:new Gn,groundColor:new Gn};break;case"RectAreaLight":n={color:new Gn,position:new En,halfWidth:new En,halfHeight:new En}}return e[t.id]=n,n}}}var pa,fa,da,ma,ga,va,_a,ya,xa,ba,Ma=0;function Sa(){var e=new ha,t={id:Ma++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new En,i=new Sn,r=new Sn;return{setup:function(a,o,s){for(var l=0,c=0,u=0,h=0,p=0,f=0,d=0,m=0,g=s.matrixWorldInverse,v=0,_=a.length;v<_;v++){var y=a[v],x=y.color,b=y.intensity,M=y.distance,S=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)l+=x.r*b,c+=x.g*b,u+=x.b*b;else if(y.isDirectionalLight){var w=e.get(y);if(w.color.copy(y.color).multiplyScalar(y.intensity),w.direction.setFromMatrixPosition(y.matrixWorld),n.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(g),w.shadow=y.castShadow,y.castShadow){var E=y.shadow;w.shadowBias=E.bias,w.shadowRadius=E.radius,w.shadowMapSize=E.mapSize}t.directionalShadowMap[h]=S,t.directionalShadowMatrix[h]=y.shadow.matrix,t.directional[h]=w,h++}else if(y.isSpotLight){var w=e.get(y);if(w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(g),w.color.copy(x).multiplyScalar(b),w.distance=M,w.direction.setFromMatrixPosition(y.matrixWorld),n.setFromMatrixPosition(y.target.matrixWorld),w.direction.sub(n),w.direction.transformDirection(g),w.coneCos=Math.cos(y.angle),w.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),w.decay=y.decay,w.shadow=y.castShadow,y.castShadow){var E=y.shadow;w.shadowBias=E.bias,w.shadowRadius=E.radius,w.shadowMapSize=E.mapSize}t.spotShadowMap[f]=S,t.spotShadowMatrix[f]=y.shadow.matrix,t.spot[f]=w,f++}else if(y.isRectAreaLight){var w=e.get(y);w.color.copy(x).multiplyScalar(b),w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(g),r.identity(),i.copy(y.matrixWorld),i.premultiply(g),r.extractRotation(i),w.halfWidth.set(.5*y.width,0,0),w.halfHeight.set(0,.5*y.height,0),w.halfWidth.applyMatrix4(r),w.halfHeight.applyMatrix4(r),t.rectArea[d]=w,d++}else if(y.isPointLight){var w=e.get(y);if(w.position.setFromMatrixPosition(y.matrixWorld),w.position.applyMatrix4(g),w.color.copy(y.color).multiplyScalar(y.intensity),w.distance=y.distance,w.decay=y.decay,w.shadow=y.castShadow,y.castShadow){var E=y.shadow;w.shadowBias=E.bias,w.shadowRadius=E.radius,w.shadowMapSize=E.mapSize,w.shadowCameraNear=E.camera.near,w.shadowCameraFar=E.camera.far}t.pointShadowMap[p]=S,t.pointShadowMatrix[p]=y.shadow.matrix,t.point[p]=w,p++}else if(y.isHemisphereLight){var w=e.get(y);w.direction.setFromMatrixPosition(y.matrixWorld),w.direction.transformDirection(g),w.direction.normalize(),w.skyColor.copy(y.color).multiplyScalar(b),w.groundColor.copy(y.groundColor).multiplyScalar(b),t.hemi[m]=w,m++}}t.ambient[0]=l,t.ambient[1]=c,t.ambient[2]=u,t.directional.length=h,t.spot.length=f,t.rectArea.length=d,t.point.length=p,t.hemi.length=m,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=p,t.hash.spotLength=f,t.hash.rectAreaLength=d,t.hash.hemiLength=m,t.hash.shadowsLength=o.length},state:t}}function wa(){var e=new Sa,t=[],n=[],i={lightsArray:t,shadowsArray:n,lights:e};return{init:function(){t.length=0,n.length=0},state:i,setupLights:function(i){e.setup(t,n,i)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function Ea(){var e={};return{get:function(t,n){var i;return void 0===e[t.id]?(i=new wa,e[t.id]={},e[t.id][n.id]=i):void 0===e[t.id][n.id]?(i=new wa,e[t.id][n.id]=i):i=e[t.id][n.id],i},dispose:function(){e={}}}}function Ta(e){ki.call(this),this.type="MeshDepthMaterial",this.depthPacking=xt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.map_etc_alpha=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Aa(e){ki.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new En,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.map_etc_alpha=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function La(e,t,n){for(var i=new Sn,r=new Mn,a=new Mn(n,n),o=new En,s=new En,l=1,c=2,u=1+(l|c),h=new Array(u),p=new Array(u),f={},d={0:b,1:x,2:M},m=[new En(1,0,0),new En(-1,0,0),new En(0,0,1),new En(0,0,-1),new En(0,1,0),new En(0,-1,0)],g=[new En(0,1,0),new En(0,1,0),new En(0,1,0),new En(0,1,0),new En(0,0,1),new En(0,0,-1)],v=[new Pn,new Pn,new Pn,new Pn,new Pn,new Pn],y=0;y!==u;++y){var S=0!=(y&l),w=0!=(y&c),E=new Ta({depthPacking:bt,morphTargets:S,skinning:w});h[y]=E;var T=new Aa({morphTargets:S,skinning:w});p[y]=T}var A=this;function L(t,n,i,r,a,o){var s=t.geometry,u=null,m=h,g=t.customDepthMaterial;if(i&&(m=p,g=t.customDistanceMaterial),g)u=g;else{var v=!1;n.morphTargets&&(s&&s.isBufferGeometry?v=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:s&&s.isGeometry&&(v=s.morphTargets&&s.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var _=t.isSkinnedMesh&&n.skinning,y=0;v&&(y|=l),_&&(y|=c),u=m[y]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var x=u.uuid,b=n.uuid,M=f[x];void 0===M&&(M={},f[x]=M);var S=M[b];void 0===S&&(S=u.clone(),M[b]=S),u=S}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=null!=n.shadowSide?n.shadowSide:d[n.side],u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,i&&u.isMeshDistanceMaterial&&(u.referencePosition.copy(r),u.nearDistance=a,u.farDistance=o),u}function C(n,i,r,a){if(!1!==n.visible){var o=n.layers.test(i.layers);if(o&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);var l=t.update(n),c=n.material;if(Array.isArray(c))for(var u=l.groups,h=0,p=u.length;h<p;h++){var f=u[h],d=c[f.materialIndex];if(d&&d.visible){var m=L(n,d,a,s,r.near,r.far);e.renderBufferDirect(r,null,l,m,n,f)}}else if(c.visible){var m=L(n,c,a,s,r.near,r.far);e.renderBufferDirect(r,null,l,m,n,null)}}for(var g=n.children,v=0,_=g.length;v<_;v++)C(g[v],i,r,a)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=_,this.render=function(t,n,l){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){e.context;var c,u=e.state;u.disable(3042),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(var h=0,p=t.length;h<p;h++){var f=t[h],d=f.shadow,_=f&&f.isPointLight;if(void 0!==d){var y=d.camera;if(r.copy(d.mapSize),r.min(a),_){var x=r.x,b=r.y;v[0].set(2*x,b,x,b),v[1].set(0,b,x,b),v[2].set(3*x,b,x,b),v[3].set(x,b,x,b),v[4].set(3*x,0,x,b),v[5].set(x,0,x,b),r.x*=4,r.y*=2}if(null===d.map){var M={minFilter:de,magFilter:de,format:Ue};d.map=new Rn(r.x,r.y,M),d.map.texture.name=f.name+".shadowMap",y.updateProjectionMatrix()}d.isSpotLightShadow&&d.update(f);var S=d.map,w=d.matrix;s.setFromMatrixPosition(f.matrixWorld),y.position.copy(s),_?(c=6,w.makeTranslation(-s.x,-s.y,-s.z)):(c=1,o.setFromMatrixPosition(f.target.matrixWorld),y.lookAt(o),y.updateMatrixWorld(),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(y.projectionMatrix),w.multiply(y.matrixWorldInverse)),e.setRenderTarget(S),e.clear();for(var E=0;E<c;E++){if(_){o.copy(y.position),o.add(m[E]),y.up.copy(g[E]),y.lookAt(o),y.updateMatrixWorld();var T=v[E];u.viewport(T)}i.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),C(n,l,y,_)}}else console.warn("THREE.WebGLShadowMap:",f,"has no shadow.")}A.needsUpdate=!1}}}function Ca(e,t,n,i){var r=new function(){var t=!1,n=new Pn,i=null,r=new Pn(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?re(2929):ae(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case X:e.depthFunc(512);break;case Y:e.depthFunc(519);break;case q:e.depthFunc(513);break;case K:e.depthFunc(515);break;case Z:e.depthFunc(514);break;case Q:e.depthFunc(518);break;case J:e.depthFunc(516);break;case $:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null;return{setTest:function(e){e?re(2960):ae(2960)},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,c=null}}},s=e.getParameter(34921),l=new Uint8Array(s),c=new Uint8Array(s),u=new Uint8Array(s),h={},p=null,f=null,d=null,_=null,y=null,x=null,S=null,R=null,I=null,D=null,U=!1,O=null,B=null,N=null,F=null,G=null,k=e.getParameter(35661),H=!1,V=0;-1!=="WebGL 1.0".indexOf("WebGL")?(V=parseFloat(/^WebGL\ ([0-9])/.exec("WebGL 1.0")[1]),H=V>=1):-1!=="WebGL 1.0".indexOf("OpenGL ES")&&(V=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec("WebGL 1.0")[1]),H=V>=2);var z=null,j={},W=new Pn,ee=new Pn;function te(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var ne={};function ie(n,r){if(l[n]=1,0===c[n]&&(e.enableVertexAttribArray(n),c[n]=1),u[n]!==r){var a=i.isWebGL2?e:t.get("ANGLE_instanced_arrays");a[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),u[n]=r}}function re(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function ae(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}function oe(t,i,r,a,o,s,l,c){if(t!==w){if(t===C)o=o||i,s=s||r,l=l||a,i===y&&o===R||(e.blendEquationSeparate(n.convert(i),n.convert(o)),y=i,R=o),r===x&&a===S&&s===I&&l===D||(e.blendFuncSeparate(n.convert(r),n.convert(a),n.convert(s),n.convert(l)),x=r,S=a,I=s,D=l),_=t,U=null;else if(t!==_||c!==U){if(y===P&&R===P||(e.blendEquation(32774),y=P,R=P),c)switch(t){case E:e.blendFuncSeparate(1,771,1,771);break;case T:e.blendFunc(1,1);break;case A:e.blendFuncSeparate(0,0,769,771);break;case L:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case E:e.blendFuncSeparate(770,771,1,771);break;case T:e.blendFunc(770,1);break;case A:e.blendFunc(0,769);break;case L:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}x=null,S=null,I=null,D=null,_=t,U=c}}else d&&(ae(3042),d=!1)}function se(t){O!==t&&(t?e.frontFace(2304):e.frontFace(2305),O=t)}function le(t){t!==m?(re(2884),t!==B&&(t===g?e.cullFace(1029):t===v?e.cullFace(1028):e.cullFace(1032))):ae(2884),B=t}function ce(t,n,i){t?(re(32823),F===n&&G===i||(e.polygonOffset(n,i),F=n,G=i)):ae(32823)}function ue(t){void 0===t&&(t=33984+k-1),z!==t&&(e.activeTexture(t),z=t)}return ne[3553]=te(3553,3553,1),ne[34067]=te(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),re(2929),a.setFunc(K),se(!1),le(g),re(2884),oe(w),{buffers:{color:r,depth:a,stencil:o},initAttributes:function(){for(var e=0,t=l.length;e<t;e++)l[e]=0},enableAttribute:function(e){ie(e,0)},enableAttributeAndDivisor:ie,disableUnusedAttributes:function(){for(var t=0,n=c.length;t!==n;++t)c[t]!==l[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:re,disable:ae,getCompressedTextureFormats:function(){if(null===p&&(p=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(34467),i=0;i<n.length;i++)p.push(n[i]);return p},useProgram:function(t){return f!==t&&(e.useProgram(t),!0)},setBlending:oe,setMaterial:function(e,t){e.side===M?ae(2884):re(2884);var n=e.side===b;t&&(n=!n),se(n),e.blending===E&&!1===e.transparent?oe(w):oe(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite),ce(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:se,setCullFace:le,setLineWidth:function(t){t!==N&&(H&&e.lineWidth(t),N=t)},setPolygonOffset:ce,setScissorTest:function(e){e?re(3089):ae(3089)},activeTexture:ue,bindTexture:function(t,n){null===z&&ue();var i=j[z];void 0===i&&(i={type:void 0,texture:void 0},j[z]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ne[t]),i.type=t,i.texture=n)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments),e.texParameteri(3553,10240,9728),e.texParameteri(3553,10241,9728)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments),e.texParameteri(3553,10240,9728),e.texParameteri(3553,10241,9728)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===W.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),W.copy(t))},viewport:function(t){!1===ee.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),ee.copy(t))},reset:function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);h={},p=null,z=null,j={},f=null,_=null,O=null,B=null,r.reset(),a.reset(),o.reset()}}}function Pa(e,t,n,i,r,a,o){var s,l={};function c(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var n=t/Math.max(e.width,e.height),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=Math.floor(e.width*n),i.height=Math.floor(e.height*n);var r=i.getContext("2d");return r.drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height),i}return e}function u(e){return bn.isPowerOfTwo(e.width)&&bn.isPowerOfTwo(e.height)}function h(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==ve}function p(e,t,n,r){var a=i.get(t);a.__maxMipLevel=0}function f(e,t){if(!r.isWebGL2)return e;if(6403===e){if(5126===t)return 33326;if(5131===t)return 33325;if(5121===t)return 33321}if(6407===e){if(5126===t)return 34837;if(5131===t)return 34843;if(5121===t)return 32849}if(6408===e){if(5126===t)return 34836;if(5131===t)return 34842;if(5121===t)return 32856}return e}function d(e){return e===de||e===me||e===ge?9728:9729}function m(t){var n=t.target;n.removeEventListener("dispose",m),function(t){var n=i.get(t);if(t.image&&n.__image__webglTextureCube)e.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture)}i.remove(t)}(n),n.isVideoTexture&&delete l[n.id],o.memory.textures--}function g(t){var n=t.target;n.removeEventListener("dispose",g),function(t){var n=i.get(t),r=i.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);i.remove(t.texture),i.remove(t)}}(n),o.memory.textures--}function v(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=e.id,n=o.render.frame;l[t]!==n&&(l[t]=n,e.update())}(e),e.version>0&&r.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void y(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function _(n,o,s){if(s?(e.texParameteri(n,10242,a.convert(o.wrapS)),e.texParameteri(n,10243,a.convert(o.wrapT)),e.texParameteri(n,10240,a.convert(o.magFilter)),e.texParameteri(n,10241,a.convert(o.minFilter))):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),o.wrapS===pe&&o.wrapT===pe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,d(o.magFilter)),e.texParameteri(n,10241,d(o.minFilter)),o.minFilter!==de&&o.minFilter!==ve&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.get("EXT_texture_filter_anisotropic")){if(o.type===Te&&null===t.get("OES_texture_float_linear"))return;if(o.type===Ae&&null===(r.isWebGL2||t.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,34046,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function y(t,i,l){var d;d=i.isDataTexture3D?32879:3553,void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",m),t.__webglTexture=e.createTexture(),o.memory.textures++),n.activeTexture(33984+l),n.bindTexture(d,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment);var g=c(i.image,r.maxTextureSize);(function(e){return!r.isWebGL2&&(e.wrapS!==pe||e.wrapT!==pe||e.minFilter!==de&&e.minFilter!==ve)})(i)&&!1===u(g)&&(g=function(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){void 0===s&&(s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),s.width=bn.floorPowerOfTwo(e.width),s.height=bn.floorPowerOfTwo(e.height);var t=s.getContext("2d");return t.drawImage(e,0,0,s.width,s.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+s.width+"x"+s.height),s}return e}(g));var v=u(g),y=a.convert(i.format),x=a.convert(i.type),b=f(y,x);_(d,i,v);var M,S,w=i.mipmaps;if(i.isDepthTexture){if(b=6402,i.type===Te){if(!r.isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");b=36012}else r.isWebGL2&&(b=33189);i.format===Fe&&6402===b&&i.type!==Se&&i.type!==Ee&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Se,x=a.convert(i.type)),i.format===Ge&&(b=34041,i.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Re,x=a.convert(i.type))),n.texImage2D(3553,0,b,g.width,g.height,0,y,x,null)}else if(i.isDataTexture)if(w.length>0&&v){for(var E=0,T=w.length;E<T;E++)M=w[E],n.texImage2D(3553,E,b,M.width,M.height,0,y,x,M.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,b,g.width,g.height,0,y,x,g.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){g.webPvr&&e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),g.webEtc&&e.getExtension("WEBGL_compressed_texture_etc1");var A=(S=g.imgFormat)===wt?35842:S===Et?36196:void 0;n.compressedTexImage2D(3553,0,A,g.width,g.height,0,g.buffer),t.__maxMipLevel=0,g.buffer&&g.buffer.dispose&&g.buffer.dispose(),g.buffer=void 0}else if(i.isDataTexture3D)n.texImage3D(32879,0,b,g.width,g.height,g.depth,0,y,x,g.data),t.__maxMipLevel=0;else if(w.length>0&&v){for(var E=0,T=w.length;E<T;E++)M=w[E],n.texImage2D(3553,E,b,y,x,M);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,b,y,x,g),t.__maxMipLevel=0,g.buffer&&g.buffer.dispose&&g.buffer.dispose(),g.buffer=void 0;h(i,v)&&p(0,i,g.width,g.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function x(t,r,o,s){var l=a.convert(r.texture.format),c=a.convert(r.texture.type),u=f(l,c);n.texImage2D(s,0,u,r.width,r.height,0,l,c,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function b(t,n){e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(36161,33189,n.width,n.height),e.framebufferRenderbuffer(36160,36096,36161,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)):e.renderbufferStorage(36161,32854,n.width,n.height),e.bindRenderbuffer(36161,null)}function M(t){var n=i.get(t),r=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),v(n.depthTexture,0);var r=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Fe)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(n.depthTexture.format!==Ge)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),b(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),b(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}this.setTexture2D=v,this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?y(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,s){var l=i.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",m),l.__image__webglTextureCube=e.createTexture(),o.memory.textures++),n.activeTexture(33984+s),n.bindTexture(34067,l.__image__webglTextureCube),e.pixelStorei(37440,t.flipY);for(var d=t&&t.isCompressedTexture,g=t.image[0]&&t.image[0].isDataTexture,v=[],y=0;y<6;y++)v[y]=d||g?g?t.image[y].image:t.image[y]:c(t.image[y],r.maxCubemapSize);var x=v[0],b=u(x),M=a.convert(t.format),S=a.convert(t.type),w=f(M,S);_(34067,t,b);for(var y=0;y<6;y++)if(d)for(var E,T=v[y].mipmaps,A=0,L=T.length;A<L;A++)E=T[A],t.format!==Ue&&t.format!==De?n.getCompressedTextureFormats().indexOf(M)>-1?n.compressedTexImage2D(34069+y,A,w,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+y,A,w,E.width,E.height,0,M,S,E.data);else g?n.texImage2D(34069+y,0,w,v[y].width,v[y].height,0,M,S,v[y].data):n.texImage2D(34069+y,0,w,M,S,v[y]);l.__maxMipLevel=d?T.length-1:0,h(t,b)&&p(0,t,x.width,x.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+s),n.bindTexture(34067,l.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){n.activeTexture(33984+t),n.bindTexture(34067,i.get(e).__webglTexture)},this.setupRenderTarget=function(t){var r=i.get(t),a=i.get(t.texture);t.addEventListener("dispose",g),a.__webglTexture=e.createTexture(),o.memory.textures++;var s=!0===t.isWebGLRenderTargetCube,l=u(t);if(s){r.__webglFramebuffer=[];for(var c=0;c<6;c++)r.__webglFramebuffer[c]=e.createFramebuffer()}else r.__webglFramebuffer=e.createFramebuffer();if(s){n.bindTexture(34067,a.__webglTexture),_(34067,t.texture,l);for(var c=0;c<6;c++)x(r.__webglFramebuffer[c],t,36064,34069+c);h(t.texture,l)&&p(0,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,a.__webglTexture),_(3553,t.texture,l),x(r.__webglFramebuffer,t,36064,3553),h(t.texture,l)&&p(0,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&M(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture,r=u(e);if(h(t,r)){var a=e.isWebGLRenderTargetCube?34067:3553,o=i.get(t).__webglTexture;n.bindTexture(a,o),p(0,t,e.width,e.height),n.bindTexture(a,null)}}}function Ra(e,t,n){return{convert:function(e){var i;if(e===he)return 10497;if(e===pe)return 33071;if(e===fe)return 33648;if(e===de)return 9728;if(e===me)return 9984;if(e===ge)return 9986;if(e===ve)return 9729;if(e===_e)return 9985;if(e===ye)return 9987;if(e===xe)return 5121;if(e===Le)return 32819;if(e===Ce)return 32820;if(e===Pe)return 33635;if(e===be)return 5120;if(e===Me)return 5122;if(e===Se)return 5123;if(e===we)return 5124;if(e===Ee)return 5125;if(e===Te)return 5126;if(e===Ae){if(n.isWebGL2)return 5131;if(null!==(i=t.get("OES_texture_half_float")))return 36193}if(e===Ie)return 6406;if(e===De)return 6407;if(e===Ue)return 6408;if(e===Oe)return 6409;if(e===Be)return 6410;if(e===Fe)return 6402;if(e===Ge)return 34041;if(e===ke)return 6403;if(e===P)return 32774;if(e===R)return 32778;if(e===I)return 32779;if(e===O)return 0;if(e===B)return 1;if(e===N)return 768;if(e===F)return 769;if(e===G)return 770;if(e===k)return 771;if(e===H)return 772;if(e===V)return 773;if(e===z)return 774;if(e===j)return 775;if(e===W)return 776;if((e===He||e===Ve||e===ze||e===je)&&null!==(i=t.get("WEBGL_compressed_texture_s3tc"))){if(e===He)return 33776;if(e===Ve)return 33777;if(e===ze)return 33778;if(e===je)return 33779}if((e===We||e===Xe||e===Ye||e===qe)&&null!==(i=t.get("WEBGL_compressed_texture_pvrtc"))){if(e===We)return 35840;if(e===Xe)return 35841;if(e===Ye)return 35842;if(e===qe)return 35843}if(e===Ke&&null!==(i=t.get("WEBGL_compressed_texture_etc1")))return i.COMPRESSED_RGB_ETC1_WEBGL;if((e===Ze||e===Qe||e===Je||e===$e||e===et||e===tt||e===nt||e===it||e===rt||e===at||e===ot||e===st||e===lt||e===ct)&&null!==(i=t.get("WEBGL_compressed_texture_astc")))return e;if(e===D||e===U){if(n.isWebGL2){if(e===D)return 32775;if(e===U)return 32776}if(null!==(i=t.get("EXT_blend_minmax"))){if(e===D)return 32775;if(e===U)return 32776}}if(e===Re){if(n.isWebGL2)return 34042;if(null!==(i=t.get("WEBGL_depth_texture")))return 34042}return 0}}}function Ia(e){console.log("THREE.WebGLRenderer",d);var t=void 0,n=void 0!==(e=e||{}).context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=null,h=null;this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=ie,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,f,m,g,v,_,y,x,S,w,E,T,A,L,C,P,R,I,D=this,U=null,O=null,B=null,N=-1,F={geometry:null,program:null,wireframe:!1},G=null,k=null,H=new Pn,V=new Pn,z=null,j=0,W=void 0!==t?t.width:0,X=void 0!==t?t.height:0,Y=1,q=new Pn(0,0,W,X),K=new Pn(0,0,W,X),Z=!1,Q=new Zi,J=!1,$=!1,ee=new Sn,te=new En;function ne(){return null===O?Y:1}try{var re={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c};void 0===(p=n||t.getContext("webgl",re)||t.getContext("experimental-webgl",re)).getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}f=new Qi(p),m=new qi(p,f,e),console.log("glinfo:"+JSON.stringify(m)),m.isWebGL2||(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),I=new Ra(p,f,m),(g=new Ca(p,f,I,m)).scissor(V.copy(K).multiplyScalar(Y)),g.viewport(H.copy(q).multiplyScalar(Y)),v=new er(p),_=new oa,y=new Pa(p,f,g,_,m,I,v),x=new Xn(p),S=new Ji(p,x,v),w=new ir(S,v),C=new nr(p),E=new aa(D,f,m),T=new ua,A=new Ea,L=new Xi(D,g,w,s),P=new Yi(p,f,v,m),R=new $i(p,f,v,m),v.programs=E.programs,D.context=p,D.capabilities=m,D.extensions=f,D.properties=_,D.renderLists=T,D.state=g,D.info=v;var ae,oe=new La(D,w,m.maxTextureSize);function se(e){var t=e.target;t.removeEventListener("dispose",se),function(e){le(e),_.remove(e)}(t)}function le(e){var t=_.get(e).program;e.program=void 0,void 0!==t&&E.releaseProgram(t)}function ce(e,t,n,i){for(var r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,l=o.geometry,c=void 0===i?o.material:i,u=o.group;if(n.isArrayCamera){k=n;for(var p=n.cameras,f=0,d=p.length;f<d;f++){var m=p[f];if(s.layers.test(m.layers)){if("viewport"in m)g.viewport(H.copy(m.viewport));else{var v=m.bounds,_=v.x*W,y=v.y*X,x=v.z*W,b=v.w*X;g.viewport(H.set(_,y,x,b).multiplyScalar(Y))}h.setupLights(m),ue(s,t,m,l,c,u)}}}else k=null,ue(s,t,n,l,c,u)}}function ue(e,t,n,i,r,a){if(e.onBeforeRender(D,t,n,i,r,a),h=A.get(t,k||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){g.setMaterial(r);var o=pe(n,t.fog,r,e);F.geometry=null,F.program=null,F.wireframe=!1,function(e,t){e.render(function(e){D.renderBufferImmediate(e,t)})}(e,o)}else D.renderBufferDirect(n,t.fog,i,r,e,a);e.onAfterRender(D,t,n,i,r,a),h=A.get(t,k||n)}function he(e,t,n){var i=_.get(e),r=h.state.lights,a=h.state.shadowsArray,o=i.lightsHash,s=r.state.hash,l=E.getParameters(e,r.state,a,t,Q.numPlanes,Q.numIntersection,n),c=E.getProgramCode(e,l);void 0===window.allshaderCodes&&(window.allshaderCodes={}),window.allshaderCodes[c]?window.allshaderCodes[c]+=1:(window.allshaderCodes[c]=1,console.log("bk.engine new shaderCode:",l));var u=i.program,p=!0;if(void 0===u)e.addEventListener("dispose",se);else if(u.code!==c)le(e);else if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,p=!1;else{if(void 0!==l.shaderID)return;p=!1}if(p){if(l.shaderID){var f=Wn[l.shaderID];i.shader={name:e.type,uniforms:Un(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader,D),c=E.getProgramCode(e,l),u=E.acquireProgram(e,i.shader,l,c),i.program=u,e.program=u}var d=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var m=0;m<D.maxMorphTargets;m++)d["morphTarget"+m]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var m=0;m<D.maxMorphNormals;m++)d["morphNormal"+m]>=0&&e.numSupportedMorphNormals++}var g=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(i.numClippingPlanes=Q.numPlanes,i.numIntersection=Q.numIntersection,g.clippingPlanes=Q.uniform),i.fog=t,void 0===o&&(i.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(g.ambientLightColor.value=r.state.ambient,g.directionalLights.value=r.state.directional,g.spotLights.value=r.state.spot,g.rectAreaLights.value=r.state.rectArea,g.pointLights.value=r.state.point,g.hemisphereLights.value=r.state.hemi,g.directionalShadowMap.value=r.state.directionalShadowMap,g.directionalShadowMatrix.value=r.state.directionalShadowMatrix,g.spotShadowMap.value=r.state.spotShadowMap,g.spotShadowMatrix.value=r.state.spotShadowMatrix,g.pointShadowMap.value=r.state.pointShadowMap,g.pointShadowMatrix.value=r.state.pointShadowMatrix);var v=i.program.getUniforms(),y=qr.seqWithValue(v.seq,g);i.uniformsList=y}function pe(e,t,n,i){j=0;var r=_.get(n),a=h.state.lights,o=r.lightsHash,s=a.state.hash;if(J&&($||e!==G)){var l=e===G&&n.id===N;Q.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,r,l)}!1===n.needsUpdate&&(void 0===r.program?n.needsUpdate=!0:n.fog&&r.fog!==t?n.needsUpdate=!0:(!n.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===r.numClippingPlanes||r.numClippingPlanes===Q.numPlanes&&r.numIntersection===Q.numIntersection)||(n.needsUpdate=!0)),n.needsUpdate&&(he(n,t,i),n.needsUpdate=!1);var c,u,f=!1,d=!1,v=!1,y=r.program,x=y.getUniforms(),M=r.shader.uniforms;if(g.useProgram(y.program)&&(f=!0,d=!0,v=!0),n.id!==N&&(N=n.id,d=!0),f||G!==e){if(x.setValue(p,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&x.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),G!==e&&(G=e,d=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap||n.isMeshPhysicalMaterial||n.isMeshUnityPBSMaterial){var S=x.map.cameraPosition;void 0!==S&&S.setValue(p,te.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&x.setValue(p,"viewMatrix",e.matrixWorldInverse)}if(!0!==n.isCPUSkinning&&n.skinning){x.setOptional(p,i,"bindMatrix"),x.setOptional(p,i,"bindMatrixInverse");var w=i.skeleton;if(w){var E=w.bones;if(m.floatVertexTextures){if(void 0===w.boneTexture){var T=Math.sqrt(4*E.length);T=bn.ceilPowerOfTwo(T),T=Math.max(T,4);var A=new Float32Array(T*T*4);A.set(w.boneMatrices);var L=new In(A,T,T,Ue,Te);L.needsUpdate=!0,w.boneMatrices=A,w.nativeSkeleton&&w.nativeSkeleton.setBoneMatrices(w.boneMatrices),w.boneTexture=L,w.boneTextureSize=T}x.setValue(p,"boneTexture",w.boneTexture),x.setValue(p,"boneTextureSize",w.boneTextureSize)}else x.setOptional(p,w,"boneMatrices")}}return d&&(x.setValue(p,"toneMappingExposure",D.toneMappingExposure),x.setValue(p,"toneMappingWhitePoint",D.toneMappingWhitePoint),n.lights&&(u=v,(c=M).ambientLightColor.needsUpdate=u,c.directionalLights.needsUpdate=u,c.pointLights.needsUpdate=u,c.spotLights.needsUpdate=u,c.rectAreaLights.needsUpdate=u,c.hemisphereLights.needsUpdate=u),t&&n.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(M,t),n.isMeshBasicMaterial?fe(M,n):n.isMeshLambertMaterial?(fe(M,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,t.emissiveMap_etc_alpha&&(e.emissiveMap_etc_alpha.value=t.emissiveMap_etc_alpha))}(M,n)):n.isMeshPhongMaterial?(fe(M,n),n.isMeshToonMaterial?function(e,t){de(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(M,n):de(M,n)):n.isMeshStandardMaterial?(fe(M,n),n.isMeshPhysicalMaterial?function(e,t){e.specular.value=t.specular,me(e,t),e.reflectivity.value=t.reflectivity,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness}(M,n):me(M,n),n.isMeshUnityPBSMaterial&&(function(e,t){e.specular.value=t.specular,e.setup_type.value=t.setup_type,e.smoothnessTextureChannel.value=t.smoothnessTextureChannel,e.smoothnessScale.value=t.smoothnessScale,me(e,t),e.reflectivity.value=t.reflectivity}(M,n),n.isUnityPBSSkinMaterial&&function(e,t){t.deltaHSV&&(e.deltaHSV.value={x:t.deltaHSV.x,y:t.deltaHSV.y,z:t.deltaHSV.z}),t.skinMap&&(e.skinMap.value=t.skinMap),t.maskMap&&(e.maskMap.value=t.maskMap),t.otherPartWorkflow&&t.otherPartWorkflow>0&&(e.otherPartWorkflow.value=t.otherPartWorkflow,t.autodeskGlossiness&&(e.autodeskGlossiness.value=t.autodeskGlossiness),t.autodeskSpecGlossMap&&(e.autodeskSpecGlossMap.value=t.autodeskSpecGlossMap),t.autodeskMetallic&&(e.autodeskMetallic.value=t.autodeskMetallic),t.autodeskMetallicGlossMap&&(e.autodeskMetallicGlossMap.value=t.autodeskMetallicGlossMap),t.customStandardGlossiness&&(e.customStandardGlossiness.value=t.customStandardGlossiness),t.customStandardGlossMapScale&&(e.customStandardGlossMapScale.value=t.customStandardGlossMapScale),t.customStandardMetallic&&(e.customStandardMetallic.value=t.customStandardMetallic),t.customStandardMetallicGlossMap&&(e.customStandardMetallicGlossMap.value=t.customStandardMetallicGlossMap),t.customStandardSmoothnessTextureChannel&&(e.customStandardSmoothnessTextureChannel.value=t.customStandardSmoothnessTextureChannel),t.customSpecularGlossiness&&(e.customSpecularGlossiness.value=t.customSpecularGlossiness),t.customSpecularGlossMapScale&&(e.customSpecularGlossMapScale.value=t.customSpecularGlossMapScale),t.customSpecularSmoothnessTextureChannel&&(e.customSpecularSmoothnessTextureChannel.value=t.customSpecularSmoothnessTextureChannel),t.customSpecularColor&&(e.customSpecularColor.value=t.customSpecularColor),t.customSpecularGlossMap&&(e.customSpecularGlossMap.value=t.customSpecularGlossMap))}(M,n))):n.isMeshMatcapMaterial?(fe(M,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshDepthMaterial?(fe(M,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshDistanceMaterial?(fe(M,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(M,n)):n.isMeshNormalMaterial?(fe(M,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(M,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(M,n)):n.isPointsMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*Y,e.scale.value=.5*X,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(M,n):n.isSpriteMaterial?function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.rotation.value=t.rotation,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}(M,n):n.isShadowMaterial?(M.color.value=n.color,M.opacity.value=n.opacity):n.isUnitySkyBoxMaterial&&(fe(M,n),function(e,t){e.rotation.value=t.rotation,e.exposure.value=t.exposure,e.tintColor.value=t.tintColor}(M,n)),void 0!==M.ltc_1&&(M.ltc_1.value=jn.LTC_1),void 0!==M.ltc_2&&(M.ltc_2.value=jn.LTC_2),qr.upload(p,r.uniformsList,M,D)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qr.upload(p,r.uniformsList,M,D),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&x.setValue(p,"center",i.center),x.setValue(p,"modelViewMatrix",i.modelViewMatrix),x.setValue(p,"normalMatrix",i.normalMatrix),x.setValue(p,"modelMatrix",i.matrixWorld),y}function fe(e,t){var n;e.bDoubleSide.value=t.side===M,e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map,t.map_etc_alpha&&(e.map_etc_alpha.value=t.map_etc_alpha)),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=_.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function de(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,t.emissiveMap_etc_alpha&&(e.emissiveMap_etc_alpha.value=t.emissiveMap_etc_alpha)),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function me(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,t.roughnessMap_etc_alpha&&(e.roughnessMap_etc_alpha.value=t.roughnessMap_etc_alpha)),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,t.metalnessMap_etc_alpha&&(e.metalnessMap_etc_alpha.value=t.metalnessMap_etc_alpha)),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap,t.emissiveMap_etc_alpha&&(e.emissiveMap_etc_alpha.value=t.emissiveMap_etc_alpha)),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===b&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===b&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}this.shadowMap=oe,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return Y},this.setPixelRatio=function(e){void 0!==e&&(Y=e,this.setSize(W,X,!1))},this.getSize=function(){return{width:W,height:X}},this.setSize=function(e,t,n){W=e,X=t,this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(){return{width:W*Y,height:X*Y}},this.setDrawingBufferSize=function(e,t,n){W=e,X=t,Y=n,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return H},this.setViewport=function(e,t,n,i){q.set(e,X-t-i,n,i),g.viewport(H.copy(q).multiplyScalar(Y))},this.setScissor=function(e,t,n,i){K.set(e,X-t-i,n,i),g.scissor(V.copy(K).multiplyScalar(Y))},this.setScissorTest=function(e){g.setScissorTest(Z=e)},this.getClearColor=function(){return L.getClearColor()},this.setClearColor=function(){L.setClearColor.apply(L,arguments)},this.getClearAlpha=function(){return L.getClearAlpha()},this.setClearAlpha=function(){L.setClearAlpha.apply(L,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),p.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){T.dispose(),A.dispose(),_.dispose(),w.dispose()},this.renderBufferImmediate=function(e,t){g.initAttributes();var n=_.get(e);e.hasPositions&&!n.position&&(n.position=p.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),e.hasColors&&!n.color&&(n.color=p.createBuffer());var i=t.getAttributes();e.hasPositions&&(p.bindBuffer(34962,n.position),p.bufferData(34962,e.positionArray,35048),g.enableAttribute(i.position),p.vertexAttribPointer(i.position,3,5126,!1,0,0)),e.hasNormals&&(p.bindBuffer(34962,n.normal),p.bufferData(34962,e.normalArray,35048),g.enableAttribute(i.normal),p.vertexAttribPointer(i.normal,3,5126,!1,0,0)),e.hasUvs&&(p.bindBuffer(34962,n.uv),p.bufferData(34962,e.uvArray,35048),g.enableAttribute(i.uv),p.vertexAttribPointer(i.uv,2,5126,!1,0,0)),e.hasColors&&(p.bindBuffer(34962,n.color),p.bufferData(34962,e.colorArray,35048),g.enableAttribute(i.color),p.vertexAttribPointer(i.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),p.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,a){var o=r.isMesh&&r.normalMatrix.determinant()<0;g.setMaterial(i,o);var s=pe(e,t,i,r),l=!1;F.geometry===n.id&&F.program===s.id&&F.wireframe===(!0===i.wireframe)||(F.geometry=n.id,F.program=s.id,F.wireframe=!0===i.wireframe,l=!0),r.morphTargetInfluences&&(C.update(r,n,i,s),l=!0);var c,u=n.index,h=n.attributes.position,d=1;!0===i.wireframe&&(u=S.getWireframeAttribute(n),d=2);var v=P;null!==u&&(c=x.get(u),(v=R).setIndex(c)),l&&(function(e,t,n){if(n&&n.isInstancedBufferGeometry&!m.isWebGL2&&null===f.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{g.initAttributes();var i=n.attributes,r=t.getAttributes(),a=e.defaultAttributeValues;for(var o in r){var s=r[o];if(s>=0){var l=i[o];if(void 0!==l){var c=l.normalized,u=l.itemSize,h=x.get(l);if(void 0===h)continue;var d=h.buffer,v=h.type,_=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var y=l.data,b=y.stride,M=l.offset;y&&y.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(s,y.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=y.meshPerAttribute*y.count)):g.enableAttribute(s),p.bindBuffer(34962,d),p.vertexAttribPointer(s,u,v,c,b*_,M*_)}else l.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(s,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):g.enableAttribute(s),p.bindBuffer(34962,d),p.vertexAttribPointer(s,u,v,c,0,0)}else if(void 0!==a){var S=a[o];if(void 0!==S)switch(S.length){case 2:p.vertexAttrib2fv(s,S);break;case 3:p.vertexAttrib3fv(s,S);break;case 4:p.vertexAttrib4fv(s,S);break;default:p.vertexAttrib1fv(s,S)}}}}}}(i,s,n),null!==u&&p.bindBuffer(34963,c.buffer));var _=1/0;null!==u?_=u.count:void 0!==h&&(_=h.count);var y=n.drawRange.start*d,b=n.drawRange.count*d,M=null!==a?a.start*d:0,w=null!==a?a.count*d:1/0,E=Math.max(y,M),T=Math.min(_,y+b,M+w)-1,A=Math.max(0,T-E+1);if(0!==A){if(r.isMesh)if(!0===i.wireframe)g.setLineWidth(i.wireframeLinewidth*ne()),v.setMode(1);else switch(r.drawMode){case ut:v.setMode(4);break;case ht:v.setMode(5);break;case pt:v.setMode(6)}else if(r.isLine){var L=i.linewidth;void 0===L&&(L=1),g.setLineWidth(L*ne()),r.isLineSegments?v.setMode(1):r.isLineLoop?v.setMode(2):v.setMode(3)}else r.isPoints?v.setMode(0):r.isSprite&&v.setMode(4);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&v.renderInstances(n,E,A):v.render(E,A)}},this.compile=function(e,t){(h=A.get(e,t)).init(),e.traverse(function(e){e.isLight&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))}),h.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)he(t.material[n],e.fog,t);else he(t.material,e.fog,t)})},this.render=function(e,t,n,i){if(t&&t.isCamera){F.geometry=null,F.program=null,F.wireframe=!1,N=-1,G=null,!0===e.autoUpdate&&e.update(this.deltaTime||0),null===t.parent&&t.updateMatrixWorld(),(h=A.get(e,t)).init(),e.onBeforeRender(D,e,t,n),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),$=this.localClippingEnabled,J=Q.init(this.clippingPlanes,$,t),(u=T.get(e,t)).init(),function e(t,n,i){if(!1!==t.visible){var r=t.layers.test(n.layers);if(r)if(t.isLight)h.pushLight(t),t.castShadow&&h.pushShadow(t);else if(t.isSprite){i&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee);var a=w.update(t),o=t.material;u.push(t,a,o,te.z,null)}else if(t.isImmediateRenderObject)i&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee),u.push(t,null,t.material,te.z,null);else if(t.isMesh||t.isLine||t.isPoints){var o=t.material;if(t.isSkinnedMesh){t.skeleton.boneTexture&&(t.skeleton.boneTexture.needsUpdate=!0);var a=t.geometry;if(!0===o.isCPUSkinning&&void 0!==a.attributes.position){var s=a.attributes.position.count,l=a.attributes.position.array;a.attributes.position.dynamic=!0,a.attributes.position.needsUpdate=!0;var c=null;void 0!==a.attributes.normal&&(c=a.attributes.normal.array,a.attributes.normal.dynamic=!0,a.attributes.normal.needsUpdate=!0);var p=null;void 0!==a.attributes.skinIndex&&(p=a.attributes.skinIndex.array,a.attributes.skinIndex.dynamic=!0,a.attributes.skinIndex.cpuSkinning=!0);var f=null;void 0!==a.attributes.skinWeight&&(f=a.attributes.skinWeight.array,a.attributes.skinWeight.dynamic=!0,a.attributes.skinWeight.cpuSkinning=!0),t._native_object3d.updateSkinning(s,l,c,p,f)}}i&&te.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ee);var a=w.update(t);if(Array.isArray(o))for(var d=a.groups,m=0,g=d.length;m<g;m++){var v=d[m],_=o[v.materialIndex];_&&_.visible&&u.push(t,a,_,te.z,v)}else o.visible&&u.push(t,a,o,te.z,null)}for(var y=t.children,m=0,g=y.length;m<g;m++)e(y[m],n,i)}}(e,t,D.sortObjects),!0===D.sortObjects&&u.sort(),J&&Q.beginShadows();var r=h.state.shadowsArray;oe.render(r,e,t),h.setupLights(t),J&&Q.endShadows(),this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),L.render(u,e,t,i);var a=u.opaque,o=u.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&ce(a,e,t,s),o.length&&ce(o,e,t,s)}else a.length&&ce(a,e,t),o.length&&ce(o,e,t);n&&y.updateRenderTargetMipmap(n),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),e.onAfterRender(D,e,t),u=null,h=null}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=j;return e>=m.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+m.maxTextures),j+=1,e},this.setTexture2D=(ae=!1,function(e,t){e&&e.isWebGLRenderTarget&&(ae||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),ae=!0),e=e.texture),y.setTexture2D(e,t)}),this.setTexture3D=function(e,t){y.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),y.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?y.setTextureCube(t,n):y.setTextureCubeDynamic(t,n)}}(),this.setFramebuffer=function(e){U=e},this.getRenderTarget=function(){return O},this.setRenderTarget=function(e){O=e,e&&void 0===_.get(e).__webglFramebuffer&&y.setupRenderTarget(e);var t=U,n=!1;if(e){var i=_.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=i[e.activeCubeFace],n=!0):t=i,H.copy(e.viewport),V.copy(e.scissor),z=e.scissorTest}else H.copy(q).multiplyScalar(Y),V.copy(K).multiplyScalar(Y),z=Z;if(B!==t&&(p.bindFramebuffer(36160,t),B=t),g.viewport(H),g.scissor(V),g.setScissorTest(z),n){var r=_.get(e.texture);p.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,n,i,r,a){if(e&&e.isWebGLRenderTarget){var o=_.get(e).__webglFramebuffer;if(o){var s=!1;o!==B&&(p.bindFramebuffer(36160,o),s=!0);try{var l=e.texture,c=l.format,u=l.type;if(c!==Ue&&I.convert(c)!==p.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(u===xe||I.convert(u)===p.getParameter(35738)||u===Te&&(m.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||u===Ae&&(m.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===p.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&p.readPixels(t,n,i,r,I.convert(c),I.convert(u),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&p.bindFramebuffer(36160,B)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var i=t.image.width,r=t.image.height,a=I.convert(t.format);this.setTexture2D(t,0),p.copyTexImage2D(3553,n||0,a,e.x,e.y,i,r,0)},this.copyTextureToTexture=function(e,t,n,i){var r=t.image.width,a=t.image.height,o=I.convert(n.format),s=I.convert(n.type);this.setTexture2D(n,0),t.isDataTexture?p.texSubImage2D(3553,i||0,e.x,e.y,r,a,o,s,t.image.data):p.texSubImage2D(3553,i||0,e.x,e.y,o,s,t.image)},this.unityColorSpace=2,e.unityColorSpace&&(this.unityColorSpace=e.unityColorSpace)}function Da(){$n.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Ua(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Oa(e,t,n,i){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}function Ba(e){ki.call(this),this.type="SpriteMaterial",this.color=new Gn(16777215),this.map=null,this.map_etc_alpha=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function Na(e){if($n.call(this),this.type="Sprite",void 0===pa){pa=new Mi;var t=new Float32Array([-20,-20,0,0,0,20,-20,0,1,0,20,20,0,1,1,-20,20,0,0,1]),n=new Ua(t,5);pa.setIndex([0,1,2,0,2,3]),pa.addAttribute("position",new Oa(n,3,0,!1)),pa.addAttribute("uv",new Oa(n,2,3,!1))}this.geometry=pa,this.material=void 0!==e?e:new Ba,this.center=new Mn(.5,.5)}function Fa(e){ki.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Gn(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.map_etc_alpha=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.emissiveMap_etc_alpha=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.roughnessMap_etc_alpha=null,this.metalnessMap=null,this.metalnessMap_etc_alpha=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ga(e){Fa.call(this),this.defines={PHYSICAL:"",UNITY_PBS:""},this.type="MeshUnityPBSMaterial",this.reflectivity=.5,this.specular=new Gn(16777215),this.specularMap=null,this.setup_type=e.setup_type,this.smoothnessTextureChannel=e.smoothnessTextureChannel,this.smoothnessScale=e.smoothnessScale,e&&void 0===e.roughness&&(e.roughness=1),this.setValues(e)}function ka(e){Ga.call(this),this.type="MeshPhysicalCPUSkinningMaterial",this.setValues(e)}function Ha(e,t){this.bindMode="attached",this.bindMatrix=new Sn,this.bindMatrixInverse=new Sn,this._bufferInt32=new Int32Array([0,1]),this._bufferFloat32=new Float32Array([0,0,0,0,0,0,0,0,0,0,1,1,1]),this._native_object3d=new BK.TSkinnedMesh(this._bufferInt32,this._bufferFloat32),this._native_object3d.setBindMatrix(this.bindMatrix.elements,this.bindMatrixInverse.elements),e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Wi.call(this,e,t),this.type="SkinnedMesh"}function Va(e,t){var n=this;e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length);var i=e.map(function(e){return e._native_object3d});if(t&&(this.nativeBoneInverses=new Float32Array(16*t.length),t.forEach(function(e,t){return n.nativeBoneInverses.set(e.elements,16*t)})),this.nativeSkeleton=new BK.TSkeleton(i,this.nativeBoneInverses,this.boneMatrices),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,a=this.bones.length;r<a;r++)this.boneInverses.push(new Sn)}}function za(){$n.call(this),this.type="Bone"}function ja(){$n.call(this),this.type="Group"}function Wa(e,t,n,i,r,a,o,s,l,c){if((c=void 0!==c?c:Fe)!==Fe&&c!==Ge)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&c===Fe&&(n=Se),void 0===n&&c===Ge&&(n=Re),Cn.call(this,null,i,r,a,o,s,c,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:de,this.minFilter=void 0!==s?s:de,this.flipY=!1,this.generateMipmaps=!1}function Xa(e,t,n,i,r,a,o){li.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new Ya(e,t,n,i,r,a,o)),this.mergeVertices()}function Ya(e,t,n,i,r,a,o){Mi.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,l,c=a+o,u=0,h=[],p=new En,f=new En,d=[],m=[],g=[],v=[];for(l=0;l<=n;l++){var _=[],y=l/n;for(s=0;s<=t;s++){var x=s/t;p.x=-e*Math.cos(i+x*r)*Math.sin(a+y*o),p.y=e*Math.cos(a+y*o),p.z=e*Math.sin(i+x*r)*Math.sin(a+y*o),m.push(p.x,p.y,p.z),f.set(p.x,p.y,p.z).normalize(),g.push(f.x,f.y,f.z),v.push(x,1-y),_.push(u++)}h.push(_)}for(l=0;l<n;l++)for(s=0;s<t;s++){var b=h[l][s+1],M=h[l][s],S=h[l+1][s],w=h[l+1][s+1];(0!==l||a>0)&&d.push(b,M,w),(l!==n-1||c<Math.PI)&&d.push(M,S,w)}this.setIndex(d),this.addAttribute("position",new vi(m,3)),this.addAttribute("normal",new vi(g,3)),this.addAttribute("uv",new vi(v,2))}function qa(e,t,n,i,r,a){li.call(this),this.type="UnitySkyBoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new Ka(e,t,n,i,r,a)),this.mergeVertices()}function Ka(e,t,n,i,r,a){Mi.call(this),this.type="UnitySkyBoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,i=Math.floor(i)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var s=[],l=[],c=[],u=[],h=0,p=0;function f(e,t,n,i,r,a,f,d,m,g,v){var _,y,x=a/m,b=f/g,M=a/2,S=f/2,w=d/2,E=m+1,T=g+1,A=0,L=0,C=new En;for(y=0;y<T;y++){var P=y*b-S;for(_=0;_<E;_++){var R=_*x-M;C[e]=R*i,C[t]=P*r,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=d>0?1:-1,c.push(C.x,C.y,C.z),u.push(1-_/m),u.push(1-y/g),A+=1}}for(y=0;y<g;y++)for(_=0;_<m;_++){var I=h+_+E*y,D=h+_+E*(y+1),U=h+(_+1)+E*(y+1),O=h+(_+1)+E*y;s.push(I,D,O),s.push(D,U,O),L+=6}o.addGroup(p,L,v),p+=L,h+=A}f("z","y","x",-1,-1,n,t,e,a,r,0),f("z","y","x",1,-1,n,t,-e,a,r,1),f("x","z","y",1,1,e,n,t,i,a,2),f("x","z","y",1,-1,e,n,-t,i,a,3),f("x","y","z",1,-1,e,t,n,i,r,4),f("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.addAttribute("position",new vi(l,3)),this.addAttribute("normal",new vi(c,3)),this.addAttribute("uv",new vi(u,2))}function Za(e){Fa.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.specular=new Gn(0),this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Qa(e){ki.call(this),this.type="MeshPhongMaterial",this.color=new Gn(16777215),this.specular=new Gn(1118481),this.shininess=30,this.map=null,this.map_etc_alpha=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.emissiveMap_etc_alpha=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ja(e){ki.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function $a(e){ki.call(this),this.type="MeshLambertMaterial",this.color=new Gn(16777215),this.map=null,this.map_etc_alpha=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Gn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.emissiveMap_etc_alpha=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function eo(e){this.useSkinMap=e.useSkinMap,this.useDeltaHSV=!!e.useSkinMap,this.deltaHSV=new En(0,0,0),this.skinMap=e.skinMap,this.maskMap=e.maskMap,this.otherPartWorkflow=e.otherPartWorkflow,this.autodeskGlossiness=e.autodeskGlossiness,this.autodeskSpecGlossMap=e.autodeskSpecGlossMap,this.autodeskMetallic=e.autodeskMetallic,this.autodeskMetallicGlossMap=e.autodeskMetallicGlossMap,this.customStandardGlossiness=e.customStandardGlossiness,this.customStandardGlossMapScale=e.customStandardGlossMapScale,this.customStandardMetallic=e.customStandardMetallic,this.customStandardMetallicGlossMap=e.customStandardMetallicGlossMap,this.customStandardSmoothnessTextureChannel=e.customStandardSmoothnessTextureChannel,this.customSpecularGlossiness=e.customSpecularGlossiness,this.customSpecularGlossMapScale=e.customSpecularGlossMapScale,this.customSpecularSmoothnessTextureChannel=e.customSpecularSmoothnessTextureChannel,this.customSpecularColor=e.customSpecularColor,this.customSpecularGlossMap=e.customSpecularGlossMap,Ga.call(this,e),this.type="MeshUnityPBSSkinMaterial"}function to(e){ji.call(this),this.type="MeshUnitySkyBoxMaterial",this.defines={UNITY_COLORSPACE_GAMMA:""},this.tintColor=new Gn(8421504),this.exposure=0,this.rotation=0,this.depthTest=!0,this.depthWrite=!1,this.setValues(e)}function no(e,t,n){var i=this,r=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}}Ta.prototype=Object.create(ki.prototype),Ta.prototype.constructor=Ta,Ta.prototype.isMeshDepthMaterial=!0,Ta.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Aa.prototype=Object.create(ki.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isMeshDistanceMaterial=!0,Aa.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Da.prototype=Object.assign(Object.create($n.prototype),{constructor:Da}),Object.defineProperty(Ua.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ua.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Oa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Oa.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}}),Ba.prototype=Object.create(ki.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isSpriteMaterial=!0,Ba.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},Na.prototype=Object.assign(Object.create($n.prototype),{constructor:Na,isSprite:!0,raycast:function(){var e=new En,t=new En,n=new En,i=new Mn,r=new Mn,a=new Sn,o=new En,s=new En,l=new En,c=new Mn,u=new Mn,h=new Mn;function p(e,t,n,o,s,l){i.subVectors(e,n).addScalar(.5).multiply(o),void 0!==s?(r.x=l*i.x-s*i.y,r.y=s*i.x+l*i.y):r.copy(i),e.copy(t),e.x+=r.x,e.y+=r.y,e.applyMatrix4(a)}return function(i,r){t.setFromMatrixScale(this.matrixWorld),a.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),n.setFromMatrixPosition(this.modelViewMatrix);var f,d,m=this.material.rotation;0!==m&&(d=Math.cos(m),f=Math.sin(m));var g=this.center;p(o.set(-.5,-.5,0),n,g,t,f,d),p(s.set(.5,-.5,0),n,g,t,f,d),p(l.set(.5,.5,0),n,g,t,f,d),c.set(0,0),u.set(1,0),h.set(1,1);var v=i.ray.intersectTriangle(o,s,l,!1,e);if(null!==v||(p(s.set(-.5,.5,0),n,g,t,f,d),u.set(0,1),null!==(v=i.ray.intersectTriangle(o,l,s,!1,e)))){var _=i.ray.origin.distanceTo(e);_<i.near||_>i.far||r.push({distance:_,point:e.clone(),uv:zi.getUV(e,o,s,l,c,u,h,new Mn),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return $n.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Fa.prototype=Object.create(ki.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isMeshStandardMaterial=!0,Fa.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveMap_etc_alpha=e.emissiveMap_etc_alpha,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.roughnessMap_etc_alpha=e.roughnessMap_etc_alpha,this.metalnessMap=e.metalnessMap,this.metalnessMap_etc_alpha=e.metalnessMap_etc_alpha,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ga.prototype=Object.create(Fa.prototype),Ga.prototype.constructor=Ga,Ga.prototype.isMeshUnityPBSMaterial=!0,Ga.prototype.copy=function(e){return Fa.prototype.copy.call(this,e),this.defines={PHYSICAL:"",UNITY_PBS:""},this.reflectivity=e.reflectivity,this.specular=e.specular,this.specularMap=e.specularMap,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this.setup_type=e.setup_type,this.smoothnessTextureChannel=e.smoothnessTextureChannel,this.smoothnessScale=e.smoothnessScale,this},ka.prototype=Object.create(Ga.prototype),ka.prototype.constructor=ka,ka.prototype.isMeshPhysicalCPUSkinningMaterial=!0,ka.prototype.copy=function(e){return Ga.prototype.copy.call(this,e),this},Ha.prototype=Object.assign(Object.create(Wi.prototype),{constructor:Ha,isSkinnedMesh:!0,bind:function(e,t){if(this.skeleton=e,void 0===t?this._native_object3d.bind(this.skeleton.nativeSkeleton):this._native_object3d.bind(this.skeleton.nativeSkeleton,t.elements),!0===this.material.isMeshUnityPBSMaterial&&window.max_bones<e.bones.length){switch(console.warn("SkinnedMesh use cpu skinning [skeleton bones : "+e.bones.length+"]"),this.material.isCPUSkinning=!0,this.material.needsUpdate=!0,this.material.sub_type){case"MeshUnityPBSSkinMaterial_png_gpu_skinning":this.material.sub_type="MeshUnityPBSSkinMaterial_png_cpu_skinning";break;case"MeshUnityPBSSkinMaterial_etc_gpu_skinning":this.material.sub_type="MeshUnityPBSSkinMaterial_etc_cpu_skinning"}var n="cs.report_data_2_compass.local",i={cmd:n,actionName:"cpu_skinning",enter:0,result:0,r2:""+window.max_bones,r3:""+e.bones.length,r4:"",r5:""};BK.MQQ.SsoRequest.send(i,n)}},updateSelf:function(e){Wi.prototype.updateSelf.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Pn,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Wi.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},updateSkinning:(ma=new Pn,ga=new Pn(0,0,0,0),va=new Sn,_a=new Sn,ya=new Sn,xa=new Sn,ba=new Sn,function(e,t,n,i,r){if(this.skeleton&&null!==i&&null!==r){if(!this.originPosition){this.originPosition=t.slice(0);for(var a=0;a<e;++a){var o=3*a;ma.set(this.originPosition[o+0],this.originPosition[o+1],this.originPosition[o+2],1),ma.applyMatrix4(this.bindMatrix),this.originPosition[o+0]=ma.x,this.originPosition[o+1]=ma.y,this.originPosition[o+2]=ma.z}}this.originNormal||null===n||(this.originNormal=n.slice(0));for(var s=this.skeleton.boneMatrices,a=0;a<e;++a){var l=4*a,c=r[l+0],u=r[l+1],h=r[l+2],p=r[l+3],o=3*a;if(ga.set(0,0,0,0),0!==c){var f=i[l+0];va.fromArray(s,16*f).multiplyScalar(c),ma.set(this.originPosition[o+0],this.originPosition[o+1],this.originPosition[o+2],1),ma.applyMatrix4(va),ga.add(ma)}if(0!==u&&(i[l+1],_a.fromArray(s,16*f).multiplyScalar(u),ma.set(this.originPosition[o+0],this.originPosition[o+1],this.originPosition[o+2],1),ma.applyMatrix4(_a),ga.add(ma)),0!==h){var d=i[l+2];ya.fromArray(s,16*d).multiplyScalar(h),ma.set(this.originPosition[o+0],this.originPosition[o+1],this.originPosition[o+2],1),ma.applyMatrix4(ya),ga.add(ma)}if(0!==p){var m=i[l+3];xa.fromArray(s,16*m).multiplyScalar(p),ma.set(this.originPosition[o+0],this.originPosition[o+1],this.originPosition[o+2],1),ma.applyMatrix4(xa),ga.add(ma)}if(ga.applyMatrix4(this.bindMatrixInverse),t[o+0]=ga.x,t[o+1]=ga.y,t[o+2]=ga.z,null!==n){ba.elements[0]=va.elements[0]+_a.elements[0]+ya.elements[0]+xa.elements[0],ba.elements[1]=va.elements[1]+_a.elements[1]+ya.elements[1]+xa.elements[1],ba.elements[2]=va.elements[2]+_a.elements[2]+ya.elements[2]+xa.elements[2],ba.elements[3]=va.elements[3]+_a.elements[3]+ya.elements[3]+xa.elements[3],ba.elements[4]=va.elements[4]+_a.elements[4]+ya.elements[4]+xa.elements[4],ba.elements[5]=va.elements[5]+_a.elements[5]+ya.elements[5]+xa.elements[5],ba.elements[6]=va.elements[6]+_a.elements[6]+ya.elements[6]+xa.elements[6],ba.elements[7]=va.elements[7]+_a.elements[7]+ya.elements[7]+xa.elements[7],ba.elements[8]=va.elements[8]+_a.elements[8]+ya.elements[8]+xa.elements[8],ba.elements[9]=va.elements[9]+_a.elements[9]+ya.elements[9]+xa.elements[9],ba.elements[10]=va.elements[10]+_a.elements[10]+ya.elements[10]+xa.elements[10],ba.elements[11]=va.elements[11]+_a.elements[11]+ya.elements[11]+xa.elements[11],ba.elements[12]=va.elements[12]+_a.elements[12]+ya.elements[12]+xa.elements[12],ba.elements[13]=va.elements[13]+_a.elements[13]+ya.elements[13]+xa.elements[13],ba.elements[14]=va.elements[14]+_a.elements[14]+ya.elements[14]+xa.elements[14],ba.elements[15]=va.elements[15]+_a.elements[15]+ya.elements[15]+xa.elements[15];var g=this.bindMatrixInverse.clone().multiply(ba).multiply(this.bindMatrix);ma.set(this.originNormal[o+0],this.originNormal[o+1],this.originNormal[o+2],0),ma.applyMatrix4(g),n[o+0]=ma.x,n[o+1]=ma.y,n[o+2]=ma.z}}}})}),Object.assign(Va.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Sn;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(fa=new Sn,da=new Sn,function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++){var o=e[r]?e[r].matrixWorld:da;fa.multiplyMatrices(o,t[r]),fa.toArray(n,16*r)}void 0!==i&&(i.needsUpdate=!0)}),getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}}),za.prototype=Object.assign(Object.create($n.prototype),{constructor:za,isBone:!0}),ja.prototype=Object.assign(Object.create($n.prototype),{constructor:ja,isGroup:!0}),Wa.prototype=Object.create(Cn.prototype),Wa.prototype.constructor=Wa,Wa.prototype.isDepthTexture=!0,Xa.prototype=Object.create(li.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(Mi.prototype),Ya.prototype.constructor=Ya,qa.prototype=Object.create(li.prototype),qa.prototype.constructor=qa,Ka.prototype=Object.create(Mi.prototype),Ka.prototype.constructor=Ka,Za.prototype=Object.create(Fa.prototype),Za.prototype.constructor=Za,Za.prototype.isMeshPhysicalMaterial=!0,Za.prototype.copy=function(e){return Fa.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.specular=e.specular,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Qa.prototype=Object.create(ki.prototype),Qa.prototype.constructor=Qa,Qa.prototype.isMeshPhongMaterial=!0,Qa.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveMap_etc_alpha=e.emissiveMap_etc_alpha,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ja.prototype=Object.create(ki.prototype),Ja.prototype.constructor=Ja,Ja.prototype.isMeshNormalMaterial=!0,Ja.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},$a.prototype=Object.create(ki.prototype),$a.prototype.constructor=$a,$a.prototype.isMeshLambertMaterial=!0,$a.prototype.copy=function(e){return ki.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.map_etc_alpha=e.map_etc_alpha,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveMap_etc_alpha=e.emissiveMap_etc_alpha,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},eo.prototype=Object.create(Ga.prototype),eo.prototype.constructor=eo,eo.prototype.isUnityPBSSkinMaterial=!0,eo.prototype.copy=function(e){return Ga.prototype.copy.call(this,e),this.useDeltaHSV=e.useDeltaHSV,this.deltaHSV.copy(e.deltaHSV),this.maskMap=e.maskMap,this.otherPartWorkflow=e.otherPartWorkflow,this.autodeskGlossiness=e.autodeskGlossiness,this.autodeskSpecGlossMap=e.autodeskSpecGlossMap,this.autodeskMetallic=e.autodeskMetallic,this.autodeskMetallicGlossMap=e.autodeskMetallicGlossMap,this.customStandardGlossiness=e.customStandardGlossiness,this.customStandardGlossMapScale=e.customStandardGlossMapScale,this.customStandardMetallic=e.customStandardMetallic,this.customStandardMetallicGlossMap=e.customStandardMetallicGlossMap,this.customSpecularGlossiness=e.customSpecularGlossiness,this.customSpecularGlossMapScale=e.customSpecularGlossMapScale,this.customSpecularSmoothnessTextureChannel=e.customSpecularSmoothnessTextureChannel,this.customSpecularColor=e.customSpecularColor,this.customSpecularGlossMap=e.customSpecularGlossMap,this},eo.prototype.setUseDeltaHSV=function(e){this.useDeltaHSV!==e&&(this.useDeltaHSV=e,this.needsUpdate=!0)},eo.prototype.setDeltaHSV=function(e){e&&(this.deltaHSV.x=e.x,this.deltaHSV.y=e.y,this.deltaHSV.z=e.z,this.needsUpdate=!0)},to.prototype=Object.create(ji.prototype),to.prototype.constructor=to,to.prototype.isUnitySkyBoxMaterial=!0,to.prototype.copy=function(e){return ji.prototype.copy.call(this,e),this.defines={UNITY_COLORSPACE_GAMMA:""},this.tintColor=e.tintColor,this.exposure=e.exposure,this.rotation=e.rotation,this};var io=new no,ro={},ao=function(){function e(e){this.path="",this.manager=e||io}return e.prototype.load=function(e,t,i,r){void 0===e&&(e=""),this.path&&(e=this.path+e);var a=function(e,t,n){e.manager.itemStart(t);var i=ro[t];if(void 0!==i)return void 0!==i.bkImage?(i.refCount+=1,n&&n(i.bkImage),e.manager.itemEnd(t),i):(i.onLoadList.push(n),i);ro[t]={refCount:0,onLoadList:[n],bkImage:void 0}}(this,e=this.manager.resolveURL(e),t);if(void 0!==a)return a.bkImage;var o=n.Image.loadImage(e);if(o){if(o.src=e,o.complete=!0,o.naturalWidth=o.width,o.naturalHeight=o.height,o.imageAlpha){var s=e+"_etc1_alpha",l=o.imageAlpha;l.src=s,l.complete=!0,l.naturalWidth=o.width,l.naturalHeight=o.height,o.imageAlpha=void 0,o.hasETC1Alpha=!0,function(e,t,n){ro[t]={refCount:1,onLoadList:void 0,bkImage:n};var i=ro[t],r=n.dispose;n.dispose=function(){i.refCount-=1,i.refCount<=0&&(ro[t]=void 0,r.apply(this))}.bind(n)}(0,s,l)}return function(e,t,n){var i=ro[t];i.bkImage=n,i.refCount=1;var r=n.dispose;for(var a in n.dispose=function(){i.refCount-=1,i.refCount<=0&&(ro[t]=void 0,r.apply(this))}.bind(n),i.onLoadList){var o=i.onLoadList[a];void 0!==o&&o(n),e.manager.itemEnd(t,o)}i.onLoadList=void 0}(this,e,o),o}var c={src:e,complete:!1,width:0,naturalWidth:0,height:0,naturalHeight:0};return r&&r({type:"error",target:c}),this.manager.itemError(e),this.manager.itemEnd(e),c},e.prototype.setCrossOrigin=function(){return this},e.prototype.setPath=function(e){return this.path=e,this},e}();function oo(e){this.manager=void 0!==e?e:io}Object.assign(oo.prototype,{crossOrigin:"anonymous",load:function(e,t,n,i){var r=new Cn,a=new ao(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(n){r.image=n,n.hasETC1Alpha&&(r.hasETC1Alpha=!0),1!==n.imgFormat&&2!==n.imgFormat||(r.isCompressedTexture=!0,2===n.imgFormat&&(r.isEtc1=!0));var i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);r.format=i?De:Ue,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}});var so={};function lo(e){this.manager=void 0!==e?e:io}function co(e,t){$n.call(this),this.type="Light",this.color=new Gn(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function uo(){$n.call(this),this.type="Camera",this.matrixWorldInverse=new Sn,this.projectionMatrix=new Sn,this.projectionMatrixInverse=new Sn}function ho(e,t,n,i){uo.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function po(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Mn(512,512),this.map=null,this.matrix=new Sn}function fo(e,t,n,i){co.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new po(new ho(90,1,.5,500))}function mo(e,t,n){co.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy($n.DefaultUp),this.updateMatrix(),this.groundColor=new Gn(t)}function go(e,t,n,i,r,a){uo.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==i?i:-1,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function vo(){po.call(this,new go(-5,5,5,-5,.5,500))}function _o(e,t){co.call(this,e,t),this.type="DirectionalLight",this.position.copy($n.DefaultUp),this.updateMatrix(),this.target=new $n,this.shadow=new vo}function yo(e,t){co.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}Object.assign(lo.prototype,{load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this;if(void 0===so[e]){var a=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var o=a[1],s=!!a[2],l=a[3];l=decodeURIComponent(l),s&&(l=atob(l));try{var c,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var h=new Uint8Array(l.length),p=0;p<l.length;p++)h[p]=l.charCodeAt(p);c="blob"===u?new Blob([h.buffer],{type:o}):h.buffer;break;case"document":var f=new DOMParser;c=f.parseFromString(l,o);break;case"json":c=JSON.parse(l);break;default:c=l}setTimeout(function(){t&&t(c),r.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{so[e]=[],so[e].push({onLoad:t,onProgress:n,onError:i});var d=new XMLHttpRequest;for(var m in d.open("GET",e,!0),d.addEventListener("load",function(t){var n=this.response,i=so[e];if(delete so[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var a=0,o=i.length;a<o;a++){var s=i[a];s.onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else{for(var a=0,o=i.length;a<o;a++){var s=i[a];s.onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),d.addEventListener("progress",function(t){for(var n=so[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}},!1),d.addEventListener("error",function(t){var n=so[e];delete so[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),d.addEventListener("abort",function(t){var n=so[e];delete so[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(d.responseType=this.responseType),void 0!==this.withCredentials&&(d.withCredentials=this.withCredentials),d.overrideMimeType&&d.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)d.setRequestHeader(m,this.requestHeader[m]);d.send(null)}return r.manager.itemStart(e),d}so[e].push({onLoad:t,onProgress:n,onError:i})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),co.prototype=Object.assign(Object.create($n.prototype),{constructor:co,isLight:!0,copy:function(e){return $n.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}}),uo.prototype=Object.assign(Object.create($n.prototype),{constructor:uo,isCamera:!0,copy:function(e,t){return $n.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new En),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){$n.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ho.prototype=Object.assign(Object.create(uo.prototype),{constructor:ho,isPerspectiveCamera:!0,setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*bn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*bn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*bn.RAD2DEG*Math.atan(Math.tan(.5*bn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*bn.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(r+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),Object.assign(po.prototype,{}),fo.prototype=Object.assign(Object.create(co.prototype),{constructor:fo,isPointLight:!0,copy:function(e){return co.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),mo.prototype=Object.assign(Object.create(co.prototype),{constructor:mo,isHemisphereLight:!0,copy:function(e){return co.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),go.prototype=Object.assign(Object.create(uo.prototype),{constructor:go,isOrthographicCamera:!0,setViewOffset:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),c=this.zoom/(this.view.height/this.view.fullHeight),u=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;r+=u*(this.view.offsetX/l),a=r+u*(this.view.width/l),o-=h*(this.view.offsetY/c),s=o-h*(this.view.height/c)}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}),vo.prototype=Object.assign(Object.create(po.prototype),{constructor:vo}),_o.prototype=Object.assign(Object.create(co.prototype),{constructor:_o,isDirectionalLight:!0,copy:function(e){return co.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),yo.prototype=Object.assign(Object.create(co.prototype),{constructor:yo,isAmbientLight:!0});var xo=function(){function e(e,t,n){var i=this;this.mixer=e,this.bkClip=t,this.bk=n,this.bk.cb=function(e,t){switch(e){case 1:i.mixer.dispatchEvent({type:"finished",action:i,direction:t})}}}return e.prototype.getMixer=function(){return this.mixer},e.prototype.setLoop=function(e,t){return this.bk.setLoop(e,2200===e?1:t),this},e.prototype.play=function(){return this.bk.play(),this},e.prototype.stop=function(){return this.bk.stop(),this},e}(),bo=function(e){function t(t){var i=e.call(this)||this;return i.bk=new n.TAnimationMixer(t._native_object3d),i.actions=[],i}return r(t,e),t.prototype.clipAction=function(e,t){t&&(t=t._native_object3d);var n=this.bk.clipAction(e,t),i=new xo(this,e,n);return this.actions.push(i),i},t.prototype.update=function(e){this.bk.update(e)},t}(i),Mo={arraySlice:function(e,t,n){return Mo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,l=0;l!==t;++l)r[o++]=e[s+l];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}}};function So(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function wo(e,t,n,i){So.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Eo(e,t,n,i){So.call(this,e,t,n,i)}function To(e,t,n,i){So.call(this,e,t,n,i)}function Ao(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Mo.convertArray(t,this.TimeBufferType),this.values=Mo.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Lo(e,t,n){Ao.call(this,e,t,n)}function Co(e,t,n,i){Ao.call(this,e,t,n,i)}function Po(e,t,n,i){Ao.call(this,e,t,n,i)}function Ro(e,t,n,i){So.call(this,e,t,n,i)}function Io(e,t,n,i){Ao.call(this,e,t,n,i)}function Do(e,t,n,i){Ao.call(this,e,t,n,i)}function Uo(e,t,n,i){Ao.call(this,e,t,n,i)}function Oo(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=bn.generateUUID(),this.duration<0&&this.resetDuration()}function Bo(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Po;case"vector":case"vector2":case"vector3":case"vector4":return Uo;case"color":return Co;case"quaternion":return Io;case"bool":case"boolean":return Lo;case"string":return Do}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];Mo.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function No(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Fo(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Go(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function ko(e){$n.call(this),this.material=e,this.render=function(){}}function Ho(e,t){$n.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Mi,this.material=void 0!==t?t:new ji({color:16777215*Math.random()}),this.drawMode=ut,this.skybox=!0,this.updateMorphTargets()}function Vo(e){this.manager=void 0!==e?e:io,this._parser=null}Object.assign(So.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(So.prototype,{beforeStart_:So.prototype.copySampleValue_,afterEnd_:So.prototype.copySampleValue_}),wo.prototype=Object.assign(Object.create(So.prototype),{constructor:wo,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*c,this._offsetNext=a*c},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,f=(n-t)/(i-t),d=f*f,m=d*f,g=-h*m+2*h*d-h*f,v=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*f+1,_=(-1-p)*m+(1.5+p)*d+.5*f,y=p*m-p*d,x=0;x!==o;++x)r[x]=g*a[c+x]+v*a[l+x]+_*a[s+x]+y*a[u+x];return r}}),Eo.prototype=Object.assign(Object.create(So.prototype),{constructor:Eo,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,c=(n-t)/(i-t),u=1-c,h=0;h!==o;++h)r[h]=a[l+h]*u+a[s+h]*c;return r}}),To.prototype=Object.assign(Object.create(So.prototype),{constructor:To,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ao,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Mo.convertArray(e.times,Array),values:Mo.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(Ao.prototype,{constructor:Ao,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new To(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Eo(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new wo(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);var o=this.getValueSize();this.times=Mo.arraySlice(n,r,a),this.values=Mo.arraySlice(this.values,r*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&Mo.isTypedArray(i))for(var o=0,l=i.length;o!==l;++o){var c=i[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),i=2302===this.getInterpolation(),r=1,a=e.length-1,o=1;o<a;++o){var s=!1,l=e[o],c=e[o+1];if(l!==c&&(1!==o||l!==l[0]))if(i)s=!0;else for(var u=o*n,h=u-n,p=u+n,f=0;f!==n;++f){var d=t[u+f];if(d!==t[h+f]||d!==t[p+f]){s=!0;break}}if(s){if(o!==r){e[r]=e[o];for(var m=o*n,g=r*n,f=0;f!==n;++f)t[g+f]=t[m+f]}++r}}if(a>0){e[r]=e[a];for(var m=a*n,g=r*n,f=0;f!==n;++f)t[g+f]=t[m+f];++r}return r!==e.length&&(this.times=Mo.arraySlice(e,0,r),this.values=Mo.arraySlice(t,0,r*n)),this}}),Lo.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Lo,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Co.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Co,ValueTypeName:"color"}),Po.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Po,ValueTypeName:"number"}),Ro.prototype=Object.assign(Object.create(So.prototype),{constructor:Ro,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=(n-t)/(i-t),c=s+o;s!==c;s+=4)wn.slerpFlat(r,0,a,s-o,a,s,l);return r}}),Io.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Io,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new Ro(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Do.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Do,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Uo.prototype=Object.assign(Object.create(Ao.prototype),{constructor:Uo,ValueTypeName:"vector"}),Object.assign(Oo,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(Bo(n[r]).scale(i));return new Oo(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},r=0,a=n.length;r!==a;++r)t.push(Ao.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],l=[];s.push((o+r-1)%r,o,(o+1)%r),l.push(0,1,0);var c=Mo.getKeyframeOrder(s);s=Mo.sortedArray(s,1,c),l=Mo.sortedArray(l,1,c),i||0!==s[0]||(s.push(r),l.push(l[0])),a.push(new Po(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new Oo(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(r);if(l&&l.length>1){var c=l[1],u=i[c];u||(i[c]=u=[]),u.push(s)}}var h=[];for(var c in i)h.push(Oo.CreateFromMorphTargetSequence(c,i[c],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];Mo.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],l=0;l<s.length;l++){var c=s[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){for(var u={},h=0;h<c.length;h++)if(c[h].morphTargets)for(var p=0;p<c[h].morphTargets.length;p++)u[c[h].morphTargets[p]]=-1;for(var f in u){for(var d=[],m=[],p=0;p!==c[h].morphTargets.length;++p){var g=c[h];d.push(g.time),m.push(g.morphTarget===f?1:0)}i.push(new Po(".morphTargetInfluence["+f+"]",d,m))}a=u.length*(o||1)}else{var v=".bones["+t[l].name+"]";n(Uo,v+".position",c,"pos",i),n(Io,v+".quaternion",c,"rot",i),n(Uo,v+".scale",c,"scl",i)}}if(0===i.length)return null;var _=new Oo(r,a,i);return _}}),Object.assign(Oo.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,n=0,i=e.length;n!==i;++n){var r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),No.prototype.clone=function(){return new No(void 0===this.value.clone?this.value:this.value.clone())},Object.assign(Fo.prototype,{start:function(){this.startTime=Date.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=Date.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(Go.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(bn.clamp(t/this.radius,-1,1))),this}}),ko.prototype=Object.create($n.prototype),ko.prototype.constructor=ko,ko.prototype.isImmediateRenderObject=!0,Ho.prototype=Object.assign(Object.create($n.prototype),{constructor:Ho,isMesh:!0,setDrawMode:function(e){this.drawMode=e},onBeforeRender:function(e,t,n,i,r,a){},onAfterRender:function(e,t,n,i,r,a){},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}),Object.assign(Vo.prototype,{load:function(e,t,n,i){var r=this,a=new In,o=new lo(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:pe,a.wrapT=void 0!==n.wrapT?n.wrapT:pe,a.magFilter=void 0!==n.magFilter?n.magFilter:ve,a.minFilter=void 0!==n.minFilter?n.minFilter:ye,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps),1===n.mipmapCount&&(a.minFilter=ve),a.needsUpdate=!0,t&&t(a,n))},n,i),a},setPath:function(e){return this.path=e,this}}),Object.assign(bn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),bn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),bn.ceilPowerOfTwo(e)}}),Object.assign(Tn.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Sn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new En),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)}}),wn.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Mn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(En.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Pn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(li.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign($n.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties($n.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperty(Va.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Ha.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ho.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(co.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(ci.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Mi.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Mi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(No.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(ki.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Gn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Qa.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.assign(Ia.prototype,{clearTarget:function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Ia.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(La.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Rn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}});var zo={merge:function(e,t,n){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};An.crossOrigin=void 0,An.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new oo;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},An.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new CubeTextureLoader;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},An.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},An.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var jo={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};e.WebGLRenderTarget=Rn,e.WebGLRenderer=Ia,e.ShaderLib=Wn,e.UniformsLib=jn,e.UniformsUtils=Fn,e.ShaderChunk=Dn,e.Scene=Da,e.Sprite=Na,e.SkinnedMesh=Ha,e.Skeleton=Va,e.Bone=za,e.Mesh=Wi,e.Group=ja,e.DataTexture=In,e.DepthTexture=Wa,e.Texture=Cn,e.TextureLoader=oo,e.DefaultLoadingManager=io,e.LoadingManager=no,e.ImageLoader=ao,e.FileLoader=lo,e.PointLight=fo,e.HemisphereLight=mo,e.DirectionalLightShadow=vo,e.DirectionalLight=_o,e.AmbientLight=yo,e.LightShadow=po,e.Light=co,e.PerspectiveCamera=ho,e.OrthographicCamera=go,e.Camera=uo,e.AnimationMixer=bo,e.AnimationClip=Oo,e.Uniform=No,e.BufferGeometry=Mi,e.Geometry=li,e.Face3=Yn,e.Object3D=$n,e.Layers=Qn,e.EventDispatcher=i,e.Clock=Fo,e.Math=bn,e.Spherical=Go,e.Matrix4=Sn,e.Matrix3=Tn,e.Euler=Zn,e.Vector4=Pn,e.Vector3=En,e.Vector2=Mn,e.Quaternion=wn,e.Color=Gn,e.ImmediateRenderObject=ko,e.ImageUtils=An,e.WebGLUtils=Ra,e.Skybox=Ho,e.SphereGeometry=Xa,e.SphereBufferGeometry=Ya,e.PlaneGeometry=Ei,e.PlaneBufferGeometry=Ti,e.BoxGeometry=Si,e.BoxBufferGeometry=wi,e.UnitySkyBoxGeometry=qa,e.UnitySkyBoxBufferGeometry=Ka,e.SpriteMaterial=Ba,e.ShaderMaterial=Hi,e.MeshPhysicalMaterial=Za,e.MeshStandardMaterial=Fa,e.MeshPhongMaterial=Qa,e.MeshNormalMaterial=Ja,e.MeshLambertMaterial=$a,e.MeshBasicMaterial=ji,e.MeshUnityPBSMaterial=Ga,e.MeshUnityPBSSkinMaterial=eo,e.MeshUnitySkyBoxMaterial=to,e.Material=ki,e.Float64BufferAttribute=_i,e.Float32BufferAttribute=vi,e.Uint32BufferAttribute=gi,e.Int32BufferAttribute=mi,e.Uint16BufferAttribute=di,e.Int16BufferAttribute=fi,e.Uint8ClampedBufferAttribute=pi,e.Uint8BufferAttribute=hi,e.Int8BufferAttribute=ui,e.BufferAttribute=ci,e.REVISION=d,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=m,e.CullFaceBack=g,e.CullFaceFront=v,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=_,e.PCFSoftShadowMap=y,e.FrontSide=x,e.BackSide=b,e.DoubleSide=M,e.FlatShading=1,e.SmoothShading=2,e.NoColors=S,e.FaceColors=1,e.VertexColors=2,e.NoBlending=w,e.NormalBlending=E,e.AdditiveBlending=T,e.SubtractiveBlending=A,e.MultiplyBlending=L,e.CustomBlending=C,e.AddEquation=P,e.SubtractEquation=R,e.ReverseSubtractEquation=I,e.MinEquation=D,e.MaxEquation=U,e.ZeroFactor=O,e.OneFactor=B,e.SrcColorFactor=N,e.OneMinusSrcColorFactor=F,e.SrcAlphaFactor=G,e.OneMinusSrcAlphaFactor=k,e.DstAlphaFactor=H,e.OneMinusDstAlphaFactor=V,e.DstColorFactor=z,e.OneMinusDstColorFactor=j,e.SrcAlphaSaturateFactor=W,e.NeverDepth=X,e.AlwaysDepth=Y,e.LessDepth=q,e.LessEqualDepth=K,e.EqualDepth=Z,e.GreaterEqualDepth=Q,e.GreaterDepth=J,e.NotEqualDepth=$,e.MultiplyOperation=ee,e.MixOperation=te,e.AddOperation=ne,e.NoToneMapping=0,e.LinearToneMapping=ie,e.ReinhardToneMapping=2,e.Uncharted2ToneMapping=3,e.CineonToneMapping=4,e.ACESFilmicToneMapping=5,e.UVMapping=300,e.CubeReflectionMapping=re,e.CubeRefractionMapping=ae,e.EquirectangularReflectionMapping=oe,e.EquirectangularRefractionMapping=se,e.SphericalReflectionMapping=le,e.CubeUVReflectionMapping=ce,e.CubeUVRefractionMapping=ue,e.RepeatWrapping=he,e.ClampToEdgeWrapping=pe,e.MirroredRepeatWrapping=fe,e.NearestFilter=de,e.NearestMipMapNearestFilter=me,e.NearestMipMapLinearFilter=ge,e.LinearFilter=ve,e.LinearMipMapNearestFilter=_e,e.LinearMipMapLinearFilter=ye,e.UnsignedByteType=xe,e.ByteType=be,e.ShortType=Me,e.UnsignedShortType=Se,e.IntType=we,e.UnsignedIntType=Ee,e.FloatType=Te,e.HalfFloatType=Ae,e.UnsignedShort4444Type=Le,e.UnsignedShort5551Type=Ce,e.UnsignedShort565Type=Pe,e.UnsignedInt248Type=Re,e.AlphaFormat=Ie,e.RGBFormat=De,e.RGBAFormat=Ue,e.LuminanceFormat=Oe,e.LuminanceAlphaFormat=Be,e.RGBEFormat=Ne,e.DepthFormat=Fe,e.DepthStencilFormat=Ge,e.RedFormat=ke,e.RGB_S3TC_DXT1_Format=He,e.RGBA_S3TC_DXT1_Format=Ve,e.RGBA_S3TC_DXT3_Format=ze,e.RGBA_S3TC_DXT5_Format=je,e.RGB_PVRTC_4BPPV1_Format=We,e.RGB_PVRTC_2BPPV1_Format=Xe,e.RGBA_PVRTC_4BPPV1_Format=Ye,e.RGBA_PVRTC_2BPPV1_Format=qe,e.RGB_ETC1_Format=Ke,e.RGBA_ASTC_4x4_Format=Ze,e.RGBA_ASTC_5x4_Format=Qe,e.RGBA_ASTC_5x5_Format=Je,e.RGBA_ASTC_6x5_Format=$e,e.RGBA_ASTC_6x6_Format=et,e.RGBA_ASTC_8x5_Format=tt,e.RGBA_ASTC_8x6_Format=nt,e.RGBA_ASTC_8x8_Format=it,e.RGBA_ASTC_10x5_Format=rt,e.RGBA_ASTC_10x6_Format=at,e.RGBA_ASTC_10x8_Format=ot,e.RGBA_ASTC_10x10_Format=st,e.RGBA_ASTC_12x10_Format=lt,e.RGBA_ASTC_12x12_Format=ct,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=ut,e.TriangleStripDrawMode=ht,e.TriangleFanDrawMode=pt,e.LinearEncoding=ft,e.sRGBEncoding=dt,e.GammaEncoding=mt,e.RGBEEncoding=gt,e.LogLuvEncoding=3003,e.RGBM7Encoding=vt,e.RGBM16Encoding=_t,e.RGBDEncoding=yt,e.BasicDepthPacking=xt,e.RGBADepthPacking=bt,e.TangentSpaceNormalMap=Mt,e.ObjectSpaceNormalMap=St,e.ImageFormatUnknown=0,e.ImageFormatPvr=wt,e.ImageFormatEtc=Et,e.ImageFormatJpg=3,e.ImageFormatPng=4,e.ImageFormatGif=5,e.program_code_texture_bit_flag_alphaMap=Tt,e.program_code_texture_bit_flag_aoMap=At,e.program_code_texture_bit_flag_autodeskMetallicGlossMap=Lt,e.program_code_texture_bit_flag_autodeskSpecGlossMap=Ct,e.program_code_texture_bit_flag_bumpMap=Pt,e.program_code_texture_bit_flag_customSpecularGlossMap=Rt,e.program_code_texture_bit_flag_customStandardMetallicGlossMap=It,e.program_code_texture_bit_flag_displacementMap=Dt,e.program_code_texture_bit_flag_emissiveMap=Ut,e.program_code_texture_bit_flag_emissiveMapIsEtc1=Ot,e.program_code_texture_bit_flag_emissiveMap_etc_alpha=Bt,e.program_code_texture_bit_flag_envMap=Nt,e.program_code_texture_bit_flag_envMapCubeUV=Ft,e.program_code_texture_bit_flag_gradientMap=Gt,e.program_code_texture_bit_flag_lightMap=kt,e.program_code_texture_bit_flag_map=Ht,e.program_code_texture_bit_flag_mapIsEtc1=Vt,e.program_code_texture_bit_flag_map_etc_alpha=zt,e.program_code_texture_bit_flag_maskMap=jt,e.program_code_texture_bit_flag_metalnessMap=Wt,e.program_code_texture_bit_flag_metalnessMapIsEtc1=Xt,e.program_code_texture_bit_flag_metalnessMap_etc_alpha=Yt,e.program_code_texture_bit_flag_normalMap=qt,e.program_code_texture_bit_flag_objectSpaceNormalMap=Kt,e.program_code_texture_bit_flag_roughnessMap=Zt,e.program_code_texture_bit_flag_roughnessMapIsEtc1=Qt,e.program_code_texture_bit_flag_roughnessMap_etc_alpha=Jt,e.program_code_texture_bit_flag_skinMap=$t,e.program_code_texture_bit_flag_specularMap=en,e.program_code_texture_bit_flag_specularMapIsEtc1=tn,e.program_code_bit_flag_dithering=nn,e.program_code_bit_flag_flatShading=rn,e.program_code_bit_flag_flipSided=an,e.program_code_bit_flag_fog=on,e.program_code_bit_flag_fogExp=sn,e.program_code_bit_flag_gammaInput=ln,e.program_code_bit_flag_gammaOutput=cn,e.program_code_bit_flag_logarithmicDepthBuffer=un,e.program_code_bit_flag_matcap=hn,e.program_code_bit_flag_morphNormals=pn,e.program_code_bit_flag_morphTargets=fn,e.program_code_bit_flag_physicallyCorrectLights=dn,e.program_code_bit_flag_premultipliedAlpha=mn,e.program_code_bit_flag_shadowMapEnabled=gn,e.program_code_bit_flag_skinning=vn,e.program_code_bit_flag_supportsVertexTextures=_n,e.program_code_bit_flag_useFog=yn,e.program_code_bit_flag_useVertexTexture=xn,e.CubeGeometry=Si,e.Face4=function(e,t,n,i,r,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Yn(e,t,n,r,a,o)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new En(e,t,n)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new ci(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ui(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new hi(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new pi(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new fi(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new di(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new mi(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new gi(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new vi(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new _i(e,t)},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new lo(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Vo(e)},e.GeometryUtils=zo,e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils=jo,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(21),n(25))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SkeletonLoad="SkeletonLoad",e.AccessoryAdd="AccessoryAdd",e.AccessoryRemove="AccessoryRemove",e.FaceDataLoad="FaceJsonLoad",e.FaceAdd="FaceAdd",e.FaceRemove="FaceRemove",e.MakeupAccessoryAdd="MakeUpAccessoryAdd",e.MakeupAccessoryRemove="MakeupAccessoryRemove",e.BatchAccessoryBegin="BatchAccessoryBegin",e.BatchAccessoryEnd="BatchAccessoryEnd",e.AnimationLoad="AnimationLoad",e.AnimationStart="AnimationStart",e.AnimationComplete="AnimationComplete",e.AnimationEnd="AnimationEnd",e.PositionChange="PositionChange"}(t.CmModelEvent||(t.CmModelEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(30),a=n(5),o=n(11),s=function(){function e(){this.textureLoader=new i.TextureLoader,this.textureCache=new Map,this.defaultNormalMap={refCount:0},this.defaultMaskMap={refCount:0}}return e.prototype.load=function(e,t){var n=this,i=this.textureCache.get(e);if(i&&i.texture){if(i.refCount+=1,t)if(i.texture.image)t(i.texture);else{var r=function(){i.texture&&(i.texture.removeEventListener("loaded",r),t(i.texture))};i.texture.addEventListener("loaded",r)}return i.texture}var a={refCount:1};this.textureCache.set(e,a),a.texture=this.textureLoader.load(e,function(e){a.refCount<=0?e.image.dispose():(t&&t(e),e.dispatchEvent({type:"loaded"}))});var o=a.texture.dispose;return a.texture.dispose=function(){a.refCount-=1,a.refCount<=0&&a.texture&&(a.texture.image&&a.texture.image.dispose&&a.texture.image.dispose(),n.textureCache.delete(e),o.apply(a.texture))},a.texture},e.prototype.loadWithDataView=function(e,t,n,r){var a=this,o=this.textureCache.get(e);if(o&&o.texture)return o.refCount+=1,o.texture;i.addImageWithDataView(e,t,n,r);var s={refCount:1};this.textureCache.set(e,s),s.texture=this.textureLoader.load(e,function(e){s.refCount<=0?e.image&&e.image.dispose&&e.image.dispose():e.dispatchEvent({type:"loaded"})});var l=s.texture.dispose;return s.texture.dispose=function(){s.refCount-=1,s.refCount<=0&&s.texture&&(s.texture.image&&s.texture.image.dispose&&s.texture.image.dispose(),a.textureCache.delete(e),l.apply(s.texture))},s.texture},e.prototype.getDefaultNormalMap=function(){var e=this;if(0===this.defaultNormalMap.refCount){for(var t=new Uint8Array(48),n=0;n<16;++n){var r=3*n;t[r]=127,t[r+1]=127,t[r+2]=255}var a=new i.DataTexture(t,4,4,i.RGBFormat);a.needsUpdate=!0,this.defaultNormalMap.refCount=1;var o=a.dispose;a.dispose=function(){e.defaultNormalMap.refCount-=1,e.defaultNormalMap.refCount<=0&&o.apply(e.defaultNormalMap.texture)},this.defaultNormalMap.texture=a}return this.defaultNormalMap.refCount+=1,this.defaultNormalMap.texture},e.prototype.getDefaultMaskMap=function(){var e=this;if(0===this.defaultMaskMap.refCount){for(var t=new Uint8Array(48),n=0;n<16;++n){var r=3*n;t[r]=0,t[r+1]=0,t[r+2]=0}var a=new i.DataTexture(t,4,4,i.RGBFormat);a.needsUpdate=!0,this.defaultMaskMap.refCount=1;var o=a.dispose;a.dispose=function(){e.defaultMaskMap.refCount-=1,e.defaultMaskMap.refCount<=0&&o.apply(e.defaultMaskMap.texture)},this.defaultMaskMap.texture=a}return this.defaultMaskMap.refCount+=1,this.defaultMaskMap.texture},e}();t.cm_texture_loader=new s;var l=a.TlvReader.prototype;t.TEXTURE_FIELDS={3:{name:"Name",read:r.sanitizeNodeName},4:{name:"RelativeFilename",read:l.getString},5:{name:"ModelUVScaling",read:l.getFloat32Array},6:{name:"ModelUVTranslation",read:l.getFloat32Array},7:{name:"TextureAlphaSource",read:l.getString},8:{name:"Cropping",read:l.getFloat32Array},9:{name:"BlendMode",read:l.getInt64},11:{name:"WrapModeUV",read:l.getUint8Array},12:{name:"uvRotation",read:l.getFloat32Array},13:{name:"uvScalingPivot",read:l.getFloat32Array},14:{name:"uvRotationPivot",read:l.getFloat32Array},15:{name:"premultiplyAlpha",read:l.getUint8},16:{name:"originSize",read:l.getInt32Array}};t.loadTexture=function(){return o.readObject({1:{name:"textures",read:o.readObjectArray(t.TEXTURE_FIELDS)}}).call(this).textures||[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(13);var i=n(10),r=n(0),a=n(1);t.CmModelEvent=a.CmModelEvent;var o=n(26);t.CmModel=o.CmModel;var s=n(47),l=n(0),c=n(2);t.cm_texture_loader=c.cm_texture_loader,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(48));var u,h,p=[];t.startTicker=function(){u&&u.getDelta()};var f=!1;function d(){if(!1!==f){requestAnimationFrame(d);var e=u.getDelta();t.cameraAnimation.update(e);for(var n=0,i=p.length;n<i;n++)p[n].update(e);var r=h.getParameter(h.VIEWPORT);h.viewport(0,0,window.innerWidth,window.innerHeight),t.renderer.deltaTime=e,t.renderer.render(t.scene,t.camera),t.renderer.state.setBlending(l.CustomBlending,l.AddEquation,l.OneFactor,l.OneMinusSrcAlphaFactor,void 0,l.OneFactor,l.OneMinusSrcAlphaFactor),BK.Director.setCurrentGraphicParams(9999,9999,9999),h.disable(2884),h.disable(2929),h.viewport(r[0],r[1],r[2],r[3]),BK.Director.renderAllCameras(e),h.enable(2929),h.enable(2884),h.glCommit(),!1===BK.first_frame_render&&(BK.first_frame_render=!0,BK.reportTraceEnd&&BK.reportTraceEnd())}}t.init=function(e,n){if(!1===f){f=!0,h=i.bkWebGLGetInstance(),BK.Director.mainCamera.clearFlag=65535,window.innerWidth=e,window.innerHeight=n,t.scene=new r.Scene,comGlobalParam.location===LOCATION_TYPE.TYPE_AIO&&(window.innerHeight=4*window.innerWidth/3);var a=60;comGlobalParam.location===LOCATION_TYPE.TYPE_DRAWER&&(a=15),comGlobalParam.location===LOCATION_TYPE.TYPE_AIO&&(a=30),comGlobalParam.location===LOCATION_TYPE.TYPE_FCARD&&(a=15),t.camera=new r.PerspectiveCamera(a,window.innerWidth/window.innerHeight,100,1e4),t.camera.name="cam",comGlobalParam.location===LOCATION_TYPE.TYPE_AIO&&(t.camera.position.set(0,97,1e3),t.camera.lookAt(new r.Vector3(0,260,0))),comGlobalParam.location===LOCATION_TYPE.TYPE_DRAWER&&(t.camera.position.set(20,120,770),t.camera.lookAt(new r.Vector3(-20,95,0))),comGlobalParam.location===LOCATION_TYPE.TYPE_FCARD&&(t.camera.position.set(20,70,770),t.camera.lookAt(new r.Vector3(-20,85,0))),t.cameraAnimation=new s.CameraAnimation(t.camera),u=new r.Clock,t.renderer=new r.WebGLRenderer({antialias:!0,context:h});var o=new r.AmbientLight(12961221,.3);t.scene.add(o);var l=new r.DirectionalLight(15329506,1);l.position.set(-10,15,20),t.scene.add(l),t.renderer.setPixelRatio(1),t.renderer.getContext().clearColor(0,0,0,0),t.renderer.setClearAlpha(0),t.renderer.setSize(window.innerWidth,window.innerHeight),d()}},t.addToScene=function(e){!1!==f&&(t.scene.add(e.group),p.push(e))},t.removeFromScene=function(e){if(!1!==f){t.scene.remove(e.group);var n=p.indexOf(e);n>=0&&p.splice(n,1)}},t.addFrame=function(){if(!1!==f){t.cameraAnimation.update(0);for(var e=0,n=p.length;e<n;e++)p[e].update(0);var i=h.getParameter(h.VIEWPORT);h.viewport(0,0,window.innerWidth,window.innerHeight),t.renderer.deltaTime=0,t.renderer.render(t.scene,t.camera),BK.Director.setCurrentGraphicParams(9999,9999,9999),h.disable(2884),h.disable(2929),h.viewport(i[0],i[1],i[2],i[3]),BK.Director.renderAllCameras(0),h.enable(2929),h.enable(2884),h.glCommit()}},t.onSizeChanged=function(e,n){t.renderer&&(window.innerWidth=e,comGlobalParam.location===LOCATION_TYPE.TYPE_AIO?window.innerHeight=4*window.innerWidth/3:window.innerHeight=n,t.renderer.setSize(window.innerWidth,window.innerHeight))}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=n(8),s=function(e){function t(t){void 0===t&&(t="");var n=e.call(this)||this;return n.focus=a.noop,n.remove=a.noop,n.tagName=t.toUpperCase(),o.style(n),o.classList(n),n}return r(t,e),t}(n(16).Element);t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i){void 0===i&&(i=!0),void 0===n&&(n=e.byteLength),this.dv=new DataView(e,t||0,n),this.offset=0,this.littleEndian=i}return e.prototype.getBool=function(){this.skipTagAndLen();var e=this.dv.getUint8(this.offset);return this.skip(1),1===e},e.prototype.getUint8=function(){this.skipTagAndLen();var e=this.dv.getUint8(this.offset);return this.skip(1),e},e.prototype.getInt16=function(){this.skipTagAndLen();var e=this.dv.getInt16(this.offset,this.littleEndian);return this.skip(2),e},e.prototype.getInt32=function(){this.skipTagAndLen();var e=this.dv.getInt32(this.offset,this.littleEndian);return this.skip(4),e},e.prototype.getInt64=function(){return this.skipTagAndLen(),this._getInt64(this.littleEndian)},e.prototype.getFloat32=function(){this.skipTagAndLen();var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.skip(4),e},e.prototype.getFloat64=function(){this.skipTagAndLen();var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.skip(8),e},e.prototype.getInt=function(){this.skipTag();var e=this.getValueLength(),t=this.offset;switch(this.offset+=e,e){case 1:return this.dv.getUint8(t);case 2:return this.dv.getInt16(t,this.littleEndian);case 4:return this.dv.getInt32(t,this.littleEndian);default:throw new Error("malformed int length: "+e+".")}},e.prototype._getInt64=function(e){var t,n;return e?(t=this.dv.getUint32(this.offset,e),this.skip(4),n=this.dv.getUint32(this.offset,e),this.skip(4)):(n=this.dv.getUint32(this.offset,e),this.skip(4),t=this.dv.getUint32(this.offset,e),this.skip(4)),2147483648&n?(n=4294967295&~n,4294967295===(t=4294967295&~t)&&(n=n+1&4294967295),-(4294967296*n+(t=t+1&4294967295))):4294967296*n+t},e.prototype.getUint8Array=function(){return this.readTypedArray(Uint8Array)},e.prototype.getInt16Array=function(){return this.readTypedArray(Int16Array)},e.prototype.getInt32Array=function(){return this.readTypedArray(Int32Array)},e.prototype.getInt64Array=function(){this.skipTag();for(var e=this.getValueLength()/8,t=[],n=0;n<e;n++){var i=this._getInt64(this.littleEndian);t.push(i)}return t},e.prototype.getFloat32Array=function(){return this.readTypedArray(Float32Array)},e.prototype.getFloat64Array=function(){return this.readTypedArray(Float64Array)},e.prototype.readTypedArray=function(e){this.skipTag();var t=this.getValueLength(),n=this.dv.byteOffset+this.offset,i=new e(this.dv.buffer.slice(n,n+t));return this.offset+=t,i},e.prototype.getString=function(){return this.skipTag(),this.readString()},e.prototype.getStringArray=function(){this.skipTag();for(var e=this.createSubReader(),t=[];!e.eof();){var n=e.readString();t.push(n)}return t},e.prototype.skip=function(e){this.offset+=e},e.prototype.skipTag=function(){this.offset+=1},e.prototype.skipTagAndLen=function(){this.offset+=5},e.prototype.skipField=function(){var e=this.dv.getUint32(this.offset+1,this.littleEndian);this.offset+=5+e},e.prototype.getOffset=function(){return this.offset},e.prototype.getTag=function(){return this.dv.getUint8(this.offset)},e.prototype.getValueLength=function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},e.prototype.createSubReader=function(){var t=this.getValueLength(),n=new e(this.dv.buffer,this.dv.byteOffset+this.offset,t);return this.offset+=t,n},e.prototype.readString=function(){var e=this.getValueLength(),t=new Uint8Array(this.dv.buffer,this.dv.byteOffset+this.offset,e),n=String.fromCharCode.apply(String,t);return this.offset+=e,n},e.prototype.eof=function(){return this.offset>=this.dv.byteLength},e}();t.TlvReader=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=BK.Director.screenPixelSize,r=i.width,a=i.height;t.innerWidth=r,t.innerHeight=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=n(7);t.style=function(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:i.innerWidth+"px",height:i.innerHeight+"px",margin:"0px",padding:"0px"})},t.classList=function(e){e.classList=[],e.classList.add=r.noop,e.classList.remove=r.noop,e.classList.contains=r.noop,e.classList.toggle=r.noop}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(10);function a(e,t,n){void 0===n&&(n=!1);var i=arguments,r=arguments.length;e=r>0&&void 0!==i[0]?i[0]:0,t=r>1&&void 0!==i[1]?i[1]:0;this.__nativeObj=new BK.CanvasNode(e,t),this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=1,this._a=1,this._b=0,this._c=0,this._d=1,this._tx=0,this._ty=0,this._fillStyle={},this.canvas=this;var o={"no-repeat":0,"repeat-x":1,"repeat-y":2,repeat:3};this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"scale"!=t&&"transform"!=t&&"contentSize"!=t&&"size"!=t&&"fontPath"!=t&&"fillStyle"!=t&&"globalCompositeOperation"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(a.prototype,"fontPath",{get:function(){return this.__nativeObj.fontPath},set:function(e){BK.FileUtil.isFileExist(e)&&(this.__nativeObj.fontPath=e)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"canvas",{get:function(){return this},set:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(e){switch(e){case 0:case 1:case 2:this._textBaseLine=e;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){switch(e){case 0:case 1:case 2:this._textAlign=e;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(e){this.__nativeObj.lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fillStyle",{get:function(){return this._fillStyle},set:function(e){this._fillStyle=e;var t={};e instanceof BK.CanvasPattern&&(t.type=3,t.tag=e.tag,"string"==typeof e.image?t.imagePath=e.image:"object"==typeof e.image&&(t.image=e.image),t.repetition=o[e.repetition]||""),this.__nativeObj.fillStyle=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(e){e=Math.min(1,e),e=Math.max(0,e),this.__nativeObj.globalAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(e){this.__nativeObj.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(e){this.__nativeObj.strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(e){this.__nativeObj.lineCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(e){this.__nativeObj.lineJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(e){this.__nativeObj.miterLimit=e},enumerable:!0,configurable:!0})}t.default=function(){var e=new a(0,0,!1);return e.getContext,"tagName"in e||(e.tagName="CANVAS"),e.type="canvas",i.style(e),i.classList(e),e.addEventListener=function(e,t,n){void 0===n&&(n={}),document.addEventListener(e,t,n)},e.removeEventListener=function(e,t){document.removeEventListener(e,t)},e},Object.defineProperties(a.prototype,{width:{get:function(){return this.size.width},set:function(e){var t=this.size;t.width=e,this.size=t},configurable:!0},height:{get:function(){return this.size.height},set:function(e){var t=this.size;t.height=e,this.size=t},configurable:!0}}),a.prototype.setFlipXY=function(e,t){this.__nativeObj.setUVFlip(e,t)},a.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},a.prototype.dispose=function(){return this.__nativeObj.dispose()},a.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1,1==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode()):0},a.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},a.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},a.prototype.drawImage=function(){if(this.__nativeObj){var e=arguments.length;if(9==e)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==e)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=e)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}this._innerSetTransform()}return 0},a.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},a.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},a.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},a.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},a.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},a.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},a.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},a.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},a.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},a.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},a.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},a.prototype.arc=function(){if(this.__nativeObj){var e=arguments.length;if(5==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);if(6==e)return this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},a.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},a.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},a.prototype.fillText=function(){if(arguments.length>=3){var e=2048,t=1024;arguments[3]&&(e=arguments[3]),arguments[4]&&(t=arguments[4]);var n=this.measureText(arguments[0],e,t),i=arguments[1],r=arguments[2];switch(1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine){case 1:r-=.5*n.height;break;case 2:r-=1*n.height}switch(this._textAlign){case 1:i-=.5*n.width;break;case 2:i-=1*n.width}this.__nativeObj.fillText(arguments[0],i,r,Math.min(e,n.width),Math.min(t,n.height)),this._innerSetTransform()}return 0},a.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},a.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},a.prototype.scale=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scale  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},a.prototype.scales=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. scales  :"+arguments[0]+" , "+arguments[1]),this.__nativeObj.scales(arguments[0],arguments[1])},a.prototype.rotate=function(){if(this.__nativeObj)return BK.Script.log(0,0,"bk.canvas. rotate  :"+arguments[0]),this.__nativeObj.rotate(arguments[0])},a.prototype.translate=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5)?(this._tx=arguments[0],this._ty=arguments[1],this._innerSetTransform()):this.__nativeObj.translate(arguments[0],arguments[1])}},a.prototype.transform=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},a.prototype.transforms=function(){return this.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},a.prototype.setTransform=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");if(Number(e[0])<7||7==Number(e[0])&&Number(e[1])<7){if("ios"==GameStatusInfo.platform){var t=(n=this._a,i=this._b,r=this._c,a=this._d,o=this._tx,s=this._ty,f=h=-1*(1*r-0*o)/(l=n*a*1+r*s*0+o*i*0-o*a*0-r*i*1-n*s*0),h=c=-1*(1*i-0*s)/l,c=f,f=1*(r*s-o*a)/l,u=1*(0*i-0*a)/l,u=f,f=p=-1*(0*n-0*r)/l,p=-1*(n*s-o*i)/l,f,[1*(1*a-0*s)/l,h,c,1*(1*n-0*o)/l,u,p]);this.__nativeObj.transforms(t[0],t[1],t[2],t[3],t[4],t[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return this._a=arguments[0],this._b=arguments[1],this._c=arguments[2],this._d=arguments[3],this._tx=arguments[4],this._ty=arguments[5],this.__nativeObj.setTransform(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}var n,i,r,a,o,s,l,c,u,h,p,f},a.prototype._innerSetTransform=function(){if(this.__nativeObj){var e=GameStatusInfo.QQVer.split(".");if(7==Number(e[0])&&Number(7==e[1]&&Number(e[2])<=5))return this.__nativeObj.setTransform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},a.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},a.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},a.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},a.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},a.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},a.prototype.getTexture=function(){return this.__nativeObj?this.__nativeObj.getTexture():null},a.prototype.drawText=function(){return this.__nativeObj&&(this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this._innerSetTransform()),null},a.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},a.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},a.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},a.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},a.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},a.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},a.prototype.createPattern=function(e,t){return new BK.CanvasPattern(e,t)},a.prototype.getContext=function(e){if("webgl"===e){var t=r.bkWebGLGetInstance();return t.canvas=this,t}return this},BK.CanvasPattern=function(){function e(e,t){this.image=e,this.repetition=t,this.tag="813858ef942fd556"}return e.prototype.setTransform=function(e){},e}()},function(e,t,n){"use strict";e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/webgl/WebGLRenderingContext.ts")}({"./src/util/buffer.ts":
/*!****************************!*\
          !*** ./src/util/buffer.ts ***!
          \****************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=BK.Director.queryDeviceInfo(),r=!("ios"===i.platform&&Number(i.version.split(".")[0])<10);t.isSupportArrayBuffer=r;var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function o(e,t){if(r&&BK.Misc.toArrayBuffer){var n=new ArrayBuffer(e.length);return BK.Misc.toArrayBuffer(e,n),n}return BK.Misc.toArrayBufferCompatible?BK.Misc.toArrayBufferCompatible(e,t):BK.Misc.BKBufferToArrayBuffer(e)}function s(e){if(r&&BK.Misc.toBKBuffer)return BK.Misc.toBKBuffer(e,e.byteOffset,e.byteLength);if(BK.Misc.transferArrayBuffer)return function(e){function t(e,t){var n=t.length,i={type:e,length:t.byteLength,offset:0};switch(e){case 0:for(var r=0;n>0;){var a=Math.min(n,40960),o=new Int8Array(t.buffer,r*Int8Array.BYTES_PER_ELEMENT,a);i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960}break;case 1:for(r=0;n>0;)a=Math.min(n,40960),o=new Int16Array(t.buffer,r*Int16Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960;break;case 2:for(r=0;n>0;)a=Math.min(n,40960),o=new Int32Array(t.buffer,r*Int32Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960;break;case 3:for(r=0;n>0;)a=Math.min(n,40960),o=new Uint8Array(t.buffer,r*Uint8Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960;break;case 5:for(r=0;n>0;)a=Math.min(n,40960),o=new Uint16Array(t.buffer,r*Uint16Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960;break;case 6:for(r=0;n>0;)a=Math.min(n,40960),o=new Uint32Array(t.buffer,r*Uint32Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960;break;case 7:for(r=0;n>0;)a=Math.min(n,40960),o=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT,a),i.offset=r,BK.Misc.transferArrayBuffer.apply(i,o),r+=40960,n-=40960}}return e instanceof Int8Array==1?t(0,e):e instanceof Int16Array==1?t(1,e):e instanceof Int32Array==1?t(2,e):e instanceof Uint8Array==1?t(3,e):e instanceof Uint16Array==1?t(5,e):e instanceof Uint32Array==1?t(6,e):e instanceof Float32Array==1&&t(7,e),BK.Misc.getTransferedArrayBuffer()}(e);var t=function(e,t,n){var i,r=new Uint8Array(e,t||0,n||e.byteLength),o=r.length,s="";for(i=0;i<o;i+=3)s+=a[r[i]>>2],s+=a[(3&r[i])<<4|r[i+1]>>4],s+=a[(15&r[i+1])<<2|r[i+2]>>6],s+=a[63&r[i+2]];return o%3==2?s=s.substring(0,s.length-1)+"=":o%3==1&&(s=s.substring(0,s.length-2)+"=="),s}(e.buffer,e.byteOffset,e.byteLength);return BK.Misc.decodeBase64FromString(t)}t.typedArrayToBKBuffer=s,t.BKBufferToInt8Array=function(e){return new Int8Array(o(e,0))},t.BKBufferToInt16Array=function(e){return new Int16Array(o(e,1))},t.BKBufferToInt32Array=function(e){return new Int32Array(o(e,2))},t.BKBufferToUint8Array=function(e){return new Uint8Array(o(e,3))},t.BKBufferToUint16Array=function(e){return new Uint16Array(o(e,5))},t.BKBufferToUint32Array=function(e){return new Uint32Array(o(e,6))},t.BKBufferToFloat32Array=function(e){return new Float32Array(o(e,7))},t.BKBufferToArrayBuffer=function(e){return o(e,0)},t.arrayBufferToBKBuffer=function(e){return s(new Int8Array(e))}},"./src/webgl/WebGLBuffer.ts":
/*!**********************************!*\
          !*** ./src/webgl/WebGLBuffer.ts ***!
          \**********************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._bufferid=e}return Object.defineProperty(e.prototype,"bufferId",{get:function(){return this._bufferid},set:function(e){this._bufferid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLFramebuffer.ts":
/*!***************************************!*\
          !*** ./src/webgl/WebGLFramebuffer.ts ***!
          \***************************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._framabufferid=e}return Object.defineProperty(e.prototype,"framebufferId",{get:function(){return this._framabufferid},set:function(e){this._framabufferid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLProgram.ts":
/*!***********************************!*\
          !*** ./src/webgl/WebGLProgram.ts ***!
          \***********************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._programid=e}return Object.defineProperty(e.prototype,"programId",{get:function(){return this._programid},set:function(e){this._programid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLRenderbuffer.ts":
/*!****************************************!*\
          !*** ./src/webgl/WebGLRenderbuffer.ts ***!
          \****************************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._renderbufferid=e}return Object.defineProperty(e.prototype,"renderbufferId",{get:function(){return this._renderbufferid},set:function(e){this._renderbufferid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLRenderingContext.ts":
/*!********************************************!*\
          !*** ./src/webgl/WebGLRenderingContext.ts ***!
          \********************************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(/*! ./WebGLBuffer */"./src/webgl/WebGLBuffer.ts"),a=n(/*! ./WebGLFramebuffer */"./src/webgl/WebGLFramebuffer.ts"),o=n(/*! ./WebGLRenderbuffer */"./src/webgl/WebGLRenderbuffer.ts"),s=n(/*! ./WebGLProgram */"./src/webgl/WebGLProgram.ts"),l=n(/*! ./WebGLShader */"./src/webgl/WebGLShader.ts"),c=n(/*! ./WebGLTexture */"./src/webgl/WebGLTexture.ts"),u=n(/*! ./WebGLUniformLocation */"./src/webgl/WebGLUniformLocation.ts"),h=n(/*! ../util/buffer */"./src/util/buffer.ts");function p(e){return Array.isArray(e)?h.typedArrayToBKBuffer(new Int32Array(e)):h.typedArrayToBKBuffer(e)}function f(e){return Array.isArray(e)?h.typedArrayToBKBuffer(new Float32Array(e)):h.typedArrayToBKBuffer(e)}t.bkWebGLGetInstance=function(){return i||(i=d.getInstance(),renderTicker&&renderTicker.setTickerCallBack(function(e,t){})),i};var d=function(){function e(){this.firstFrameUpload=!1,this.DEPTH_BUFFER_BIT=256,this.STENCIL_BUFFER_BIT=1024,this.COLOR_BUFFER_BIT=16384,this.POINTS=0,this.LINES=1,this.LINE_LOOP=2,this.LINE_STRIP=3,this.TRIANGLES=4,this.TRIANGLE_STRIP=5,this.TRIANGLE_FAN=6,this.ZERO=0,this.ONE=1,this.SRC_COLOR=768,this.ONE_MINUS_SRC_COLOR=769,this.SRC_ALPHA=770,this.ONE_MINUS_SRC_ALPHA=771,this.DST_ALPHA=772,this.ONE_MINUS_DST_ALPHA=773,this.DST_COLOR=774,this.ONE_MINUS_DST_COLOR=775,this.SRC_ALPHA_SATURATE=776,this.FUNC_ADD=32774,this.BLEND_EQUATION=32777,this.BLEND_EQUATION_RGB=32777,this.BLEND_EQUATION_ALPHA=34877,this.FUNC_SUBTRACT=32778,this.FUNC_REVERSE_SUBTRACT=32779,this.BLEND_DST_RGB=32968,this.BLEND_SRC_RGB=32969,this.BLEND_DST_ALPHA=32970,this.BLEND_SRC_ALPHA=32971,this.CONSTANT_COLOR=32769,this.ONE_MINUS_CONSTANT_COLOR=32770,this.CONSTANT_ALPHA=32771,this.ONE_MINUS_CONSTANT_ALPHA=32772,this.BLEND_COLOR=32773,this.ARRAY_BUFFER=34962,this.ELEMENT_ARRAY_BUFFER=34963,this.ARRAY_BUFFER_BINDING=34964,this.ELEMENT_ARRAY_BUFFER_BINDING=34965,this.STREAM_DRAW=35040,this.STATIC_DRAW=35044,this.DYNAMIC_DRAW=35048,this.BUFFER_SIZE=34660,this.BUFFER_USAGE=34661,this.CURRENT_VERTEX_ATTRIB=34342,this.FRONT=1028,this.BACK=1029,this.FRONT_AND_BACK=1032,this.CULL_FACE=2884,this.BLEND=3042,this.DITHER=3024,this.STENCIL_TEST=2960,this.DEPTH_TEST=2929,this.SCISSOR_TEST=3089,this.POLYGON_OFFSET_FILL=32823,this.SAMPLE_ALPHA_TO_COVERAGE=32926,this.SAMPLE_COVERAGE=32928,this.NO_ERROR=0,this.INVALID_ENUM=1280,this.INVALID_VALUE=1281,this.INVALID_OPERATION=1282,this.OUT_OF_MEMORY=1285,this.CW=2304,this.CCW=2305,this.LINE_WIDTH=2849,this.ALIASED_POINT_SIZE_RANGE=33901,this.ALIASED_LINE_WIDTH_RANGE=33902,this.CULL_FACE_MODE=2885,this.FRONT_FACE=2886,this.DEPTH_RANGE=2928,this.DEPTH_WRITEMASK=2930,this.DEPTH_CLEAR_VALUE=2931,this.DEPTH_FUNC=2932,this.STENCIL_CLEAR_VALUE=2961,this.STENCIL_FUNC=2962,this.STENCIL_FAIL=2964,this.STENCIL_PASS_DEPTH_FAIL=2965,this.STENCIL_PASS_DEPTH_PASS=2966,this.STENCIL_REF=2967,this.STENCIL_VALUE_MASK=2963,this.STENCIL_WRITEMASK=2968,this.STENCIL_BACK_FUNC=34816,this.STENCIL_BACK_FAIL=34817,this.STENCIL_BACK_PASS_DEPTH_FAIL=34818,this.STENCIL_BACK_PASS_DEPTH_PASS=34819,this.STENCIL_BACK_REF=36003,this.STENCIL_BACK_VALUE_MASK=36004,this.STENCIL_BACK_WRITEMASK=36005,this.VIEWPORT=2978,this.SCISSOR_BOX=3088,this.COLOR_CLEAR_VALUE=3106,this.COLOR_WRITEMASK=3107,this.UNPACK_ALIGNMENT=3317,this.PACK_ALIGNMENT=3333,this.MAX_TEXTURE_SIZE=3379,this.MAX_VIEWPORT_DIMS=3386,this.SUBPIXEL_BITS=3408,this.RED_BITS=3410,this.GREEN_BITS=3411,this.BLUE_BITS=3412,this.ALPHA_BITS=3413,this.DEPTH_BITS=3414,this.STENCIL_BITS=3415,this.POLYGON_OFFSET_UNITS=10752,this.POLYGON_OFFSET_FACTOR=32824,this.TEXTURE_BINDING_2D=32873,this.SAMPLE_BUFFERS=32936,this.SAMPLES=32937,this.SAMPLE_COVERAGE_VALUE=32938,this.SAMPLE_COVERAGE_INVERT=32939,this.COMPRESSED_TEXTURE_FORMATS=34467,this.DONT_CARE=4352,this.FASTEST=4353,this.NICEST=4354,this.GENERATE_MIPMAP_HINT=33170,this.BYTE=5120,this.UNSIGNED_BYTE=5121,this.SHORT=5122,this.UNSIGNED_SHORT=5123,this.INT=5124,this.UNSIGNED_INT=5125,this.FLOAT=5126,this.DEPTH_COMPONENT=6402,this.ALPHA=6406,this.RGB=6407,this.RGBA=6408,this.LUMINANCE=6409,this.LUMINANCE_ALPHA=6410,this.UNSIGNED_SHORT_4_4_4_4=32819,this.UNSIGNED_SHORT_5_5_5_1=32820,this.UNSIGNED_SHORT_5_6_5=33635,this.FRAGMENT_SHADER=35632,this.VERTEX_SHADER=35633,this.MAX_VERTEX_ATTRIBS=34921,this.MAX_VERTEX_UNIFORM_VECTORS=36347,this.MAX_VARYING_VECTORS=36348,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,this.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,this.MAX_TEXTURE_IMAGE_UNITS=34930,this.MAX_FRAGMENT_UNIFORM_VECTORS=36349,this.SHADER_TYPE=35663,this.DELETE_STATUS=35712,this.LINK_STATUS=35714,this.VALIDATE_STATUS=35715,this.ATTACHED_SHADERS=35717,this.ACTIVE_UNIFORMS=35718,this.ACTIVE_ATTRIBUTES=35721,this.SHADING_LANGUAGE_VERSION=35724,this.CURRENT_PROGRAM=35725,this.NEVER=512,this.LESS=513,this.EQUAL=514,this.LEQUAL=515,this.GREATER=516,this.NOTEQUAL=517,this.GEQUAL=518,this.ALWAYS=519,this.KEEP=7680,this.REPLACE=7681,this.INCR=7682,this.DECR=7683,this.INVERT=5386,this.INCR_WRAP=34055,this.DECR_WRAP=34056,this.VENDOR=7936,this.RENDERER=7937,this.VERSION=7938,this.NEAREST=9728,this.LINEAR=9729,this.NEAREST_MIPMAP_NEAREST=9984,this.LINEAR_MIPMAP_NEAREST=9985,this.NEAREST_MIPMAP_LINEAR=9986,this.LINEAR_MIPMAP_LINEAR=9987,this.TEXTURE_MAG_FILTER=10240,this.TEXTURE_MIN_FILTER=10241,this.TEXTURE_WRAP_S=10242,this.TEXTURE_WRAP_T=10243,this.TEXTURE_2D=3553,this.TEXTURE=5890,this.TEXTURE_CUBE_MAP=34067,this.TEXTURE_BINDING_CUBE_MAP=34068,this.TEXTURE_CUBE_MAP_POSITIVE_X=34069,this.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,this.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,this.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,this.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,this.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,this.MAX_CUBE_MAP_TEXTURE_SIZE=34076,this.TEXTURE0=33984,this.TEXTURE1=33985,this.TEXTURE2=33986,this.TEXTURE3=33987,this.TEXTURE4=33988,this.TEXTURE5=33989,this.TEXTURE6=33990,this.TEXTURE7=33991,this.TEXTURE8=33992,this.TEXTURE9=33993,this.TEXTURE10=33994,this.TEXTURE11=33995,this.TEXTURE12=33996,this.TEXTURE13=33997,this.TEXTURE14=33998,this.TEXTURE15=33999,this.TEXTURE16=34e3,this.TEXTURE17=34001,this.TEXTURE18=34002,this.TEXTURE19=34003,this.TEXTURE20=34004,this.TEXTURE21=34005,this.TEXTURE22=34006,this.TEXTURE23=34007,this.TEXTURE24=34008,this.TEXTURE25=34009,this.TEXTURE26=34010,this.TEXTURE27=34011,this.TEXTURE28=34012,this.TEXTURE29=34013,this.TEXTURE30=34014,this.TEXTURE31=34015,this.ACTIVE_TEXTURE=34016,this.REPEAT=10497,this.CLAMP_TO_EDGE=33071,this.MIRRORED_REPEAT=33648,this.FLOAT_VEC2=35664,this.FLOAT_VEC3=35665,this.FLOAT_VEC4=35666,this.INT_VEC2=35667,this.INT_VEC3=35668,this.INT_VEC4=35669,this.BOOL=35670,this.BOOL_VEC2=35671,this.BOOL_VEC3=35672,this.BOOL_VEC4=35673,this.FLOAT_MAT2=35674,this.FLOAT_MAT3=35675,this.FLOAT_MAT4=35676,this.SAMPLER_2D=35678,this.SAMPLER_CUBE=35680,this.VERTEX_ATTRIB_ARRAY_ENABLED=34338,this.VERTEX_ATTRIB_ARRAY_SIZE=34339,this.VERTEX_ATTRIB_ARRAY_STRIDE=34340,this.VERTEX_ATTRIB_ARRAY_TYPE=34341,this.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,this.VERTEX_ATTRIB_ARRAY_POINTER=34373,this.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,this.IMPLEMENTATION_COLOR_READ_TYPE=35738,this.IMPLEMENTATION_COLOR_READ_FORMAT=35739,this.COMPILE_STATUS=35713,this.LOW_FLOAT=36336,this.MEDIUM_FLOAT=36337,this.HIGH_FLOAT=36338,this.LOW_INT=36339,this.MEDIUM_INT=36340,this.HIGH_INT=36341,this.FRAMEBUFFER=36160,this.RENDERBUFFER=36161,this.RGBA4=32854,this.RGB5_A1=32855,this.RGB565=36194,this.DEPTH_COMPONENT16=33189,this.STENCIL_INDEX8=36168,this.DEPTH_STENCIL=34041,this.RENDERBUFFER_WIDTH=36162,this.RENDERBUFFER_HEIGHT=36163,this.RENDERBUFFER_INTERNAL_FORMAT=36164,this.RENDERBUFFER_RED_SIZE=36176,this.RENDERBUFFER_GREEN_SIZE=36177,this.RENDERBUFFER_BLUE_SIZE=36178,this.RENDERBUFFER_ALPHA_SIZE=36179,this.RENDERBUFFER_DEPTH_SIZE=36180,this.RENDERBUFFER_STENCIL_SIZE=36181,this.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,this.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,this.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,this.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,this.COLOR_ATTACHMENT0=36064,this.DEPTH_ATTACHMENT=36096,this.STENCIL_ATTACHMENT=36128,this.DEPTH_STENCIL_ATTACHMENT=33306,this.NONE=0,this.FRAMEBUFFER_COMPLETE=36053,this.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,this.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,this.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,this.FRAMEBUFFER_UNSUPPORTED=36061,this.FRAMEBUFFER_BINDING=36006,this.RENDERBUFFER_BINDING=36007,this.MAX_RENDERBUFFER_SIZE=34024,this.INVALID_FRAMEBUFFER_OPERATION=1286,this.UNPACK_FLIP_Y_WEBGL=37440,this.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,this.CONTEXT_LOST_WEBGL=37442,this.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,this.BROWSER_DEFAULT_WEBGL=37444,this.SHADER_BINARY_FORMATS=36344,this.NUM_SHADER_BINARY_FORMATS=36345,this.NUM_COMPRESSED_TEXTURE_FORMATS=34466,this.total_size=1e5,this.next_index=0,this.bufferdata_pointer=0,this.extensions=new Array,this.no_extensions=new Array,this.gl=new BK.WebGL,this.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height)}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.viewport=function(e,t,n,i){this.gl.glViewport(e,t,n,i)},e.prototype.bindAttribLocation=function(e,t,n){this.gl.glBindAttribLocation(e.programId,t,n)},e.prototype.createProgram=function(){var e=this.gl.glCreateProgram();return new s.default(e)},e.prototype.deleteProgram=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");this.gl.glDeleteProgram(e.programId)},e.prototype.getActiveAttrib=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glGetActiveAttrib(e.programId,t)},e.prototype.getActiveUniform=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glGetActiveUniform(e.programId,t)},e.prototype.getAttribLocation=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glGetAttribLocation(e.programId,t)},e.prototype.getProgramParameter=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glGetProgramParameter(e.programId,t)},e.prototype.getProgramInfoLog=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glGetProgramInfoLog(e.programId)},e.prototype.isProgram=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");return this.gl.glIsProgram(e.programId)},e.prototype.linkProgram=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");e&&this.gl.glLinkProgram(e.programId)},e.prototype.useProgram=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");e&&this.gl.glUseProgram(e.programId)},e.prototype.validateProgram=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");this.gl.glValidateProgram(e.programId)},e.prototype.bindBuffer=function(e,t){this.gl.glBindBuffer(e,t?t.bufferId:null)},e.prototype.createBuffer=function(){return new r.default(this.gl.glCreateBuffer())},e.prototype.isBuffer=function(e){return e&&this.gl.glIsBuffer(e.bufferId)},e.prototype.deleteBuffer=function(e){e&&this.gl.glDeleteBuffer(e.bufferId)},e.prototype.getBufferParameter=function(e,t){return this.gl.glGetBufferParameter(e,t)},e.prototype.bindFramebuffer=function(e,t){this.gl.glBindFramebuffer(e,t?t.framebufferId:null)},e.prototype.createFramebuffer=function(){return new a.default(this.gl.glCreateFramebuffer())},e.prototype.deleteFramebuffer=function(e){e&&this.gl.glDeleteFramebuffer(e.framebufferId)},e.prototype.isFramebuffer=function(e){return e&&this.gl.glIsFramebuffer(e.framebufferId)},e.prototype.getFramebufferAttachmentParameter=function(e,t,n){return this.gl.glGetFramebufferAttachmentParameter(e,t,n)},e.prototype.bindRenderbuffer=function(e,t){this.gl.glBindRenderbuffer(e,t?t.renderbufferId:null)},e.prototype.createRenderbuffer=function(){return new o.default(this.gl.glCreateRenderbuffer())},e.prototype.deleteRenderbuffer=function(e){e&&this.gl.glDeleteRenderbuffer(e.renderbufferId)},e.prototype.isRenderbuffer=function(e){return e&&this.gl.glIsRenderbuffer(e.renderbufferId)},e.prototype.getRenderbufferParameter=function(e,t){return this.gl.glGetRenderbufferParameter(e,t)},e.prototype.attachShader=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");if(!(t instanceof l.default))throw new TypeError("shader argument type error");this.gl.glAttachShader(e.programId,t.shaderId)},e.prototype.compileShader=function(e){if(!(e instanceof l.default))throw new TypeError("shader argument type error");this.gl.glCompileShader(e.shaderId)},e.prototype.getShaderParameter=function(e,t){if(!(e instanceof l.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderParameter(e.shaderId,t)},e.prototype.createShader=function(e){var t=this.gl.glCreateShader(e);return new l.default(t)},e.prototype.deleteShader=function(e){if(!(e instanceof l.default))throw new TypeError("shader argument type error");this.gl.glDeleteShader(e.shaderId)},e.prototype.detachShader=function(e,t){if(!(e instanceof s.default))throw new TypeError("program argument type error");if(!(t instanceof l.default))throw new TypeError("shader argument type error");this.gl.glDetachShader(e.programId,t.shaderId)},e.prototype.getShaderInfoLog=function(e){if(!(e instanceof l.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderInfoLog(e.shaderId)},e.prototype.getShaderSource=function(e){if(!(e instanceof l.default))throw new TypeError("shader argument type error");return this.gl.glGetShaderSource(e.shaderId)},e.prototype.isShader=function(e){if(!(e instanceof l.default))throw new TypeError("shader argument type error");return this.gl.glIsShader(e.shaderId)},e.prototype.shaderSource=function(e,t){if(!(e instanceof l.default))throw new TypeError("shader argument type error");this.gl.glShaderSource(e.shaderId,t)},e.prototype.getAttachedShaders=function(e){if(!(e instanceof s.default))throw new TypeError("program argument type error");var t=this.gl.glGetAttachedShaders(e.programId);return new l.default(t)},e.prototype.bindTexture=function(e,t){if(null===t)this.gl.glBindTexture(e,0);else{if(!(t instanceof c.default))throw new TypeError("texture argument type error");this.gl.glBindTexture(e,t.textureId)}},e.prototype.compressedTexImage2D=function(e,t,n,i,r,a,o){this.gl.glCompressedTexImage2D(e,t,n,i,r,a,o)},e.prototype.compressedTexSubImage2D=function(e,t,n,i,r,a,o,s){this.gl.glCompressedTexSubImage2D(e,t,n,i,r,a,o,s)},e.prototype.copyTexImage2D=function(e,t,n,i,r,a,o,s){this.gl.glCopyTexImage2D(e,t,n,i,r,a,o,s)},e.prototype.copyTexSubImage2D=function(e,t,n,i,r,a,o,s){this.gl.glCopyTexSubImage2D(e,t,n,i,r,a,o,s)},e.prototype.createTexture=function(){return new c.default(this.gl.glCreateTexture())},e.prototype.deleteTexture=function(e){if(!(e instanceof c.default))throw new TypeError("texture argument type error");this.gl.glDeleteTexture(e.textureId)},e.prototype.generateMipmap=function(e){this.gl.glGenerateMipmap(e)},e.prototype.getTexParameter=function(e,t){return this.gl.glGetTexParameter(e,t)},e.prototype.isTexture=function(e){if(!(e instanceof c.default))throw new TypeError("texture argument type error");return this.gl.glIsTexture(e.textureId)},e.prototype.texImage2D=function(e,t,n){switch(arguments.length){case 6:var i=arguments[3],r=arguments[4];(l=arguments[5])&&Object.prototype.hasOwnProperty.call(l,"__nativeObj")?(this.gl.glTexImage2D(e,t,n,i,r,l.__nativeObj),l.dispose&&l.dispose()):(l==[]&&(l=null),this.gl.glTexImage2D(e,t,n,i,r,l));break;case 9:var a=arguments[3],o=arguments[4],s=arguments[5],l=(i=arguments[6],r=arguments[7],arguments[8]);this.gl.glTexImage2D(e,t,n,a,o,s,i,r,l)}},e.prototype.texSubImage2D=function(e,t,n,i){switch(arguments.length){case 7:var r=arguments[4],a=arguments[5],o=arguments[6];Object.prototype.hasOwnProperty.call(o,"__nativeObj")?this.gl.glTexSubImage2D(e,t,n,i,r,a,o.__nativeObj):this.gl.glTexSubImage2D(e,t,n,i,r,a,o);break;case 9:var s=arguments[4],l=arguments[5];r=arguments[6],a=arguments[7],o=arguments[8];this.gl.glTexSubImage2D(e,t,n,i,s,l,r,a,o)}},e.prototype.texParameterf=function(e,t,n){this.gl.glTexParameterf(e,t,n)},e.prototype.texParameteri=function(e,t,n){this.gl.glTexParameteri(e,t,n)},e.prototype.activeTexture=function(e){this.gl.glActiveTexture(e)},e.prototype.framebufferTexture2D=function(e,t,n,i,r){if(!(i instanceof c.default))throw new TypeError("texture argument type error");this.gl.glFramebufferTexture2D(e,t,n,i.textureId,r)},e.prototype.getShaderPrecisionFormat=function(e,t){return this.gl.glGetShaderPrecisionFormat(e,t)},e.prototype.getParameter=function(e){switch(e){case i.ARRAY_BUFFER_BINDING:return new o.default(this.gl.glGetParameterInt(e,1));case i.CURRENT_PROGRAM:return new s.default(this.gl.glGetParameterInt(e,1));case i.ELEMENT_ARRAY_BUFFER_BINDING:return new r.default(this.gl.glGetParameterInt(e,1));case i.FRAMEBUFFER_BINDING:return new a.default(this.gl.glGetParameterInt(e,1));case i.RENDERBUFFER_BINDING:return new o.default(this.gl.glGetParameterInt(e,1));case i.TEXTURE_BINDING_2D:case i.TEXTURE_BINDING_CUBE_MAP:return new c.default(this.gl.glGetParameterInt(e,1));case i.ACTIVE_TEXTURE:case i.ALPHA_BITS:case i.BLUE_BITS:case i.CULL_FACE_MODE:case i.DEPTH_BITS:case i.DEPTH_FUNC:case i.FRONT_FACE:case i.GENERATE_MIPMAP_HINT:case i.GREEN_BITS:case i.IMPLEMENTATION_COLOR_READ_FORMAT:case i.IMPLEMENTATION_COLOR_READ_TYPE:case i.MAX_COMBINED_TEXTURE_IMAGE_UNITS:case i.MAX_CUBE_MAP_TEXTURE_SIZE:case i.MAX_FRAGMENT_UNIFORM_VECTORS:case i.MAX_RENDERBUFFER_SIZE:case i.MAX_TEXTURE_IMAGE_UNITS:case i.MAX_TEXTURE_SIZE:case i.MAX_VARYING_VECTORS:case i.MAX_VERTEX_ATTRIBS:case i.MAX_VERTEX_TEXTURE_IMAGE_UNITS:case i.MAX_VERTEX_UNIFORM_VECTORS:case i.MAX_VIEWPORT_DIMS:case i.NUM_COMPRESSED_TEXTURE_FORMATS:case i.NUM_SHADER_BINARY_FORMATS:case i.PACK_ALIGNMENT:case i.RED_BITS:case i.SAMPLE_BUFFERS:case i.SAMPLES:case i.STENCIL_BACK_FAIL:case i.STENCIL_BACK_FUNC:case i.STENCIL_BACK_PASS_DEPTH_FAIL:case i.STENCIL_BACK_PASS_DEPTH_PASS:case i.STENCIL_BACK_REF:case i.STENCIL_BACK_VALUE_MASK:case i.STENCIL_BACK_WRITEMASK:case i.STENCIL_BITS:case i.STENCIL_CLEAR_VALUE:case i.STENCIL_FAIL:case i.STENCIL_FUNC:case i.STENCIL_PASS_DEPTH_FAIL:case i.STENCIL_PASS_DEPTH_PASS:case i.STENCIL_REF:case i.STENCIL_VALUE_MASK:case i.STENCIL_WRITEMASK:case i.SUBPIXEL_BITS:case i.UNPACK_ALIGNMENT:case i.BLEND_DST_ALPHA:case i.BLEND_DST_RGB:case i.BLEND_EQUATION_ALPHA:case i.BLEND_EQUATION_RGB:case i.BLEND_SRC_ALPHA:case i.BLEND_SRC_RGB:return this.gl.glGetParameterInt(e,1);case i.ALIASED_LINE_WIDTH_RANGE:case i.ALIASED_POINT_SIZE_RANGE:case i.DEPTH_RANGE:case i.MAX_VIEWPORT_DIMS:return this.gl.glGetParameterFloat(e,2);case i.BLEND:case i.CULL_FACE:case i.DEPTH_TEST:case i.DEPTH_WRITEMASK:case i.DITHER:case i.POLYGON_OFFSET_FILL:case i.SAMPLE_ALPHA_TO_COVERAGE:case i.SAMPLE_COVERAGE:case i.SAMPLE_COVERAGE_INVERT:case i.SCISSOR_TEST:case i.STENCIL_TEST:return this.gl.glGetParameterBool(e,1);case i.BLEND_COLOR:case i.COLOR_CLEAR_VALUE:return this.gl.glGetParameterFloat(e,4);case i.SCISSOR_BOX:case i.VIEWPORT:return this.gl.glGetParameterInt(e,4);case i.COLOR_WRITEMASK:return this.gl.glGetParameterBool(e,4);case i.POLYGON_OFFSET_FACTOR:case i.POLYGON_OFFSET_UNITS:case i.SAMPLE_COVERAGE_VALUE:return this.gl.glGetParameterFloat(e,1);case i.SHADER_BINARY_FORMATS:var t=this.gl.glGetParameterInt(i.NUM_SHADER_BINARY_FORMATS,1);return this.gl.glGetParameterInt(e,t);case i.COMPRESSED_TEXTURE_FORMATS:t=this.gl.glGetParameterInt(i.NUM_COMPRESSED_TEXTURE_FORMATS,1);return this.gl.glGetParameterInt(e,t)}},e.prototype.getUniform=function(e,t){return this.gl.glGetUniform(e.programId,t.uniformLocationId)},e.prototype.getUniformLocation=function(e,t){return new u.default(this.gl.glGetUniformLocation(e.programId,t))},e.prototype.uniform1f=function(e,t){this.gl.glUniform1f(e.uniformLocationId,t)},e.prototype.uniform2f=function(e,t,n){this.gl.glUniform2f(e.uniformLocationId,t,n)},e.prototype.uniform3f=function(e,t,n,i){this.gl.glUniform3f(e.uniformLocationId,t,n,i)},e.prototype.uniform4f=function(e,t,n,i,r){this.gl.glUniform4f(e.uniformLocationId,t,n,i,r)},e.prototype.uniform1i=function(e,t){this.gl.glUniform1i(e.uniformLocationId,t)},e.prototype.uniform2i=function(e,t,n){this.gl.glUniform2i(e.uniformLocationId,t,n)},e.prototype.uniform3i=function(e,t,n,i){this.gl.glUniform3i(e.uniformLocationId,t,n,i)},e.prototype.uniform4i=function(e,t,n,i,r){this.gl.glUniform4i(e.uniformLocationId,t,n,i,r)},e.prototype.uniform1fv=function(e,t){this.gl.glUniform1fv(e.uniformLocationId,f(t))},e.prototype.uniform2fv=function(e,t){this.gl.glUniform2fv(e.uniformLocationId,f(t))},e.prototype.uniform3fv=function(e,t){this.gl.glUniform3fv(e.uniformLocationId,f(t))},e.prototype.uniform4fv=function(e,t){this.gl.glUniform4fv(e.uniformLocationId,f(t))},e.prototype.uniform1iv=function(e,t){this.gl.glUniform1iv(e.uniformLocationId,p(t))},e.prototype.uniform2iv=function(e,t){this.gl.glUniform2iv(e.uniformLocationId,p(t))},e.prototype.uniform3iv=function(e,t){this.gl.glUniform3iv(e.uniformLocationId,p(t))},e.prototype.uniform4iv=function(e,t){this.gl.glUniform4iv(e.uniformLocationId,p(t))},e.prototype.uniformMatrix2fv=function(e,t,n){this.gl.glUniformMatrix2fv(e.uniformLocationId,t,f(n))},e.prototype.uniformMatrix3fv=function(e,t,n){this.gl.glUniformMatrix3fv(e.uniformLocationId,t,f(n))},e.prototype.uniformMatrix4fv=function(e,t,n){this.gl.glUniformMatrix4fv(e.uniformLocationId,t,f(n))},e.prototype.sampleCoverage=function(e,t){this.gl.glSampleCoverage(e,t)},e.prototype.scissor=function(e,t,n,i){this.gl.glScissor(e,t,n,i)},e.prototype.stencilFunc=function(e,t,n){this.gl.glStencilFunc(e,t,n)},e.prototype.stencilFuncSeparate=function(e,t,n,i){this.gl.glStencilFuncSeparate(e,t,n,i)},e.prototype.stencilMask=function(e){this.gl.glStencilMask(e)},e.prototype.stencilMaskSeparate=function(e,t){this.gl.glStencilMaskSeparate(e,t)},e.prototype.stencilOp=function(e,t,n){this.gl.glStencilOp(e,t,n)},e.prototype.stencilOpSeparate=function(e,t,n,i){this.gl.glStencilOpSeparate(e,t,n,i)},e.prototype.vertexAttrib1f=function(e,t){this.gl.glVertexAttrib1f(e,t)},e.prototype.vertexAttrib2f=function(e,t,n){this.gl.glVertexAttrib2f(e,t,n)},e.prototype.vertexAttrib3f=function(e,t,n,i){this.gl.glVertexAttrib3f(e,t,n,i)},e.prototype.vertexAttrib4f=function(e,t,n,i,r){this.gl.glVertexAttrib4f(e,t,n,i,r)},e.prototype.vertexAttrib1fv=function(e,t){this.gl.glVertexAttrib1fv(e,f(t))},e.prototype.vertexAttrib2fv=function(e,t){this.gl.glVertexAttrib2fv(e,f(t))},e.prototype.vertexAttrib3fv=function(e,t){this.gl.glVertexAttrib3fv(e,f(t))},e.prototype.vertexAttrib4fv=function(e,t){this.gl.glVertexAttrib4fv(e,f(t))},e.prototype.vertexAttribPointer=function(e,t,n,i,r,a){this.gl.glVertexAttribPointer(e,t,n,i,r,a)},e.prototype.getVertexAttrib=function(e,t){return this.gl.glGetVertexAttrib(e,t)},e.prototype.flush=function(){this.gl.glFlush()},e.prototype.framebufferRenderbuffer=function(e,t,n,i){this.gl.glFramebufferRenderbuffer(e,t,n,i.renderbufferId)},e.prototype.frontFace=function(e){this.gl.glFrontFace(e)},e.prototype.getError=function(){return this.gl.glGetError()},e.prototype.getVertexAttribOffset=function(e,t){this.gl.glGetVertexAttribOffset(e,t)},e.prototype.hint=function(e,t){this.gl.glHint(e,t)},e.prototype.isEnabled=function(e){return this.gl.glIsEnabled(e)},e.prototype.lineWidth=function(e){this.gl.glLineWidth(e)},e.prototype.pixelStorei=function(e,t){this.gl.glPixelStorei(e,t)},e.prototype.polygonOffset=function(e,t){this.gl.glPolygonOffset(e,t)},e.prototype.readPixels=function(e,t,n,i,r,a,o){},e.prototype.renderbufferStorage=function(e,t,n,i){this.gl.glRenderbufferStorage(e,t,n,i)},e.prototype.colorMask=function(e,t,n,i){this.gl.glColorMask(e,t,n,i)},e.prototype.cullFace=function(e){this.gl.glCullFace(e)},e.prototype.depthFunc=function(e){this.gl.glDepthFunc(e)},e.prototype.depthMask=function(e){this.gl.glDepthMask(e)},e.prototype.depthRange=function(e,t){this.gl.glDepthRange(e,t)},e.prototype.disable=function(e){this.gl.glDisable(e)},e.prototype.disableVertexAttribArray=function(e){this.gl.glDisableVertexAttribArray(e)},e.prototype.drawArrays=function(e,t,n){this.gl.glDrawArrays(e,t,n),n>0&&this.checkFirstFrames()},e.prototype.checkFirstFrames=function(){0==this.firstFrameUpload&&(BK.MQQ.SsoRequest.send({},"cs.first_frame_drawn.local"),this.firstFrameUpload=!0)},e.prototype.drawElements=function(e,t,n,i){this.gl.glDrawElements(e,t,n,i),t>0&&this.checkFirstFrames()},e.prototype.enable=function(e){this.gl.glEnable(e)},e.prototype.enableVertexAttribArray=function(e){this.gl.glEnableVertexAttribArray(e)},e.prototype.finish=function(){this.gl.glFinish()},e.prototype.blendColor=function(e,t,n,i){return this.gl.glBlendColor(e,t,n,i)},e.prototype.blendEquation=function(e){return e in[this.FUNC_ADD,this.FUNC_SUBTRACT,this.FUNC_REVERSE_SUBTRACT]?this.gl.glBlendEquation(e):this.INVALID_ENUM},e.prototype.blendEquationSeparate=function(e,t){return this.gl.glBlendEquationSeparate(e,t)},e.prototype.blendFunc=function(e,t){this.gl.glBlendFunc(e,t)},e.prototype.blendFuncSeparate=function(e,t,n,i){this.gl.glBlendFuncSeparate(e,t,n,i)},e.prototype.bufferData=function(e,t,n){this.gl.glBufferData(e,t,n)},e.prototype.bufferSubData=function(e,t,n){this.gl.glBufferSubData(e,t,n)},e.prototype.checkFramebufferStatus=function(e){return this.gl.glCheckFramebufferStatus(e)},e.prototype.clear=function(e){this.gl.glClear(e)},e.prototype.clearColor=function(e,t,n,i){this.gl.glClearColor(e,t,n,i)},e.prototype.clearDepth=function(e){this.gl.glClearDepth(e)},e.prototype.clearStencil=function(e){this.gl.glClearStencil(e)},e.prototype.glCommit=function(){this.gl.commit()},e.prototype.getExtension=function(e){if(this.gl.glGetExtention){for(var t=0;t<this.extensions.length;t++)if(this.extensions[t]===e)return{};for(t=0;t<this.no_extensions.length;t++)if(this.no_extensions[t]===e)return;return this.gl.glGetExtention(e)?(this.extensions.push(e),{}):void this.no_extensions.push(e)}},e.prototype.getSupportedExtensions=function(){return[]},e.prototype.getContextAttributes=function(){return{alpha:!0,antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"default",premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!0}},e.prototype.isContextLost=function(){return!1},e.prototype.flushCommand=function(){this.next_index>0&&(this.gl.flushCommand(this.next_index,this.buffer_data),this.next_index=0)},e.prototype.OpenOptMode=function(){this.flushCommand&&h.isSupportArrayBuffer},e}();t.WebGLRenderingContext=d},"./src/webgl/WebGLShader.ts":
/*!**********************************!*\
          !*** ./src/webgl/WebGLShader.ts ***!
          \**********************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._shaderid=e}return Object.defineProperty(e.prototype,"shaderId",{get:function(){return this._shaderid},set:function(e){this._shaderid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLTexture.ts":
/*!***********************************!*\
          !*** ./src/webgl/WebGLTexture.ts ***!
          \***********************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=0),this._textureid=e}return Object.defineProperty(e.prototype,"textureId",{get:function(){return this._textureid},set:function(e){this._textureid=e},enumerable:!0,configurable:!0}),e}();t.default=i},"./src/webgl/WebGLUniformLocation.ts":
/*!*******************************************!*\
          !*** ./src/webgl/WebGLUniformLocation.ts ***!
          \*******************************************/
/*! no static exports found */function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._uniformLocationId=e}return Object.defineProperty(e.prototype,"uniformLocationId",{get:function(){return this._uniformLocationId},set:function(e){this._uniformLocationId=e},enumerable:!0,configurable:!0}),e}();t.default=i}})},function(e,t,n){"use strict";function i(e,t){for(var n={};!t.eof();){var i=e[t.getTag()];i?n[i.name]=i.read.call(t):t.skipField()}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.readObjectArray=function(e){return function(){this.skipTag();for(var t=this.createSubReader(),n=[];!t.eof();){var r=t.createSubReader(),a=i(e,r);n.push(a)}return n}},t.readObject=function(e){return function(){this.skipTag();var t=this.createSubReader();return i(e,t)}},t.loadObject=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2);t.PBS_MATERIAL_PROP_MAP={Bump:"bumpMap",DisplacementColor:"displacementMap",Emissive:"emissiveMap",EmissiveColor:"emissiveMap",NormalMap:"normalMap",Metallic:"metalnessMap",Roughness:"roughnessMap",AmbientOcclusion:"aoMap",ReflectionColor:"envMap",Albedo:"map",DiffuseColor:"map",AmbientColor:"map",ShininessExponent:"map",SpecularFactor:"map",VectorDisplacementColor:"map",bumpMap:"bumpMap",displacementMap:"displacementMap",emissiveMap:"emissiveMap",normalMap:"normalMap",metalnessMap:"metalnessMap",roughnessMap:"roughnessMap",aoMap:"aoMap",envMap:"envMap",map:"map",_MainTex:"map",_BumpMap:"normalMap",_MetallicGlossMap:"metalnessMap",_SpecGlossMap:"roughnessMap",_OcclusionMap:"aoMap"};var a=[i.ZeroFactor,i.OneFactor,i.DstColorFactor,i.SrcColorFactor,i.OneMinusDstColorFactor,i.SrcAlphaFactor,i.OneMinusSrcColorFactor,i.DstAlphaFactor,i.OneMinusSrcAlphaFactor,i.SrcAlphaSaturateFactor,i.OneMinusSrcAlphaFactor];function o(e){return e&&e.length>=6?new i.Color(parseInt(e.substr(0,6),16)):(console.warn("bk.engine parseUnityColor  failed!"),new i.Color(0,0,0))}function s(e){switch(e){case"Standard":return 1;case"Custom/Face":case"Custom/Eyelash":case"Custom/Eyebrow":case"Standard (Specular setup)":case"Custom/CustomStandard(Specular)":return 2;case"Autodesk Interactive":default:return 0}}function l(e,t,n){n.hasETC1Alpha&&(e[t+"_etc_alpha"]=r.cm_texture_loader.load(n.src+"_etc1_alpha"),e.needsUpdate=!0)}t.parseUnityPBSParameters=function(e){var t={metalness:0,roughness:1,alphaTest:.5,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:.1,side:i.FrontSide,setup_type:0,smoothnessTextureChannel:0,smoothnessScale:1},n={_ALPHAPREMULTIPLY_ON:"premultipliedAlpha",_Metallic:"metalness",_Glossiness:"roughness",_GlossMapScale:"smoothnessScale",_SmoothnessTextureChannel:"smoothnessTextureChannel"};if(e.colBase&&(t.color=new i.Color(1,1,1)),void 0!==e._Cull){var r=[i.DoubleSide,i.BackSide,i.FrontSide];t.side=r[e._Cull]}for(var l in void 0!==e._SpecColor&&(t.specular=o(e._SpecColor)),"number"==typeof e._ZWrite&&(t.depthWrite=1===e._ZWrite),n)if(n.hasOwnProperty(l)){var c=n[l];void 0!==e[l]&&(t[c]=e[l])}switch(e._Mode){case 2:t.transparent=!0}if(t.setup_type=s(e.type),"boolean"==typeof e._ALPHABLEND_ON&&e._ALPHABLEND_ON&&e._SrcBlend&&e._DstBlend){t.blending=i.CustomBlending;var u=e._SrcBlend,h=e._DstBlend;u>=0&&u<a.length?t.blendSrc=Number(a[u]):console.error("bk.engine srcBlend error : "+u),h>=0&&h<a.length?t.blendDst=Number(a[h]):console.error("bk.engine dstBlend error : "+h)}return e._ALPHATEST_ON&&e._Cutoff&&(t.alphaTest=e._Cutoff),t},t.parseUnityColor=o,t.parsePBSType=s,t.parseUnityPBSMaterialTextures=function(e,n,a,o){var s=!1;return n&&n.length>0&&n.forEach(function(n){var r=n.prop,c=n.names,u=t.PBS_MATERIAL_PROP_MAP[r];if(u){"roughnessMap"===u&&2==e.setup_type&&(u="specularMap");var h=a.get(c[0]);if(h){".etc"===h.RelativeFilename.slice(h.RelativeFilename.length-4)&&(s=!0);var p=o.get(h.Name);!function(e,t,n){if(e[t]=n,n.image)l(e,t,n.image);else{var i=function(){n.removeEventListener("loaded",i),l(e,t,n.image)};n.addEventListener("loaded",i)}}(e,u,p),"envMap"===u&&(e.envMap.mapping=i.EquirectangularReflectionMapping)}}else{if("MeshUnityPBSMaterial"!==e.type)return;console.warn("unsupported material prop: "+r+".")}}),e.normalMap||(e.normalMap=r.cm_texture_loader.getDefaultNormalMap()),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6);window.innerWidth=i.innerWidth,window.innerHeight=i.innerHeight;var r=n(14);window.setTimeout=r.setTimeout,window.clearTimeout=r.clearTimeout,window.setInterval=r.setInterval,window.cancelAnimationFrame=r.cancelAnimationFrame,window.requestAnimationFrame=r.requestAnimationFrame,window.setPreferredFramesPerSecond=r.setPreferredFramesPerSecond,window.clearInterval=r.clearInterval;var a=n(49);a.default._immediateFn=function(e){return e()},window.Promise=a.default;var o=n(15);o.document.location=window.location,window.document=o.document;var s=n(4),l=n(9);window.HTMLElement=s.default,window.HTMLCanvasElement=l.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={timers:{},intervals:{},_fpsinterval:0},r=0;BK.Director.ticker.add(function(e,t){Object.keys(i.timers).map(function(t){var n=i.timers[t];n&&n.b&&n.b+n.t<=e?(n.f(e),delete i.timers[t]):n&&void 0===n.b&&n.a+n.t<=e&&(n.f(e),i.timers[t]&&(i.timers[t].a+=n.t))})});function a(e,t){t||(t=0);var n=++r;return i.timers[n]={b:Date.now(),t:t,f:e},n}function o(e){delete i.timers[e]}t.setTimeout=a,t.clearTimeout=o,t.requestAnimationFrame=function(e){var t=(new Date).getTime(),n=i._fpsinterval,r=a(e,n);return t+n,r},t.setPreferredFramesPerSecond=function(e){i._fpsinterval=1-1*e/60},t.cancelAnimationFrame=function(e){o(e)},t.setInterval=function(e,t){var n=++r;return i.timers[n]={t:t,f:e,a:Date.now()},n},t.clearInterval=function(e){e&&i.timers[e]&&delete i.timers[e]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(9),a=n(19),o=n(20),s={};t.document={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentElement:null,documentElement:new a.default,head:new i.default("head"),body:new o.default,createElement:function(e){return"canvas"===(e=e.toLowerCase())?new r.default:new i.default(e)},createElementNS:function(e,t){return this.createElement(t)},addEventListener:function(e,t){s[e]||(s[e]=[]),s[e].push(t)},removeEventListener:function(e,t){var n=s[e];if(n){var i=n.indexOf(t);i>=0&&n.splice(i,1)}},dispatchEvent:function(e){var t=e.type,n=s[t];if(n)for(var i=0;i<n.length;i++)n[i](e);e.target&&"function"==typeof e.target["on"+t]&&e.target["on"+t](e)}}},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.children=[],t}return r(t,e),t.prototype.setAttribute=function(e,t){this[e]=t},t.prototype.getAttribute=function(e){return this[e]},t.prototype.setAttributeNS=function(e,t){this[e]=t},t.prototype.getAttributeNS=function(e){return this[e]},t}(n(17).Node);t.Element=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.childNodes=[],t}return r(t,e),t.prototype.appendChild=function(e){this.childNodes.push(e)},t.prototype.removeChild=function(e){var t=this.childNodes.indexOf(e);return-1!==t?this.childNodes.splice(t,1):null},t}(n(18).EventTarget);t.Node=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=new WeakMap,r=function(){function e(){}return e.prototype.addEventListener=function(e,t){var n=i.get(this);n||(n={},i.set(this,n)),n[e]||(n[e]=[]),n[e].push(t)},e.prototype.removeEventListener=function(e,t){var n=i.get(this)[e];if(n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}},e.prototype.dispatchEvent=function(e){var t=this;i.get(this)[e.type].forEach(function(n){n.call(t,e)})},e}();t.EventTarget=r},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return e.call(this,"html",0)||this}return r(t,e),t}(n(4).default);t.default=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return e.call(this,"body",0)||this}return r(t,e),t}(n(4).default);t.default=a},function(e,t,n){(function(e){var i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++)n[t[i]]=Object.getOwnPropertyDescriptor(e,t[i]);return n},r=/%[sdj%]/g;t.format=function(e){if(!v(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var i=arguments,a=i.length,o=String(e).replace(r,function(e){if("%%"===e)return"%";if(n>=a)return e;switch(e){case"%s":return String(i[n++]);case"%d":return Number(i[n++]);case"%j":try{return JSON.stringify(i[n++])}catch(e){return"[Circular]"}default:return e}}),l=i[n];n<a;l=i[++n])m(l)||!x(l)?o+=" "+l:o+=" "+s(l);return o},t.deprecate=function(n,i){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(e.throwDeprecation)throw new Error(i);e.traceDeprecation?console.trace(i):console.error(i),r=!0}return n.apply(this,arguments)}};var a,o={};function s(e,n){var i={seen:[],stylize:c};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),d(n)?i.showHidden=n:n&&t._extend(i,n),_(i.showHidden)&&(i.showHidden=!1),_(i.depth)&&(i.depth=2),_(i.colors)&&(i.colors=!1),_(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=l),u(i,e,i.depth)}function l(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function c(e,t){return e}function u(e,n,i){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(i,e);return v(r)||(r=u(e,r,i)),r}var a=function(e,t){if(_(t))return e.stylize("undefined","undefined");if(v(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(d(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),M(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(n);if(0===o.length){if(S(n)){var l=n.name?": "+n.name:"";return e.stylize("[Function"+l+"]","special")}if(y(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(M(n))return h(n)}var c,x="",w=!1,E=["{","}"];(f(n)&&(w=!0,E=["[","]"]),S(n))&&(x=" [Function"+(n.name?": "+n.name:"")+"]");return y(n)&&(x=" "+RegExp.prototype.toString.call(n)),b(n)&&(x=" "+Date.prototype.toUTCString.call(n)),M(n)&&(x=" "+h(n)),0!==o.length||w&&0!=n.length?i<0?y(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=w?function(e,t,n,i,r){for(var a=[],o=0,s=t.length;o<s;++o)A(t,String(o))?a.push(p(e,t,n,i,String(o),!0)):a.push("");return r.forEach(function(r){r.match(/^\d+$/)||a.push(p(e,t,n,i,r,!0))}),a}(e,n,i,s,o):o.map(function(t){return p(e,n,i,s,t,w)}),e.seen.pop(),function(e,t,n){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,x,E)):E[0]+x+E[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,i,r,a){var o,s,l;if((l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),A(i,r)||(o="["+r+"]"),s||(e.seen.indexOf(l.value)<0?(s=m(n)?u(e,l.value,null):u(e,l.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),_(o)){if(a&&r.match(/^\d+$/))return s;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function f(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function v(e){return"string"==typeof e}function _(e){return void 0===e}function y(e){return x(e)&&"[object RegExp]"===w(e)}function x(e){return"object"==typeof e&&null!==e}function b(e){return x(e)&&"[object Date]"===w(e)}function M(e){return x(e)&&("[object Error]"===w(e)||e instanceof Error)}function S(e){return"function"==typeof e}function w(e){return Object.prototype.toString.call(e)}function E(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(_(a)&&(a=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!o[n])if(new RegExp("\\b"+n+"\\b","i").test(a)){var i=e.pid;o[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,i,e)}}else o[n]=function(){};return o[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=d,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=v,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=_,t.isRegExp=y,t.isObject=x,t.isDate=b,t.isError=M,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(23);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[E(e.getHours()),E(e.getMinutes()),E(e.getSeconds())].join(":"),[e.getDate(),T[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(24),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),i=n.length;i--;)e[n[i]]=t[n[i]];return e};var L="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function C(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(L&&e[L]){var t;if("function"!=typeof(t=e[L]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,L,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,i=new Promise(function(e,i){t=e,n=i}),r=[],a=0;a<arguments.length;a++)r.push(arguments[a]);r.push(function(e,i){e?n(e):t(i)});try{e.apply(this,r)}catch(e){n(e)}return i}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),L&&Object.defineProperty(t,L,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=L,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],i=0;i<arguments.length;i++)n.push(arguments[i]);var r=n.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return r.apply(a,arguments)};t.apply(this,n).then(function(t){e.nextTick(o,null,t)},function(t){e.nextTick(C,t,o)})}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,i(t)),n}}).call(this,n(22))},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var l,c=[],u=!1,h=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&f())}function f(){if(!u){var e=s(p);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||u||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=BK},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(0),a=n(27),o=n(28),s=n(29),l=n(34),c=n(35),u=n(1),h=n(3),p=n(36),f=n(43),d=n(44),m=n(45),g=n(46);function v(e,t){return e?Promise.resolve(e):t?m.loadBuffer(t):Promise.reject(new Error("invalid arguments: "+arguments+"."))}Math.PI;var _=180/Math.PI,y={top_q:"skin",top:"skin",top_app:"skin",bottom_q:"skin",bottom:"skin",bottom_app:"skin",foot:"skin",hair:"hair",eyebrow_q:"eyebrow",eyebrow:"eyebrow",eyebrow_app:"eyebrow",eyelash_q:"eyelash",eyelash:"eyelash",eyelash_app:"eyelash"},x=function(){function e(e){this.name="",this.group=new r.Group,this.midGroup=new r.Group,this.emitter=new c.EventEmitter,this.cmSkeleton=new f.CmSkeleton(this.midGroup,this.emitter),this.cmGroup=new a.CmGroup(this.midGroup,this.cmSkeleton,this.emitter),this.cmAnim=new l.CmAnim(this.group,this.emitter),this.localPosition=new i.Vector3,this.isMirror=!1,this.hsvs=void 0,this.makeup=new p.CmMakeUp(this.emitter),this.weightsId=-1,this.weights=void 0,this.skinPath=void 0,this.group.add(this.midGroup),this.initCmMakkeup()}return e.prototype.getSkeleton=function(){return this.cmSkeleton},Object.defineProperty(e.prototype,"position",{get:function(){return this.localPosition},set:function(e){this.group.position.set(e.x||0,e.y||0,e.z||0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aioposition",{get:function(){return this.group.position.x},set:function(e){var t=new i.Vector3;-1===e?t.set(-50,0,0):1===e&&t.set(50,0,0),this.group.position.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.group.scale},set:function(e){var t=e.x,n=void 0===t?0:t,i=e.y,r=void 0===i?0:i,a=e.z,o=void 0===a?0:a;this.group.scale.set(n,r,o)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){var e=this.group.rotation;return{x:e.x*_,y:e.y*_,z:e.z*_,order:e.order}},set:function(e){e.x,e.y,e.z,e.order},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this.group.visible},set:function(e){this.group.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return!this.visible},set:function(e){this.visible=!e},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.cmAnim.update(e),this.nameplate&&this.nameplate.updateNamePlatePosition()},e.prototype.load=function(e){var t=this,n=e.path,i=e.buffer,r=e.skeleton,a=e.skinPath,s=e.tag;s=s||n,this.loadSkinMap(a),r?this.cmSkeleton.setupSkeleton(r,s):v(i,n).then(function(e){var t=o.loadHeader(e),n=t.headerSize,i=t.bodySize,r=new Uint8Array(e,n,i);return m.loadSkeleton(r)}).then(function(e){t.cmSkeleton.setupSkeleton(e,s)}).catch(function(e){console.error("load "+s+" error.",e.message,e.stack)})},e.prototype.loadSkinMap=function(e){e&&(this.skinPath=e)},e.prototype.loadAccessory=function(e){var t=e.acc;t&&t.name&&t.meshes&&this.cmGroup.addAccessory(t)},e.prototype.setAccessory=function(e){var t=this,n=e.path,i=e.prefix,r=e.buffer,a=e.tag;e.makeupInfo;i&&i.length||(i=n&&n.substring(0,n.lastIndexOf("/")+1)),a||(a=n),v(r,n).then(function(e){var n=o.loadHeader(e),r=n.bodyType,l=n.headerSize,c=n.bodySize,h=new Uint8Array(e,l,c);r!==o.BodyType.Slot?r!=o.BodyType.Makeup?m.loadAccessory(h,t.weightsId).then(function(e){var n=s.loadAccessory(e.accessory,i,t.weights,t.skinPath);t._insetToModel(n,a,i)}):m.loadMakeup(h).then(function(e){e&&t.emitter.emit(u.CmModelEvent.MakeupAccessoryAdd,{makeupAccessory:e,prefix:i,tag:a})}):m.loadAccessory(h,t.weightsId).then(function(e){m.loadSkeleton(h).then(function(n){var r=s.loadAccessory(e.accessory,i,t.weights,t.skinPath);r.nodes=n,r.db=e.db,r.collider=e.collider,t.cmGroup.addAccessory(r,a)})})})},e.prototype._insetToModel=function(e,t,n){this.updateCurrentAccessoryHSV(e),this.cmGroup.addAccessory(e,t)},e.prototype.removeAccessory=function(e){var t=e.name,n=e.tag;t?this.cmGroup.removeAccessory(t):n&&this.cmGroup.removeAccessoryByTag(n),this.emitter.emit(u.CmModelEvent.MakeupAccessoryRemove,{tag:n,name:t})},e.prototype.loadAccessoryAnimation=function(e){var t=e.arrayBuffer,n=e.animName;if(this.cmAnim.containAnimation(n))console.log("CmAnim: "+n+" already loaded.");else{var i=new l.Future;this.cmAnim.setAnimFuture(n,i),this.loadAnimation(i,n,t)}},e.prototype.setAccessoryAnimation=function(e){var t=this,n=e.path,i=e.animName;if(this.cmAnim.containAnimation(i))console.log("CmAnim: "+i+" already loaded.");else{var r=new l.Future;this.cmAnim.setAnimFuture(i,r),m.loadBuffer(n).then(function(e){var a=n.substring(0,n.lastIndexOf("/")+1);t.loadAnimation(r,i,e,a)})}},e.prototype.loadAnimation=function(e,t,n,i){var r=this,a=o.loadHeader(n),l=new Uint8Array(n,a.headerSize,a.bodySize);a.bodyType===o.BodyType.Animation?m.loadAnimation(l).then(function(t){var n=d.createAnim(t);n&&(r.emitter.emit(u.CmModelEvent.AnimationLoad,n),e.resolve(n))}):a.bodyType===o.BodyType.Trick?m.loadAnimation(l).then(function(t){m.loadAccessory(l,r.weightsId).then(function(n){m.loadSkeleton(l).then(function(a){var o=s.loadAccessory(n.accessory,i,r.weights,r.skinPath);o.nodes=a;var l=d.createAnim(t,r.cmGroup,o);l&&(r.emitter.emit(u.CmModelEvent.AnimationLoad,l),e.resolve(l))})})}):console.error("[error] fail to parse animation: "+t+".")},e.prototype.setAnimation=function(e){var t=e.trackId,n=e.animName,i=e.loop,r=e.noCam,a=e.callType;!0===i?i=1/0:!1===i&&(i=0),this.cmAnim.setAnimation(n,t,i,r,a)},e.prototype.renderAtSec=function(e){e.animName,e.second;console.error("CmModel: renderAtSec is unsupported.")},e.prototype.pauseAnimation=function(e){e.paused;console.error("CmModel: pauseAnimation is unsupported.")},e.prototype.containAnimation=function(e){var t=e.animName;return this.cmAnim.containAnimation(t)},e.prototype.removeAccessoryAnimation=function(e){var t=e.animName;this.cmAnim.removeAnimation(t)},e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.pop=function(e){this.emitter.pop(e)},e.prototype.setMirror=function(){this.midGroup.applyMatrix((new i.Matrix4).makeScale(-1,1,1)),this.isMirror=!this.isMirror,this.cmGroup.setMirror(this.isMirror)},e.prototype.dispose=function(){this.removeModelWeights(),h.removeFromScene(this),this.makeup.dispose(),this.cmAnim.dispose(),this.cmGroup.dispose(),this.hideNamePlate()},e.prototype.convertToScreen=function(e){var t=new i.Vector3;t.copy(e);var n=t.project(h.camera);return n.x=(.5+n.x/2)*BK.Director.screenPixelSize.width,n.y=(.5+n.y/2)*BK.Director.screenPixelSize.height,new i.Vector3(n.x,n.y,n.z)},e.prototype.convertToThreeCoordinate=function(e){var t=new i.Vector3(e.x,e.y,e.z);return t.x=e.x/BK.Director.screenPixelSize.width*2-1,t.y=e.y/BK.Director.screenPixelSize.height*2-1,t.unproject(h.camera),t},e.prototype.getBoundingBox=function(){return{x:0,y:0,w:0,h:0}},e.prototype.setPaused=function(e){},e.prototype.updatePosition=function(){this.position=this.localPosition,this.emitter.emit(u.CmModelEvent.PositionChange)},e.prototype.getMeshDeltaHSV=function(e){if(this.hsvs&&y[e]){var t=y[e];return this.hsvs[t]?this.hsvs[t]:void 0}},e.prototype.updateLoadedAccessoryHSV=function(){var e=this;this.hsvs&&this.cmGroup.traverseAccessory(function(t,n,i){if(t.meshes.length>0)for(var a=0;a<t.meshes.length;a++){var o=t.meshes[a],s=e.getMeshDeltaHSV(o.name),l=o.material;s&&l.isUnityPBSSkinMaterial&&(l.setDeltaHSV(new r.Vector3(s.H/p.HSVScales.x,s.S/p.HSVScales.y,s.V/p.HSVScales.z)),l.setUseDeltaHSV(!0))}})},e.prototype.updateCurrentAccessoryHSV=function(e){if(this.hsvs&&e&&e.meshes.length>0)for(var t=0;t<e.meshes.length;t++){var n=e.meshes[t],i=this.getMeshDeltaHSV(n.name),a=n.material;i&&a.isUnityPBSSkinMaterial&&(console.log(n.name+" meshHSV:"+JSON.stringify(i)),a.setDeltaHSV(new r.Vector3(i.H/p.HSVScales.x,i.S/p.HSVScales.y,i.V/p.HSVScales.z)),a.setUseDeltaHSV(!0))}},e.prototype.initCmMakkeup=function(){var e=this;this.emitter.on(p.CmMakeUpEvent.MakeUpFinish,function(t){e.cmGroup.setAccessoryTexture("face",t)?console.log("bk.engine makeup <CmModel> rtt set face success."):console.log("bk.engine makeup <CmModel> rtt set face failed.")}),this.emitter.on(u.CmModelEvent.AccessoryAdd,function(t){if(/face/i.test(t.name))for(var n=0;n<t.meshes.length;n++){var i=t.meshes[n];if("face"===i.name)return void(i.material&&e.emitter.emit(u.CmModelEvent.FaceAdd,{map:i.material.map,mapAlpha:i.material.map_etc_alpha,mask:i.material.maskMap}))}}),this.emitter.on(u.CmModelEvent.AccessoryRemove,function(t){if(/face/i.test(t.name))for(var n=0;n<t.meshes.length;n++){var i=t.meshes[n];if("face"===i.name)return void(i.material&&e.emitter.emit(u.CmModelEvent.FaceRemove,{map:i.material.map}))}})},e.prototype.showNamePlate=function(e){this.nameplate||(this.nameplate=new g.NamePanel(this)),this.nameplate.show(e)},e.prototype.hideNamePlate=function(){this.nameplate&&this.nameplate.hide()},e.prototype.setModelWeights=function(e){if(e){this.hsvs=e.hsvs||e.deltaHSV,this.hsvs&&(this.updateLoadedAccessoryHSV(),this.emitter.emit(u.CmModelEvent.FaceDataLoad,this.hsvs));var t=e.blendshape;t?(this.weightsId=BK.TFLoader.setModelWeights(this.weightsId,t),this.weights=void 0):(this.weightsId=-1,this.weights=void 0),e.skeleton&&this.cmGroup.setFaceBoneTransform(e.skeleton)}},e.prototype.removeModelWeights=function(){BK.TFLoader.removeModelWeights(this.weightsId),this.hsvs=void 0,this.weightsId=-1,this.weights=void 0},e}();t.CmModel=x},function(e,t,n){"use strict";var i=this&&this.__values||function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o};Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(1),s=function(){function e(e,t,n){this.group=e,this.cmSkeleton=t,this.emitter=n,this.accessoryInfoMap=new Map,this.meshAccessoryMap=new Map,this.mirrorMap=new Map,this.isSkeletonSetup=!1,n.once(o.CmModelEvent.SkeletonLoad,this.onSkeletonLoad.bind(this))}return e.prototype.onSkeletonLoad=function(){var e=this;this.isSkeletonSetup=!0,this.accessoryInfoMap.forEach(function(t){try{e.mountAccessory(t)}catch(e){throw e.tag=t.tag,e}}),this.faceBoneTransformData&&this.refreshFaceBoneTransform(this.faceBoneTransformData)},e.prototype.addAccessory=function(e,t){var n=this;t&&(e.tag=t);var i=e.name;this.accessoryInfoMap.has(i)&&this.removeAccessory(i);var r={origin:[],mirror:[]},a=[];e.meshes.forEach(function(e){var t=n.meshAccessoryMap.get(e.name);t&&n.removeAccessory(t),e.name.startsWith("mirror_")&&(r.mirror.push(e),a.push(e.name.substring(7)))}),e.meshes.forEach(function(e){for(var t=0;t<a.length;++t)if(e.name===a[t]){r.origin.push(e);break}}),this.mirrorMap.set(i,r),this.accessoryInfoMap.set(i,e),this.isSkeletonSetup&&this.mountAccessory(e),this.emitter.emit(o.CmModelEvent.AccessoryAdd,e)},e.prototype.mountAccessory=function(e){var t=this,n=e.nodes,i=e.meshes,r=e.db,a=e.collider;if(n&&this.cmSkeleton.mountBones(n),a&&a.forEach(function(e){var n=t.cmSkeleton.getBoneByName(e.boneName);if(!n)throw new Error("CmGroup: collider "+e.boneName+" bone not found.");e.bind(n._native_object3d)}),r){var o=this.cmSkeleton.getBoneByName("Root_M");o&&r.forEach(function(e){var n=t.cmSkeleton.getBoneByName(e.root);n&&(e.bind(o._native_object3d,n._native_object3d),a&&a.forEach(function(t){e.addCollider(t)}))})}i.forEach(function(e){return t.mountMesh(e)})},e.prototype.mountMesh=function(e){var t=this;if(e instanceof a.SkinnedMesh){var n=e.userData.rawBones,i=new Array(n.length),r=new Array(n.length);n.forEach(function(n,o){var s=n.srcNodes[0],l=t.cmSkeleton.getBoneByName(s);if(!l)throw console.error("CmGroup: mesh "+e.name+"'s bone "+s+" not found."),new Error("CmGroup: mesh "+e.name+"'s bone "+s+" not found.");i[o]=l,r[o]=(new a.Matrix4).fromArray(n.transform)});var o=new a.Matrix4;(l=e.userData.matrix)&&o.fromArray(l);var s=new a.Skeleton(i,r);e.bind(s,o)}else{var l;(l=e.userData.matrix)&&(new a.Matrix4).fromArray(l).decompose(e.position,e.quaternion,e.scale)}this.group.add(e)},e.prototype.removeAccessoryByTag=function(e){var t,n;try{for(var a=i(this.accessoryInfoMap.entries()),o=a.next();!o.done;o=a.next()){var s=r(o.value,2),l=s[0];if(e===s[1].tag)return this.removeAccessory(l)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.removeAccessory=function(e){var t=this.accessoryInfoMap.get(e);return t&&(this.accessoryInfoMap.delete(e),this.unmountAccessory(t),this.emitter.emit(o.CmModelEvent.AccessoryRemove,t)),this.mirrorMap.has(e)&&this.mirrorMap.delete(e),t},e.prototype.unmountAccessory=function(e){var t=this,n=e.nodes,i=e.meshes,r=e.db,a=e.collider;n&&n.forEach(function(e){t.cmSkeleton.unmountBones(e.name)}),r&&r.forEach(function(e){a&&a.forEach(function(t){e.removeCollider(t)}),e.unbind()}),a&&a.forEach(function(e){e.unbind()}),i.forEach(function(e){return t.unmountMesh(e)})},e.prototype.unmountMesh=function(t){if((t.parent||this.group).remove(t),t instanceof a.SkinnedMesh){var n=t.skeleton;if(n){var i=n.boneTexture;i&&i.dispose()}}e.disposeMesh(t)},e.disposeMesh=function(e){var t=e.geometry,n=e.material;t.dispose(),Array.isArray(n)?n.forEach(function(e){return e.dispose()}):n.dispose()},e.prototype.dispose=function(){var e=this;this.accessoryInfoMap.forEach(function(t){e.unmountAccessory(t)}),this.accessoryInfoMap.clear()},e.prototype.setMirror=function(e){this.mirrorMap.forEach(function(t){t.origin.forEach(function(t){t.visible=!e}),t.mirror.forEach(function(t){t.visible=e})})},e.prototype.traverseAccessory=function(e){this.accessoryInfoMap.forEach(e)},e.prototype.setAccessoryTexture=function(e,t){var n,a,o,s,l;try{for(var c=i(this.accessoryInfoMap),u=c.next();!u.done;u=c.next()){var h=r(u.value,2);h[0];if(g=h[1])for(var p=0;p<g.meshes.length;p++){(_=g.meshes[p]).name===e&&_.material&&(l=_.material.map)}}}catch(e){n={error:e}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}var f=!1;if(l)try{for(var d=i(this.accessoryInfoMap),m=d.next();!m.done;m=d.next()){var g,v=r(m.value,2);v[0];if(g=v[1])for(p=0;p<g.meshes.length;p++){var _;(_=g.meshes[p]).material&&_.material.map&&_.material.map.uuid==l.uuid&&(_.material.map=t,f=!0)}}}catch(e){o={error:e}}finally{try{m&&!m.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}return f},e.prototype.setFaceBoneTransform=function(e){this.isSkeletonSetup?this.refreshFaceBoneTransform(e):this.faceBoneTransformData=e},e.prototype.refreshFaceBoneTransform=function(e){var t=this;e&&e.forEach(function(e){var n=t.cmSkeleton.getBoneByName(e.name);n&&(e.position&&n.position.set(100*e.position[0],100*e.position[1],100*e.position[2]),e.rotation&&n.quaternion.set(e.rotation[0],e.rotation[1],e.rotation[2],e.rotation[3]),e.scale&&n.scale.set(e.scale[0],e.scale[1],e.scale[2]))})},e}();t.CmGroup=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.Skeleton=1]="Skeleton",e[e.Body=2]="Body",e[e.Accessory=3]="Accessory",e[e.Animation=4]="Animation",e[e.Face=5]="Face",e[e.Pose=6]="Pose",e[e.Makeup=7]="Makeup",e[e.Trick=8]="Trick",e[e.Slot=9]="Slot"}(t.BodyType||(t.BodyType={})),function(e){e[e.Unknown=0]="Unknown",e[e.FBX=1]="FBX",e[e.GLTF=2]="GLTF",e[e.THREE=3]="THREE"}(t.FileType||(t.FileType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Bin=1]="Bin",e[e.Ascii=2]="Ascii"}(t.RawType||(t.RawType={})),t.loadHeader=function(e,t){void 0===t&&(t=!0);var n=new DataView(e),i=0,r=n.getUint16(i,t);if(i+=2,17229!==r)throw new Error("magic not matched.");var a=n.getUint32(i,t);i+=4;var o=n.getUint16(i,t);i+=2;var s=n.getUint32(i,t);i+=4;var l=n.getUint8(i);i+=1;var c=n.getUint8(i),u=n.getUint8(i+1);i+=2;var h=n.getUint32(i,t),p=new Date(1e3*h);return console.log("cm3d.HeaderLoader!resource timestamp: "+p.toLocaleString()),o+s>e.byteLength&&console.error("buffer size exceeded."),{version:a,headerSize:o,bodySize:s,bodyType:l,offset:i,fileType:c,rawType:u}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0),a=n(31),o=n(32);t.loadAccessory=function(e,t,n,s){t=t||"";var l=new Map;s&&l.set("skin_map_png",i.cm_texture_loader.load(s));var c=e.map(function(e){e.texture&&e.texture.forEach(function(e){var n=e.Name,r=t+e.RelativeFilename;l.set(n,i.cm_texture_loader.load(r))});var c=function(e){var t={};if(e){var n=e.skin,i=e.blendShape;n&&n.length&&(t.rawBones=n[0].rawBones),i&&i.length&&(t.rawTargets=i[0].rawTargets)}return t}(e.deformer),u=function(e,t,n){n&&t.forEach(function(e){return e.skinning=!0});var i=1===t.length?t[0]:t;if(n){var a=new r.SkinnedMesh(e,i);if(n.length&&n[0].weights)throw new Error("AccessoryLoader: legacy accessory with old geometry format.");return a.userData.rawBones=n,a}return new r.Mesh(e,i)}(a.parseGeometry2(e.geometry2,c.rawTargets,n),o.parseMaterials(e.material,e.texture||[],l,s),c.rawBones);return u.name=e.model.name,u.userData.matrix=e.model.matrix,u});return{name:c.map(function(e){return e.name}).join("|"),meshes:c,textures:Array.from(l.values())}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5);t.sanitizeNodeName=i.TlvReader.prototype.getString,t.sanitizeNodeNameArray=i.TlvReader.prototype.getStringArray},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),r=n(5),a=n(0),o=r.TlvReader.prototype,s={1:{name:"vertices",read:o.getFloat32Array},2:{name:"uvs",read:o.getFloat32Array},3:{name:"normals",read:o.getFloat32Array},4:{name:"weights",read:o.getFloat32Array},5:{name:"boneIndices",read:o.getInt16Array},6:{name:"indices",read:o.getInt16Array},7:{name:"uvs2",read:o.getFloat32Array}};t.loadGeometry2=function(){return i.readObject(s).call(this)},t.parseGeometry2=function(e,t,n){return function(e){var t=e.vertices,n=e.uvs,i=e.uvs2,r=e.normals,o=e.weights,s=e.boneIndices,l=e.indices,c=new a.BufferGeometry;return c.addAttribute("position",new a.Float32BufferAttribute(t,3)),s&&o&&(c.addAttribute("skinIndex",new a.Uint16BufferAttribute(s,4)),c.addAttribute("skinWeight",new a.Float32BufferAttribute(o,4))),c.addAttribute("uv",new a.Float32BufferAttribute(n,2)),i&&i.length?c.addAttribute("uv2",new a.Float32BufferAttribute(i,2)):c.addAttribute("uv2",new a.Float32BufferAttribute(n,2)),c.addAttribute("normal",new a.Float32BufferAttribute(r,3)),l&&c.setIndex(new a.Uint16BufferAttribute(l,1)),c}(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(33),a=n(12);t.parseMaterials=function(e,t,n,o){var s=new Map;return t.forEach(function(e){s.set(e.Name,e)}),e.map(function(e){var t=function(e,t,n,o){switch(e.type){case"Custom/Face":case"Custom/Eyelash":case"Custom/Eyebrow":var s=r.parseUnityPBSSkinParameters(e),l=new i.MeshUnityPBSSkinMaterial(s),c=a.parseUnityPBSMaterialTextures(l,e.textures,t,n),u=r.parseUnityPBSSkinMaterialTextures(l,e.textures,t,n);return l.sub_type=c||u?"MeshUnityPBSSkinMaterial_etc_gpu_skinning":"MeshUnityPBSSkinMaterial_png_gpu_skinning",l;case"Custom/CustomStandard(Specular)":!function(e,t,n){n&&(e.textures.push({names:["skin_map_png"],prop:"_RealSkinMap"}),t.set("skin_map_png",{BlendMode:1,Cropping:[0,0,0,0],ModelUVScaling:[1,1],ModelUVTranslation:[0,0],Name:"skin_map_png",RelativeFilename:"skin.png",TextureAlphaSource:"",WrapModeUV:[1,1],originSize:[0,0],premultiplyAlpha:1,uvRotation:[0,0],uvRotationPivot:[0,0],uvScalingPivot:[0,0]}))}(e,t,o);var s=r.parseUnityPBSSkinParameters(e),l=new i.MeshUnityPBSSkinMaterial(s),c=a.parseUnityPBSMaterialTextures(l,e.textures,t,n),u=r.parseUnityPBSSkinMaterialTextures(l,e.textures,t,n);return l.sub_type=c||u?"MeshUnityPBSSkinMaterial_etc_gpu_skinning":"MeshUnityPBSSkinMaterial_png_gpu_skinning",l;case"Autodesk Interactive":case"Standard":case"Standard(Specular)":default:var s=a.parseUnityPBSParameters(e),l=new i.MeshUnityPBSMaterial(s),h=a.parseUnityPBSMaterialTextures(l,e.textures,t,n);return l.sub_type=h?"MeshUnityPBSMaterial_etc":"MeshUnityPBSMaterial_png",l}}(e,s,n,o);return t.addEventListener("dispose",function(){for(var e in t){var n=t[e];n instanceof i.Texture&&!n.isNeedHold&&n.dispose()}}),t.name=e.Name,t})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(12),a=n(2);!function(e){e[e.None=0]="None",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.MetallicSmooth=2]="MetallicSmooth"}(i||(i={})),t.parseUnityPBSSkinParameters=function(e){var t=r.parseUnityPBSParameters(e);e.useDeltaHSV&&(t.useDeltaHSV=e.useDeltaHSV),e.deltaHSV&&(t.deltaHSV=e.deltaHSV),e._otherPartWorkflow&&(t.otherPartWorkflow=e._otherPartWorkflow);var n={_useSkinMap:"useSkinMap",_otherPartWorkflow:"otherPartWorkflow",_autodeskGlossiness:"autodeskGlossiness",_autodeskMetallic:"autodeskMetallic",_CustomStandardGlossiness:"customStandardGlossiness",_CustomStandardGlossMapScale:"customStandardGlossMapScale",_CustomStandardMetallic:"customStandardMetallic",_CustomStandardSmoothnessTextureChannel:"customStandardSmoothnessTextureChannel",_CustomSpecularGlossiness:"customSpecularGlossiness",_CustomSpecularGlossMapScale:"customSpecularGlossMapScale",_CustomSpecularSmoothnessTextureChannel:"customSpecularSmoothnessTextureChannel"};for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];void 0!==e[i]&&(t[a]=e[i])}return void 0!==e._CustomSpecularColor&&(t.customSpecularColor=r.parseUnityColor(e._CustomSpecularColor)),t};var o={Mask:"maskMap",maskMap:"maskMap",_skinMap:"maskMap",_RealSkinMap:"skinMap",_autodeskSpecGlossMap:"autodeskSpecGlossMap",_autodeskMetallicGlossMap:"autodeskMetallicGlossMap",_CustomStandardMetallicGlossMap:"customStandardMetallicGlossMap",_CustomSpecularGlossMap:"customSpecularGlossMap"};function s(e,t,n){n.hasETC1Alpha&&(e[t+"_etc_alpha"]=a.cm_texture_loader.load(n.src+"_etc1_alpha"),e.needsUpdate=!0)}t.parseUnityPBSSkinMaterialTextures=function(e,t,n,i){var l=!1;return t&&t.length>0&&t.forEach(function(t){var a=t.prop,c=t.names,u=o[a];if(u){var h=n.get(c[0]);if(h){".etc"===h.RelativeFilename.slice(h.RelativeFilename.length-4)&&(l=!0);var p=i.get(h.Name);!function(e,t,n){if(e[t]=n,n.image)s(e,t,n.image);else{var i=function(){n.removeEventListener("loaded",i),s(e,t,n.image)};n.addEventListener("loaded",i)}}(e,u,p)}}else{if(r.PBS_MATERIAL_PROP_MAP[a])return;console.warn("unsupported PBSskin material prop: "+a+".")}}),e.maskMap||(e.maskMap=a.cm_texture_loader.getDefaultMaskMap()),l}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(1),a=function(){function e(e){this.value=e,this.state=0,this.callback=null,e&&(this.state=1)}return e.prototype.getState=function(){return this.state},e.prototype.getValue=function(){if(this.value)return this.value;throw new Error("Future not ready.")},e.prototype.cancel=function(){0===this.state&&(this.state=2,this.callback=null)},e.prototype.resolve=function(e){0===this.state&&(this.state=1,this.callback&&(this.callback(e),this.callback=null),this.value=e)},e.prototype.then=function(e){1===this.state?e(this.value):0===this.state&&(this.callback=e)},e}();t.Future=a;var o=function(){function e(e,t){this.group=e,this.emitter=t,this.animationInfoMap=new Map,this.pendingPlayAnimation=null,this.playingAnimation=null,this.pendingSetAnimationParam=void 0,t.once(r.CmModelEvent.SkeletonLoad,this.onSkeletonLoad.bind(this))}return e.prototype.update=function(e){this.playingAnimation&&this.playingAnimation.mixer.update(e)},e.prototype.onSkeletonLoad=function(){var e=this.pendingSetAnimationParam;this.pendingSetAnimationParam=null,e&&this.setAnimation.apply(this,Array.from(e))},e.prototype.setAnimation=function(e,t,n,i,r){var a=this;if(void 0===n&&(n=0),null===this.pendingSetAnimationParam){var o=this.animationInfoMap.get(e);if(o)switch(o.getState()){case 1:var s=o.getValue();1!=r&&this.animationInfoMap.delete(e),this.playAnimation(e,t,s,n,i);break;case 0:o.then(function(o){if(1!=r&&a.animationInfoMap.delete(e),a.pendingPlayAnimation){var s=a.pendingPlayAnimation,l=s.name,c=s.trackId;l===e&&c===t&&a.playAnimation(e,t,o,n,i)}}),this.pendingPlayAnimation={name:e,trackId:t}}else console.log("CmAnim: "+e+" not found.")}else this.pendingSetAnimationParam=arguments},e.prototype.playAnimation=function(e,t,n,a,o){var s=this;this.resetPlayingAnimation();var l=new i.AnimationMixer(this.group),c=n.instantiate({mixer:l,loop:a,noCam:o}).play();n.cam&&!o&&(c.cam=!0),l.addEventListener("finished",function(n){c.interceptEvent&&c.interceptEvent(n)||(s.playingAnimation=null,s.emitter.emit(r.CmModelEvent.AnimationComplete,e,t,c))}),this.playingAnimation={name:e,trackId:t,mixer:l,action:c},this.emitter.emit(r.CmModelEvent.AnimationStart,e,t,c)},e.prototype.resetPlayingAnimation=function(){if(this.pendingPlayAnimation){var e=this.pendingPlayAnimation.name;this.pendingPlayAnimation=null,this.removeAnimation(e)}if(this.playingAnimation){var t=this.playingAnimation,n=t.name,i=t.trackId,a=(t.mixer,t.action);this.playingAnimation=null,a.stop(),this.emitter.emit(r.CmModelEvent.AnimationEnd,n,i,a)}},e.prototype.setAnimFuture=function(e,t){this.animationInfoMap.set(e,t)},e.prototype.containAnimation=function(e){return this.animationInfoMap.has(e)},e.prototype.removeAnimation=function(e){var t=this.animationInfoMap.get(e);t&&(t.cancel(),this.animationInfoMap.delete(e),this.pendingPlayAnimation&&this.pendingPlayAnimation.name===e&&(this.pendingPlayAnimation=null)),this.playingAnimation&&this.playingAnimation.name===e&&this.resetPlayingAnimation()},e.prototype.dispose=function(){this.animationInfoMap.forEach(function(e){return e.cancel()}),this.animationInfoMap.clear(),this.resetPlayingAnimation()},e}();t.CmAnim=o},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e,t,n){this.event=e,this.listener=t,this.once=n}}(),o=function(){function e(){this._emits={}}return e.prototype.__emit_get=function(e){return this._emits[e]||(this._emits[e]=new Array),this._emits[e]},e.prototype.__emit_exists=function(e){var t=this.__emit_get(e);return!!(t&&t.length>0)},e.prototype.__emit_put=function(e,t,n){var i=new a(e,t,n);return this.__emit_get(e).push(i),this},e.prototype.__emit_remove=function(e,t){if(1==this.__emit_exists(e)){for(var n=-1,i=this.__emit_get(e),r=i.length-1;r>=0;r--){if(t==i[r].listener){n=r;break}}return n>-1&&i.splice(n,1),!0}return!1},e.prototype.on=function(e,t){return this.__emit_put(e,t,!1),this},e.prototype.once=function(e,t){return this.__emit_put(e,t,!0),this},e.prototype.off=function(e,t){return this.__emit_remove(e,t),this},e.prototype.pop=function(e){var t=this.__emit_get(e);t.length&&t.length>=1&&this.__emit_remove(e,t[t.length-1])},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.__emit_exists(e)){for(var i=[],a=this.__emit_get(e),o=a.length,s=0;s<o;s++){var l=a[s];l.listener.apply(l,r(t)),l.once&&i.push(l)}for(s=0;s<i.length;s++){var c=i[s];this.__emit_remove(e,c.listener)}return!0}return!1},e}();t.EventEmitter=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(0),a=n(1),o=n(2),s=n(37),l=n(38);!function(e){e.MakeUpFinish="makeUpFinish"}(i=t.CmMakeUpEvent||(t.CmMakeUpEvent={}));var c=["freckle","eyeshadow","blusher","eyelid","eyeline","lipstick","tatoo"];t.MakeupTargetMeshName="face",t.HSVScales=new r.Vector3(360,100,100);var u=512,h=512,p=function(){function e(e){var t=this;this.emitter=e,this.pendingList=new Array,this.completeList=new Array,this.isRenderLock=!1,this.hsvData=void 0,this.face=void 0,this.renderTarget=new r.WebGLRenderTarget(u,h),this.isRendering=!1,this.needsUpdate=!1,this.emitter.on(a.CmModelEvent.FaceDataLoad,function(e){console.log("bk.engine   on  faceData load  "),t.onFaceDataLoad(e)}),this.emitter.on(a.CmModelEvent.FaceAdd,function(e){console.log("bk.engine   on  Face load  "),t.onFaceAdd(e)}),this.emitter.on(a.CmModelEvent.FaceRemove,function(e){console.log("bk.engine   on  Face remove "),t.onFaceRemove(e)}),this.emitter.on(a.CmModelEvent.MakeupAccessoryAdd,function(e){var n=e.makeupAccessory.texture[0];if(!n)return console.log("bk.engine unsurpport makeup resource, dress.bin"),void t.emitter.emit(a.CmModelEvent.AccessoryAdd,{tag:e.tag});var i={attachMent:e.makeupAccessory.attachMent,image:e.prefix+n.RelativeFilename,cropping:n.Cropping,originSize:n.originSize,tag:e.tag};console.log("bk.engine   on  makeup load :  "+i.attachMent),t.onMakeupAdd(i)}),this.emitter.on(a.CmModelEvent.MakeupAccessoryRemove,function(e){console.log("bk.engine   on  makeup remove :  "+e.tag),t.onMakeupRemove(e)}),this.emitter.on(a.CmModelEvent.BatchAccessoryBegin,function(){console.log("bk.engine   on  BatchAccessoryBegin"),t.isRenderLock=!0}),this.emitter.on(a.CmModelEvent.BatchAccessoryEnd,function(){console.log("bk.engine   on  makeup BatchAccessoryEnd "),t.isRenderLock=!1})}return e.prototype.dispose=function(){this.renderTarget&&this.renderTarget.dispose(),this.makeupMaterial&&(this.makeupMaterial.dispose(),this.makeupMaterial=void 0);for(var e=this.pendingList.length-1;e>=0;e--){(t=this.pendingList[e]).map&&(t.map.dispose(),t.map=void 0),this.pendingList.splice(e,1)}for(e=this.completeList.length-1;e>=0;e--){var t;(t=this.completeList[e]).map&&(t.map.dispose(),t.map=void 0),this.completeList.splice(e,1)}this.face&&(this.face.map&&this.face.map.dispose(),this.face.mapAlpha&&this.face.mapAlpha.dispose(),this.face.mask&&this.face.mask.dispose(),this.face=void 0)},e.prototype.onFaceDataLoad=function(e){this.hsvData=e,this.renderer()},e.prototype.onFaceAdd=function(e){if(e){if(e&&e.map&&this.renderTarget&&e.map.uuid===this.renderTarget.texture.uuid)return void this.renderer();if(this.face&&this.face.map&&this.face.map.uuid===e.map.uuid)return console.log("bk.engine  makeup face map is the same."),void this.renderer();this.face&&(this.face.map&&this.face.map.isNeedHold&&this.face.map.dispose(),this.face.mapAlpha&&this.face.mapAlpha.isNeedHold&&this.face.mapAlpha.dispose(),this.face.mask&&this.face.mask.isNeedHold&&this.face.mask.dispose()),this.face=e,this.face&&(this.face.map&&(this.face.map.isNeedHold=!0),this.face.mapAlpha&&(this.face.mapAlpha.isNeedHold=!0),this.face.mask&&(this.face.mask.isNeedHold=!0)),this.renderer()}},e.prototype.onFaceRemove=function(e){this.face&&this.face.map&&e.uuid===this.face.map.uuid&&(this.face=void 0,console.log("bk.engine  makeup  faceRemove"))},e.prototype.onMakeupAdd=function(e){var t=this;this._checkMakeupAttachment(e.attachMent)?this._findMakeup(e)?(console.log("bk.engine  makeup exist,skip add "),this.emitter.emit(a.CmModelEvent.AccessoryAdd,e)):(this._innerRemoveMakeupEntry({name:e.name,tag:e.tag}),this.pendingList.push(e),o.cm_texture_loader.load(e.image,function(n){console.log("bk.engine  makeup texture load : "+e.attachMent);var i=t._findMakeupInArray(t.pendingList,e.name,e.tag);if(i>=0){e.map=n;var r=t.pendingList.splice(i,1);t.completeList.push(r[0]),t.renderer()}else n.dispose();t.emitter.emit(a.CmModelEvent.AccessoryAdd,e)})):console.error("bk.engine makeup attachment unsupport! "+e.attachMent)},e.prototype.onMakeupRemove=function(e){this._innerRemoveMakeupEntry(e)&&(console.log("bk.engine  makeup remove success!"),this.renderer(),this.emitter.emit(a.CmModelEvent.AccessoryRemove,e))},e.prototype.renderer=function(){var e=this;this.isRenderLock?console.log("bk.engine  makeup <Renderer> renderLock!!!"):(this.hsvData||console.log("bk.engine  makeup <Renderer> hsvData undefined"),this.face&&this.face.map?this.pendingList.length>0?console.log("bk.engine  makeup <Renderer> accessory loading  count:"+this.pendingList.length+", waiting ..."):this.waitTextureLoaded(this.face.map,function(){e.renderer()})&&this.waitTextureLoaded(this.face.mapAlpha,function(){e.renderer()})&&this.waitTextureLoaded(this.face.mask,function(){e.renderer()})&&(this.isRendering?this.needsUpdate=!0:(this.isRendering=!0,setTimeout(function(){e._render(),e.isRendering=!1,e.needsUpdate&&(e.needsUpdate=!1,e.renderer())},0))):console.log("bk.engine  makeup <Renderer> face undefined"))},e.prototype._render=function(){if(this.face){for(var e=new Array,t=new Array,n=new Array,a=new Array,o=0;o<c.length;o++){var u=c[o],h=this._getMakeupByAttachMent(u);if(h)if(h.map&&h.map.image&&h.map.image.complete)if(t.push(this._getHSV(u)),e.push(h.map),h.cropping&&h.originSize){var p={x:h.cropping[0],y:h.cropping[1]},f={x:h.originSize[0],y:h.originSize[1]};n.push(new r.Vector2(p.x/f.x,(f.y-(p.y+h.map.image.height))/f.y)),a.push(new r.Vector2(h.map.image.width/f.x,h.map.image.height/f.y))}else n.push(new r.Vector2(0,0)),a.push(new r.Vector2(1,1));else;}if(console.log("bk.engine  makeup <Renderer>  start"),this.makeupMaterial=new l.CmMakeupMaterial,this.makeupMaterial){this.makeupMaterial.updateUniforms({map:this.face.map,mask:this.face.mask,mapAlpha:this.face.mapAlpha,makeupHsv:this._getHSV("skin"),entryTextures:e,entryHsvs:t,locations:n,sizes:a});var d=s.CmMakeUpRenderer.getInstance();d.setRendererTarget(this.renderTarget),d.render(this.makeupMaterial),this.renderTarget.texture.isNeedHold=!0,this.emitter.emit(i.MakeUpFinish,this.renderTarget.texture)}}else console.log("bk.engine  makeup <_innerRender> face is null")},e.prototype._getHSV=function(e){if(this.hsvData&&this.hsvData[e]){var n=this.hsvData[e];return{H:n.H/t.HSVScales.x,S:n.S/t.HSVScales.y,V:n.V/t.HSVScales.z}}return{H:0,S:0,V:0}},e.prototype._getMakeupByAttachMent=function(e,t){for(var n=0;n<this.completeList.length;n++){var i=this.completeList[n];if(e&&e===i.attachMent)return i}},e.prototype._checkMakeupAttachment=function(e){for(var t=0;t<c.length;t++){if(c[t]===e)return!0}return!1},e.prototype._findMakeup=function(e){var t=this._findMakeupInArray(this.completeList,e.name,e.tag);return t>=0&&this.completeList[t].image===e.image?this.completeList[t]:(t=this._findMakeupInArray(this.pendingList,e.name,e.tag))>=0&&this.pendingList[t].image===e.image?this.pendingList[t]:void 0},e.prototype._findMakeupInArray=function(e,t,n){for(var i=0;i<e.length;i++){var r=e[i];if(t&&t===r.name||n&&n===r.tag)return i}return-1},e.prototype._innerRemoveMakeupEntry=function(e){var t,n=!1,i=this._findMakeupInArray(this.pendingList,e.name,e.tag);i>=0&&((t=this.pendingList.splice(i,1))[0].map&&t[0].map.dispose(),n=!0);(i=this._findMakeupInArray(this.completeList,e.name,e.tag))>=0&&((t=this.completeList.splice(i,1))[0].map&&t[0].map.dispose(),n=!0);return n},e.prototype.waitTextureLoaded=function(e,t){return!e||(!!(e&&e.image&&e.image.complete)||(e.addEventListener("loaded",function(){t&&t(),t=function(){}}),!1))},e}();t.CmMakeUp=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(3),a=function(){function e(){this.scene=new i.Scene,this.scene.background=new i.Color(0),this.camera=new i.OrthographicCamera(-1,1,1,-1,-1,1),this.bufferGeo=new i.BufferGeometry,this.bufferGeo.addAttribute("uv",new i.Float32BufferAttribute([0,0,1,0,1,1,0,1],2)),this.bufferGeo.addAttribute("pos",new i.Float32BufferAttribute([-1,-1,1,-1,1,1,-1,1],2)),this.bufferGeo.setIndex(new i.Uint16BufferAttribute([0,1,2,0,2,3],1))}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setRendererTarget=function(e){this.renderTarget=e},e.prototype.render=function(e){var t=new i.Mesh(this.bufferGeo,e);this.scene.add(t),r.renderer.render(this.scene,this.camera,this.renderTarget),this.scene.remove(t)},e}();t.CmMakeUpRenderer=a},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(0),o=n(39),s=n(40),l=n(0);function c(e){return""!==e}var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.parseCmMaterial=function(e){var t=l.UniformsUtils.merge([e.mapAlpha?o.CmUniformsLib.makeup_map_alpha:{},e.mask?o.CmUniformsLib.makeup_mask:{},e.map?o.CmUniformsLib.makeup_common:{}]);e.mapAlpha&&(t.map_alpha.value=e.mapAlpha),e.mask&&(t.mask.value=e.mask),e.map&&(t.map.value=e.map,t.hsv.value=new a.Vector3(e.makeupHsv.H,e.makeupHsv.S,e.makeupHsv.V));for(var n=0,i=0;i<e.entryTextures.length&&i<e.entryHsvs.length;i++){var r=e.entryTextures[i];r&&(t["beautyMap"+(i+1)].value=r,t["beautyHsv"+(i+1)].value=new a.Vector3(e.entryHsvs[i].H,e.entryHsvs[i].S,e.entryHsvs[i].V),t["beautyLocation"+(i+1)].value=e.locations[i],t["beautySize"+(i+1)].value=e.sizes[i],n++)}t.beautyCount.value=n;var u=[e.map?"#define USE_MAP":"",e.mapAlpha?"#define USE_MAP_ALPHA":"",e.mask?"#define USE_MASK":"",s.shaderLibs.makeup.fragmentShader].filter(c).join("\n");return{vShader:[s.shaderLibs.makeup.vertexShader].filter(c).join("\n"),fShader:u,uniforms:t}},t.prototype.updateUniforms=function(e){var n=t.parseCmMaterial(e),i=n.vShader,r=n.fShader,a=n.uniforms;this.needsUpdate=!0,this.fragmentShader=r,this.vertexShader=i,this.uniforms=a},t}(a.ShaderMaterial);t.CmMakeupMaterial=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r={makeup_common:{map:{value:null},hsv:{value:new i.Vector3},beautyMap1:{value:null},beautyHsv1:{value:new i.Vector3},beautyLocation1:{value:new i.Vector2},beautySize1:{value:new i.Vector2(1,1)},beautyMap2:{value:null},beautyHsv2:{value:new i.Vector3},beautyLocation2:{value:new i.Vector2},beautySize2:{value:new i.Vector2(1,1)},beautyMap3:{value:null},beautyHsv3:{value:new i.Vector3},beautyLocation3:{value:new i.Vector2},beautySize3:{value:new i.Vector2(1,1)},beautyMap4:{value:null},beautyHsv4:{value:new i.Vector3},beautyLocation4:{value:new i.Vector2},beautySize4:{value:new i.Vector2(1,1)},beautyMap5:{value:null},beautyHsv5:{value:new i.Vector3},beautyLocation5:{value:new i.Vector2},beautySize5:{value:new i.Vector2(1,1)},beautyMap6:{value:null},beautyHsv6:{value:new i.Vector3},beautyLocation6:{value:new i.Vector2},beautySize6:{value:new i.Vector2(1,1)},beautyCount:{value:0}},makeup_map_alpha:{map_alpha:{value:null}},makeup_mask:{mask:{value:null}}};t.CmUniformsLib=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),r={makeup:{vertexShader:n(42).default,fragmentShader:i.default}};t.shaderLibs=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\nprecision mediump float;\n\n\n#ifdef USE_MAP_ALPHA\nuniform sampler2D map_alpha;\n#endif\n\n\n#ifdef USE_MASK\nuniform sampler2D mask;\n#endif\n\nvarying vec2 v_TexCoord;\nuniform sampler2D map;\nuniform vec3 hsv;\n\nuniform sampler2D beautyMap1;\nuniform vec3 beautyHsv1;\nuniform vec2 beautyLocation1;\nuniform vec2 beautySize1;\n\nuniform sampler2D beautyMap2;\nuniform vec3 beautyHsv2;\nuniform vec2 beautyLocation2;\nuniform vec2 beautySize2;\n\nuniform sampler2D beautyMap3;\nuniform vec3 beautyHsv3;\nuniform vec2 beautyLocation3;\nuniform vec2 beautySize3;\n\nuniform sampler2D beautyMap4;\nuniform vec3 beautyHsv4;\nuniform vec2 beautyLocation4;\nuniform vec2 beautySize4;\n\nuniform sampler2D beautyMap5;\nuniform vec3 beautyHsv5;\nuniform vec2 beautyLocation5;\nuniform vec2 beautySize5;\n\nuniform sampler2D beautyMap6;\nuniform vec3 beautyHsv6;\nuniform vec2 beautyLocation6;\nuniform vec2 beautySize6;\n\nuniform int beautyCount;\n\nvec3 rgb2hsv(vec3 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 0.0001;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\n\nvec4 applyHSV(vec4 color, vec3 deltaHSV)\n{\n    if (deltaHSV.x != 0.0)\n    {\n        vec3 hsv = rgb2hsv(color.rgb);\n        hsv.x += deltaHSV.x;\n        if (hsv.x > 6.0) {\n            hsv.x = hsv.x - 6.0;\n        } else if (hsv.x < 0.0) {\n            hsv.x = hsv.x + 6.0;\n        }\n        color.rgb = hsv2rgb(hsv);\n    }\n\n    if (deltaHSV.y != 0.0)\n    {\n        float c_max = max(color.r, max(color.g, color.b));\n        float c_min = min(color.r, min(color.g, color.b));\n        float delta = c_max - c_min;\n        if (delta != 0.0)\n        {\n            float v = c_max + c_min;\n            float l = v * 0.5;\n            float s = l < 0.5 ? (delta / v) : ((delta) / (2.0 - v));\n            if (deltaHSV.y >= 0.0)\n            {\n                float alpha = (deltaHSV.y + s) >= 1.0 ? s : (1.0 - deltaHSV.y);\n                alpha = 1.0 / alpha - 1.0;\n                color.rgb = color.rgb + (color.rgb - l) * alpha;\n            }\n            else\n            {\n                float alpha = deltaHSV.y;\n                color.rgb = l + (color.rgb - l) * (1.0 + alpha);\n            }\n        }\n    }\n\n    if (deltaHSV.z != 0.0)\n    {\n        color.rgb = deltaHSV.z > 0.0 ? (color.rgb * (1.0 - deltaHSV.z) + deltaHSV.z) : (color.rgb + color.rgb * deltaHSV.z);\n    }\n    return color;\n}\n\n\nvoid main() {\n\n#ifdef USE_MAP\n    vec4 mc = texture2D(map, v_TexCoord);\n\n    #ifdef USE_MAP_ALPHA\n        mc = vec4(mc.rgb, texture2D(map_alpha, v_TexCoord).r);\n    #endif\n\n    mc = mapTexelToLinear(mc);\n\n#ifdef USE_MASK\n    vec4 maskc = texture2D(mask, v_TexCoord);\n    if(  maskc.a > 0.0 )\n    {\n        mc = applyHSV(mc, hsv);\n    }\n#endif\n\n    if (beautyCount >= 1)\n    {\n        vec2 cl = beautyLocation1;\n        vec2 cs = beautySize1;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap1, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv1);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n\n\n    if (beautyCount >= 2)\n    {\n        vec2 cl = beautyLocation2;\n        vec2 cs = beautySize2;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap2, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv2);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n\n\n    if (beautyCount >= 3)\n    {\n        vec2 cl = beautyLocation3;\n        vec2 cs = beautySize3;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap3, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv3);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n\n\n    if (beautyCount >= 4)\n    {\n        vec2 cl = beautyLocation4;\n        vec2 cs = beautySize4;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap4, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv4);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n    if (beautyCount >= 5)\n    {\n        vec2 cl = beautyLocation5;\n        vec2 cs = beautySize5;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap5, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv5);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n\n    if (beautyCount >= 6)\n    {\n        vec2 cl = beautyLocation6;\n        vec2 cs = beautySize6;\n        if(v_TexCoord.x >= cl.x && v_TexCoord.x <= (cl.x + cs.x) && v_TexCoord.y >= cl.y && v_TexCoord.y <= (cl.y + cs.y) )\n        {\n            vec2 localUV = vec2((v_TexCoord.x - cl.x) / (cs.x) ,(v_TexCoord.y - cl.y) / (cs.y) );\n            vec4 c = texture2D(beautyMap6, localUV);\n            c = applyHSV(mapTexelToLinear(c), beautyHsv6);\n            mc = mc * ( 1.0- c.a) + vec4(c.rgb,1.0) * c.a;\n        }\n    }\n\n    gl_FragColor = linearToOutputTexel(mc);\n\n#endif\n\n}\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\nattribute vec2 pos; \nvarying vec2 v_TexCoord;\nvoid main() { \n   gl_Position = vec4(pos, 0, 1); \n   v_TexCoord = uv; \n}\n"},function(e,t,n){"use strict";var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=n(0),s=function(){function e(e,t){this.group=e,this.emitter=t,this.boneMap=new Map}return e.prototype.isSkeletonSetup=function(){return this.boneMap.size>0},e.prototype.getBoneByName=function(e){return this.boneMap.get(e)},e.prototype.setupSkeleton=function(e,t){var n;(n=this.group).remove.apply(n,r(this.group.children)),this.boneMap.clear(),this.mountBones(e),this.group.updateMatrixWorld(!0),this.emitter.emit(a.CmModelEvent.SkeletonLoad,{skeleton:e,tag:t})},e.prototype.mountBones=function(e){var t=this;e.forEach(function(e){var n=e.name,i=e.parent,r=e.matrix;if(t.boneMap.has(n))console.error("CmSkeleton: bone "+n+" existed.");else{var a=new o.Bone;a.name=n,a.applyMatrix((new o.Matrix4).fromArray(r)),t.boneMap.set(n,a),(i&&t.boneMap.get(i)||t.group).add(a)}})},e.prototype.unmountBones=function(e){var t=this.boneMap.get(e);if(t){this.boneMap.delete(e);var n=t.parent;n&&n.remove(t)}},e}();t.CmSkeleton=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(3),a=function(){function e(e){this.anims=e}return e.prototype.instantiate=function(e){var t=this.anims.map(function(t){return t.instantiate(e)});return new o(t)},e}();t.CompositeAnim=a;var o=function(){function e(e){this.actions=e}return e.prototype.interceptEvent=function(e){return this.actions.some(function(t){return void 0!==t.interceptEvent&&t.interceptEvent(e)})},e.prototype.play=function(){return this.actions.forEach(function(e){return e.play()}),this},e.prototype.stop=function(){return this.actions.forEach(function(e){return e.stop()}),this},e}();function s(e,t,n,i){var r;r=i?new p([e],i,n):new h([e]);var o="cam"+e.name,s=t.findIndex(function(e){return e.name===o});if(-1===s)return r;var l=t.splice(s,1)[0],u=new a([r,new c(l)]);return u.cam=!0,u}t.CompositeAnimAction=o,t.createAnim=function(e,t,n){var i=(e=e.slice())[0].name;if(""===i)return s(e[0],e,t,n);if("main"===i){var r=e.shift(),a={mainAnim:s(r,e),cmGroup:t,accessory:n};for(r=e.shift();r;)"pre"===r.name?a.preAnim=s(r,e):"post"===r.name&&(a.postAnim=s(r,e)),r=e.shift();return new d(a)}return null};var l=function(){function e(){}return e.prototype.play=function(){return this},e.prototype.stop=function(){return this},e}(),c=function(){function e(e){this.clip=e}return e.prototype.instantiate=function(e){e.mixer;var t=e.loop;return e.noCam?new l:new u(this.clip,t)},e}();t.CameraAnim=c;var u=function(){function e(e,t){this.clip=e,this.loop=t,this.id=void 0}return e.prototype.play=function(){return this.id=r.cameraAnimation.play(this.clip,this.loop),this},e.prototype.stop=function(){return r.cameraAnimation.stop(this.id),this.id=void 0,this},e}(),h=function(){function e(e){this.clips=e}return e.prototype.instantiate=function(e){var t=e.mixer,n=e.loop,r=t.clipAction(this.clips[0]).setLoop(n?i.LoopRepeat:i.LoopOnce,n);return r.clampWhenFinished=!0,r},e}();t.ClipAnim=h;var p=function(){function e(e,t,n){this.clips=e,this.accessory=t,this.cmGroup=n}return e.prototype.instantiate=function(e){var t=e.mixer,n=e.loop;this.cmGroup.addAccessory(this.accessory,this.accessory.name);var r=t.clipAction(this.clips[0]).setLoop(n?i.LoopRepeat:i.LoopOnce,n);return r.clampWhenFinished=!0,new f(r,this.accessory,this.cmGroup)},e}();t.TrickAnim=p;var f=function(){function e(e,t,n){var i=this;this.action=e,this.accessory=t,this.cmGroup=n,this.onStop=function(){i.action.mixer.removeEventListener("finished",i.onStop),i.cmGroup.removeAccessory(i.accessory.name)}}return e.prototype.play=function(){return this.action.mixer.addEventListener("finished",this.onStop),this.action.play(),this},e.prototype.stop=function(){return this.onStop(),this.action.stop(),this},e}();t.TrickAnimAction=f;var d=function(){function e(e){this.param=e,this.cam=[e.mainAnim,e.preAnim,e.postAnim].some(function(e){return e&&e.cam})}return e.prototype.instantiate=function(e){var t,n=e.mixer,i=e.loop,r=e.noCam,a=this.param,o=a.cmGroup,s=a.accessory,l=a.mainAnim,c=a.preAnim,u=a.postAnim;o&&s&&(o.addAccessory(s,s.name),t=function(){o.removeAccessory(s.name)});var h=[l.instantiate({mixer:n,loop:i,noCam:r})];return c&&h.unshift(c.instantiate({mixer:n,loop:1,noCam:r})),u&&h.push(u.instantiate({mixer:n,loop:1,noCam:r})),new m(h,t)},e}(),m=function(){function e(e,t){this.actions=e,this.onStop=t,this.currIndex=-1}return e.prototype.interceptEvent=function(e){if("finished"===e.type&&this.currIndex>=0){e.action.stop(),this.currIndex++;var t=this.actions[this.currIndex];if(t)return t.play(),!0;this.onStop&&this.onStop()}return!1},e.prototype.play=function(){this.currIndex=0;var e=this.actions[0];return e?e.play():this.onStop&&this.onStop(),this},e.prototype.stop=function(){if(this.currIndex>=0){var e=this.actions[this.currIndex];this.currIndex=-1,this.onStop&&this.onStop(),e&&e.stop()}return this},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=BK.TFLoader;t.loadBuffer=function(e){return new Promise(function(t,n){i.loadFile({path:[e],complete:function(e,i){!e&&i.length?t(i[0].buffer):n(new Error("load buffer error: "+e+"."))}})})},t.loadSkeleton=function(e){return new Promise(function(t,n){i.loadSkeleton({buffer:[e],complete:function(e,i){0===e&&i.length?t(i[0].skeleton):n(new Error("load skeleton error: "+e+"."))}})})},t.loadAccessory=function(e,t){return new Promise(function(n,r){i.loadAccessory({buffer:[e],id:t,complete:function(e,t){0===e&&t.length?n(t[0]):r(new Error("load accessory error: "+e+"."))}})})},t.loadMakeup=function(e){return new Promise(function(t,n){i.loadMakeup({buffer:[e],complete:function(e,i){0===e&&i.length?t(i[0]):n(new Error("load makeup error: "+e+"."))}})})},t.loadAnimation=function(e){return new Promise(function(t,n){var r=function(e,i){0===e&&i.length?t(i[0].clip):n(new Error("load animation error: "+e+"."))};"string"!=typeof e?i.loadAnimation({buffer:[e],complete:r}):i.loadAnimation({path:[e],complete:r})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function e(e){this.cmModel=e,this.lastX=0}return e.prototype.getBoneXByName=function(e){if(this.cmModel){var t=this.cmModel.getSkeleton().getBoneByName(e);if(t)return this.cmModel.convertToScreen(t.getWorldPosition(new i.Vector3)).x}return 0},e.prototype.updateNamePlatePosition=function(){if(this.textBK&&this.imageBK&&this.info){var e=this.getBoneXByName(this.info.parentBoneName);if(Math.abs(e-this.lastX)>.5){var t=this.info.margin;"left"===this.info.direction&&(t=-1*this.info.margin-this.imageBK.size.width);var n=0;1===this.info.style.textAlign&&(n=(this.textBK.size.height-this.info.style.fontSize)/2*this.info.platform),this.textBK.position={x:t+e+this.info.padding[3],y:this.info.y+n},this.imageBK.position={x:t+e,y:this.info.y}}this.lastX=e}},e.prototype.show=function(e){if(this.info=e,this.info&&e.context){this.lastX=0,this.textBK&&this.textBK.removeFromParent(),this.imageBK&&this.imageBK.removeFromParent();var t=new BK.Texture(e.imagePath);if(t){var n=t.size,i=n.width*e.imageScale,r=n.height*e.imageScale;this.imageBK=new BK.Sprite(i,r,t,e.flipU,1,1,1),e.style.width=i-e.padding[1]-e.padding[3],e.style.height=r-e.padding[0]-e.padding[2],e.style.maxWidth=e.style.width+50,e.style.maxHeight=e.style.height+50,this.textBK=new BK.Text(e.style,e.context);var a=e.context.length,o=a,s=void 0;for(this.textBK.width<0&&(this.textBK.width=0),e.style.width<0&&(e.style.width=0);this.textBK.width>e.style.width;)o--,s=e.context.substring(0,o),this.textBK=new BK.Text(e.style,s);o!=a&&o>2&&(s=e.context.substring(0,o-2),s+="",this.textBK=new BK.Text(e.style,s)),BK.Director.root.addChild(this.imageBK),BK.Director.root.addChild(this.textBK),this.updateNamePlatePosition()}}},e.prototype.hide=function(){this.textBK&&(this.textBK.removeFromParent(),this.textBK=null),this.imageBK&&(this.imageBK.removeFromParent(),this.imageBK=null)},e}();t.NamePanel=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=1,a=function(){function e(e){this.camera=e,this.playingAnimation=null,this.position=new i.Vector3,this.quaternion=new i.Quaternion,this.position.copy(this.camera.position),this.quaternion.copy(this.camera.quaternion)}return e.prototype.update=function(e){this.playingAnimation&&this.playingAnimation.mixer.update(e)},e.prototype.play=function(e,t){var n=this,a=r++;this.playingAnimation?this.resetPlayingAnimation():(this.position.copy(this.camera.position),this.quaternion.copy(this.camera.quaternion));var o=new i.AnimationMixer(this.camera),s=o.clipAction(e).setLoop(t?i.LoopRepeat:i.LoopOnce,t).play();return o.addEventListener("finished",function(){n.resetPlayingAnimation()}),this.playingAnimation={id:a,mixer:o,action:s},a},e.prototype.stop=function(e){this.playingAnimation&&e===this.playingAnimation.id&&this.resetPlayingAnimation()},e.prototype.resetPlayingAnimation=function(){if(this.playingAnimation){var e=this.playingAnimation.action;this.playingAnimation=null,e.stop(),this.camera.position.copy(this.position),this.camera.quaternion.copy(this.quaternion)}},e}();t.CameraAnimation=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(0),a=n(1);!function(e){e[e.AIO=0]="AIO",e[e.DRAWER=1]="DRAWER"}(i||(i={}));var o=function(){function e(e,t,n,o,l){var c=this;if(this.info=o,this.model=e,this.type=t,this.direction=n,this.needMirror=l||!1,this.bubbleImage=null,this.bubbleCanvas=document.createElement("canvas").getContext("2d"),this.textCanvas=document.createElement("canvas").getContext("2d"),null!==this.bubbleCanvas&&null!==this.textCanvas){this.bubbleCanvas.strokeColor={r:0,g:0,b:0,a:0},this.textCanvas.strokeColor={r:0,g:0,b:0,a:0};var u=null,h=null,p=this.bubbleCanvas;u=void 0!==p.getTexture?new r.Texture(p.getTexture()):new r.Texture(p);var f=this.textCanvas;h=void 0!==f.getTexture?new r.Texture(f.getTexture()):new r.Texture(f),u.needsUpdate=!0,h.needsUpdate=!0,s.getInstance().inCm3d&&(u.image=this.bubbleCanvas.__nativeObj,h.image=this.textCanvas.__nativeObj),this.bubbleSprite=new r.Sprite(new r.SpriteMaterial({map:u})),this.textSprite=new r.Sprite(new r.SpriteMaterial({map:h})),this.bubbleSprite.name="bubbleSprite",this.textSprite.name="textSprite";var d=!1;t===i.AIO&&"left"===n&&l&&this.model.on(a.CmModelEvent.AnimationComplete,function(){d||(c.setMirror(),d=!0)})}else console.error("Canvas is disabled.")}return e.prototype.getTextCanvas=function(){return null!==comGlobalParam&&comGlobalParam.platform&&"ios"===comGlobalParam.platform.toLowerCase()?this.bubbleCanvas:this.textCanvas},e.prototype.updateCanvasSize=function(e,t){this.textCanvas&&(this.textCanvas.canvas.width=e,this.textCanvas.canvas.height=t),this.bubbleCanvas&&(this.bubbleCanvas.canvas.width=e,this.bubbleCanvas.canvas.height=t)},e.prototype.hidePanel=function(){this.textSprite&&this.textSprite.parent&&this.textSprite.parent.remove&&this.textSprite.parent.remove(this.textSprite),this.bubbleSprite&&this.bubbleSprite.parent&&this.bubbleSprite.parent.remove&&this.bubbleSprite.parent.remove(this.bubbleSprite),s.getInstance().inCm3d&&this.dispose()},e.prototype.useH5Mode=function(){this.textCanvas&&this.textCanvas.useH5Mode(),this.bubbleCanvas&&this.bubbleCanvas.useH5Mode()},e.prototype.dispose=function(){this.bubbleCanvas&&this.bubbleCanvas.dispose&&this.bubbleCanvas.dispose(),this.textCanvas&&this.textCanvas.dispose&&this.textCanvas.dispose()},e.prototype.setFillStyle=function(e){this.bubbleCanvas&&(this.bubbleCanvas.fillStyle=e),this.textCanvas&&(this.textCanvas.fillStyle=e)},e.prototype.setFont=function(e){var t=this.getTextCanvas();null!=t&&(t.font=e)},e.prototype.setLineWidth=function(e){var t=this.getTextCanvas();null!=t&&(t.lineWidth=e)},e.prototype.setTextAlign=function(e){var t=this.getTextCanvas();null!=t&&(t.textAlign=e)},e.prototype.setTextBaseline=function(e){var t=this.getTextCanvas();null!=t&&(t.textBaseline=e)},e.prototype.setTextSize=function(e){var t=this.getTextCanvas();null!=t&&t.setTextSize(e)},e.prototype.findBreakPoint=function(e,t){var n=0,i=e.length-1,r=this.getTextCanvas();if(r)for(;n<=i;){var a=Math.floor((n+i)/2),o=r.measureText(e.substr(0,a)).width,s=r.measureText(e.substr(0,a+1)).width;if(o<=t&&s>t)return a;o<t?n=a+1:i=a-1}return-1},e.prototype.breakLinesForCanvas=function(e,t){for(var n=this.type===i.DRAWER?2:3,r=[],a=0,o=0;-1!==(a=this.findBreakPoint(e,t));){if(o++,r.push(e.substr(0,a)),o==n){e="";break}e=e.substr(a)}if(e&&r.push(e),o==n&&this.type===i.AIO){var s=r[n-1];s=s.substr(0,s.length-2),s+="...",r[n-1]=s}return r},e.prototype.measureText=function(e){var t=this.getTextCanvas();return t?t.measureText(e):new TextMetrics},e.prototype.save=function(){this.bubbleCanvas&&this.bubbleCanvas.save()},e.prototype.restore=function(){this.bubbleCanvas&&this.bubbleCanvas.restore()},e.prototype.setTransform=function(e,t,n,i,r,a){this.bubbleCanvas&&this.bubbleCanvas.setTransform(e,t,n,i,r,a)},e.prototype.drawImage=function(e,t,n,i,r,a,o,s,l){this.bubbleCanvas&&this.bubbleCanvas.drawImage(e,t,n,i,r,a,o,s,l)},e.prototype.getPanelWidth=function(){return this.bubbleCanvas?this.bubbleCanvas.canvas.width:0},e.prototype.getPanelHeight=function(){return this.bubbleCanvas?this.bubbleCanvas.canvas.height:0},e.prototype.update=function(){var e;this.bubbleSprite&&((e=this.bubbleSprite.material)&&(e.map.needsUpdate=!0));this.textSprite&&((e=this.textSprite.material)&&(e.map.needsUpdate=!0))},e.prototype.fillText=function(e,t,n,i){var r=this.getTextCanvas();null!=r&&r.fillText(e,t,n,i)},e.prototype.drawStyle=function(e){var t=this.getTextCanvas();null!=t&&(t.drawStyle=e)},e.prototype.setFillColor=function(e){var t=this.getTextCanvas();null!=t&&(t.fillColor=e)},e.prototype.setSpriteCenter=function(e,t){this.bubbleSprite&&this.bubbleSprite.center.set(e,t),this.textSprite&&this.textSprite.center.set(e,t)},e.prototype.setSpriteScale=function(e,t,n){this.bubbleSprite&&this.bubbleSprite.scale.set(e,t,n),this.textSprite&&this.textSprite.scale.set(e,t,n)},e.prototype.setSpritePosition=function(e,t,n){this.bubbleSprite&&this.bubbleSprite.position.set(e,t,n),this.textSprite&&this.textSprite.position.set(e,t,n)},e.prototype.getSpritePosition=function(){return this.bubbleSprite?this.bubbleSprite.position:new r.Vector3(0,0,0)},e.prototype.addToParent=function(e){this.bubbleSprite&&e&&e.add&&e.add(this.bubbleSprite),this.textSprite&&e&&e.add&&e.add(this.textSprite)},e.prototype.needRender=function(e){return void 0!==this.bubbleSprite&&void 0!==this.textSprite&&(!this.bubbleSprite.parent||this.bubbleSprite.parent!==e||!this.textSprite.parent||this.textSprite.parent!==e)},e.prototype.setBubbleImage=function(e){"left"===this.direction&&(this.bubbleImage=e)},e.prototype.getMaxTextWidth=function(e){var t=0;if(void 0!==e.maxTextWidth){var n=parseInt(e.maxTextWidth);isNaN(n)||(t=n)}return t},e.prototype.setMirror=function(){var e=this.getSpritePosition();if(this.setSpritePosition(e.x,e.y,-e.z),this.bubbleCanvas)if(this.save(),this.setTransform(-1,0,0,1,this.getPanelWidth(),0),this.bubbleImage&&this.bubbleCanvas){var t=this.bubbleImage;if(this.bubbleCanvas.clearRect(0,0,this.getPanelWidth(),this.getPanelHeight()),this.drawImage(t,0,0,t.width,t.height,0,0,this.getPanelWidth(),this.getPanelHeight()),this.restore(),this.getTextCanvas()===this.bubbleCanvas){var n=this.getMaxTextWidth(this.info);this.info.text&&(this.setFillColor(void 0!==this.info.bkFillColor?this.info.bkFillColor:{r:0,g:0,b:0,a:1}),this.drawStyle(void 0!==this.info.bkDrawStyle?this.info.bkDrawStyle:0),this.fillText(this.info.text,this.getPanelWidth()/2,void 0===this.info.textOffsetY?10:0|this.info.textOffsetY,n))}}else this.restore()},e}(),s=function(){function e(){this.running=!1,this.inCm3d=!1,this.panelList=[],this.inCm3d="undefined"!=typeof BK&&void 0!==BK.Image}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.createPanel=function(e,t,n,i,r){return new o(e,t,n,i,r)},e.prototype.render=function(e){if(void 0!==e&&e instanceof r.Scene&&this.panelList){var t=this;this.panelList.map(function(n){void 0!==n.bubbleSprite&&e.add(n.bubbleSprite),void 0!==n.textSprite&&e.add(n.textSprite),t.running=!0})}},e.prototype.isRunning=function(){return this.running},e.prototype.queryPanel=function(e){return this.panelList[e]},e.prototype.updatePanel=function(t,n,r,a){var o=i.AIO;n&&n.type&&"drawer"===n.type&&(o=i.DRAWER);var s="right";n&&n.direction&&(s=n.direction);var l=n&&!0===n.needMirror||!1,c=t.group.uuid,u=this.panelList[c];u?(u.info=n,console.error("Cm3d Panel has already exist")):(u=e.createPanel(t,o,s,n,l),this.panelList[c]=u);var h=0,p=0;if(u){var f=void 0===n.textOffsetX?10:0|n.textOffsetX,d=void 0===n.textOffsetY?10:0|n.textOffsetY,m=u.getMaxTextWidth(n);if(n.image){u.useH5Mode();var g=BK.Image.loadImage(n.image);if(void 0===g)return void u.dispose();u.setBubbleImage(g),p=g.height,h=g.width,u.updateCanvasSize(h,p),n.fillStyle&&u.setFillStyle(n.fillStyle),n.font&&u.setFont(n.font),n.lineWidth&&u.setLineWidth(n.lineWidth);var v=[],_=parseInt(n.font),y=m+f,x=0;n.text&&(u.setTextAlign("center"),u.setTextBaseline(void 0===n.textBaseline?"top":n.textBaseline),u.setTextSize(_),(v=u.breakLinesForCanvas(n.text,m)).length<=1&&(y=u.measureText(n.text).width+2*f),x=(_+18)*v.length+2*d+_,n.text=v.join("")),l&&(u.save(),u.setTransform(-1,0,0,1,u.getPanelWidth(),0)),(o!==i.AIO||"left"!==s||l)&&(n.scaleBackground?u.drawImage(g,0,0,g.width,g.height,0,0,y,x):u.drawImage(g,0,0,g.width,g.height,0,0,u.getPanelWidth(),u.getPanelHeight())),l&&u.restore(),n.text&&(u.setFillColor(void 0!==n.bkFillColor?n.bkFillColor:{r:0,g:0,b:0,a:1}),u.drawStyle(void 0!==n.bkDrawStyle?n.bkDrawStyle:0),u.fillText(n.text,u.getPanelWidth()/2,void 0===n.textOffsetY?10:0|n.textOffsetY,m)),u.update()}if(u.setSpriteCenter(1,0),n.scale&&u.setSpriteScale(n.scale,n.scale*(p/h),1),n.position){var b=o===i.AIO?1:-1;u.setSpritePosition(n.position[0],n.position[1],n.position[2]*b)}if(o!==i.AIO||"left"!==s||l||u.setMirror(),a){var M=t.getSkeleton().getBoneByName(a);M&&u.addToParent(M)}else r&&u.needRender(r)?this.render(r):u.update()}else console.error("Failed to create canvas")},e.prototype.hidePanel=function(e,t){var n=e.group.uuid,i=this.panelList[n];i?i.hidePanel():console.error("panel not exist!"),delete this.panelList[n]},e.prototype.releaseAll=function(e){void 0!==e&&this.panelList&&(this.panelList.map(function(t){void 0!==t.bubbleSprite&&e.remove(t.bubbleSprite),void 0!==t.textSprite&&e.remove(t.textSprite)}),this.running=!1),this.panelList=[]},e.prototype.getContainer=function(e){return this.panelList[e]},e}();t.CmPanelManager=s},function(e,t,n){"use strict";n.r(t);var i=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},r=setTimeout;function a(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],p(e,this)}function s(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var i;try{i=n(e._value)}catch(e){return void c(t.promise,e)}l(t.promise,i)}else(1===e._state?l:c)(t.promise,e._value)})):e._deferreds.push(t)}function l(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void u(e);if("function"==typeof n)return void p((i=n,r=t,function(){i.apply(r,arguments)}),e)}e._state=1,e._value=t,u(e)}catch(t){c(e,t)}var i,r}function c(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)s(e,e._deferreds[t]);e._deferreds=null}function h(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function p(e,t){var n=!1;try{e(function(e){n||(n=!0,l(t,e))},function(e){n||(n=!0,c(t,e))})}catch(e){if(n)return;n=!0,c(t,e)}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,t){var n=new this.constructor(a);return s(this,new h(e,t,n)),n},o.prototype.finally=i,o.all=function(e){return new o(function(t,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(e);if(0===i.length)return t([]);var r=i.length;function a(e,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(t){a(e,t)},n)}i[e]=o,0==--r&&t(i)}catch(e){n(e)}}for(var o=0;o<i.length;o++)a(o,i[o])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var i=0,r=e.length;i<r;i++)e[i].then(t,n)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){r(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};t.default=o}]);
cm3d.version = "timestamp : 2019-08-22 11:31:08, version : 121f316-ec69f7a";
BK.Script.log(1, 1, "cm3d.js " + cm3d.version);
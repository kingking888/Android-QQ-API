!function(e,t){for(var o in t)e[o]=t[o]}(this.window=this,function(e){var t={};function o(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=14)}([function(e,t,o){"use strict";function a(e){return function(){for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)try{o[a]=JSON.stringify(arguments[a])}catch(e){BK.Script.log(1,1,">> log format error: "+e.message+"\n"+e.stack),o[a]="[error]"}BK.Script.log(e,e,">> "+o.join(" | "))}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(0);function n(e,t,o){var a="[Zero]["+t+"] "+o;BK.Script.log(e,e,a)}t.console={log:i,debug:i,info:a(1),warn:a(2),error:a(3)},t.CMShowLog=n,t.myLog=function(e,t){n(e,"",t)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CMSHOW_LOG_PROTECT_VERSION="7.7.0",t.CMSHOW_ASYNCIO_QQ_VERSION="7.8.0",t.CMSHOW_LOG_TOUCHEVENT_VERSION="7.9.2",t.CMSHOW_3D_QQ_VERSION="7.9.9",t.CMSHOW_MAX_SPRITE_NUM=3,t.CMSHOW_BUBBLE_ACCESSORY_NAME="Bubble",t.bubbleTextRect={25:{x:0,y:0,width:77},26:{x:0,y:0,width:229},27:{x:0,y:0,width:44},28:{x:0,y:0,width:44},29:{x:0,y:0,width:170},30:{x:0,y:0,width:170},51:{x:0,y:0,width:44},52:{x:0,y:0,width:44},53:{x:0,y:0,width:170},54:{x:0,y:0,width:170},55:{x:0,y:0,width:44},56:{x:0,y:0,width:44},57:{x:0,y:0,width:170},58:{x:0,y:0,width:170},59:{x:0,y:0,width:44},60:{x:0,y:0,width:44},61:{x:0,y:0,width:170},62:{x:0,y:0,width:170},63:{x:0,y:0,width:44},64:{x:0,y:0,width:44},65:{x:0,y:0,width:170},66:{x:0,y:0,width:170}},function(e){e[e.CMShowResTypeRole=0]="CMShowResTypeRole",e[e.CMShowResTypeDress=1]="CMShowResTypeDress",e[e.CMShowResTypeAction=2]="CMShowResTypeAction"}(t.CMShowResType||(t.CMShowResType={})),function(e){e[e.CMShowActionTypeBasic=0]="CMShowActionTypeBasic",e[e.CMShowActionTypeWhiteFace=1]="CMShowActionTypeWhiteFace",e[e.CMShowActionTypeSlave=5]="CMShowActionTypeSlave",e[e.CMShowActionTypeRoll=6]="CMShowActionTypeRoll",e[e.CMShowActionTypeInterActive=7]="CMShowActionTypeInterActive",e[e.CMShowActionTypeRandom=8]="CMShowActionTypeRandom"}(t.CMShowActionType||(t.CMShowActionType={})),function(e){e[e.CMShowActionStatusNone=-1]="CMShowActionStatusNone",e[e.CMShowActionStatusStandUp=0]="CMShowActionStatusStandUp",e[e.CMShowActionStatusStandUp_Down=1]="CMShowActionStatusStandUp_Down",e[e.CMShowActionStatusThinking=2]="CMShowActionStatusThinking",e[e.CMShowActionStatusGetDown=3]="CMShowActionStatusGetDown",e[e.CMShowActionStatusGetDown_Down=4]="CMShowActionStatusGetDown_Down",e[e.CMShowActionStatusWait=5]="CMShowActionStatusWait",e[e.CMShowActionStatusAction=6]="CMShowActionStatusAction",e[e.CMShowActionStatusAction_Down=7]="CMShowActionStatusAction_Down",e[e.CMShowActionStatusJumpUp=8]="CMShowActionStatusJumpUp",e[e.CMShowActionStatusJumpDown=9]="CMShowActionStatusJumpDown"}(t.CMShowActionStatus||(t.CMShowActionStatus={})),function(e){e[e.CMShowBasicActionTypeNone=0]="CMShowBasicActionTypeNone",e[e.CMShowBasicActionTypeSingleAction=1]="CMShowBasicActionTypeSingleAction",e[e.CMShowBasicActionTypeDoubleAction=2]="CMShowBasicActionTypeDoubleAction"}(t.CMShowBasicActionType||(t.CMShowBasicActionType={})),function(e){e[e.CMShowCompletionStatusNone=0]="CMShowCompletionStatusNone",e[e.CMShowCompletionStatusStart=1]="CMShowCompletionStatusStart",e[e.CMShowCompletionStatusComplete=2]="CMShowCompletionStatusComplete",e[e.CMShowCompletionStatusInterrupt=3]="CMShowCompletionStatusInterrupt"}(t.CMShowCompletionStatus||(t.CMShowCompletionStatus={})),function(e){e[e.CMShowDefTaskIDStandUp=-1e3]="CMShowDefTaskIDStandUp",e[e.CMShowDefTaskIDThinking=-2e3]="CMShowDefTaskIDThinking",e[e.CMShowDefTaskIDGetDown=-3e3]="CMShowDefTaskIDGetDown",e[e.CMShowDefTaskIDWaiting=-4e3]="CMShowDefTaskIDWaiting",e[e.CMShowDefTaskIDJumpUp=-5e3]="CMShowDefTaskIDJumpUp",e[e.CMShowDefTaskIDJumpDown=-6e3]="CMShowDefTaskIDJumpDown"}(t.CMShowDefTaskID||(t.CMShowDefTaskID={})),function(e){e.CMShowDefActionNameStandUp="standUp",e.CMShowDefActionNameGetDown="getDown",e.CMShowDefActionNameThinking="thinking",e.CMShowDefActionNameWaiting="waiting",e.CMShowDefActionNameJumpUp="jumpUp",e.CMShowDefActionNameJumpDown="jumpDown"}(t.CMShowDefActionName||(t.CMShowDefActionName={})),function(e){e[e.CMShowLocationTypeAIO=0]="CMShowLocationTypeAIO",e[e.CMShowLocationTypeDrawer=1]="CMShowLocationTypeDrawer",e[e.CMShowLocationTypeFCard=2]="CMShowLocationTypeFCard"}(t.CMShowLocationType||(t.CMShowLocationType={})),function(e){e[e.TYPE_AIO=0]="TYPE_AIO",e[e.TYPE_DRAWER=1]="TYPE_DRAWER",e[e.TYPE_FCARD=2]="TYPE_FCARD"}(t.LOCATION_TYPE||(t.LOCATION_TYPE={})),function(e){e[e.CMShowAIOTypeNone=0]="CMShowAIOTypeNone",e[e.CMShowAIOTypeFriend=1]="CMShowAIOTypeFriend",e[e.CMShowAIOTypeTroop=4]="CMShowAIOTypeTroop",e[e.CMShowAIOTypeDiscussion=5]="CMShowAIOTypeDiscussion"}(t.CMShowAIOType||(t.CMShowAIOType={})),function(e){e[e.UIN_TYPE_FRIEND=1]="UIN_TYPE_FRIEND",e[e.UIN_TYPE_TROOP=4]="UIN_TYPE_TROOP",e[e.UIN_TYPE_DISCUSSION=5]="UIN_TYPE_DISCUSSION"}(t.AIO_TYPE||(t.AIO_TYPE={})),function(e){e[e.CMShowAIOStatusTypeNone=0]="CMShowAIOStatusTypeNone",e[e.CMShowAIOStatusTypePause=1]="CMShowAIOStatusTypePause",e[e.CMShowAIOStatusTypeResume=2]="CMShowAIOStatusTypeResume"}(t.CMShowAIOStatusType||(t.CMShowAIOStatusType={})),function(e){e.BKListenerCMD_SC_GameBox="sc.script_game_box_user_change.local",e.BKListenerCMD_SC_SpriteIsShow="sc.script_set_sprite_visibility.local",e.BKListenerCMD_SC_UserOperation="sc.script_notify_user_operation.local",e.BKListenerCMD_SC_ClickPart="sc.script_on_sprite_single_clicked.local",e.BKListenerCMD_SC_PanelStatus="sc.script_panel_status_change.local",e.BKListenerCMD_SC_DressReady="sc.script_notify_dress_ready.local",e.BKListenerCMD_SC_UserDressOrStatus="sc.script_user_dressOrStatus_changed.local",e.BKListenerCMD_SC_StopAllTask="sc.script_stop_all_task.local",e.BKListenerCMD_SC_AddBubble="sc.script_add_bubble.local",e.BKListenerCMD_SC_DrawAreaChange="sc.script_draw_area_change.local",e.BKListenerCMD_SC_ScreenSizeChange="sc.script_notify_screen_size_change.local"}(t.BKListenerCMD_SC||(t.BKListenerCMD_SC={})),function(e){e.CMShow3DSkeletonListenerNameLoadSkeleton="SkeletonLoad",e.CMShow3DSkeletonListenerNameAccessoryAdd="AccessoryAdd"}(t.CMShow3DSkeletonListenerName||(t.CMShow3DSkeletonListenerName={})),function(e){e[e.SpriteClickPartSprite=0]="SpriteClickPartSprite",e[e.SpriteClickPartBubble=1]="SpriteClickPartBubble",e[e.SpriteClickPartGift=2]="SpriteClickPartGift"}(t.SpriteClickPart||(t.SpriteClickPart={})),function(e){e[e.CMShowNotifyStatusGetDown=1]="CMShowNotifyStatusGetDown",e[e.CMShowNotifyStatusStandUp=2]="CMShowNotifyStatusStandUp",e[e.CMShowNotifyStatusHidden=3]="CMShowNotifyStatusHidden",e[e.CMShowNotifyStatusJumpDown=4]="CMShowNotifyStatusJumpDown"}(t.CMShowNotifyStatus||(t.CMShowNotifyStatus={})),function(e){e[e.SkeletonDirectionNone=-2]="SkeletonDirectionNone",e[e.SkeletonDirectionLeft=-1]="SkeletonDirectionLeft",e[e.SkeletonDirectionMiddle=0]="SkeletonDirectionMiddle",e[e.SkeletonDirectionRight=1]="SkeletonDirectionRight"}(t.SkeletonDirection||(t.SkeletonDirection={})),function(e){e[e.BubbleDirectionLeft=-1]="BubbleDirectionLeft",e[e.BubbleDirectionRight=1]="BubbleDirectionRight"}(t.BubbleDirection||(t.BubbleDirection={}))},function(e,t,o){"use strict";var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(t,"__esModule",{value:!0});var n=o(1),r=o(0),s=o(3),c=o(4);t.CMShowPlatformString_iOS="iOS",t.CMShowPlatformString_Android="android";var l=function(){function e(e,t,o){this.x=0,this.y=0,this.scale=0,this.x=e,this.y=t,this.scale=o}return e.TAG="CmBaseGlobalParam",e}(),p=function(e){function o(){var t=e.call(this,0,0,1)||this;return t.phoneModel="",t.osVersion="",t.aioPanelClose=!0,t.uin="",t.friendUin="",t.aioType=n.CMShowAIOType.CMShowAIOTypeNone,t.platform="",t.qqVer="",t.location=n.CMShowLocationType.CMShowLocationTypeAIO,t.loaction=n.LOCATION_TYPE.TYPE_AIO,t.drawWidth=0,t.drawHeight=0,t.viewWidth=0,t.viewHeight=0,t.screenW=0,t.screenH=0,t.timeScale=0,t.density=0,t.distance=0,t.functionMap={},t.defDress=new Array,t.defRole="",t.defAction2D={},t.defAction3D={},t.isCommInit=!1,t.isLoadSixScript=!1,t.adaptationScale=1,t.originScale=0,t.frameCount=0,t.fpsInfo={actionID:0,startTS:0,completeTS:0,frameCount:0},t.fpsStandard=20,t.needReportBubbleRect=!1,t.cmshowDebugTag=!0,t.otherScriptAudio=void 0,t.defRes3D={role3D:"",dress3D:new Array},t}return i(o,e),Object.defineProperty(o.prototype,"firstFrameRender",{get:function(){return BK.first_frame_render},set:function(e){BK.first_frame_render=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"width",{get:function(){return this.drawWidth},set:function(e){this.drawWidth=e,t.comGlobalParam.qqVer&&s.versionCompare(t.comGlobalParam.qqVer,"8.0.8")>0&&t.comGlobalParam.location===n.CMShowLocationType.CMShowLocationTypeAIO&&c.skeleManager.calculate2DHeightScale()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"vWidth",{get:function(){return this.viewWidth},set:function(e){this.viewWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"height",{get:function(){return this.drawHeight},set:function(e){this.drawHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"vHeight",{get:function(){return this.viewHeight},set:function(e){this.viewHeight=e},enumerable:!0,configurable:!0}),o.prototype.registerFunction=function(e,t){e?this.functionMap[e]=t:r.CMShowLog(1,o.TAG+"_registerFunction","method name is null or undefined!")},o.TAG="CmGlobalParam",o}(l);t.comGlobalParam=new p,t.drawerCommParam=new l(186,15,1),t.cardCommParam=new l(119,0,1),t.GameStatusInfo=t.GameStatusInfo||{},t.GameStatusInfo.QQVer=t.GameStatusInfo.QQVer||"7.9.0",BK.Script.renderMode=0,BK.Director.ticker=BK.Director.ticker||new BK.Ticker,t.registerFunction=function(e,o){t.comGlobalParam.registerFunction(e,o)},t.registerPlayerAudio=function(e){t.comGlobalParam.otherScriptAudio=e}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),i=o(1),n=o(0),r=o(8),s=o(5),c="CMShowScriptUtil",l=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];function p(e,t){return e<t?e:t}function h(e){var t=String(e);return t.replace(t.substr(2,4),"***")+"_"+(a.comGlobalParam?a.comGlobalParam.location:0)}t.versionCompare=function(e,t){try{for(var o=e.split("."),a=t.split("."),i=o.length,r=a.length,l=p(i,r),h=0;h<l;h++){if(parseInt(o[h])>parseInt(a[h]))return 1;if(parseInt(o[h])<parseInt(a[h]))return-1}return i-r}catch(e){n.CMShowLog(1,c+"_versionCompare",""+e),s.reportManager.reportErrorEvent(c+"_versionCompare, err:"+e,s.CmReportManager.Error_Code)}return 0},t.comMin=p,t.cutUin=h,t.getUinList=function(e){for(var t="",o=0;o<e.length;o++){0==o&&(t+="["),0!=o&&(t+=",");var a=String(e[o].uin);a.indexOf("#")>=0&&(a=a.substr(0,a.length-1)),t=t+'"'+a+'"',o==e.length-1&&(t+="]")}return t},t.getResPath=function(e,t,o,r){var s="",l="";switch(o){case i.CMShowResType.CMShowResTypeRole:l="Role://";break;case i.CMShowResType.CMShowResTypeDress:l="Dress://";break;case i.CMShowResType.CMShowResTypeAction:l="ActionRes://"}return e&&(s=0===e.indexOf("def")?e:l+e),t&&(a.comGlobalParam.platform===a.CMShowPlatformString_iOS&&-1===s.indexOf("def")&&(s+="/playRes"),s=s+"/"+t),n.CMShowLog(1,c+"_getResPath","path ret:"+s+", type:"+o+", model:"+r),s},t.getPetActionByPath=function(e){if(!e)return null;var t=e.lastIndexOf("/action");if(t<=0)return null;var o=e.substr(0,t);return e=o+"/script_rsc/pet/default/action"},t.checkAndComplete3DRes=function(e){var t={role:a.comGlobalParam.defRes3D.role3D,dress:a.comGlobalParam.defRes3D.dress3D};if(e["3DObject"]&&e["3DObject"].role&&e["3DObject"].dress)n.CMShowLog(0,c+"_checkAndComplete3DRes","uin:"+h(e.uin)+", 3d res is ok.");else{n.CMShowLog(1,c+"_checkAndComplete3DRes","uin:"+h(e.uin)+", 3d res need initial.");var o=null;e["3DObject"]&&e["3DObject"].faceModel&&(o=e["3DObject"].faceModel),t.faceModel=o,e["3DObject"]=t}},t.utf8ToUtf16=function(e){var t,o,a,i,n,r;for(t="",a=e.length,o=0;o<a;)switch((i=e.charCodeAt(o++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(o-1);break;case 12:case 13:n=e.charCodeAt(o++),t+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=e.charCodeAt(o++),r=e.charCodeAt(o++),t+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&r)<<0)}return t},t.base64Decode=function(e){var t,o,a,i,n,r,s;for(r=e.length,n=0,s="";n<r;){do{t=l[255&e.charCodeAt(n++)]}while(n<r&&-1==t);if(-1==t)break;do{o=l[255&e.charCodeAt(n++)]}while(n<r&&-1==o);if(-1==o)break;s+=String.fromCharCode(t<<2|(48&o)>>4);do{if(61==(a=255&e.charCodeAt(n++)))return s;a=l[a]}while(n<r&&-1==a);if(-1==a)break;s+=String.fromCharCode((15&o)<<4|(60&a)>>2);do{if(61==(i=255&e.charCodeAt(n++)))return s;i=l[i]}while(n<r&&-1==i);if(-1==i)break;s+=String.fromCharCode((3&a)<<6|i)}return s},t.getPosition=function(e,t){n.CMShowLog(0,c+"_getPosition","posIndex:"+e+", spriteNum:"+t+", width:"+a.comGlobalParam.width+", distance:"+a.comGlobalParam.distance);var o={x:0,y:0,aioposition:i.SkeletonDirection.SkeletonDirectionNone};return 1==t?(o.x=a.comGlobalParam.width/2,o.aioposition=i.SkeletonDirection.SkeletonDirectionMiddle):2==t?0==e?(o.x=a.comGlobalParam.width/2-a.comGlobalParam.distance/2*a.comGlobalParam.adaptationScale,o.aioposition=i.SkeletonDirection.SkeletonDirectionLeft):(o.x=a.comGlobalParam.width/2+a.comGlobalParam.distance/2*a.comGlobalParam.adaptationScale,o.aioposition=i.SkeletonDirection.SkeletonDirectionRight):o.x=0==e?a.comGlobalParam.width/4:1==e?a.comGlobalParam.width/2:3*a.comGlobalParam.width/4,o},t.getMasterByPetId=function(e){var t=e.indexOf("_"),o=e.substring(0,t);return r.findSprite(o)},t.calculateFPS=function(e,t){var o=0;return t>0&&e>0&&(o=e/t),n.CMShowLog(0,"calculateFPS","fps count:"+1/o),o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(2),n=o(0),r=o(3),s=o(10),c=o(8),l=o(11),p=o(9),h=o(7),S=o(6),m=o(12),u=o(5),d="CmSkeleManager",M=function(){function e(){this.isSpriteShow=!0,this.lastBlendShape=void 0,this.loadSpriteNum=0,this.aioStatus=a.CMShowAIOStatusType.CMShowAIOStatusTypeNone,this.alreadyInitSprite=!1,this.spriteStatus=a.CMShowActionStatus.CMShowActionStatusNone,this.spriteOriModel={},this.spriteDressInfo=[],this.seq=0,this.petOffSet=40,this.drawerNoRestore=!1,this.androidNeedRestore=!1,this.spriteList=new Array,this.destroyingList=new Array,this.restoreList=new Array,this.cmshow3DRect={width:50,height:200},this.cmshow2DRect={width:50,height:200},this.origin2DHeight=0,this.cmshow3DBubbleAIORect={width:80,height:100},this.cmshow3DBubbleDrawerRect={width:120,height:95},this.glviewIPhone7Rect={width:395.25,height:553.58},this.iPhone6_2DHeight=243,this.iPhone6_3DHeight=320,this.bubbleMessage={bubblePath:"",bubbleText:"",hasBubble:!1},this.actionTypeMap={}}return e.prototype.calculate3DRoleHeight=function(e){var t=0,o=0,n=0,r=0,s=1.35;i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer?(t=90*e*2,o=223*e*2,n=100*e*2,r=75*e*2):i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeFCard?(t=100*e*2,o=240*e*2):(t=40*e*2,o=80*e*2,s=4/3,this.glviewIPhone7Rect.height=this.glviewIPhone7Rect.width*s),this.cmshow3DRect.width=t*i.comGlobalParam.width/this.glviewIPhone7Rect.width,this.cmshow3DRect.height=o*(i.comGlobalParam.width*s)/this.glviewIPhone7Rect.height,this.cmshow3DBubbleDrawerRect.width=n*i.comGlobalParam.width/this.glviewIPhone7Rect.width,this.cmshow3DBubbleDrawerRect.height=r*(i.comGlobalParam.width*s)/this.glviewIPhone7Rect.height},e.prototype.calculate2DHeightScale=function(){this.calculate3DRoleHeight(1);var e=this.cmshow3DRect.height*this.iPhone6_2DHeight/this.iPhone6_3DHeight;if(this.cmshow2DRect.height=e,this.origin2DHeight>0&&e>0){var t=e/this.origin2DHeight;i.comGlobalParam.adaptationScale=t>0?t:1,n.CMShowLog(1,d+"_calculate2DHeightScale","adaptation:"+i.comGlobalParam.adaptationScale+", height:"+this.cmshow2DRect.height)}else n.CMShowLog(1,d+"_calculate2DHeightScale","error, origin2DHeight:"+this.origin2DHeight+", expectHeight:"+e+", 3DHeight:"+this.cmshow3DRect.height)},e.prototype.clearNoMatchedSprite=function(e){2===e.length&&e[0].uin===e[1].uin&&(e[1].uin=e[1].uin+"#");for(var t=!0,o=new Array,a=0;a<this.spriteList.length;a++){for(var i=this.spriteList[a],s=!1,l=0;l<e.length;l++){if(e[l].uin===i.uin){s=!0;break}}!1===s&&(n.CMShowLog(1,d+"_clearNoMatchedSprite","not found, remove:"+r.cutUin(i.uin)),o.push(i),t=!1)}this.spriteList.length!==e.length&&(t=!1);for(var p=0;p<o.length;p++)c.removeSprite(o[p],!0);return t},e.prototype.initActionCallBack=function(e){var o=this;if(e)n.CMShowLog(1,d+"_initActionCallBack","ani:"+r.cutUin(e.uin)),s.setStartCallBack(e,function(o,l,S){n.CMShowLog(1,d+"_initActionCallBack","start callback, "+e.model+", uin:"+r.cutUin(e.uin)+", taskId:"+l),i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&e.is2D()&&e.setOptions({opt:{autoRestore:!0}}),e.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusStart,t.skeleManager.actionTypeMap[l]=p.cmActionManager.lastBasicActionType;var m=t.skeleManager.actionTypeMap[l]?t.skeleManager.actionTypeMap[l]:a.CMShowBasicActionType.CMShowBasicActionTypeNone;l>=0&&m==a.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&(i.comGlobalParam.frameCount=0,i.comGlobalParam.fpsInfo.frameCount=0,i.comGlobalParam.fpsInfo.actionID=l,i.comGlobalParam.fpsInfo.startTS=Date.now(),i.comGlobalParam.fpsInfo.completeTS=0);var u=o.indexOf("3000059")>-1;if(!e.is2D()&&m===a.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&l>0&&!u&&i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&i.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend){for(var M=0;M<t.skeleManager.spriteList.length;M++){var C=t.skeleManager.spriteList[M];C.uin!==e.uin&&(C.hidden=!0,c.removeAccessory_2Dor3D(C,"Bubble",null),C.pet&&(C.pet.hidden=!0))}e.aioCache3DPosition=0,e.aioposition&&(e.aioposition>0?e.aioCache3DPosition=1:e.aioposition<0&&(e.aioCache3DPosition=-1)),e.aioposition=0}var g=e.curTask;if(g){if(g.startCnt++,1===g.startCnt)if(g.audio&&!g.playedAudio)if(g.audio.delayMill<100)if(h.isAllowPlayAudio().isAllowed){var w="ActionRes://"+g.audio.path;"android"==i.comGlobalParam.platform?g.player=new BK.Audio(1,w,1):g.player=new BK.Audio(1,w,1,1),g.player&&(g.player.startMusic(),g.playedAudio=!0)}l<0?s.onDefActStart(o,g,e):s.onNorActStart(o,g,e)}e.needMirror&&(e.setMirror(),e.needMirror=!1,e.hasMirror=!0),h.report3DSpriteRect(e)}),s.setCompleteCallBack(e,function(c,l,p){n.CMShowLog(1,d+"_initActionCallBack","complete, "+e.model+", uin:"+r.cutUin(e.uin)+", taskId:"+l);var S=t.skeleManager.actionTypeMap[l]?t.skeleManager.actionTypeMap[l]:a.CMShowBasicActionType.CMShowBasicActionTypeNone;if(i.comGlobalParam.fpsInfo.actionID===l&&S==a.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&(i.comGlobalParam.fpsInfo.completeTS=Date.now(),i.comGlobalParam.fpsInfo.frameCount=i.comGlobalParam.frameCount,i.comGlobalParam.fpsInfo.startTS>0&&i.comGlobalParam.fpsInfo.completeTS>i.comGlobalParam.fpsInfo.startTS)){var M=1/r.calculateFPS(i.comGlobalParam.fpsInfo.frameCount,i.comGlobalParam.fpsInfo.completeTS-i.comGlobalParam.fpsInfo.startTS);M<i.comGlobalParam.fpsStandard&&(u.reportManager.reportFPSTraceEvent({cmd:u.CmReportManager.NotifyCMD_CS_Trace_Begin,featureId:u.CmReportManager.Feature_FPS_ID,spanId:u.CmReportManager.Span_Fps_Report,msg:"trace Begin report fps error.",timeStamp:Date.now()}),u.reportManager.reportFPSTraceEvent({cmd:u.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,featureId:u.CmReportManager.Feature_FPS_ID,spanId:u.CmReportManager.Span_Fps_Report,msg:"span Begin report fps error.",timeStamp:Date.now()}),u.reportManager.reportFPSTraceEvent({cmd:u.CmReportManager.NotifyCMD_CS_Trace_Span_End,featureId:u.CmReportManager.Feature_FPS_ID,spanId:u.CmReportManager.Span_Fps_Report,msg:"actionName:"+c+", fps:"+M.toFixed(2)+", frameCount:"+i.comGlobalParam.fpsInfo.frameCount+", startTime:"+i.comGlobalParam.fpsInfo.startTS+", completeTime:"+i.comGlobalParam.fpsInfo.completeTS,result:u.CmReportManager.Fps_Error,timeStamp:Date.now()}))}if(h.report3DSpriteRect(e),i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&e.is2D()){var C=e.getSlotNames();if(C)for(var g=0;g<C.length;g++)"GIFT"===C[g]&&e.setOptions({opt:{autoRestore:!1}})}e.hasMirror&&!0===e.hasMirror&&(e.setMirror(),e.hasMirror=!1);var w=c.indexOf("3000059")>-1;if(!e.is2D()&&S===a.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&l>0&&!w&&i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&i.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend){for(var f=0;f<t.skeleManager.spriteList.length;f++){var y=t.skeleManager.spriteList[f];y.uin!==e.uin&&(y.hidden=!1,o.restoreOldSprite(y,!0),y.pet&&(y.pet.hidden=!1))}-100!==e.aioCache3DPosition&&(e.aioposition=e.aioCache3DPosition,e.aioCache3DPosition=-100)}e.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusComplete;var A=e.curTask;A&&(A.completeCnt++,l<0?s.onDefActComplete(c,A,e):s.onNorActComplete(c,A,e)),m.hasInit3DLib()&&BK.Director.forceGC&&BK.Director.forceGC()}),s.setEndCallBack(e,function(c,l,S){n.CMShowLog(1,d+"_initActionCallBack","end callback, "+e.model+", uin:"+r.cutUin(e.uin)+", taskId:"+l),i.comGlobalParam.fpsInfo.actionID===l&&(i.comGlobalParam.fpsInfo.startTS=0,i.comGlobalParam.fpsInfo.completeTS=0,i.comGlobalParam.fpsInfo.frameCount=0),h.report3DSpriteRect(e),e.hasMirror&&!0===e.hasMirror&&(e.setMirror(),e.hasMirror=!1);var u=t.skeleManager.actionTypeMap[l]?t.skeleManager.actionTypeMap[l]:a.CMShowBasicActionType.CMShowBasicActionTypeNone,M=c.indexOf("3000059")>-1;if(!e.is2D()&&u===a.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&l>0&&!M&&i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&i.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend){for(var C=0;C<t.skeleManager.spriteList.length;C++){var g=t.skeleManager.spriteList[C];g.uin!==e.uin&&(g.hidden=!1,g.pet&&(g.pet.hidden=!1))}-100!==e.aioCache3DPosition&&(e.aioposition=e.aioCache3DPosition,e.aioCache3DPosition=-100)}if(i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&c!==a.CMShowDefActionName.CMShowDefActionNameStandUp&&c!==a.CMShowDefActionName.CMShowDefActionNameGetDown){if(e.curTask&&e.curTask.taskId!==l){(w=p.cmActionManager.findTaskById(l))&&w.audio&&w.player&&(w.player.stopMusic(),w.player=null),h.notifyActionStatusChanged(l,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt),s.restoreAnimationState_2Dor3D(e),l>=0&&p.cmActionManager.removeTaskById(l,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt)}else{var w=e.curTask,f=!0;for(C=0;C<o.spriteList.length;C++)o.spriteList[C].uin===e.uin&&(f=!1);if(f&&o.restoreOldSprite(e,!1),h.notifyActionStatusChanged(l,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt),w&&(w.completeCnt===w.count||1===w.count)&&l>=0){for(var y=0;y<w.spriteArray.length;y++)s.restoreAnimationState_2Dor3D(w.spriteArray[y]);p.cmActionManager.removeTaskById(l,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt)}}m.hasInit3DLib()&&BK.Director.forceGC&&BK.Director.forceGC()}}),e.pet&&this.initPetCallBack(e.pet);else for(var l=0;l<this.spriteList.length;l++)this.initActionCallBack(this.spriteList[l])},e.prototype.initPetCallBack=function(e){e&&(n.CMShowLog(1,d+"_initPetCallBack","ani:"+r.cutUin(e.uin)),s.setStartCallBack(e,function(t,o){n.CMShowLog(1,d+"_initPetCallBack","start action ani:"+e.uin+", taskId:"+o),e.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusStart}),s.setCompleteCallBack(e,function(t,o){if(n.CMShowLog(1,d+"_initPetCallBack","complete action ani:"+e.uin+", taskId:"+o),e.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusComplete,i.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO)return o!==a.CMShowDefTaskID.CMShowDefTaskIDJumpUp&&s.restoreAnimationState_2Dor3D(e),void(S.isAllowStopSticker()&&BK.Director.ticker.setTimeout(function(){S.stopTicker(!1)},50,null));if(o===a.CMShowDefTaskID.CMShowDefTaskIDGetDown||o===a.CMShowDefTaskID.CMShowDefTaskIDStandUp)e.doGetDownOrStandUp=!1,o===a.CMShowDefTaskID.CMShowDefTaskIDStandUp&&(s.restoreAnimationState_2Dor3D(e),e.action=null),S.isAllowStopSticker()&&BK.Director.ticker.setTimeout(function(){S.stopTicker(!1)},50,null);else{if(!e.action)return;var c=e.action.actionId,l=r.getMasterByPetId(e.uin);if(e.action=null,!l)return;if(o===c)if(s.removeAccessoryAnimation_2Dor3D(e,t),s.restoreAnimationState_2Dor3D(e),l.status===a.CMShowActionStatus.CMShowActionStatusGetDown_Down||l.status===a.CMShowActionStatus.CMShowActionStatusGetDown){var p=e.actionGetDown;e.taskID=a.CMShowDefTaskID.CMShowDefTaskIDGetDown,BK.Director.ticker.setTimeout(function(){var t=r.cutUin(e.uin)+"_"+e.taskID;e.doGetDownOrStandUp=!0,s.setAccessoryAnimationByBuffer(e,p,t),s.setAnimation_2Dor3D(e,e.taskID,t,0)},50,e)}else S.isAllowStopSticker()&&BK.Director.ticker.setTimeout(function(){S.stopTicker(!1)},50,null)}}),s.setEndCallBack(e,function(t,o){n.CMShowLog(1,d+"_initPetCallBack","end action ani:"+e.uin+", taskId:"+o),o!==a.CMShowDefTaskID.CMShowDefTaskIDGetDown&&o!==a.CMShowDefTaskID.CMShowDefTaskIDStandUp||(e.doGetDownOrStandUp=!1)}))},e.prototype.clearCallback=function(){n.CMShowLog(1,d+"_clearCallback","clear all callback");for(var e=0;e<this.spriteList.length;e++){var t=this.spriteList[e];s.setStartCallBack(t,function(){}),s.setCompleteCallBack(t,function(){}),s.setEndCallBack(t,function(){}),n.CMShowLog(1,d+"_clearCallback","clear "+r.cutUin(t.uin)+" callback")}},e.prototype.changeSpriteTo2Dor3D=function(e){n.CMShowLog(1,d+"_changeSpriteTo2Dor3D","change sprite"),n.CMShowLog(0,d+"_changeSpriteTo2Dor3D","change sprite, json:"+JSON.stringify(e));for(var t=e.model,o=e.sprites,h=0,S=new Array,m=0;m<o.length;m++)if(o[m].action){var u=c.findSprite(o[m].uin);u&&o[m]&&(u.spriteData=o[m],r.checkAndComplete3DRes(u.spriteData)),h++,S.push(u)}else e.actionType===a.CMShowActionType.CMShowActionTypeWhiteFace&&S.push(c.findSprite(o[m].uin));if(e.actionType===a.CMShowActionType.CMShowActionTypeWhiteFace&&(h=i.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend?2:1),S.length<=0)n.CMShowLog(1,d+"_changeSpriteTo2Dor3D","actionPlayers is empty");else{n.CMShowLog(1,d+"_changeSpriteTo2Dor3D","action number:"+h+", actionModel:"+t+", actionPlayers length:"+S.length);for(m=0;m<h;m++){var M=S[m];if(M&&M.spriteData)if(M.adjustPosition&&(M.position={x:M.adjustPosition.x,y:M.adjustPosition.y,z:M.adjustPosition.z}),n.CMShowLog(0,d+"_changeSpriteTo2Dor3D","start change 2d to 3d"),M.model!==t){M.spriteData.model="2D"===M.model?"3D":"2D";var C=M.spriteData,g="2D"===M.spriteData.model?M.rotation2D:M.rotation;M.adjustPosition&&(M.position={x:M.adjustPosition.x,y:M.adjustPosition.y,z:M.adjustPosition.z});var w=M.position,f=this.getOldSprite(M.uin);if(M&&M.curTask){for(var y=M.curTask,A=0;A<y.spriteArray.length;A++){var D=y.spriteArray[A];if(s.removeAccessoryAnimation_2Dor3D(D,D.lastAction),D.curTask=null,1===h&&D.uin!==M.uin){var k=this.restoreOldSprite(D,!1),_=new l.CMShowActionTask({spriteArray:[k],repeatCnt:3});this.spriteStatus===a.CMShowActionStatus.CMShowActionStatusGetDown_Down?s.doWaitingAction(_):s.doThinkingAction(_)}}n.CMShowLog(1,d+"_changeSpriteTo2Dor3D","remove task:"+y.taskId),p.cmActionManager.removeTaskById(y.taskId,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt)}var b=null,T=!0;if(f&&f.model===C.model?(this.saveOldSprite(M),b=f):(this.saveOldSprite(M),r.checkAndComplete3DRes(C),b=c.loadSprite(C,w,g.y,!0),1===h&&b&&!0===this.bubbleMessage.hasBubble&&(c.setAccessoryWithInfo_2Dor3D(b,this.bubbleMessage.bubblePath,this.bubbleMessage.bubbleText,void 0),this.bubbleMessage.hasBubble=!1),b&&(T=!1)),!b)return void n.CMShowLog(1,d+"_changeSpriteTo2Dor3D","now ani is null, "+r.cutUin(C.uin));T&&(b.uin=C.uin,b.extendString=b.uin,b.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusComplete,b.hidden=!0,c.addSprite(b))}else n.CMShowLog(0,d+"_changeSpriteTo2Dor3D","model is equal, uin:"+r.cutUin(M.uin))}}},e.prototype.restoreOldSprite=function(e,o){if(this.drawerNoRestore)return n.CMShowLog(1,d+"_restoreOldSprite","drawer play 3D action, but model is 2D"),e;if(!this.isValidAni(e))return n.CMShowLog(1,d+"_restoreOldSprite","ani:"+r.cutUin(e.uin)+", model:"+e.model+", is invalid, return"),e;if(n.CMShowLog(1,d+"_restoreOldSprite","ani:"+r.cutUin(e.uin)+", model:"+e.model+", oriModel:"+this.spriteOriModel[e.uin]),this.spriteOriModel[e.uin]===e.model){for(var l=0;l<this.restoreList.length;l++)this.restoreList[l].uin===e.uin&&this.restoreList.splice(l,1);return e}var p=this.getOldSprite(e.uin);if(p){if(n.CMShowLog(1,d+"_restoreOldSprite","uin:"+r.cutUin(e.uin)+", restore old sprite"),p.position={x:e.position.x,y:e.position.y,z:e.position.z},p.is2D()){if(p.rotation={x:0,y:e.rotation2D.y,z:0},p.pet&&p.is2D()){var S=t.skeleManager.petOffSet;180===p.rotation.y&&(S*=-1),p.pet.position={x:p.position.x+S,y:p.position.y,z:p.position.z},p.pet.rotation={x:0,y:p.rotation.y,z:0},p.pet.nameplate&&p.is2D()&&(BK.Director.root.removeChild(p.pet.nameplate),p.nameplate.text&&BK.Director.root.removeChild(p.pet.nameplate.text)),p.spriteData&&p.spriteData.pet.nickname&&c.setAccessoryWithInfo_2Dor3D(p.pet,p.spriteData.pet.nameplate,p.spriteData.pet.nickname,void 0)}if(p.spriteData){var m=void 0!==p.spriteData.pet&&void 0!==p.spriteData.pet.standUp&&void 0!==p.spriteData.pet.getDown&&p.spriteData.pet.standUp.length>0&&p.spriteData.pet.getDown.length>0;c.loadNamePlate(p,p.spriteData,p.position,p.rotation.y,m)}}else{var u=0;i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&(e.position.x<i.comGlobalParam.width/2?u=a.SkeletonDirection.SkeletonDirectionLeft:e.position.x>i.comGlobalParam.width/2&&(u=a.SkeletonDirection.SkeletonDirectionRight)),p.aioposition=u}if(e.hidden=!0,e.curTask=null,c.removeSprite(e,!0),h.report3DSpriteRect(e),p.is2D()?(void 0!==o&&!0===o||!p?p&&(p.hidden=!1):s.playSmoke(p,!0),p.pet&&(p.pet.hidden=!1),p.nameplate&&(p.nameplate.text&&(p.nameplate.text.hidden=!1),p.nameplate.hidden=!1)):BK.Director.ticker.setTimeout(function(){void 0!==o&&!0===o||!p?p&&(p.hidden=!1):s.playSmoke(p,!0)},200,null),i.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&i.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend&&(e.is2D()&&e.nameplate&&(BK.Director.root.removeChild(e.nameplate),e.nameplate.text&&BK.Director.root.removeChild(e.nameplate.text)),!p.is2D()&&p.spriteData&&p.spriteData.nameplate)){var M=r.getResPath(p.spriteData.nameplate+".png",null,a.CMShowResType.CMShowResTypeDress,"3D"),C=1;void 0!==p.aioposition&&p.aioposition<0&&(C=-1),0===p.aioposition&&i.comGlobalParam.uin!==p.uin&&(C=-1);var g=r.utf8ToUtf16(r.base64Decode(p.spriteData.nickname));p.show3DNamePlate({content:g,imagePath:M,isVip:p.isVip,direction:C})}return n.CMShowLog(1,d+"_restoreOldSprite","restore old sprite success, uin:"+r.cutUin(p.uin)),c.addSprite(p),p}return n.CMShowLog(1,d+"_restoreOldSprite","not find old ani, uin:"+r.cutUin(e.uin)),null},e.prototype.saveOldSprite=function(e){n.CMShowLog(1,d+"_saveOldSprite","save sprite, uin:"+e.uin),e.is2D()?(BK.Director.ticker.setTimeout(function(){s.playSmoke(e,!1)},200,null),e.pet&&(e.pet.hidden=!0),e.nameplate&&(e.nameplate.text&&(e.nameplate.text.hidden=!0),e.nameplate.hidden=!0)):s.playSmoke(e,!1),e.is2D()||e.hide3DNamePlate(),e.hidden=!0;for(var t=0;t<this.restoreList.length;t++)if(e.uin===this.restoreList[t].uin)return void n.CMShowLog(1,d+"_saveOldSprite","have "+r.cutUin(e.uin)+", return");for(var o=0;o<this.spriteList.length;o++)if(this.spriteList[o].uin===e.uin){n.CMShowLog(1,d+"_saveOldSprite","find "+r.cutUin(e.uin)+", delete from list"),this.spriteList.splice(o,1);break}this.restoreList.push(e)},e.prototype.getOldSprite=function(e){n.CMShowLog(1,d+"_getOldSprite","get old sprite, uin:"+r.cutUin(e));for(var t=0;t<this.restoreList.length;t++){var o=this.restoreList[t];if(o.uin===e)return this.restoreList.splice(t,1),o}return null},e.prototype.isValidAni=function(e){for(var t=0;t<this.spriteList.length;t++)if(this.spriteList[t].uin===e.uin&&this.spriteList[t].model===e.model)return!0;return!1},e.SkeletonResName="skeleton.bin",e.DressResName="dress.bin",e.SkinResName="skin.png",e}();t.CmSkeleManager=M,t.res2DMap={},t.skeleManager=new M},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),i=o(0),n=o(13),r="CmReportManager",s=function(){function e(){this.roleIdArray={},this.dressIdArray={},this.needNotifyDressReady=!1,this.alreadyLoadSprite=0,this.reportEnd=!1,this.dressNum=0,this.roleNum=0}return e.prototype.reportTraceEvent=function(o){var n="report trace event: cmd: "+o.cmd+" spanId: "+o.spanId+" msg: "+o.msg+" errCode: "+o.result+" timeStamp: "+o.timeStamp;if(i.CMShowLog(0,r,n),!t.reportManager.reportEnd){o.cmd===e.NotifyCMD_CS_Trace_End&&(t.reportManager.reportEnd=!0);var s=a.comGlobalParam.platform===a.CMShowPlatformString_iOS?50:0,c={featureId:(o.featureId?o.featureId:a.comGlobalParam.location+1)+s,featureName:"",spanId:o.spanId,spanName:"",msg:o.msg,spanDesc:o.spanDesc,errCode:o.result,timestamp:o.timeStamp};BK.MQQ.Native.syncSend(c,o.cmd)}},e.prototype.reportFPSTraceEvent=function(e){var t="report trace event: cmd: "+e.cmd+" spanId: "+e.spanId+" msg: "+e.msg+" errCode: "+e.result+" timeStamp: "+e.timeStamp;i.CMShowLog(0,r,t);var o=a.comGlobalParam.platform===a.CMShowPlatformString_iOS?50:0,n={featureId:(e.featureId?e.featureId:a.comGlobalParam.location+1)+o,featureName:"",spanId:e.spanId,spanName:"",msg:e.msg,spanDesc:e.spanDesc,errCode:e.result,timestamp:e.timeStamp};BK.MQQ.Native.syncSend(n,e.cmd)},e.prototype.reportErrorEvent=function(t,o){var s=t;o!==e.SkeAni_Pet_Undefined_Error&&o!==e.SkeAni_Undefined_Error&&o!==e.Data_Unusual_Error&&o!==e.Error_Code||(s=t+" stack:{"+new Error("msg").stack+"}");var c="report error trace event, msg:"+(s=s+" version:"+n.CMSHOW_SCRIPT_VERSION+"_newScript")+", errorCode:"+o;i.CMShowLog(0,r,c);var l={featureId:a.comGlobalParam.location+1,featureName:"",spanId:e.Span_Load_Error,spanName:"",msg:s,errCode:o,timestamp:Date.now()};BK.MQQ.Native.syncSend(l,e.NotifyCMD_CS_Trace_Span_End)},e.NotifyCMD_CS_Trace_Begin="cs.trace_begin.local",e.NotifyCMD_CS_Trace_End="cs.trace_end.local",e.NotifyCMD_CS_Trace_Span_Begin="cs.trace_span_begin.local",e.NotifyCMD_CS_Trace_Span_End="cs.trace_span_end.local",e.NotifyCMD_CS_Trace_Log="cs.trace_log.local",e.Span_Load_Engine=400,e.Span_Load_Role=500,e.Span_Load_Accessory=600,e.Span_First_Render_Time=800,e.Span_Load_Error=1e3,e.Span_Fps_Report=2e3,e.Result_Succ=0,e.Result_Fail=1,e.Error_Code=50,e.Parse_Json_Error=51,e.SkeAni_Undefined_Error=52,e.SkeAni_Pet_Undefined_Error=53,e.Data_Unusual_Error=54,e.Func_Not_Found_Error=55,e.Read_File_Error=56,e.Load_CM3D_Error=57,e.Fps_Error=112,e.Feature_FPS_ID=4,e}();t.CmReportManager=s,t.reportManager=new s,BK.reportTraceEnd=function(){i.CMShowLog(0,"reportTraceEnd","enter report trace end"),t.reportManager.reportTraceEvent({cmd:s.NotifyCMD_CS_Trace_Span_End,spanId:s.Span_First_Render_Time,msg:"First Frame Render,End",timeStamp:Date.now()}),t.reportManager.reportTraceEvent({cmd:s.NotifyCMD_CS_Trace_End,spanId:0,msg:"load Sprite over!",result:s.Result_Succ,timeStamp:Date.now()}),!0!==a.comGlobalParam.firstFrameRender&&(a.comGlobalParam.firstFrameRender=!0)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),i=o(1),n=o(3),r=o(4),s=o(12),c=0;function l(){for(var e=0;e<r.skeleManager.spriteList.length;e++){var t=r.skeleManager.spriteList[e];if(t.actionStatus===i.CMShowCompletionStatus.CMShowCompletionStatusStart)return a.CMShowLog(1,"isAllowStopSticker","return false, ani:"+n.cutUin(t.uin)),!1;if(t.pet&&t.pet.actionStatus===i.CMShowCompletionStatus.CMShowCompletionStatusStart)return a.CMShowLog(1,"isAllowStopSticker","return false, pet:"+n.cutUin(t.uin)),!1}return a.CMShowLog(1,"isAllowStopSticker","return true"),!0}t.startTicker=function(){BK.Director.ticker&&(BK.Director.ticker.interval=1,BK.Director.ticker.paused=!1),renderTicker&&!s.hasInit3DLib()&&(renderTicker.interval=1,renderTicker.paused=!1),BK.Director.tickerSetInterval(2),BK.Director.tickerResume?BK.Director.tickerResume():a.CMShowLog(1,"startTicker","BK.Director.tickerResume is not exist."),c=0,window.cm3d&&(a.CMShowLog(1,"startTicker","3d start ticker!"),window.cm3d.startTicker()),a.CMShowLog(1,"startTicker","start ticker!")},t.stopTicker=function(e){(e||l())&&(BK.Director.ticker&&(BK.Director.ticker.paused=!0),renderTicker&&(renderTicker.paused=!0),BK.Director.tickerPause?BK.Director.tickerPause():a.CMShowLog(1,"stopTicker","BK.Director.tickerResume is not exist."),c=1,this.isInit3DLib&&BK.Director.forceGC&&(BK.Director.forceGC(),a.CMShowLog(0,"stopTicker","force GC!")),a.CMShowLog(1,"stopTicker","stop ticker!"))},t.getTickerStatus=function(){return c},t.isAllowStopSticker=l,t.addFrame=function(){renderTicker.paused&&(s.hasInit3DLib()?cm3d.addFrame():BK.Director.root&&(BK.Render.clear(0,0,0,0),BK.Render.treeRender(BK.Director.root,0),BK.Render.commit(),a.CMShowLog(1,"addFrame","add last frame!!")))}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(5),i=o(3),n=o(0),r=o(1),s=o(2),c=o(4),l="CmDefReport",p="cs.script_action_apollo_click.local",h="cs.script_action_status_notify.local",S="cs.script_play_action.local",m="cs.script_change_panel_status.local",u="cs.script_sprite_status_change.local",d="cs.script_sprite_model_change_notify.local",M="cs.script_show_toast.local",C="cs.script_get_show_action.local",g="cs.script_get_config.local",w="cs.script_send_action_msg.local",f="cs.script_get_dress_data.local",y="cs.script_is_allow_play_audio.local",A="cs.get_cm3D_state.local",D="cs.script_show_barrage.local";function k(e,t){n.CMShowLog(1,l+"_getPetActionPath"," get pet action: "+i.cutUin(e.uin));var o=[];o.push(e);var a=i.getUinList(o),r=C,s="["+t+"]";n.CMShowLog(1,l+"_getPetActionPath"," get pet action id: "+s);var c={cmd:r,uinList:a,type:1,actionList:s},p=BK.MQQ.Native.syncSend(c,r);if(!p)return n.CMShowLog(1,l+"_getPetActionPath"," get pet action error, actionId: "+s),null;if(!p.path)return n.CMShowLog(1,l+"_getPetActionPath"," get pet action path error, actionId: "+s),null;var h=p.path;if(h.length<=0)return n.CMShowLog(1,l+"_getPetActionPath"," actionList is empty, actionId: "+s),null;var S=h[0];if(S.petPath){var m=S.petPath;return m.length>0?m[0]:null}return n.CMShowLog(1,l+"_getPetActionPath"," get petPath error, actionId: "+s),null}t.notifyTerminalClickInfo=function(e,t,o){n.CMShowLog(0,l+"_notifyTerminalClickInfo","msgSign:"+e+",apolloIdï¼š"+t+",status:"+o);var a=p,i={from:s.comGlobalParam.location,clickPart:e,apolloId:t,apolloStatus:o};BK.MQQ.Native.syncSend(i,a)},t.notifySpriteDoAction=function(){n.CMShowLog(1,l+"_notifySpriteDoAction","request play action!");var e=S,t={from:s.comGlobalParam.location,uinList:i.getUinList(c.skeleManager.spriteList)};BK.MQQ.Native.syncSend(t,e)},t.notifyActionStatusChanged=function(e,t){n.CMShowLog(0,l+"_notifyActionStatusChanged","msgSign:"+e+",status:"+t);var o=h,a={cmd:o,taskId:e,status:t};BK.MQQ.Native.syncSend(a,o)},t.notifyChangePanelStatus=function(e){n.CMShowLog(1,l+"_notifyChangePanelStatus"," status:"+e);var t=m,o={cmd:t,status:e};BK.MQQ.Native.syncSend(o,t)},t.notifySpriteStatusChanged=function(e){n.CMShowLog(1,l+"_notifySpriteStatusChanged"," status:"+e);var t=0;c.skeleManager.origin2DHeight>0&&c.skeleManager.cmshow2DRect.height>0&&(t=c.skeleManager.cmshow2DRect.height-c.skeleManager.origin2DHeight);for(var o=0;o<c.skeleManager.spriteList.length;o++)if(!c.skeleManager.spriteList[o].is2D()){t=c.skeleManager.cmshow3DRect.height-c.skeleManager.cmshow2DRect.height;break}0!==c.skeleManager.cmshow3DRect.height&&0!==c.skeleManager.cmshow2DRect.height&&0!==s.comGlobalParam.width||(t=0,n.CMShowLog(1,l+"_notifySpriteStatusChanged","height or width is 0, whiteHeight = 0"));var a=u,i={cmd:a,status:e,whiteHeight:t};BK.MQQ.Native.syncSend(i,a)},t.notifySpriteDressReady=function(){n.CMShowLog(1,l+"_notifySpriteDressReady"," dressReady");var e=d,t={cmd:e};BK.MQQ.Native.syncSend(t,e),a.reportManager.needNotifyDressReady=!1},t.notifyTerminalShowToast=function(e){n.CMShowLog(1,l+"_notifyTerminalShowToast"," content: "+e);var t=M,o={cmd:t,text:e};BK.MQQ.Native.syncSend(o,t)},t.getShowActionRes=function(){try{var e=i.getUinList(c.skeleManager.spriteList),t=C,o={cmd:t,uinList:e,type:0};return BK.MQQ.Native.syncSend(o,t)}catch(e){return n.CMShowLog(1,l+"_getShowActionRes"," error: "+e),a.reportManager.reportErrorEvent(l+"_getShowActionRes "+e,a.CmReportManager.Error_Code),null}},t.getPetActionPath=k,t.getPetAction=function(e,t){if(n.CMShowLog(1,l+"_getPetAction"," get action :"+i.cutUin(e.uin)+"|"+t),!e.pet)return null;if(!e.pet.actionSet||e.pet.actionSet.length<=0){var o=g,a={cmd:o,config_name:"pet"},r=BK.MQQ.Native.syncSend(a,o);if(!r)return n.CMShowLog(1,l+"_getPetAction"," get actionConfig error"),null;if(!r.petConfig)return n.CMShowLog(1,l+"_getPetAction"," get petConfig error"),null;for(var s=r.petConfig,c=0;c<s.length;c++){var p=s[c];p.roleId===e.pet.roleId&&(e.pet.actionSet=p.petActionSet,p.petStateMapping&&(e.pet.actionArray=p.petStateMapping[0].actionSet))}}if(t)return n.CMShowLog(1,l+"_getPetAction","only get config, onlyGetConfig:"+t),null;var h={path:"",actionId:0,relatedActions:null};if(!e.pet.actionSet)return null;e.pet.action?e.pet.action.relatedActions&&(c=Math.floor(Math.random()*(e.pet.action.relatedActions.length-1)),h.actionId=e.pet.action.relatedActions[c]):(c=Math.floor(Math.random()*(e.pet.actionArray.length-1)),h.actionId=e.pet.actionArray[c]);if(!h.actionId)return null;for(c=0;c<e.pet.actionSet.length;c++)e.pet.actionSet[c].actionId===h.actionId&&(h=e.pet.actionSet[c]);return h.path=k(e,h.actionId),h.path&&h.path.length>0?h:null},t.sendActionMsg=function(e,t){var o,i=w;if(t&&t.length>0)try{o=JSON.parse(t)}catch(e){n.CMShowLog(1,l+"_sendActionMsg"," parse json error:"+e+",json:"+t),a.reportManager.reportErrorEvent(l+"_sendActionMsg "+e,a.CmReportManager.Parse_Json_Error)}var r={cmd:i,basicMsg:e,extendJson:o};BK.MQQ.SsoRequest.send(r,i)},t.getDressRes=function(e){n.CMShowLog(1,l+"_getDressRes"," get dress res");var t=f,o={cmd:t,uinList:e};BK.MQQ.SsoRequest.send(o,t)},t.isAllowPlayAudio=function(){n.CMShowLog(0,l+"_isAllowPlayAudio"," get allow play audio");var e=y,t={cmd:e};return BK.MQQ.Native.syncSend(t,e)},t.get3Dstatus=function(){var e=A,t={cmd:e};return BK.MQQ.Native.syncSend(t,e)},t.showOrRemoveActionBarrage=function(e,t,o){n.CMShowLog(1,l+"_showOrRemoveActionBarrage"," taskId:"+o+",toggle:"+e+",text:"+t);var a=D,i={cmd:a,isShow:e?1:0,text:t};BK.MQQ.Native.syncSend(i,a)},t.reportTraceEndEvent=function(){n.CMShowLog(0,"reportTraceEndEvent","do report trace end function in CmDefReport"),s.comGlobalParam.location===r.CMShowLocationType.CMShowLocationTypeAIO&&s.comGlobalParam.aioType!==r.CMShowAIOType.CMShowAIOTypeFriend&&a.reportManager.reportTraceEvent({cmd:a.CmReportManager.NotifyCMD_CS_Trace_End,spanId:0,msg:"",result:a.CmReportManager.Result_Succ,timeStamp:Date.now()})},t.report3DSpriteRect=function(e){if(e.is2D())n.CMShowLog(1,l+"_report3DSpriteRect","ani is 2d, report zero"),e.pushBoundingBoxChange({x:0,y:0,w:0,h:0,bX:0,bY:0,bW:0,bH:0,dispose:0});else{var t=void 0,o=void 0,a=void 0,i=void 0,p=void 0,h=void 0,S=void 0,m=void 0,u=e.position.x;switch(e.status){case r.CMShowActionStatus.CMShowActionStatusStandUp:case r.CMShowActionStatus.CMShowActionStatusStandUp_Down:case r.CMShowActionStatus.CMShowActionStatusThinking:t=u-c.skeleManager.cmshow3DRect.width/2,o=e.position.y,a=c.skeleManager.cmshow3DRect.width,i=c.skeleManager.cmshow3DRect.height,h=o+.3*c.skeleManager.cmshow3DRect.height;break;case r.CMShowActionStatus.CMShowActionStatusGetDown:case r.CMShowActionStatus.CMShowActionStatusGetDown_Down:case r.CMShowActionStatus.CMShowActionStatusWait:t=u-c.skeleManager.cmshow3DRect.width/2,o=e.position.y,a=c.skeleManager.cmshow3DRect.width,i=c.skeleManager.cmshow3DRect.height/3,h=o,m=.4*c.skeleManager.cmshow3DBubbleAIORect.height*s.comGlobalParam.density;break;case r.CMShowActionStatus.CMShowActionStatusJumpUp:t=s.comGlobalParam.width-c.skeleManager.cmshow3DRect.width,o=e.position.y+c.skeleManager.cmshow3DRect.height/3,a=c.skeleManager.cmshow3DRect.width,i=.65*c.skeleManager.cmshow3DRect.height;break;case r.CMShowActionStatus.CMShowActionStatusJumpDown:t=s.comGlobalParam.width/2,o=e.position.y,a=s.comGlobalParam.width/2-20*s.comGlobalParam.density,i=c.skeleManager.cmshow3DRect.height,h=o+.3*c.skeleManager.cmshow3DRect.height;break;default:t=u-c.skeleManager.cmshow3DRect.width/2,o=e.position.y,a=c.skeleManager.cmshow3DRect.width,i=c.skeleManager.cmshow3DRect.height,h=o+.3*c.skeleManager.cmshow3DRect.height}s.comGlobalParam.location!==r.CMShowLocationType.CMShowLocationTypeFCard&&(s.comGlobalParam.location===r.CMShowLocationType.CMShowLocationTypeDrawer?(p=t-(c.skeleManager.cmshow3DBubbleDrawerRect.width-.35*c.skeleManager.cmshow3DRect.width),h=o+i-.1*c.skeleManager.cmshow3DBubbleDrawerRect.height,S=c.skeleManager.cmshow3DBubbleDrawerRect.width,m=c.skeleManager.cmshow3DBubbleDrawerRect.height):(p=s.comGlobalParam.location===r.CMShowLocationType.CMShowLocationTypeAIO&&void 0!==e.aioposition&&e.aioposition<0?t-(c.skeleManager.cmshow3DBubbleAIORect.width+5)*s.comGlobalParam.density:t+c.skeleManager.cmshow3DRect.width+5*s.comGlobalParam.density,S=c.skeleManager.cmshow3DBubbleAIORect.width*s.comGlobalParam.density,void 0===m&&(m=.8*c.skeleManager.cmshow3DBubbleAIORect.height*s.comGlobalParam.density))),s.comGlobalParam.needReportBubbleRect||(p=0,h=0,S=0,m=0),e.pushBoundingBoxChange({x:t,y:o,w:a,h:i,bX:p,bY:h,bW:S,bH:m,dispose:0})}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(3),n=o(15),r=o(2),s=o(0),c=o(5),l=o(12),p=o(7),h=o(9),S=o(4),m="CmSkeleManager";function u(e,t,o,n){try{var l;if(r.comGlobalParam.qqVer&&i.versionCompare(r.comGlobalParam.qqVer,a.CMSHOW_3D_QQ_VERSION)<0&&(e.model="2D"),(l=g(e.uin))&&r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO){if(s.CMShowLog(1,m+"_loadSprite","find sprite, return"),l.rotation2D={x:0,y:o,z:0},l.position={x:t.x,y:t.y,z:t.z},l.adjustPosition=l.position,l.is2D()&&(l.rotation={x:0,y:o,z:0}),l.aioposition=t.aioposition,l.pet&&l.is2D()){var h=S.skeleManager.petOffSet;180===o&&(h*=-1),l.pet.position={x:t.x+h,y:t.y,z:t.z},l.pet.rotation={x:0,y:o,z:0},l.pet.nameplate&&l.is2D()&&(BK.Director.root.removeChild(l.pet.nameplate),l.nameplate.text&&BK.Director.root.removeChild(l.pet.nameplate.text)),e.pet.nickname&&_(l.pet,e.pet.nameplate,e.pet.nickname,void 0)}var u=void 0!==e.pet&&void 0!==e.pet.standUp&&void 0!==e.pet.getDown&&e.pet.standUp.length>0&&e.pet.getDown.length>0;return M(l,e,t,o,u),l}if(s.CMShowLog(1,m+"_loadSprite","load SkeletonAnimation"),!(l=C(P(e.uin,!1),e,o,0,t,!0)))return s.CMShowLog(1,m+"_loadSprite","SkeletonAnimation is null, return"),c.reportManager.reportErrorEvent("["+m+"_loadSprite], load skeAni error, uin:"+i.cutUin(e.uin),c.CmReportManager.SkeAni_Undefined_Error),null;l.extendString=e.uin,l.adjustPosition=l.position,l.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusComplete,l.rotate=o,l.hidden=n,l.openAABBCallback(),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&(r.comGlobalParam.platform===r.CMShowPlatformString_iOS&&(S.skeleManager.spriteDressInfo=e.dress),r.comGlobalParam.qqVer&&i.versionCompare(r.comGlobalParam.qqVer,a.CMSHOW_LOG_TOUCHEVENT_VERSION)>=0&&l.setOptions({opt:{autoRestore:!1}}));var f=l.is2D()?e.dress:e["3DObject"].dress;if(l.is2D()){for(var y=0;y<f.length;y++){var D=f[y];s.CMShowLog(1,m+"_loadSprite","path:"+D),A(l,D,!1)}c.reportManager.alreadyLoadSprite++,c.reportManager.needNotifyDressReady&&p.notifySpriteDressReady(),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.reportManager.roleIdArray[e.uin]+200,msg:e.model+"|"+i.cutUin(e.uin),spanDesc:""+e.uin,timeStamp:Date.now()})}else{l.dressNum=e["3DObject"].dress.length+1,c.reportManager.dressIdArray={},l.cmModel.on(a.CMShow3DSkeletonListenerName.CMShow3DSkeletonListenerNameAccessoryAdd,function(t){if(!l)return s.CMShowLog(1,m+"_loadSprite","add accessory callback, skeAni is null"),void c.reportManager.reportErrorEvent("["+m+"_loadSprite], accessoryAdd callBack,load skeAni error, uin:"+i.cutUin(e.uin),c.CmReportManager.SkeAni_Undefined_Error);c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.reportManager.dressIdArray[l.uin+t.tag],msg:"End",result:c.CmReportManager.Result_Succ,timeStamp:Date.now()}),0==--l.dressNum&&(c.reportManager.alreadyLoadSprite++,c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.reportManager.roleIdArray[e.uin]+200,msg:e.model+"|"+i.cutUin(e.uin),spanDesc:""+e.uin,timeStamp:Date.now()}),s.CMShowLog(1,m+"_loadSprite","alreadyLoadSprite:"+c.reportManager.alreadyLoadSprite+", loadSpriteNum:"+S.skeleManager.loadSpriteNum),c.reportManager.alreadyLoadSprite===S.skeleManager.loadSpriteNum&&(r.comGlobalParam.cmshowDebugTag?void 0===r.comGlobalParam.firstFrameRender&&(r.comGlobalParam.firstFrameRender=!1,c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:c.CmReportManager.Span_First_Render_Time,msg:"Data Ready, Begin render",timeStamp:Date.now()})):c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_End,spanId:0,msg:""+i.cutUin(e.uin),result:c.CmReportManager.Result_Succ,timeStamp:Date.now()})),c.reportManager.needNotifyDressReady&&p.notifySpriteDressReady())});for(y=0;y<f.length;y++){D=f[y];s.CMShowLog(1,m+"_loadSprite","path:"+D),A(l,D,!1)}s.CMShowLog(1,m+"_loadSprite","face path:"+l.facePath),l.facePath&&l.facePath.length>0&&k(l,l.facePath,!1,!0)}var b=void 0!==e.pet&&void 0!==e.pet.standUp&&void 0!==e.pet.getDown&&e.pet.standUp.length>0&&e.pet.getDown.length>0;return b&&l.is2D()?d(l,e.pet,t,o,n):s.CMShowLog(1,m+"_loadSprite","don't have pet"),M(l,e,t,o,b),w(l),s.CMShowLog(1,m+"_loadSprite","load sprite successfully!"),S.skeleManager.alreadyInitSprite=!0,l}catch(e){return s.CMShowLog(1,m+"_loadSprite","load sprite error:"+e),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.CmReportManager.Span_Load_Error,msg:m+"_loadSprite "+e,result:c.CmReportManager.Error_Code,timeStamp:Date.now()}),null}}function d(e,t,o,n,l){s.CMShowLog(1,m+"_loadPet","start load pet, uin:"+i.cutUin(e.uin));var h=S.skeleManager.petOffSet;180===n&&(h*=-1),t.model="2D";var u={x:o.x+h,y:o.y};t.xPos&&(u.x=t.xPos*r.comGlobalParam.density,r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&(u.x+=h),u.y=t.yPos*r.comGlobalParam.density);var d=C(P(e.uin,!0),t,n,0,u,!0);if(null===d)return s.CMShowLog(1,m+"_loadPet","load pet error! uin:"+i.cutUin(e.uin)),void c.reportManager.reportErrorEvent("["+m+"_loadPet], pet:"+e.uin+" is undefined",c.CmReportManager.SkeAni_Pet_Undefined_Error);for(var M=0;M<t.dress.length;M++)D(d,t.dress[M]);t.nickname&&_(d,t.nameplate,t.nickname,void 0),d.hidden=l,d.createPetInfo({masterUin:e.uin,petData:t}),d.openAABBCallback&&d.openAABBCallback(),e.pet=d,p.getPetAction(e,!0)}function M(e,t,o,n,c){if(e.nameplate&&e.is2D()&&(BK.Director.root.removeChild(e.nameplate),e.nameplate.text&&BK.Director.root.removeChild(e.nameplate.text)),e.is2D()||e.hide3DNamePlate(),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend)if(!t.nameplate||-1===t.nameplate.indexOf("/28/")&&-1===t.nameplate.indexOf("/30/")||(e.isVip=!0),e.is2D())!1===c?_(e,t.nameplate,t.nickname,void 0):b(e,t,o,n);else{if(!t.nameplate)return void s.CMShowLog(1,m+"_loadNamePlate","sprite data not have nameplate");var l=i.getResPath(t.nameplate+".png",null,a.CMShowResType.CMShowResTypeDress,"3D"),p=1;void 0!==e.aioposition&&e.aioposition<0&&(p=-1),0===e.aioposition&&r.comGlobalParam.uin!==e.uin&&(p=-1);var h=i.utf8ToUtf16(i.base64Decode(t.nickname));e.show3DNamePlate({content:h,imagePath:l,isVip:e.isVip,direction:p})}}function C(e,t,o,p,h,u){s.CMShowLog(0,m+"_loadRoleByBuffer","start load role, name:"+e+", spriteData:"+JSON.stringify(t)),c.reportManager.roleIdArray[t.uin]=c.CmReportManager.Span_Load_Role+c.reportManager.roleNum++;var d=t.scale?t.scale:r.comGlobalParam.scale;r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&(d=r.comGlobalParam.scale),t.model||(t.model="2D"),"3D"===t.model&&l.init3DLib(),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:c.reportManager.roleIdArray[t.uin]+200,msg:t.model+"|"+i.cutUin(t.uin),spanDesc:""+t.uin,timeStamp:Date.now()}),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:c.reportManager.roleIdArray[t.uin],msg:t.model+"|"+i.cutUin(t.uin)+",Begin",timeStamp:Date.now()}),s.CMShowLog(1,m+"_loadRoleByBuffer","load "+t.model+" role:"+("2D"===t.model?t.role:t["3DObject"].role));var M=new n.CMShowSkeletonAni({model:t.model,name:t.uin});if("2D"===t.model){var C=i.getResPath(t.role+".json",null,a.CMShowResType.CMShowResTypeRole,t.model),g=i.getResPath(t.role+".atlas",null,a.CMShowResType.CMShowResTypeRole,t.model),w=!1;S.res2DMap[C]&&S.res2DMap[C].length>0&&S.res2DMap[g]&&S.res2DMap[g].length>0&&(w=!0);var f=!1;if(f=w?M.load({jsonBuf:S.res2DMap[C],jsonPath:C,atlasBuf:S.res2DMap[g],atlasPath:g}):null==(M=new n.CMShowSkeletonAni({model:"2D",json:C,atlas:g,startCallBack:null,completeCallBack:null,endCallBack:null,name:t.uin})),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.reportManager.roleIdArray[t.uin],msg:t.role+"|End",spanDesc:""+t.role,result:f?c.CmReportManager.Result_Fail:c.CmReportManager.Result_Succ,timeStamp:Date.now()}),f)return s.CMShowLog(1,m+"_loadRoleByBuffer","load 2d fail ,uin:"+i.cutUin(t.uin)),null;M.timeScale=r.comGlobalParam.timeScale,M.scale={x:d,y:d,z:d},M.rotation={x:0,y:o,z:p},M.position={x:h.x,y:h.y,z:0},M.canUserInteract=!0,u&&(BK.Director.root.addChild(M),s.CMShowLog(0,m+"_loadRoleByBuffer","add role to root, name:"+e))}else{i.checkAndComplete3DRes(t);var y=i.getResPath(""+t["3DObject"].role,S.CmSkeleManager.SkeletonResName,a.CMShowResType.CMShowResTypeRole,t.model),A=i.getResPath(""+t["3DObject"].role,S.CmSkeleManager.DressResName,a.CMShowResType.CMShowResTypeRole,t.model),D=i.getResPath(""+t["3DObject"].role,S.CmSkeleManager.SkinResName,a.CMShowResType.CMShowResTypeRole,t.model);M.cmModel.on(a.CMShow3DSkeletonListenerName.CMShow3DSkeletonListenerNameLoadSkeleton,function(){c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.reportManager.roleIdArray[t.uin],msg:t["3DObject"].role+"|End",spanDesc:""+t["3DObject"].role,result:c.CmReportManager.Result_Succ,timeStamp:Date.now()})}),cm3d.addToScene(M.cmModel),M.load({path:y,skinPath:D}),M.position={x:h.x,y:h.y,z:0};var _=0;r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&(h.x<r.comGlobalParam.width/2?_=a.SkeletonDirection.SkeletonDirectionLeft:h.x>r.comGlobalParam.width/2&&(_=a.SkeletonDirection.SkeletonDirectionRight)),M.aioposition=_,M.rotation2D={x:0,y:o,z:p},M.facePath=A,S.skeleManager.calculate3DRoleHeight(1);var b=void 0,T=!1;t["3DObject"].faceModel&&(b=t["3DObject"].faceModel.path),(!b||b.length<=0)&&(b=y.replace("/skeleton.bin",""),T=!0),s.CMShowLog(1,m+"_loadRoleByBuffer","faceJson:"+b),k(M,b,!0,T)}return M&&(M.name=e,M.uin=t.uin,M.model=t.model,M.spriteData=t,S.skeleManager.spriteOriModel[t.uin]||(S.skeleManager.spriteOriModel[t.uin]=M.model)),M}function g(e){if(s.CMShowLog(0,m+"_findSprite","enter find sprite , uin:"+i.cutUin(e)+", sprites length:"+S.skeleManager.spriteList.length),S.skeleManager.spriteList.length<=0)return s.CMShowLog(1,m+"_findSprite","spritelist is empty"),null;for(var t=S.skeleManager.spriteList,o=0;o<t.length;o++){var a=t[o];if(a.uin===e)return s.CMShowLog(1,m+"_findSprite","find sprite, uin:"+i.cutUin(a.uin)),a}return s.CMShowLog(1,m+"_findSprite","sprite not exit, uin:"+i.cutUin(e)),null}function w(e){if(s.CMShowLog(0,m+"_addSprite","add sprite, uin:"+i.cutUin(e.uin)),S.skeleManager.spriteList.length>=a.CMSHOW_MAX_SPRITE_NUM){var t=y();t&&f(t,!0)}S.skeleManager.initActionCallBack(e),S.skeleManager.spriteList.push(e),r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend&&1===S.skeleManager.loadSpriteNum&&(s.CMShowLog(0,m+"_addSprite","reset sprite position"),T())}function f(e,t){if(s.CMShowLog(1,m+"_removeSprite","remove sprite, uin:"+i.cutUin(e.uin)+" sprites length:"+S.skeleManager.spriteList.length),e){e.curTask&&h.cmActionManager.removeTaskById(e.curTask.taskId,a.CMShowCompletionStatus.CMShowCompletionStatusNone),r.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend||e.is2D()||e.hide3DNamePlate();for(var o=null,n=0;n<S.skeleManager.spriteList.length;n++)if(S.skeleManager.spriteList[n].uin===e.uin){o=S.skeleManager.spriteList[n],S.skeleManager.spriteList.splice(n,1);break}t&&o&&S.skeleManager.destroyingList.push(o)}}function y(){for(var e=null,t=0;t<S.skeleManager.spriteList.length;t++)0===t?e=S.skeleManager.spriteList[t]:e&&S.skeleManager.spriteList[t].taskID<e.taskID&&(e=S.skeleManager.spriteList[t]);return e}function A(e,t,o){e.is2D()?D(e,t):k(e,t,o,!1)}function D(e,t){s.CMShowLog(1,m+"_setAccessoryByBuffer_2D","set 2D accessory");var o=i.getResPath(t+".json",null,a.CMShowResType.CMShowResTypeDress,"2D"),n=i.getResPath(t+".atlas",null,a.CMShowResType.CMShowResTypeDress,"2D");e.loadAccessory_2D(t,o,n)}function k(e,t,o,n){s.CMShowLog(1,m+"_setAccessoryByBuffer_3D","set 3D accessory:"+t+", isFace:"+o);var r=t;n||(r=i.getResPath(t,S.CmSkeleManager.DressResName,a.CMShowResType.CMShowResTypeDress,"3D"));var l=void 0;if(o){if(t)try{if(r=i.getResPath(t+"/face.json",null,a.CMShowResType.CMShowResTypeDress,"3D"),BK.FileUtil.isFileExist(r)){var p=BK.FileUtil.readFile(r).readAsString(!0);l=JSON.parse(p),S.skeleManager.lastBlendShape=l}else s.CMShowLog(1,m+"_setFace",r+" is not exist!")}catch(e){s.CMShowLog(1,m+"_setAccessoryByBuffer_3D","get blendShape error:"+e),c.reportManager.reportErrorEvent("[$"+m+"_setAccessoryByBuffer_3D] "+e,c.CmReportManager.Error_Code)}else-1===e.facePath.indexOf("def")&&(l=S.skeleManager.lastBlendShape);l&&e.setModelWeights(l),s.CMShowLog(0,m+"_setAccessoryByBuffer_3D","face:"+l)}else c.reportManager.dressIdArray[e.uin+r]=c.CmReportManager.Span_Load_Accessory+c.reportManager.dressNum++,c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:c.reportManager.dressIdArray[e.uin+r],msg:i.cutUin(e.uin)+",Begin,"+r,spanDesc:""+r,timeStamp:Date.now()}),e.setAccessory({path:r})}function _(e,t,o,n){if(s.CMShowLog(1,m+"_setAccessoryWithInfo_2Dor3D","setAccessoryWithInfo, model:"+e.model),e.is2D()){var c=i.getResPath(t+".json",null,a.CMShowResType.CMShowResTypeDress,"2D"),l=i.getResPath(t+".atlas",null,a.CMShowResType.CMShowResTypeDress,"2D");e.setAccessoryWithInfo({model:"2D",jsonPath:c,atlasPath:l,content:o})}else{var p=i.getResPath(t+".png",null,a.CMShowResType.CMShowResTypeDress,"3D"),h=-1;r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&(void 0!==e.aioposition&&e.aioposition>=0&&(h=1),n&&(h=n),o=i.utf8ToUtf16(i.base64Decode(o))),s.CMShowLog(1,m+"_setAccessoryWithInfo","content:"+o),r.comGlobalParam.needReportBubbleRect=!0,e.setAccessoryWithInfo({model:"3D",image:p,direction:h,text:o,needMirror:e.needMirror||e.hasMirror})}}function b(e,t,o,n){if(e.is2D()){var l=e.isVip;try{s.CMShowLog(1,m+"_setAccessoryWithInfoHasOffset","uin:"+i.cutUin(e.uin)+", namePlate:"+t.nameplate);var p=80*r.comGlobalParam.density,h=new BK.Texture(t.nameplate+".png"),u=new BK.Sprite(h.size.width*r.comGlobalParam.scale,h.size.height*r.comGlobalParam.scale,h,0,1,1,1);u.name=e.name+"_nameplate",BK.Director.root.addChild(u);var d=-1!==t.nameplate.indexOf("/28/")?44*r.comGlobalParam.scale:171*r.comGlobalParam.scale;e.namePlateWidth=h.size.width*r.comGlobalParam.scale,e.namePlateWidth=e.isVip?e.namePlateWidth-d:e.namePlateWidth;var M=l?u.size.height+2*r.comGlobalParam.density:7*r.comGlobalParam.density;180===n&&(p*=-1),u.position={x:o.x+p,y:o.y+M},u.rotation={x:u.rotation.x,y:n,z:u.rotation.z};for(var C=l?4286075101:4294967295,g={fontSize:10*r.comGlobalParam.density,textColor:C,maxWidth:500,maxHeight:500,width:u.size.width,height:u.size.height,textAlign:0,bold:0,italic:0,strokeColor:4278190080,strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:4294967295},w=i.utf8ToUtf16(i.base64Decode(t.nickname)),f=new BK.Text(g,w),y=0,A=l?23*r.comGlobalParam.density:2*r.comGlobalParam.density,D=t.nameplate.split("/"),k=D[D.length-2],_=w.length,b=_;f.width>a.bubbleTextRect[k].width;)b--,w=w.substring(0,b),f=new BK.Text(g,w);b!=_&&b>2&&(w=w.substring(0,b-2),w+="â€¦",f=new BK.Text(g,w));var T=(a.bubbleTextRect[k].width-f.width)/2;y=0==n?A+T:-(A+a.bubbleTextRect[k].width)+T;f.position={x:u.position.x+y,y:u.position.y-4*r.comGlobalParam.density},u.text=f,BK.Director.root.addChild(f),e.nameplate=u;var P=e.getBoneNameBySlotName({model:"2D",slotName:"Bubble_Name"}),v=e.getBonePosition({model:"2D",boneName:P});M=0;var L={x:0,y:0},I={x:0,y:0};0===n?L={x:v.x-13*r.comGlobalParam.density,y:v.y+M}:I={x:v.x-13*r.comGlobalParam.density,y:v.y+M};for(var B={},G=0;G<S.skeleManager.spriteList.length;G++)S.skeleManager.spriteList[G].uin&&S.skeleManager.spriteList[G].uin.length>0&&(B[S.skeleManager.spriteList[G].uin]=0);BK.Director.ticker.add(function(){for(var e=0;e<S.skeleManager.spriteList.length;++e){var t=S.skeleManager.spriteList[e];if(t&&t.pet&&t.is2D()){var o=t.pet.rotation.y,a=t.getBoneNameBySlotName({model:"2D",slotName:"Bubble_Name"}),i=t.getBonePosition({model:"2D",boneName:a}),n=0,s=0;if(0==o?(n=i.x-L.x,s=i.y-L.y,L={x:i.x,y:i.y}):(n=i.x-I.x,s=i.y-I.y,I={x:i.x,y:i.y}),0!=n||0!=s){var c=t.nameplate;s=0,n*=r.comGlobalParam.scale,s*=r.comGlobalParam.scale,0!=o&&(n*=-1);var l=B[t.uin];if(t.isVip&&Math.abs(n-l)>5)break;if(B[t.uin]=n,c){var p={x:c.position.x+n,y:c.position.y+s},h={x:c.text.position.x+n,y:c.text.position.y+s},m=S.skeleManager.spriteList.length>1?100:70;if(0===o){if(p.x+t.namePlateWidth>=r.comGlobalParam.width){var u=p.x;p={x:r.comGlobalParam.width-t.namePlateWidth,y:c.position.y+s},h={x:h.x-(u-p.x),y:c.text.position.y+s}}else if(p.x<=r.comGlobalParam.width/2+m*r.comGlobalParam.density){u=p.x;p={x:r.comGlobalParam.width/2+m*r.comGlobalParam.density,y:c.position.y+s},h={x:h.x+(p.x-u),y:c.text.position.y+s}}}else if(p.x-t.namePlateWidth<=0){u=p.x;p={x:t.namePlateWidth,y:c.position.y+s},h={x:h.x+(p.x-u),y:c.text.position.y+s}}else if(p.x>=r.comGlobalParam.width/2-m*r.comGlobalParam.density){u=p.x;p={x:r.comGlobalParam.width/2-m*r.comGlobalParam.density,y:c.position.y+s},h={x:h.x-(u-p.x),y:c.text.position.y+s}}c.position=p,c.text.position=h}}}}})}catch(e){s.CMShowLog(1,m+"_setAccessoryWithInfoHasOffset","error:"+e),c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:c.CmReportManager.Span_Load_Error,msg:e,result:c.CmReportManager.Error_Code,timeStamp:Date.now()})}}}function T(){if(r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend)for(var e=0;e<S.skeleManager.spriteList.length;e++){var t=S.skeleManager.spriteList[e],o=i.getPosition(e,S.skeleManager.spriteList.length),n=o.x-t.position.x;if(t.is2D())t.position={x:o.x,y:o.y},t.pet&&(t.pet.position={x:t.pet.position.x+n,y:t.pet.position.y}),t.nameplate&&(t.nameplate.position={x:t.nameplate.position.x+n,y:t.nameplate.position.y},t.nameplate.text&&(t.nameplate.text.position={x:t.nameplate.text.position.x+n,y:t.nameplate.text.position.y}));else{var s=0,c=o.x;if(c<r.comGlobalParam.width/2?s=-1:c>r.comGlobalParam.width/2&&(s=1),t.aioposition=s,t.spriteData&&t.spriteData.nameplate){var l=i.getResPath(t.spriteData.nameplate+".png",null,a.CMShowResType.CMShowResTypeDress,"3D"),p=1;void 0!==t.aioposition&&t.aioposition<0&&(p=-1),0===t.aioposition&&r.comGlobalParam.uin!==t.uin&&(p=-1);var h=i.utf8ToUtf16(i.base64Decode(t.spriteData.nickname));t.show3DNamePlate({content:h,imagePath:l,isVip:t.isVip,direction:p})}}}}function P(e,t){var o=e;return t&&(o+="_pet"),r.comGlobalParam.qqVer&&i.versionCompare(r.comGlobalParam.qqVer,a.CMSHOW_LOG_PROTECT_VERSION)>=0&&(o=i.cutUin(o)+"_"+S.skeleManager.seq++),o}t.loadSprite=u,t.loadPet=d,t.loadNamePlate=M,t.loadSpriteWithAIOType=function(e,t){if(s.CMShowLog(1,m+"_loadSpriteWithAIOType","sprites length:"+e.length+", type:"+t),t===a.CMShowAIOType.CMShowAIOTypeFriend&&e.length<2)s.CMShowLog(1,m+"_loadSpriteWithAIOType","sprites length:"+e.length+", error, return");else{2===e.length&&e[0].uin===e[1].uin&&(1===e[0].isMaster?e[1].uin=e[1].uin+"#":e[0].uin=e[0].uin+"#");var o=0;if(1===e.length){r.comGlobalParam.uin!==e[0].uin&&(o=180);var n=t!==a.CMShowAIOType.CMShowAIOTypeFriend?0:S.skeleManager.spriteList.length;u(e[0],i.getPosition(n,n+1),o,!1)}else{var l=function(e){for(var t=0;t<e.length;t++)if(e[t].uin===r.comGlobalParam.uin)return t;return-1}(e);l<0&&(l=1===e[0].isMaster?0:1),u(e[l],i.getPosition(1,2),0,!1),u(e[1-l],i.getPosition(0,2),180,!1)}if(S.skeleManager.isSpriteShow=!0,S.skeleManager.loadSpriteNum===c.reportManager.alreadyLoadSprite){for(var p=!1,h=0;h<S.skeleManager.spriteList.length;h++)if(!S.skeleManager.spriteList[h].is2D()){p=!0;break}p&&r.comGlobalParam.cmshowDebugTag?void 0===r.comGlobalParam.firstFrameRender&&(r.comGlobalParam.firstFrameRender=!1,c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:c.CmReportManager.Span_First_Render_Time,msg:"Data Ready, Begin render",timeStamp:Date.now()})):c.reportManager.reportTraceEvent({cmd:c.CmReportManager.NotifyCMD_CS_Trace_End,spanId:0,msg:"",result:c.CmReportManager.Result_Succ,timeStamp:Date.now()})}}},t.loadRoleByBuffer=function(e,t,o,i,n,r,s){return C(e,t,o,i,{x:n,y:r,aioposition:a.SkeletonDirection.SkeletonDirectionNone},s)},t.p_loadRoleByBuffer=C,t.findSprite=g,t.addSprite=w,t.getSprite=function(e,t){var o=e.uin,n=g(o);if(n)h.cmActionManager.lastActionType!==a.CMShowActionType.CMShowActionTypeBasic&&n.adjustPosition&&(n.position=n.adjustPosition);else{if(s.CMShowLog(1,m+"_getSprite","load ani:"+i.cutUin(o)),!(n=r.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend?o==r.comGlobalParam.uin?u(e,i.getPosition(1,2),0,t):u(e,i.getPosition(0,2),180,t):o==r.comGlobalParam.uin?u(e,i.getPosition(S.skeleManager.spriteList.length,S.skeleManager.spriteList.length+1),0,t):u(e,i.getPosition(S.skeleManager.spriteList.length,S.skeleManager.spriteList.length+1),180,t)))return s.CMShowLog(1,m+"_getSprite","load ani error, uin:"+i.cutUin(o)),null;S.skeleManager.spriteList.push(n)}return s.CMShowLog(1,m+"_getSprite","is2D:"+n.is2D()),n},t.removeSprite=f,t.getOldestSprite=y,t.setAccessoryByBuffer=A,t.setAccessoryByBuffer_2D=D,t.setAccessoryByBuffer_3D=k,t.removeAccessory_2Dor3D=function(e,t,o){s.CMShowLog(1,m+"_removeAccessory_2Dor3D",e.is2D()+", path:"+o);var i=t===a.CMSHOW_BUBBLE_ACCESSORY_NAME||void 0;i&&(r.comGlobalParam.needReportBubbleRect=!1),e.removeAccessory({model:e.is2D()?"2D":"3D",tag:o,accessoryName:t,bubble:i})},t.setAccessoryWithInfo_2Dor3D=_,t.setAccessoryWithInfoHasOffset=b,t.resetSpritePosition=T,t.createSpriteName=P},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(0),n=o(7),r=function(){function e(){this.waitAction=new Array,this.taskArray=new Array,this.lastActionType=a.CMShowActionType.CMShowActionTypeBasic,this.lastBasicActionType=a.CMShowBasicActionType.CMShowBasicActionTypeNone,this.actionNameMap={}}return e.prototype.addWaitAction=function(t){for(var o=JSON.parse(t).taskId,a=0;a<this.waitAction.length;a++){if(o===JSON.parse(this.waitAction[a]).taskId)return}this.waitAction.push(t),this.waitAction.length>3&&this.waitAction.shift(),i.CMShowLog(1,e.TAG+"_addWaitAction","add waitAction, taskId:"+o+", wait length:"+this.waitAction.length)},e.prototype.findTaskById=function(t){i.CMShowLog(1,e.TAG+"_findTaskById","find task by taskID:"+t);for(var o=0;o<this.taskArray.length;o++){var a=this.taskArray[o];if(t===a.taskId)return a}return i.CMShowLog(1,e.TAG+"_findTaskById","task:"+t+" is not exist!"),null},e.prototype.removeTaskById=function(t,o){i.CMShowLog(1,e.TAG+"_removeTaskById","remove task by taskID:"+t);for(var r=0;r<this.taskArray.length;r++){var s=this.taskArray[r];if(t===s.taskId)return i.CMShowLog(1,e.TAG+"_removeTaskById","find task:"+t+", remove it"),s.audio&&s.player&&(s.player.stopMusic(),s.player=null),s.barrageText&&s.barrageText.length>0&&n.showOrRemoveActionBarrage(!1,"",t),o!==a.CMShowCompletionStatus.CMShowCompletionStatusNone&&n.notifyActionStatusChanged(t,o),this.taskArray.splice(r,1),!0}return i.CMShowLog(1,e.TAG+"_removeTaskById","task:"+t+" is not exist!"),!1},e.prototype.removeAllTask=function(t){i.CMShowLog(1,e.TAG+"_removeAllTask","task length:"+this.taskArray.length);for(var o=0;o<this.taskArray.length;o++){var a=this.taskArray[o];a.audio&&a.player&&(a.player.stopMusic(),a.player=null),a.barrageText&&a.barrageText.length>0&&n.showOrRemoveActionBarrage(!1,"",a.taskId),n.notifyActionStatusChanged(a.taskId,t)}this.taskArray.splice(0,this.taskArray.length)},e.TAG="CmActionManager",e}();t.CmActionManager=r,t.cmActionManager=new r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(0),n=o(2),r=o(3),s=o(4),c=o(11),l=o(6),p=o(7),h=o(9),S=o(8),m=o(5),u=o(13),d="CmDefAction";function M(e,t,o){if(i.CMShowLog(1,d+"_setAccessoryAnimationByBuffer",e.model+", set accessoryAni:"+t),e.is2D()){var n=r.getResPath(t+".json",null,a.CMShowResType.CMShowResTypeAction,"2D"),c=r.getResPath(t+".atlas",null,a.CMShowResType.CMShowResTypeAction,"2D"),l=!1;s.res2DMap[n]&&s.res2DMap[n].length>0&&s.res2DMap[c]&&s.res2DMap[c].length>0&&(l=!0),l?e.loadAccessoryAnimation({jsonBuf:s.res2DMap[n],jsonPath:n,atlasBuf:s.res2DMap[c],atlasPath:c,animationName:o}):e.setAccessoryAnimation({jsonPath:n,atlasPath:c,animationName:o})}else{var p=r.getResPath(t+".bin",null,a.CMShowResType.CMShowResTypeAction,"3D");e.setAccessoryAnimation({path:p,animName:o})}}function C(e,t,o,a){i.CMShowLog(1,d+"_setAnimation_2Dor3D",e.model+", set animation, taskId:"+t+", actionName:"+o+", noCamera:"+e.noCamera);var n=a||0;e.is2D()&&(h.cmActionManager.actionNameMap[e.uin]=o),e.setAnimation({model:e.model,track:t,trackId:t,name:o,animName:o,noCam:e.noCamera,loop:n}),t>0&&(e.lastAction=o)}function g(e,t){i.CMShowLog(1,d+"_removeAccessoryAnimation",""+e.model),e.removeAccessoryAnimation({model:e.model,animationName:t,animName:t})}function w(e,t){return!!e.is2D()&&e.containAnimation({model:e.model,animationName:t})}function f(e){n.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeDrawer&&e.restoreAnimationState()}function y(e,t){e.setStartCallback({callback:t})}function A(e,t){e.setCompleteCallback({callback:t})}function D(e,t){e.setEndCallback({callback:t})}function k(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDStandUp,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doStandUpAction","sprite list is empty");else if(s.skeleManager.spriteStatus!==a.CMShowActionStatus.CMShowActionStatusStandUp&&s.skeleManager.spriteStatus!==a.CMShowActionStatus.CMShowActionStatusStandUp_Down){l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameStandUp;s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp,i.CMShowLog(1,d+"_doStandUpAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var c=e.spriteArray[o];if(c){c.curTask=e;var S=c.is2D()?n.comGlobalParam.defAction2D.standUpPath:n.comGlobalParam.defAction3D.standUpPath;if(c.is2D()&&0===h.cmActionManager.waitAction.length&&c.showAction&&(i.CMShowLog(1,d+"_doStandUpAction","getShowActionRes, path"+c.showAction),S=c.showAction),w(c,t)&&g(c,t),M(c,S,t),C(c,e.taskId,t,0),c.pet){var m=void 0;if(c.showActionType===a.CMShowActionType.CMShowActionTypeInterActive){var u=r.getPetActionByPath(c.showAction);m={path:u||"",actionId:a.CMShowDefTaskID.CMShowDefTaskIDStandUp,relatedActions:null}}else m=p.getPetAction(c,!1);if(m){var f=r.cutUin(c.pet.uin)+"_"+m.actionId;c.pet.action=m,g(c.pet,f),M(c.pet,m.path,f),C(c.pet,m.actionId,f,0)}else i.CMShowLog(1,d+"_doStandUpAction","pet action is null!")}}}}else i.CMShowLog(1,d+"_doStandUpAction","sprite status is stand up")}function _(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDGetDown,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doGetDownAction","sprite list is empty");else if(i.CMShowLog(1,d+"_doGetDownAction","current status:"+s.skeleManager.spriteStatus),s.skeleManager.spriteStatus!==a.CMShowActionStatus.CMShowActionStatusGetDown&&s.skeleManager.spriteStatus!==a.CMShowActionStatus.CMShowActionStatusGetDown_Down){l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameGetDown;s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown,i.CMShowLog(1,d+"_doGetDownAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var c=e.spriteArray[o];if(c){c.curTask=e;var h=c.is2D()?n.comGlobalParam.defAction2D.getDownPath:n.comGlobalParam.defAction3D.getDownPath;if(M(c,h,t),C(c,e.taskId,t,0),c.pet&&!c.pet.action){var S=p.getPetAction(c,!1);if(S){var m=r.cutUin(c.pet.uin)+"_"+S.actionId;c.pet.action=S,M(c.pet,S.path,m),C(c.pet,S.actionId,m,0)}}}}}}function b(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDThinking,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doThinkingAction","sprite list is empty");else{l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameThinking;i.CMShowLog(1,d+"_doThinkingAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var r=e.spriteArray[o];if(r){r.curTask=e;var s=r.is2D()?n.comGlobalParam.defAction2D.thinkingPath:n.comGlobalParam.defAction3D.thinkingPath;M(r,s,t),C(r,e.taskId,t,0)}}}}function T(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDWaiting,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doWaitingAction","sprite list is empty");else{l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameWaiting;i.CMShowLog(1,d+"_doWaitingAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var r=e.spriteArray[o];if(r){r.curTask=e;var s=r.is2D()?n.comGlobalParam.defAction2D.waitingPath:n.comGlobalParam.defAction3D.waitingPath;M(r,s,t),C(r,e.taskId,t,0)}}}}function P(e){if(n.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend)for(var t=0;t<h.cmActionManager.taskArray.length;t++){var o=h.cmActionManager.taskArray[t];if(e===o.taskId)for(var i=o.spriteArray,r=0;r<i.length;r++){var s=i[r];s.uin.length<=0&&(S.removeSprite(s,!0),S.resetSpritePosition())}}}t.setAccessoryAnimationByBuffer=M,t.setAnimation_2Dor3D=C,t.removeAccessoryAnimation_2Dor3D=g,t.containAnimation=w,t.restoreAnimationState_2Dor3D=f,t.setStartCallBack=y,t.setCompleteCallBack=A,t.setEndCallBack=D,t.doStandUpAction=k,t.doGetDownAction=_,t.doThinkingAction=b,t.doWaitingAction=T,t.doJumpUpAction=function(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDJumpUp,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doJumpUpAction","sprite list is empty");else{l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameJumpUp;i.CMShowLog(1,d+"_doJumpUpAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var r=e.spriteArray[o];if(r){r.curTask=e;var s=r.is2D()?n.comGlobalParam.defAction2D.fcardJumpUpPath:n.comGlobalParam.defAction3D.fcardJumpUpPath;M(r,s,t),C(r,a.CMShowDefTaskID.CMShowDefTaskIDJumpUp,t,0),r.hidden=!1,r.pet&&(f(r.pet),M(r.pet,s,t),C(r.pet,e.taskId,t,0))}}}},t.doJumpDownAction=function(e){if(e.taskId=a.CMShowDefTaskID.CMShowDefTaskIDJumpDown,e.spriteArray.length<=0)i.CMShowLog(1,d+"_doJumpDownAction","sprite list is empty");else{l.startTicker();var t=a.CMShowDefActionName.CMShowDefActionNameJumpDown;i.CMShowLog(1,d+"_doJumpDownAction","sprite list length:"+e.spriteArray.length);for(var o=0;o<e.spriteArray.length;o++){var r=e.spriteArray[o];if(r){r.curTask=e;var s=r.is2D()?n.comGlobalParam.defAction2D.fcardJumpDownPath:n.comGlobalParam.defAction3D.fcardJumpDownPath;M(r,s,t),C(r,a.CMShowDefTaskID.CMShowDefTaskIDJumpDown,t,0),r.pet&&(f(r.pet),M(r.pet,s,t),C(r.pet,e.taskId,t,0))}}}},t.doSpriteAction=function(e){i.CMShowLog(1,d+"_doSpriteAction","do sprite action, taskId:"+e),h.cmActionManager.taskArray.push(e);for(var t=0;t<e.spriteArray.length;t++){var o=e.spriteArray[t];try{if(o.curTask=e,!o.actionData||!o.actionData.action||0===o.actionData.action.length)return void h.cmActionManager.taskArray.pop();n.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&S.removeAccessory_2Dor3D(o,a.CMSHOW_BUBBLE_ACCESSORY_NAME,null);var s=r.cutUin(o.uin)+"_"+o.actionData.action;i.CMShowLog(1,d+"_doSpriteAction","set sprite action, actionPath:"+o.actionData.action),M(o,o.actionData.action,s),C(o,e.taskId,s,0)}catch(e){m.reportManager.reportErrorEvent(d+"_doSpriteAction, err:"+e,m.CmReportManager.Error_Code)}}},t.playSmoke=function(e,t){if(!e)return i.CMShowLog(1,d+"_playSmoke","ani is null, return"),void m.reportManager.reportErrorEvent(d+"_playSmoke, ani is null, return",m.CmReportManager.SkeAni_Undefined_Error);i.CMShowLog(1,d+"_playSmoke","play smoke, uin:"+r.cutUin(e.uin));var o={model:"2D",role:n.comGlobalParam.platform===n.CMShowPlatformString_iOS?"def/Role/0/playRes/role":"def/role/0/role",dress:[]},a=S.p_loadRoleByBuffer("smokeAni",o,0,0,{x:0,y:0,z:0},!0);if(!a)return i.CMShowLog(1,d+"_playSmoke","load smoke ani error, return!"),void m.reportManager.reportErrorEvent(d+"_playSmoke, load smokeAni error, "+r.cutUin(e.uin),m.CmReportManager.SkeAni_Undefined_Error);var c=e.position;a.position=c,a.smokeUin=e.uin,l.startTicker(),y(a,function(){i.CMShowLog(0,d+"_playSmoke","smoke animation start")}),A(a,function(){if(a){i.CMShowLog(0,d+"_playSmoke","smoke animation complete, "+r.cutUin(a.smokeUin));for(var e=0;e<s.skeleManager.spriteList.length;e++){if(s.skeleManager.spriteList[e].uin===a.smokeUin){s.skeleManager.spriteList[e].hidden=!1;var t=s.skeleManager.spriteList[e].pet;t&&(t.hidden=!1)}s.skeleManager.destroyingList.push(a)}}}),D(a,function(){i.CMShowLog(0,d+"_playSmoke","smoke animation end")}),g(a,"smoke"),M(a,n.comGlobalParam.defAction3D.action2To3Path,"smoke"),i.CMShowLog(0,d+"_playSmoke","set smoke animation"),C(a,1e4,"smoke",0)},t.onActionStart=function(e){if(i.CMShowLog(1,d+"_onActionStart","start action, actionId:"+e),null!=e){for(var t=0;t<s.skeleManager.spriteList.length;t++)s.skeleManager.spriteList[t].actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusStart;if(h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeSlave)for(var o=0;o<s.skeleManager.spriteList.length;o++){var n=s.skeleManager.spriteList[o];n&&n.pet&&(n.pet.hidden=!0)}p.notifyActionStatusChanged(e,a.CMShowCompletionStatus.CMShowCompletionStatusStart)}},t.onActionInterrupt=function(e,t){if(i.CMShowLog(1,d+"_onActionInterrupt","interrupt action, actionId:"+e),null!=e){P(e),h.cmActionManager.removeTaskById(e,a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt);for(var o=0;o<s.skeleManager.spriteList.length;o++){var l=s.skeleManager.spriteList[o];h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeSlave&&l.pet&&(l.pet.hidden=!1)}if(n.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend&&h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeWhiteFace&&t){if(h.cmActionManager.taskArray.length>0)return void i.CMShowLog(1,d+"_onActionInterrupt","other task is running, return");if(!(l=S.loadSprite(t,r.getPosition(0,1),0,!0)))return void i.CMShowLog(1,d+"_onActionInterrupt","skeAni:"+r.cutUin(t.uin)+" is undefined");T(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3})),l.hidden=!1}}},t.onActionComplete=function(e,t){i.CMShowLog(1,d+"_onActionComplete","complete action, actionId:"+e+", task length:"+h.cmActionManager.taskArray.length);for(var o=0;o<s.skeleManager.spriteList.length;o++){var m=s.skeleManager.spriteList[o];i.CMShowLog(1,d+"_onActionComplete","restoreOldSprite uin:"+r.cutUin(m.uin)),s.skeleManager.restoreOldSprite(m,!1),m.is2D()&&h.cmActionManager.actionNameMap[m.uin]&&(g(m,h.cmActionManager.actionNameMap[m.uin]),delete h.cmActionManager.actionNameMap[m.uin])}if(n.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO)if(P(e),h.cmActionManager.removeTaskById(e,a.CMShowCompletionStatus.CMShowCompletionStatusComplete),n.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend&&h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeWhiteFace&&t){if(!(m=S.loadSprite(t,r.getPosition(0,1),0,!0)))return void i.CMShowLog(1,d+"_onActionComplete","skeAni:"+r.cutUin(t.uin)+" is undefined");if(T(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3})),m.hidden=!1,m.pet){m.pet.hidden=!1;var u=p.getPetAction(m,!1),w=void 0,y=0;u?(w=u.path,y=u.actionId,m.pet.action=u):(w=m.pet.actionGetDown,y=a.CMShowDefTaskID.CMShowDefTaskIDGetDown),i.CMShowLog(1,d+"_onActionComplete","ani.pet.petAction:"+w);var A=r.cutUin(m.pet.uin)+"_"+y;M(m.pet,w,A),C(m.pet,y,A,0)}}else{for(o=0;o<s.skeleManager.spriteList.length;o++)m=s.skeleManager.spriteList[o],h.cmActionManager.lastActionType!==a.CMShowActionType.CMShowActionTypeWhiteFace&&f(m),s.skeleManager.initActionCallBack(m),h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeSlave&&m.pet&&(m.pet.hidden=!1);s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusAction_Down,n.comGlobalParam.aioPanelClose?h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeWhiteFace?T(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3})):_(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList})):h.cmActionManager.lastActionType===a.CMShowActionType.CMShowActionTypeWhiteFace?k(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList})):(s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,b(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3})))}else l.isAllowStopSticker()&&l.stopTicker(!1)},t.onNorActStart=function(e,t,o){if(i.CMShowLog(1,d+"_onNorActStart","actionId:"+t.taskId+", uin:"+r.cutUin(o.uin)),o.actionData&&1===o.actionData.isMaster&&void 0!==o.actionData.bubbleType)if(0===o.actionData.bubbleType){var n=-1;0!==o.aioCache3DPosition&&1!==o.aioCache3DPosition||(n=1),-100===o.aioCache3DPosition&&(n=void 0),S.setAccessoryWithInfo_2Dor3D(o,o.actionData.bubble,o.actionData.text,n)}else t.barrageText=o.actionData.text,p.showOrRemoveActionBarrage(!1,"",0),p.showOrRemoveActionBarrage(!0,o.actionData.text,t.taskId);1===t.startCnt&&(s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusAction,p.notifyActionStatusChanged(t.taskId,a.CMShowCompletionStatus.CMShowCompletionStatusStart))},t.onNorActComplete=function(e,t,o){i.CMShowLog(1,d+"_onNorActComplete","actionId:"+t.taskId+", uin:"+r.cutUin(o.uin)),n.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO?(t.completeCnt===t.count&&(P(t.taskId),h.cmActionManager.removeTaskById(t.taskId,a.CMShowCompletionStatus.CMShowCompletionStatusComplete),s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusAction_Down),s.skeleManager.restoreOldSprite(o,!1),0===h.cmActionManager.taskArray.length&&(n.comGlobalParam.aioPanelClose?_(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList})):b(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3})))):l.isAllowStopSticker()&&l.stopTicker(!1)},t.onDefActStart=function(e,t,o){switch(i.CMShowLog(1,d+"_onDefActStart",e+", actionId:"+t.taskId+", startCnt:"+t.startCnt+", count:"+t.count),t.taskId){case a.CMShowDefTaskID.CMShowDefTaskIDStandUp:o.status=a.CMShowActionStatus.CMShowActionStatusStandUp,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp,1===t.startCnt&&p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusStandUp);break;case a.CMShowDefTaskID.CMShowDefTaskIDThinking:o.status=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,1===t.startCnt&&(t.repeatCnt--,p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusStandUp));break;case a.CMShowDefTaskID.CMShowDefTaskIDGetDown:o.status=a.CMShowActionStatus.CMShowActionStatusGetDown,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown,1===t.startCnt&&p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusGetDown);break;case a.CMShowDefTaskID.CMShowDefTaskIDWaiting:if(o.status=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,1===t.startCnt&&(t.repeatCnt--,p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusGetDown),h.cmActionManager.waitAction.length>0))for(var n=h.cmActionManager.waitAction.length;n>0;){var r=h.cmActionManager.waitAction.shift();r&&(u.playAction(r,3),n--)}break;case a.CMShowDefTaskID.CMShowDefTaskIDJumpUp:o.status=a.CMShowActionStatus.CMShowActionStatusJumpUp,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusJumpUp;break;case a.CMShowDefTaskID.CMShowDefTaskIDJumpDown:o.status=a.CMShowActionStatus.CMShowActionStatusJumpDown,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusJumpDown}},t.onDefActComplete=function(e,t,o){switch(i.CMShowLog(1,d+"_onDefActComplete","actionId:"+t.taskId+", uin:"+r.cutUin(o.uin)),t.taskId){case a.CMShowDefTaskID.CMShowDefTaskIDStandUp:if(o.status=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,f(o),t.completeCnt===t.count)if(s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusStandUp),h.cmActionManager.waitAction.length>0)for(var n=h.cmActionManager.waitAction.length;n>0;)(m=h.cmActionManager.waitAction.shift())&&(u.playAction(m,1),n--);else s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,b(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3}));break;case a.CMShowDefTaskID.CMShowDefTaskIDThinking:o.status=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusStandUp_Down,t.completeCnt===t.count&&(t.repeatCnt>0?(t.completeCnt=0,t.startCnt=0,b(t)):l.isAllowStopSticker()&&l.stopTicker(!1));break;case a.CMShowDefTaskID.CMShowDefTaskIDGetDown:if(o.status=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,t.completeCnt===t.count)if(s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,p.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusGetDown),h.cmActionManager.waitAction.length>0)for(n=h.cmActionManager.waitAction.length;n>0;){var m;(m=h.cmActionManager.waitAction.shift())&&(u.playAction(m,2),n--)}else s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,T(new c.CMShowActionTask({spriteArray:s.skeleManager.spriteList,repeatCnt:3}));break;case a.CMShowDefTaskID.CMShowDefTaskIDWaiting:s.skeleManager.restoreOldSprite(o,!1),o.status=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,s.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusGetDown_Down,1===t.repeatCnt&&S.removeAccessory_2Dor3D(o,a.CMSHOW_BUBBLE_ACCESSORY_NAME,null),t.completeCnt===t.count&&(t.repeatCnt>0?(t.completeCnt=0,t.startCnt=0,T(t)):l.isAllowStopSticker()&&l.stopTicker(!1));break;case a.CMShowDefTaskID.CMShowDefTaskIDJumpUp:o.status=a.CMShowActionStatus.CMShowActionStatusJumpUp,p.report3DSpriteRect(o),l.stopTicker(!0);break;case a.CMShowDefTaskID.CMShowDefTaskIDJumpDown:o.status=a.CMShowActionStatus.CMShowActionStatusJumpDown,p.report3DSpriteRect(o),p.notifySpriteDoAction()}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){return function(e){this.spriteArray=new Array,this.taskId=0,this.count=0,this.completeCnt=0,this.startCnt=0,this.repeatCnt=0,this.playedAudio=!1,this.audio=null,this.barrageText=null,this.loopCnt=0,this.spriteArray=e.spriteArray?e.spriteArray:new Array,this.taskId=e.taskId?e.taskId:0,this.count=e.count?e.count:this.spriteArray.length,this.completeCnt=e.completeCnt?e.completeCnt:0,this.startCnt=e.startCnt?e.startCnt:0,this.repeatCnt=e.repeatCnt?e.repeatCnt:1,this.playedAudio=!!e.playedAudio&&e.playedAudio,this.player=e.player?e.player:null,this.audio=e.audio?e.audio:null,this.loopCnt=e.loopCnt?e.loopCnt:0}}();t.CMShowActionTask=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(5),i=o(0),n=o(6),r=o(1),s=!1;t.init3DLib=function(){if(!s)try{if(a.reportManager.reportTraceEvent({cmd:a.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:a.CmReportManager.Span_Load_Engine,msg:"start load 3D lib!",result:a.CmReportManager.Result_Succ,timeStamp:Date.now()}),window.cm3d?i.CMShowLog(1,"init3DLib","already load cm3d"):BK.Script.loadlib("BaseJs://cm3d.js"),window.cm3d.init){var e=comGlobalParam.location===r.CMShowLocationType.CMShowLocationTypeAIO?comGlobalParam.width:comGlobalParam.vWidth,t=comGlobalParam.location===r.CMShowLocationType.CMShowLocationTypeAIO?comGlobalParam.height:comGlobalParam.vHeight;window.cm3d.init(e,t),n.startTicker()}i.CMShowLog(1,"init3DLib","load 3D lib ok!"),s=!0,a.reportManager.reportTraceEvent({cmd:a.CmReportManager.NotifyCMD_CS_Trace_Span_End,spanId:a.CmReportManager.Span_Load_Engine,msg:"load 3D lib succ!",result:a.CmReportManager.Result_Succ,timeStamp:Date.now()})}catch(e){i.CMShowLog(1,"init3DLib","load cm3d.js error!"),a.reportManager.reportErrorEvent("[init3DLib], load cm3d.js error!",a.CmReportManager.Load_CM3D_Error)}},t.hasInit3DLib=function(){return s}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(10),i=o(2),n=o(7),r=o(8),s=o(3),c=o(0),l=o(16),p=o(17),h=o(5),S=o(6),m=o(11),u=o(9),d=o(4),M=o(1);function C(e,t){var o,s="initDrawerInfoSprite";c.CMShowLog(1,s,"enter initDrawerInfoSprite, initJson:"+e),D();try{o=JSON.parse(e)}catch(e){return c.CMShowLog(1,s,"parse drawer json error!"),h.reportManager.reportErrorEvent("["+s+"] "+e,h.CmReportManager.Parse_Json_Error),null}d.skeleManager.loadSpriteNum=1,h.reportManager.alreadyLoadSprite=0;var l=o.sprites,p={x:(l[0].xPos+0)*i.comGlobalParam.density,y:l[0].yPos*i.comGlobalParam.density},S=r.loadSprite(l[0],p,0,!1);if(!S)return c.CMShowLog(1,s,"skeAni is undefined"),null;if(d.skeleManager.loadSpriteNum===h.reportManager.alreadyLoadSprite){for(var u=!1,C=0;C<d.skeleManager.spriteList.length;C++)if(!d.skeleManager.spriteList[C].is2D()){u=!0;break}u&&i.comGlobalParam.cmshowDebugTag?void 0===i.comGlobalParam.firstFrameRender&&(i.comGlobalParam.firstFrameRender=!1,h.reportManager.reportTraceEvent({cmd:h.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:h.CmReportManager.Span_First_Render_Time,msg:"Data Ready, Begin render",timeStamp:Date.now()})):h.reportManager.reportTraceEvent({cmd:h.CmReportManager.NotifyCMD_CS_Trace_End,spanId:0,msg:"",result:h.CmReportManager.Result_Succ,timeStamp:Date.now()})}return d.skeleManager.spriteStatus=M.CMShowActionStatus.CMShowActionStatusJumpDown,i.comGlobalParam.location===M.CMShowLocationType.CMShowLocationTypeFCard?a.doJumpUpAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList})):(n.report3DSpriteRect(S),void 0!==t&&t||n.notifySpriteDoAction()),S}t.CMSHOW_SCRIPT_VERSION="7.7.0",c.CMShowLog(1,"cmshow_script_0_refactor","load script version: "+t.CMSHOW_SCRIPT_VERSION),t.commonInit=function(e){var t="commonInit";if(i.comGlobalParam&&i.comGlobalParam.isCommInit)c.CMShowLog(0,t,"common is already init!");else{c.CMShowLog(1,t,"enter commonInit, commJson:"+e);try{var o=JSON.parse(e);o.hasOwnProperty("phoneModel")&&(i.comGlobalParam.phoneModel=o.phoneModel),o.hasOwnProperty("osVersion")&&(i.comGlobalParam.osVersion=o.osVersion),o.hasOwnProperty("panelStatus")&&(i.comGlobalParam.aioPanelClose=1===o.panelStatus),i.comGlobalParam.uin=o.uin,i.comGlobalParam.aioType=o.aioType,i.comGlobalParam.friendUin=o.friendUin,i.comGlobalParam.platform=o.platform,i.comGlobalParam.qqVer=o.qqVer,i.comGlobalParam.qqVer||(i.comGlobalParam.qqVer=""),i.comGlobalParam.width=o.width,i.comGlobalParam.height=o.height,c.CMShowLog(1,t,"width: "+i.comGlobalParam.width+", height:"+i.comGlobalParam.height),i.comGlobalParam.vWidth=o.width,i.comGlobalParam.vHeight=o.vHeight,i.comGlobalParam.screenW=o.screenW,i.comGlobalParam.screenH=o.screenH,i.comGlobalParam.timeScale=1,i.comGlobalParam.scale=o.screenH/7/368,i.comGlobalParam.originScale=i.comGlobalParam.scale,i.drawerCommParam.scale=o.screenH/4/368,i.cardCommParam.scale=o.screenH/5/368,o.density?(i.comGlobalParam.density=o.density,i.drawerCommParam.x*=i.comGlobalParam.density,i.drawerCommParam.y*=i.comGlobalParam.density,i.cardCommParam.x*=i.comGlobalParam.density,i.cardCommParam.y*=i.comGlobalParam.density,d.skeleManager.petOffSet*=i.comGlobalParam.density):c.CMShowLog(1,t,"density is not exist"),i.comGlobalParam.distance=330*i.comGlobalParam.scale,i.comGlobalParam.defDress=o.defDress,i.comGlobalParam.defRole=o.defRole,i.comGlobalParam.location=o.from?o.from:0,i.comGlobalParam.loaction=o.from?o.from:0,o.standup&&(i.comGlobalParam.defAction2D={standUpPath:o.standup,thinkingPath:o.think,getDownPath:o.sitdown,waitingPath:o.wait,drawerJumpUpPath:o.drawer_up,drawerJumpDownPath:o.drawer_down,fcardJumpUpPath:o.friendcard_up,fcardJumpDownPath:o.friendcard_down}),o["3DObject"]&&(i.comGlobalParam.defAction3D={standUpPath:o["3DObject"].standup+"/action",thinkingPath:o["3DObject"].think+"/action",getDownPath:o["3DObject"].sitdown+"/action",waitingPath:o["3DObject"].wait+"/action",drawerJumpUpPath:o["3DObject"].drawer_up+"/action",drawerJumpDownPath:o["3DObject"].drawer_down+"/action",fcardJumpUpPath:o["3DObject"].friendcard_up+"/action",fcardJumpDownPath:o["3DObject"].friendcard_down+"/action",action2To3Path:o["3DObject"]["2to3DAction"]+"/action",action3To2Path:o["3DObject"]["3to2DAction"]+"/action"},i.comGlobalParam.defRes3D={role3D:o["3DObject"].defRole,dress3D:o["3DObject"].defDress,sayHi3D:o["3DObject"].sayhi+"/action",bubble3D:o["3DObject"].bubble}),i.comGlobalParam.isCommInit=!0;for(var a=Object.keys(M.bubbleTextRect),n=0;n<a.length;n++)M.bubbleTextRect[a[n]].width*=i.comGlobalParam.scale;i.comGlobalParam.registerFunction("playAction_bid_0",f),i.comGlobalParam.registerFunction("sendMsg_bid_0",y),i.comGlobalParam.registerFunction("stopAction_bid_0",A),i.comGlobalParam.qqVer&&s.versionCompare(i.comGlobalParam.qqVer,M.CMSHOW_ASYNCIO_QQ_VERSION)>=0&&l.loadQQPlayCore(),d.skeleManager.origin2DHeight=i.comGlobalParam.screenH/7,i.comGlobalParam.qqVer&&s.versionCompare(i.comGlobalParam.qqVer,"8.0.8")>0&&i.comGlobalParam.location===M.CMShowLocationType.CMShowLocationTypeAIO&&d.skeleManager.calculate2DHeightScale(),s.versionCompare(i.comGlobalParam.qqVer,"8.1.0")<0&&(i.comGlobalParam.cmshowDebugTag=!1),c.CMShowLog(1,t,"common, parse finish. location:"+i.comGlobalParam.location+", QQVersion:"+i.comGlobalParam.qqVer)}catch(o){c.CMShowLog(1,t,"common, parse error:"+o+", json:"+e),h.reportManager.reportErrorEvent("["+t+"] "+o,h.CmReportManager.Parse_Json_Error)}}},t.initSprite=function(e){var t,o="initSprite";c.CMShowLog(1,o,"enter initSprite, initJson:"+e),d.skeleManager.aioStatus=M.CMShowAIOStatusType.CMShowAIOStatusTypeResume;try{t=JSON.parse(e)}catch(t){return c.CMShowLog(1,o,"parse json error:"+t+", initJson:"+e),void h.reportManager.reportErrorEvent("["+o+"] "+t,h.CmReportManager.Parse_Json_Error)}l.preLoadRes(t,0,function(){var e=t.sprites;d.skeleManager.loadSpriteNum=e.length,S.startTicker(),u.cmActionManager.waitAction.splice(0,u.cmActionManager.waitAction.length),h.reportManager.dressNum=0;var l=e.length;(i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend||e.length<2&&e.length>0)&&(l=1,d.skeleManager.loadSpriteNum=l),2===e.length&&e[0].uin===e[1].uin&&(e[1].uin=e[1].uin+"#"),i.comGlobalParam.scale=i.comGlobalParam.scale*i.comGlobalParam.adaptationScale;for(var p=0;p<l;p++){var C=s.getPosition(0,l),g=0,w=e[p];i.comGlobalParam.aioType===M.CMShowAIOType.CMShowAIOTypeFriend&&l>1&&(w.uin===i.comGlobalParam.uin?C=s.getPosition(1,l):g=180);var f=r.loadSprite(w,C,g,!0);if(f){if(f.hidden=!1,f.pet){f.pet.hidden=!1;var y=void 0,A=n.getPetAction(f,!1),D=0;A?(y=A.path,D=A.actionId,f.pet.action=A):(y=f.pet.actionGetDown,D=M.CMShowDefTaskID.CMShowDefTaskIDGetDown);var k=s.cutUin(f.pet.uin)+"_"+D;a.setAccessoryAnimationByBuffer(f.pet,y,k),a.setAnimation_2Dor3D(f.pet,D,k,0)}}else c.CMShowLog(1,o,"load skeAni error, uin:"+s.cutUin(w.uin))}if(i.comGlobalParam.aioPanelClose?a.doWaitingAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,repeatCnt:3})):a.doThinkingAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,repeatCnt:3})),c.CMShowLog(1,""+o,"alreadyLoadSprite:"+h.reportManager.alreadyLoadSprite+", loadSpriteNum:"+d.skeleManager.loadSpriteNum),d.skeleManager.loadSpriteNum===h.reportManager.alreadyLoadSprite){for(var _=!1,b=0;b<d.skeleManager.spriteList.length;b++)if(!d.skeleManager.spriteList[b].is2D()){_=!0;break}_&&i.comGlobalParam.cmshowDebugTag?void 0===i.comGlobalParam.firstFrameRender&&(i.comGlobalParam.firstFrameRender=!1,h.reportManager.reportTraceEvent({cmd:h.CmReportManager.NotifyCMD_CS_Trace_Span_Begin,spanId:h.CmReportManager.Span_First_Render_Time,msg:"Data Ready, Begin render",timeStamp:Date.now()})):h.reportManager.reportTraceEvent({cmd:h.CmReportManager.NotifyCMD_CS_Trace_End,spanId:0,msg:"",result:h.CmReportManager.Result_Succ,timeStamp:Date.now()})}d.skeleManager.isSpriteShow=!0,d.skeleManager.alreadyInitSprite=!0,n.notifySpriteStatusChanged(M.CMShowNotifyStatus.CMShowNotifyStatusGetDown),c.CMShowLog(1,o,"init sprite end!")})},t.initDrawerInfoSprite=C;var g=0,w=500;function f(e){var t="playSpriteAction_0";c.CMShowLog(1,t,"enter playSpriteAction_0, actionJson:"+e);var o=JSON.parse(e),l=o.taskId,p=o.sprites;d.skeleManager.spriteStatus===M.CMShowActionStatus.CMShowActionStatusNone&&n.notifySpriteStatusChanged(M.CMShowNotifyStatus.CMShowNotifyStatusStandUp);for(var S=0,C=null,g=0;g<p.length;g++)p[g].action&&(S++,C=p[g]);if(1===S){if(!C)return void c.CMShowLog(1,t,"action player is null.");if(u.cmActionManager.taskArray.length>0){for(var w=0;w<d.skeleManager.spriteList.length;w++){(k=d.skeleManager.spriteList[w]).uin!==C.uin&&(c.CMShowLog(0,t,"remove accessory animation, lastAction:"+k.lastAction),r.removeAccessory_2Dor3D(k,"Bubble",null),a.removeAccessoryAnimation_2Dor3D(k,k.lastAction),a.restoreAnimationState_2Dor3D(k),i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend&&(r.removeSprite(k,!0),r.resetSpritePosition()))}u.cmActionManager.removeAllTask(M.CMShowCompletionStatus.CMShowCompletionStatusInterrupt)}u.cmActionManager.lastBasicActionType=M.CMShowBasicActionType.CMShowBasicActionTypeSingleAction;var f=r.findSprite(C.uin);if(null===f){if(i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend)return void c.CMShowLog(1,t,"ani:"+s.cutUin(C.uin)+" is not exist! return");if(null===(f=C.uin===i.comGlobalParam.uin?r.loadSprite(C,s.getPosition(1,2),0,!1):r.loadSprite(C,s.getPosition(0,2),180,!1)))return void c.CMShowLog(1,t,"ani:"+s.cutUin(C.uin)+" is not exist! return");d.skeleManager.isSpriteShow=!0}if(f.actionData=C,(b=new m.CMShowActionTask({spriteArray:[f],taskId:l})).audio=o.audio?o.audio:null,a.doSpriteAction(b),i.comGlobalParam.aioType===M.CMShowAIOType.CMShowAIOTypeFriend){for(var y=null,A=0;A<d.skeleManager.spriteList.length;A++)d.skeleManager.spriteList[A].uin!==C.uin&&(y=d.skeleManager.spriteList[A]);y&&!y.is2D()&&a.doThinkingAction(new m.CMShowActionTask({spriteArray:[y]}))}}else{u.cmActionManager.lastBasicActionType=M.CMShowBasicActionType.CMShowBasicActionTypeDoubleAction,p[0].uin===p[1].uin&&i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend&&(p[1].uin=p[1].uin+"#");var D=!1;for(g=0;g<p.length;g++){var k;if(!(k=r.findSprite(p[g].uin)))return c.CMShowLog(1,t,"ani:"+s.cutUin(p[g].uin)+" is not exist, return!"),void h.reportManager.reportErrorEvent(t+" ani:"+s.cutUin(p[g].uin)+" is undefined, return!",h.CmReportManager.SkeAni_Undefined_Error);if(k.actionData=p[g],k.needMirror=!1,k.uin!==i.comGlobalParam.uin&&(k.noCamera=!0),"3D"===o.model&&(k.uin===i.comGlobalParam.uin||void 0!==k.aioposition&&k.aioposition>0)&&0===k.actionData.isMaster){c.CMShowLog(1,t,"double action, need mirror."),D=!0;break}}if(D)for(A=0;A<p.length;A++){var _=r.findSprite(p[A].uin);_&&(_.needMirror=!0,c.CMShowLog(1,t,"double action, ani:"+s.cutUin(p[A].uin)+" need mirror."))}var b;(b=new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,taskId:l})).audio=o.audio?o.audio:null,a.doSpriteAction(b)}}function y(e){var t,o="sendSpriteMsg_0";try{t=JSON.parse(e)}catch(e){c.CMShowLog(1,o,"parse json error"+e),h.reportManager.reportErrorEvent("["+o+"] "+e,h.CmReportManager.Parse_Json_Error)}t.basicMsg&&n.sendActionMsg(t.basicMsg,"")}function A(e){c.CMShowLog(1,"stopSpriteAction_0","stop sprite_0, length:"+u.cmActionManager.taskArray.length);for(var t=0;t<u.cmActionManager.taskArray.length;t++){for(var o=u.cmActionManager.taskArray[t],n=0;n<o.spriteArray.length;n++){var s=o.spriteArray[n];s&&s.curTask&&(a.removeAccessoryAnimation_2Dor3D(s,s.lastAction),a.restoreAnimationState_2Dor3D(s),1===o.count&&i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend&&d.skeleManager.spriteList.length>1&&(r.removeSprite(s,!0),r.resetSpritePosition()))}o.audio&&o.player&&(o.player.stopMusic(),o.player=null)}u.cmActionManager.removeAllTask(M.CMShowCompletionStatus.CMShowCompletionStatusInterrupt)}function D(){var e="clearSprite_script";c.CMShowLog(0,e,"enter sendMsg");var t="stopAction_bid_"+u.cmActionManager.lastActionType;if(i.comGlobalParam.functionMap[t]&&u.cmActionManager.taskArray.length>0){var o=u.cmActionManager.taskArray[0]?u.cmActionManager.taskArray[0].taskId:-1;c.CMShowLog(1,e,"invoke function:"+t+", stopTaskId:"+o),i.comGlobalParam.functionMap[t](o)}u.cmActionManager.taskArray.splice(0,u.cmActionManager.taskArray.length),S.startTicker();for(var a=0;a<d.skeleManager.spriteList.length;a++){var n=d.skeleManager.spriteList[a];n.is2D()||n.hide3DNamePlate(),c.CMShowLog(1,e,"delete skeAni:"+s.cutUin(n.uin)),d.skeleManager.destroyingList.push(n)}d.skeleManager.spriteList.splice(0,d.skeleManager.spriteList.length)}function k(e,t,o){switch(u.cmActionManager.addWaitAction(e),d.skeleManager.initActionCallBack(void 0),o){case M.CMShowDefTaskID.CMShowDefTaskIDStandUp:a.doStandUpAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList}));break;case M.CMShowDefTaskID.CMShowDefTaskIDWaiting:a.doWaitingAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList}));break;case M.CMShowDefTaskID.CMShowDefTaskIDGetDown:a.doGetDownAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList}))}u.cmActionManager.lastActionType=t}t.playAction=function e(t,o){var p="playAction";o=o||0,c.CMShowLog(1,p,"enter playAction, actionJson:"+t+", entry:"+o);var C=Date.now();if(C-g<w&&i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend&&3===u.cmActionManager.taskArray.length)c.CMShowLog(1,p,"play frequency is too fast, return");else{var f;try{f=JSON.parse(t)}catch(e){return c.CMShowLog(1,p,"parse actionJson error:"+e+", json:"+t),void h.reportManager.reportErrorEvent("["+p+"] "+e,h.CmReportManager.Parse_Json_Error)}if(!function(e){var t=!0;if(e.actionType===M.CMShowActionType.CMShowActionTypeWhiteFace)(!e.actions||e.actions.length<=0)&&(t=!1);else{var o=e.sprites;if(!o||o.length<=0)t=!1;else for(var n=0,s=0;s<o.length;s++)(!o[s].action||o[s].action.length<=0)&&n++,n===o.length&&(t=!1)}return t||d.skeleManager.alreadyInitSprite||(r.loadSpriteWithAIOType(e.sprites,i.comGlobalParam.aioType),d.skeleManager.alreadyInitSprite=!0,a.doWaitingAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList}))),c.CMShowLog(1,"checkActionData","checkData isValid:"+t),t}(f))return c.CMShowLog(1,p,"data invalid, return"),void h.reportManager.reportErrorEvent("[playAction] action data unusual",h.CmReportManager.Data_Unusual_Error);l.preLoadRes(f,o,function(){g=C;var l=function(e){var t=e.sprites,o=!1;if(i.comGlobalParam.platform===i.CMShowPlatformString_iOS||1450!==e.actionId&&1454!==e.actionId||(e.actionType=6,i.comGlobalParam.isLoadSixScript||(BK.Script.loadlib("BaseJs://cmshow_script_6.js"),playSpriteAction&&i.comGlobalParam.registerFunction("playAction_bid_6",playSpriteAction),sendSpriteMsg&&i.comGlobalParam.registerFunction("sendMsg_bid_6",sendSpriteMsg),stopSpriteAction&&i.comGlobalParam.registerFunction("stopAction_bid_6",stopSpriteAction),i.comGlobalParam.isLoadSixScript=!0,c.CMShowLog(1,"revisedData","load 6 script!")),o=!0),i.comGlobalParam.aioType===M.CMShowAIOType.CMShowAIOTypeFriend&&2===t.length&&t[0].uin===t[1].uin){for(var a=!1,n=0;n<t.length;n++){var r=t[n];r.action&&-1!==r.action.indexOf("action_peer")&&(r.isMaster=0,r.uin=t[1].uin+"#",a=!0)}return t.length>1&&!1===a&&(t[1].isMaster=0,t[1].uin=t[1].uin+"#",t[1].action=""),e.sprites=t,e}return o?e:null}(f);l&&(f=l,t=JSON.stringify(f));var w="playAction_bid_"+f.actionType,y=f.from,A=f.sprites,_=f.taskId;if(d.skeleManager.loadSpriteNum=A.length,c.CMShowLog(1,p,"funcName:"+w+", taskId:"+_+", from:"+y),0===o){if(!d.skeleManager.isSpriteShow){if(1===y)return;return h.reportManager.dressNum=0,d.skeleManager.isSpriteShow=!0,c.CMShowLog(1,p,"sprite is hidden, load sprite first"),f.actionType===M.CMShowActionType.CMShowActionTypeWhiteFace&&i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend?(n.notifySpriteStatusChanged(M.CMShowNotifyStatus.CMShowNotifyStatusGetDown),void e(t,0)):(r.loadSpriteWithAIOType(A,i.comGlobalParam.aioType),d.skeleManager.spriteStatus=M.CMShowActionStatus.CMShowActionStatusNone,void(f.actionType===M.CMShowActionType.CMShowActionTypeWhiteFace?k(t,f.actionType,M.CMShowDefTaskID.CMShowDefTaskIDWaiting):k(t,f.actionType,M.CMShowDefTaskID.CMShowDefTaskIDStandUp)))}if(d.skeleManager.spriteStatus===M.CMShowActionStatus.CMShowActionStatusGetDown)return u.cmActionManager.lastActionType===M.CMShowActionType.CMShowActionTypeWhiteFace&&i.comGlobalParam.aioType!==M.CMShowAIOType.CMShowAIOTypeFriend&&u.cmActionManager.lastActionType===f.actionType||u.cmActionManager.waitAction.splice(0,u.cmActionManager.waitAction.length),void u.cmActionManager.addWaitAction(t);if(d.skeleManager.spriteStatus===M.CMShowActionStatus.CMShowActionStatusStandUp){for(var b=0;b<d.skeleManager.spriteList.length;b++){var T=d.skeleManager.spriteList[b];a.removeAccessoryAnimation_2Dor3D(T,M.CMShowDefActionName.CMShowDefActionNameStandUp),a.restoreAnimationState_2Dor3D(T)}u.cmActionManager.waitAction.splice(0,u.cmActionManager.waitAction.length)}if(u.cmActionManager.taskArray.length>0&&u.cmActionManager.lastActionType!==f.actionType){var P="stopAction_bid_"+u.cmActionManager.lastActionType;if(i.comGlobalParam.functionMap[w]){var v=u.cmActionManager.taskArray[0]?u.cmActionManager.taskArray[0].taskId:-1;i.comGlobalParam.functionMap[P](v),u.cmActionManager.taskArray.splice(0,u.cmActionManager.taskArray.length),n.notifyActionStatusChanged(v,M.CMShowCompletionStatus.CMShowCompletionStatusInterrupt),d.skeleManager.initActionCallBack(void 0)}}else if(u.cmActionManager.lastActionType===f.actionType){var L=null;for(b=0;b<u.cmActionManager.taskArray.length;b++){var I=u.cmActionManager.taskArray[b];if(I.taskId===_){L=I;break}}if(L){var B="stopAction_bid_"+u.cmActionManager.lastActionType;if(i.comGlobalParam.functionMap[B]&&i.comGlobalParam.functionMap[B](_),u.cmActionManager.removeTaskById(_,M.CMShowCompletionStatus.CMShowCompletionStatusInterrupt),0===u.cmActionManager.taskArray.length){for(b=0;b<d.skeleManager.spriteList.length;b++)d.skeleManager.restoreOldSprite(d.skeleManager.spriteList[b],!1);d.skeleManager.initActionCallBack(void 0),i.comGlobalParam.aioPanelClose?a.doGetDownAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList})):a.doThinkingAction(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,repeatCnt:3}))}return}}}if(i.comGlobalParam.aioType===M.CMShowAIOType.CMShowAIOTypeFriend){if(d.skeleManager.spriteStatus===M.CMShowActionStatus.CMShowActionStatusGetDown_Down){if(d.skeleManager.changeSpriteTo2Dor3D(f),f.actionType!==M.CMShowActionType.CMShowActionTypeWhiteFace)return void k(t,f.actionType,M.CMShowDefTaskID.CMShowDefTaskIDStandUp)}else if(r.findSprite(A[0].uin)||(r.loadSpriteWithAIOType(A,M.CMShowAIOType.CMShowAIOTypeFriend),n.notifySpriteStatusChanged(M.CMShowNotifyStatus.CMShowNotifyStatusStandUp)),d.skeleManager.changeSpriteTo2Dor3D(f),f.actionType===M.CMShowActionType.CMShowActionTypeWhiteFace)return void k(t,f.actionType,M.CMShowDefTaskID.CMShowDefTaskIDGetDown)}else{if(f.actionType===M.CMShowActionType.CMShowActionTypeWhiteFace&&(d.skeleManager.spriteList.length>0&&D(),i.comGlobalParam.functionMap[w])){if(c.CMShowLog(1,p,"invoke function:"+w),d.skeleManager.clearCallback(),u.cmActionManager.lastActionType===M.CMShowActionType.CMShowActionTypeWhiteFace){var G=u.cmActionManager.taskArray.pop();G&&n.notifyActionStatusChanged(G.taskId,M.CMShowCompletionStatus.CMShowCompletionStatusComplete)}return u.cmActionManager.lastActionType=f.actionType,u.cmActionManager.taskArray.push(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,taskId:_})),S.startTicker(),void i.comGlobalParam.functionMap[w](t)}if(d.skeleManager.spriteStatus===M.CMShowActionStatus.CMShowActionStatusGetDown_Down)return d.skeleManager.clearNoMatchedSprite(f.sprites)||r.loadSpriteWithAIOType(f.sprites,M.CMShowAIOType.CMShowAIOTypeTroop),d.skeleManager.changeSpriteTo2Dor3D(f),void k(t,f.actionType,M.CMShowDefTaskID.CMShowDefTaskIDStandUp);if(u.cmActionManager.lastActionType===M.CMShowActionType.CMShowActionTypeBasic&&u.cmActionManager.lastBasicActionType===M.CMShowBasicActionType.CMShowBasicActionTypeSingleAction&&u.cmActionManager.taskArray.length>0&&1===A.length){for(var O=!1,R=0;R<d.skeleManager.spriteList.length;R++)d.skeleManager.spriteList[R].uin===A[0].uin&&(O=!0);if(!O){var N=i.comGlobalParam.uin===A[0].uin?0:180;r.loadSprite(A[0],s.getPosition(d.skeleManager.spriteList.length,d.skeleManager.spriteList.length+1),N,!1),d.skeleManager.isSpriteShow=!0}}else d.skeleManager.clearNoMatchedSprite(f.sprites)||r.loadSpriteWithAIOType(A,M.CMShowAIOType.CMShowAIOTypeTroop);d.skeleManager.changeSpriteTo2Dor3D(f)}i.comGlobalParam.functionMap[w]?(u.cmActionManager.lastActionType=f.actionType,f.actionType!==M.CMShowActionType.CMShowActionTypeBasic&&(d.skeleManager.clearCallback(),u.cmActionManager.taskArray.push(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,taskId:_}))),S.startTicker(),c.CMShowLog(1,p,"invoke function:"+w+", lastActionType:"+u.cmActionManager.lastActionType),i.comGlobalParam.functionMap[w](t)):(c.CMShowLog(1,p,"function:"+w+" not registered!"),h.reportManager.reportErrorEvent("["+p+"] function:"+w+" not found",h.CmReportManager.Func_Not_Found_Error))})}},t.playDrawerInfoAction=function(e){var t="playDrawerInfoAction";if(c.CMShowLog(1,t,"enter playDrawerInfoAction, actionJson:"+e),d.skeleManager.aioStatus!==M.CMShowAIOStatusType.CMShowAIOStatusTypePause){var o;try{o=JSON.parse(e),c.CMShowLog(1,t,"taskId:"+o.taskId)}catch(e){return c.CMShowLog(1,t,"parse Json error:"+e),void h.reportManager.reportErrorEvent("["+t+"] "+e,h.CmReportManager.Parse_Json_Error)}var n="playAction_bid_"+o.actionType;if(!o.sprites||o.sprites.length<=0)h.reportManager.reportErrorEvent("["+t+"] action data unusual, sprites is empty",h.CmReportManager.Data_Unusual_Error);else{var l=o.sprites[0].uin,p=r.findSprite(l);if(!p){if("3D"!==o.sprites[0].model||i.comGlobalParam.location!==M.CMShowLocationType.CMShowLocationTypeDrawer)return h.reportManager.reportErrorEvent("["+t+"] drawer ani is undefined",h.CmReportManager.SkeAni_Undefined_Error),void c.CMShowLog(1,t,"skeAni is not exists. uin:"+s.cutUin(l));if(!(p=C(e,!0)))return void c.CMShowLog(1,t,"reloadSprite is error. uin:"+s.cutUin(l))}if(!i.comGlobalParam.functionMap[n])return c.CMShowLog(1,t,"function is not exists. funcName:"+n),void h.reportManager.reportErrorEvent("["+t+"] function:"+n+" not found",h.CmReportManager.Func_Not_Found_Error);if(u.cmActionManager.taskArray.splice(0,u.cmActionManager.taskArray.length),o.actionType!==M.CMShowActionType.CMShowActionTypeBasic&&(d.skeleManager.clearCallback(),u.cmActionManager.taskArray.push(new m.CMShowActionTask({spriteArray:d.skeleManager.spriteList,taskId:o.taskId}))),d.skeleManager.initActionCallBack(void 0),S.startTicker(),p.model!==o.model&&i.comGlobalParam.location===M.CMShowLocationType.CMShowLocationTypeDrawer&&(d.skeleManager.drawerNoRestore=!0,d.skeleManager.androidNeedRestore=!0,d.skeleManager.changeSpriteTo2Dor3D(o)),i.comGlobalParam.functionMap[n](e),o.actionType!==M.CMShowActionType.CMShowActionTypeInterActive&&p.pet&&o.sprites[0].pet&&o.sprites[0].pet.petAction){c.CMShowLog(1,t,"pet action:"+o.sprites[0].pet.petAction);var g=s.cutUin(p.uin)+"_"+o.taskId;a.setAccessoryAnimationByBuffer(p.pet,o.sprites[0].pet.petAction,g),a.setAnimation_2Dor3D(p.pet,o.taskId,g,0)}}}else c.CMShowLog(1,t,"current aioStatus:"+d.skeleManager.aioStatus+", return")},t.sendMsg=function(e){var t,o="sendMsg";c.CMShowLog(0,o,"enter sendMsg, msgJson:"+e);try{t=JSON.parse(e)}catch(e){return c.CMShowLog(1,o,"parse json error"+e),void h.reportManager.reportErrorEvent("[sendMsg] "+e,h.CmReportManager.Parse_Json_Error)}var a="sendMsg_bid_"+t.type;i.comGlobalParam.functionMap[a]&&(c.CMShowLog(1,o,"invoke function:"+a),i.comGlobalParam.functionMap[a](e))},t.clearSprite=function(){D(),S.stopTicker(!0)},t.clearSprite_script=D,p.addTerminalEventListener(),BK.Director.ticker.add(function(){var e="disposeSprite";if(i.comGlobalParam.frameCount++,d.skeleManager&&d.skeleManager.destroyingList&&d.skeleManager.destroyingList.length>0){for(var t=d.skeleManager.destroyingList,o=0;o<t.length;++o){var a=t[o];c.CMShowLog(0,e,"uin:"+s.cutUin(a.uin)),a.is2D()&&(a.nameplate&&(a.nameplate.text&&(a.nameplate.text.removeFromParent(),a.nameplate.text.dispose()),a.nameplate.removeFromParent(),a.nameplate.dispose()),a&&a.pet&&(a.pet.removeFromParent(),a.pet.dispose()),a.removeFromParent()),c.CMShowLog(1,e,"uin:"+s.cutUin(a.uin)+",is2D:"+a.is2D()),a.isDispose=!0,a.dispose()}t.splice(0,t.length),d.skeleManager.spriteList&&0==d.skeleManager.spriteList.length&&0==u.cmActionManager.taskArray.length&&S.stopTicker(!1)}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(0);t.console=a.console,t.myLog=a.myLog;var i=o(1);t.CMShowLocationType=i.CMShowLocationType,t.CMShowAIOType=i.CMShowAIOType,t.LOCATION_TYPE=i.LOCATION_TYPE,t.AIO_TYPE=i.AIO_TYPE;var n=o(2);t.comGlobalParam=n.comGlobalParam,t.drawerCommParam=n.drawerCommParam,t.cardCommParam=n.cardCommParam,t.GameStatusInfo=n.GameStatusInfo,t.registerFunction=n.registerFunction,t.registerPlayerAudio=n.registerPlayerAudio;var r=o(13);t.commonInit=r.commonInit,t.initSprite=r.initSprite,t.initDrawerInfoSprite=r.initDrawerInfoSprite,t.playAction=r.playAction,t.playDrawerInfoAction=r.playDrawerInfoAction,t.sendMsg=r.sendMsg,t.clearSprite_script=r.clearSprite_script;var s=o(8);t.loadRoleByBuffer=s.loadRoleByBuffer,t.setAccessoryByBuffer=s.setAccessoryByBuffer,t.setAccessoryWithInfo_2Dor3D=s.setAccessoryWithInfo_2Dor3D,t.getSprite=s.getSprite,t.removeAccessory_2Dor3D=s.removeAccessory_2Dor3D,t.createSpriteName=s.createSpriteName,t.loadNamePlate=s.loadNamePlate,t.setAccessoryByBuffer_3D=s.setAccessoryByBuffer_3D;var c=o(10);t.setAccessoryAnimationByBuffer=c.setAccessoryAnimationByBuffer,t.setAnimation_2Dor3D=c.setAnimation_2Dor3D,t.removeAccessoryAnimation_2Dor3D=c.removeAccessoryAnimation_2Dor3D,t.containAnimation=c.containAnimation,t.restoreAnimationState_2Dor3D=c.restoreAnimationState_2Dor3D,t.setStartCallBack=c.setStartCallBack,t.setCompleteCallBack=c.setCompleteCallBack,t.setEndCallBack=c.setEndCallBack,t.onActionStart=c.onActionStart,t.onActionComplete=c.onActionComplete,t.onActionInterrupt=c.onActionInterrupt;var l=o(7);t.showOrRemoveActionBarrage=l.showOrRemoveActionBarrage,t.sendActionMsg=l.sendActionMsg,t.reportTraceEndEvent=l.reportTraceEndEvent;var p=o(3);t.cutUin=p.cutUin,t.checkAndComplete3DRes=p.checkAndComplete3DRes,t.versionCompare=p.versionCompare,t.getPosition=p.getPosition;var h=o(6);t.addFrame=h.addFrame},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(4),n=o(0),r=o(2),s="CMShowSkeletonAni",c=function(){function e(e){this.uin="",this.model="",this.rotate=0,this.status=a.CMShowActionStatus.CMShowActionStatusNone,this.pet=null,this.rotation2D={x:0,y:0},this.facePath="",this.spriteData=null,this.actionData=null,this.lastAction="",this.taskID=0,this.curTask=null,this.showAction="",this.showActionType=a.CMShowActionType.CMShowActionTypeBasic,this.showActionModel={},this.needMirror=!1,this.hasMirror=!1,this.smokeUin="",this.isVip=!1,this.dressNum=0,this.actionStatus=a.CMShowCompletionStatus.CMShowCompletionStatusComplete,this.adjustPosition=void 0,this.isDispose=!1,this.noCamera=!1,this.namePlateWidth=0,this.aioCache3DPosition=-100,this.action=null,this.doGetDownOrStandUp=!1,this.roleId=0,this.actionStandUp="",this.actionGetDown="",this.actionSet=new Array,this.actionArray=new Array,this._model=e.model.toLowerCase(),this.__nativeObj=null,this.uin=e.name,this.is2D()?(e.atlas&&e.json?this._skeleton=new BK.SkeletonAnimation(e.atlas,e.json,e.timeScale,e.startCallBack,e.completeCallBack,e.endCallBack):this._skeleton=new BK.SkeletonAnimation,this.__nativeObj=this._skeleton):"3d"===this._model&&(this.cmModel=new cm3d.CmModel({}))}return e.prototype.is2D=function(){return"2d"===this._model},e.prototype.load=function(e){return e?this.is2D()?this._skeleton.load(e.jsonBuf,e.jsonPath,e.atlasBuf,e.atlasPath):void this.cmModel.load(e):(n.CMShowLog(1,s+"_load","opt is null!"),null)},e.prototype.loadAccessoryAnimation=function(e){e?this.is2D()&&this._skeleton.loadAccessoryAnimation(e.jsonBuf,e.jsonPath,e.atlasBuf,e.atlasPath,e.animationName):n.CMShowLog(1,s+"_loadAccessoryAnimation","opt is null!")},e.prototype.loadAccessory=function(e){e?this.is2D()?this._skeleton.loadAccessory(e.jsonBuf,e.jsonPath,e.atlasBuf,e.atlasPath):this.cmModel.loadAccessory(e):n.CMShowLog(1,s+"_loadAccessory","opt is null!")},e.prototype.setAnimation=function(e){e?this.is2D()?this._skeleton.setAnimation(e.track,e.name,!1):this.cmModel.setAnimation(e):n.CMShowLog(1,s+"_setAnimation","opt is null!")},e.prototype.setAccessory=function(e){e?this.is2D()?this._skeleton.setAccessory(e.jsonPath,e.atlasPath):this.cmModel.setAccessory(e):n.CMShowLog(1,s+"_setAccessory","opt is null!")},e.prototype.setModelWeights=function(e){this.is2D()||this.cmModel.setModelWeights(e)},e.prototype.setAccessoryAnimation=function(e){e?this.is2D()?this._skeleton.setAccessoryAnimation(e.jsonPath,e.atlasPath,e.animationName):this.cmModel.setAccessoryAnimation(e):n.CMShowLog(1,s+"_setAccessoryAnimation","opt is null!")},e.prototype.setAccessoryWithInfo=function(e){if(e)if(this.is2D())this._skeleton.setAccessoryWithInfo(e.jsonPath,e.atlasPath,e.content);else{if(!e.text||!e.image)return;var t=1|e.direction,o=void 0!==r.comGlobalParam&&r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer,i=void 0,c="25px";r.comGlobalParam.platform===r.CMShowPlatformString_iOS&&(c="25px PingFangSC");var l=1===t?"right":"left",p="",h=void 0!==e.needMirror&&e.needMirror,S=3;r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer?(i=[45,0,40],S=2,p="drawer"):(i=[-25,0,90],p="aio"),cm3d.CmPanelManager.getInstance().updatePanel(this.cmModel,{fillStyle:"#ffff00",font:c,lineWidth:.2,text:e.text,scale:S,position:i,image:e.image,scaleBackground:void 0!==e.scaleBackground,maxTextWidth:o?180:125,textOffsetX:o?40:20,textOffsetY:o?20:15,direction:l,type:p,needMirror:h},cm3d.scene,"Head_M")}else n.CMShowLog(1,s+"_setAccessoryWithInfo","opt is null!")},e.prototype.removeAccessory=function(e){e?this.is2D()?this._skeleton.removeAccessory(e.accessoryName):(void 0!==e.bubble&&cm3d.CmPanelManager.getInstance().hidePanel(this.cmModel,cm3d.scene),this.cmModel.removeAccessory(e)):n.CMShowLog(1,s+"_removeAccessory","opt is null!")},e.prototype.show3DNamePlate=function(e){var t=this;if(!this.is2D()){if(!e||!e.content||!e.imagePath)return void n.CMShowLog(1,s+"_show3DNamePlate","opt or content or imagePath is null!");BK.Director.ticker.setTimeout(function(){if(!0!==t.isDispose){n.CMShowLog(1,s+"_show3DNamePlate","content:"+e.content+", imagePath:"+e.imagePath),n.CMShowLog(0,s+"_show3DNamePlate","scale: "+r.comGlobalParam.scale);var o=1|e.direction,a=1===o?"right":"left",i=e.isVip?4286075101:4294967295,c=0===r.comGlobalParam.scale?1:r.comGlobalParam.scale,l=e.isVip?76*c:0,p=-1!==e.imagePath.indexOf("/28/")?44*c:171*c,h=e.isVip?1===o?l:p:0,S=e.isVip?1===o?p:l:0,m=-1!==e.imagePath.indexOf("/25/")?-44*c:0;m=-1!==e.imagePath.indexOf("/26/")?-52*c:m;var u=10*r.comGlobalParam.density,d=(77-u/c)/2*c;t.cmModel.showNamePlate({direction:a,imagePath:e.imagePath,padding:[d,S,0,h],parentBoneName:"Head_M",margin:52*r.comGlobalParam.density/2,y:m,imageScale:c,style:{fontSize:u,textColor:i,textAlign:1},context:e.content,flipU:1===o?0:1,platform:r.comGlobalParam.platform===r.CMShowPlatformString_iOS?0:1})}else n.CMShowLog(1,s+"_show3DNamePlate","ske is dispose, don't show nameplate")},.033,null)}},e.prototype.hide3DNamePlate=function(){var e=this;this.is2D()||BK.Director.ticker.setTimeout(function(){n.CMShowLog(1,s+"_hide3DNamePlate","hide name plate"),e.cmModel.hideNamePlate()},.033,null)},e.prototype.removeAccessoryAnimation=function(e){e?this.is2D()?this._skeleton.removeAccessoryAnimation(e.animationName):this.cmModel.removeAccessoryAnimation(e):n.CMShowLog(1,s+"_removeAccessoryAnimation","opt is null!")},e.prototype.getBoneNameBySlotName=function(e){if(e)return this.is2D()?this._skeleton.getBoneNameBySlotName(e.slotName):void 0;n.CMShowLog(1,s+"_getBoneNameBySlotName","opt is null!")},e.prototype.restoreAnimationState=function(){this.is2D()&&this._skeleton.restoreAnimationState()},e.prototype.setTimeScale=function(e){e?this.is2D()?this._skeleton.setTimeScale(e.timeScale):this.cmModel.setTimeScale(e.timeScale):n.CMShowLog(1,s+"_setTimeScale","opt is null!")},e.prototype.setStartCallback=function(e){if(e)if(this.is2D())this._skeleton.setStartCallback(e.callback);else{this.startCallbackStub||(this.startCallbackStub=function(){this.startCallback&&this.startCallback.apply(this,arguments)}.bind(this),this.cmModel.on(cm3d.CmModelEvent.AnimationStart,this.startCallbackStub)),this.startCallback=e.callback}else n.CMShowLog(1,s+"_setStartCallback","opt is null!")},e.prototype.setCompleteCallback=function(e){if(e)if(this.is2D())this._skeleton.setCompleteCallback(e.callback);else{this.completeCallbackStub||(this.completeCallbackStub=function(){this.completeCallback&&this.completeCallback.apply(this,arguments)}.bind(this),this.cmModel.on(cm3d.CmModelEvent.AnimationComplete,this.completeCallbackStub)),this.completeCallback=e.callback}else n.CMShowLog(1,s+"_setCompleteCallback","opt is null!")},e.prototype.setEndCallback=function(e){if(e)if(this.is2D())this._skeleton.setEndCallback(e.callback);else{this.endCallbackStub||(this.endCallbackStub=function(){this.endCallback&&this.endCallback.apply(this,arguments)}.bind(this),this.cmModel.on(cm3d.CmModelEvent.AnimationEnd,this.endCallbackStub)),this.endCallback=e.callback}else n.CMShowLog(1,s+"_setEndCallback","opt is null!")},e.prototype.getBonePosition=function(e){if(e)return this.is2D()?this._skeleton.getBonePosition(e.boneName):void 0;n.CMShowLog(1,s+"_getBonePosition","opt is null!")},e.prototype.containAnimation=function(e){if(e)return this.is2D()?this._skeleton.containAnimation(e.animationName):void this.cmModel.containAnimation(e);n.CMShowLog(1,s+"_containAnimation","opt is null!")},e.prototype.setMirror=function(){this.is2D()||this.cmModel.setMirror()},e.prototype.getSlotNames=function(){return this.is2D()&&this.__nativeObj?this.__nativeObj.getSlotNames():null},e.prototype.setOptions=function(e){e?this.is2D()&&this._skeleton.setOptions(e.opt):n.CMShowLog(1,s+"_setOptions","opt is null!")},e.prototype.dispose=function(){this.is2D()?this.__nativeObj&&this.__nativeObj.dispose():(this.pushBoundingBoxChange({x:0,y:0,w:0,h:0,bX:0,bY:0,bW:0,bH:0,dispose:1}),this.cmModel.dispose())},e.prototype.removeFromParent=function(){this.is2D()&&this.__nativeObj&&this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e){this.is2D()&&this.__nativeObj&&this.__nativeObj.addChild(e)},e.prototype.openAABBCallback=function(){this.is2D()&&this.__nativeObj&&this.__nativeObj.openAABBCallback()},e.prototype.pushBoundingBoxChange=function(e){if(!this.is2D()){var t="cs.script_update_boundinglist.local",o={cmd:t,x:e.x,y:e.y,w:e.w,h:e.h,bX:e.bX,bY:e.bY,bW:e.bW,bH:e.bH,name:this.name,dispose:e.dispose};BK.MQQ.Native.syncSend(o,t)}},e.prototype.on=function(e,t){this.is2D()||this.cmModel.on(e,t)},e.prototype.off=function(e,t){this.is2D()||this.cmModel.off(e,t)},e.prototype.createPetInfo=function(e){e.masterUin&&(this.uin=e.masterUin+"_pet",this.extendString=this.uin),e.petData&&(this.roleId=e.petData.roleId,this.actionStandUp=e.petData.standUp,this.actionGetDown=e.petData.getDown)},e.prototype.loadAccessory_2D=function(e,t,o){var a=i.res2DMap[t]&&i.res2DMap[t].length>0&&i.res2DMap[o]&&i.res2DMap[o].length>0;a?this.loadAccessory({model:"2D",jsonBuf:a?i.res2DMap[t]:null,jsonPath:t,atlasBuf:a?i.res2DMap[o]:null,atlasPath:o}):this.setAccessory({jsonPath:t,atlasPath:o}),n.CMShowLog(0,s+"_setAccessoryByBuffer_2D","setAccessory:"+e+" ok!")},Object.defineProperty(e.prototype,"aioposition",{get:function(){return this.cmModel.aioposition},set:function(e){this.is2D()||void 0!==e&&e!==a.SkeletonDirection.SkeletonDirectionNone&&(this.cmModel.aioposition=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.is2D()?this.__nativeObj?this.__nativeObj.id:0:-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.uuid=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){if(this.is2D()){if(this.__nativeObj)return this.__nativeObj.name}else if(this.cmModel)return this.cmModel.name;return""},set:function(e){this.is2D()?this.__nativeObj&&(this.__nativeObj.name=e):this.cmModel&&(this.cmModel.name=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extendString",{get:function(){return this.is2D()&&this.__nativeObj?this.__nativeObj.extendString:""},set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.extendString=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.is2D()?this.__nativeObj?this.__nativeObj.position:{x:0,y:0,z:0}:this.cmModel.localPosition},set:function(e){this.is2D()?this.__nativeObj&&(this.__nativeObj.position=e):this.cmModel.localPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){if(!this.is2D()){var e=this.cmModel.scale;return{x:e.x,y:e.y,z:e.z}}return this.__nativeObj?this.__nativeObj.scale:{x:0,y:0,z:0}},set:function(e){if(this.is2D())this.__nativeObj&&(this.__nativeObj.scale=e);else{var t=e.x,o=e.y,a=e.z;this.cmModel.scale.set(t,o,a)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.is2D()&&this.__nativeObj?this.__nativeObj.rotation:{x:0,y:0,z:0}},set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.rotation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.is2D()?!!this.__nativeObj&&this.__nativeObj.hidden:!this.cmModel.visible},set:function(e){this.is2D()?this.__nativeObj&&(this.__nativeObj.hidden=e):this.cmModel.visible=!e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canUserInteract",{get:function(){return!(!this.is2D()||!this.__nativeObj)&&this.__nativeObj.canUserInteract},set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.canUserInteract=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return!(!this.is2D()||!this.__nativeObj)&&this.__nativeObj.paused},set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.paused=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeScale",{get:function(){return this.is2D()?this.__nativeObj?this.__nativeObj.timeScale:0:-1},set:function(e){this.is2D()&&this.__nativeObj&&(this.__nativeObj.timeScale=e)},enumerable:!0,configurable:!0}),e}();t.CMShowSkeletonAni=c},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(2),i=o(1),n=o(6),r=o(0),s=o(3),c=o(4),l=o(5);function p(e,t,o,a,i){var n=s.getResPath(e+".json",null,t,o),r=s.getResPath(e+".atlas",null,t,o),l=s.getResPath(e+".png",null,t,o);c.res2DMap[n]||a.push({path:n}),c.res2DMap[r]||a.push({path:r}),c.res2DMap[l]||i.push({path:l,format:4,needCache:!0})}t.preLoadRes=function(e,t,o){if(a.comGlobalParam.qqVer&&s.versionCompare(a.comGlobalParam.qqVer,i.CMSHOW_ASYNCIO_QQ_VERSION)<0)o();else if(0!==t||e.actionType&&0!==e.actionType)o();else{for(var h=new Array,S=new Array,m=e.sprites,u=0;u<m.length;u++){var d=m[u];if("2D"===d.model){if(d.role&&d.role.length>0&&p(d.role,i.CMShowResType.CMShowResTypeRole,d.model,h,S),d.dress&&d.dress.length>0)for(var M=0;M<d.dress.length;M++)p(d.dress[M],i.CMShowResType.CMShowResTypeDress,d.model,h,S);if(d.pet){var C=d.pet;if(C.role&&C.role.length>0&&p(C.role,i.CMShowResType.CMShowResTypeRole,d.model,h,S),C.dress&&C.dress.length>0)for(var g=0;g<C.dress.length;g++)p(C.dress[g],i.CMShowResType.CMShowResTypeDress,d.model,h,S)}d.action&&d.action.length>0&&p(d.action,i.CMShowResType.CMShowResTypeAction,d.model,h,S)}}0!==h.length?(n.startTicker(),BK.fileSystem.readFile({file:h,success:function(e){r.CMShowLog(0,"preLoadRes","load file success,res length:"+e.length);for(var t=0;t<e.length;t++){var a=e[t];if(0==a.errcode){if(Object.getOwnPropertyNames(c.res2DMap).length>=150){var i=Object.getOwnPropertyNames(c.res2DMap)[0];delete c.res2DMap[i]}c.res2DMap[a.path]=a.data}else r.CMShowLog(1,"preLoadRes","readFile error:"+a.errcode+", path:"+a.path+", errorMsg:"+a.errmsg),l.reportManager.reportErrorEvent("[preLoadRes] readFile error:"+a.errcode+", path:"+a.path+", errorMsg:"+a.errmsg,l.CmReportManager.Read_File_Error)}BK.Texture.createTextures({file:S,success:function(e){r.CMShowLog(1,"preLoadRes","createTextures success, retObj length = "+e.length),o()}})}})):o()}},BK.Misc.qqVerLessthan=function(e,t){for(var o=e.split("."),a=t.split("."),i=Math.min(3,Math.min(o.length,a.length)),n=0;n<i;n++)if(o[n]<a[n])return!0;return!1},t.loadQQPlayCore=function(){var e;"object"==typeof(e=BK)&&(e.taskManager=new(function(){function e(){this.initTaskObserver()}return e.prototype.initTaskObserver=function(){this.taskQ=[],!1===BK.Misc.qqVerLessthan(a.comGlobalParam.qqVer,"7.8.0")&&BK.Director.ticker.add(function(){for(var e=BK.TaskManager.getCompleteQueue();e.length>0;)for(var t=e.shift(),o=0;o<this.taskQ.length;o++){var a=this.taskQ[o];if(a.taskId==t.id){this.taskQ.splice(o,1),a.callback(t.res);break}}}.bind(this))},e.prototype.pushTask=function(e,t,o){-1!=e&&this.taskQ.push({taskId:e,taskInfo:t,callback:o})},e.prototype.cancelTask=function(e){-1!=e&&!1===BK.Misc.qqVerLessthan(a.comGlobalParam.qqVer,"7.8.0")&&BK.TaskManager.cancelTask(e)},e}())),function(e,t){"object"==typeof e&&(e.fileSystem=new(function(){function e(){}return e.prototype.readFile=function(e){if(!1===BK.Misc.qqVerLessthan(a.comGlobalParam.qqVer,"7.8.0")){if(e&&e.file){for(var t=[],o=0;o<e.file.length;o++)null!=e.file[o].path&&t.push({tag:1,path:e.file[o].path,encoding:null==e.file[o].encoding?"binary":e.file[o].encoding});var i=BK.FileUtil.addReadIOTask(t);BK.taskManager.pushTask(i,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}}else{var n=[];if(e&&e.file)for(var o=0;o<e.file.length;o++){var r=e.file[o];if(r.path){var s=BK.FileUtil.readFile(r.path);n.push({errcode:s?0:-1,errmsg:s?"":"read failed!",path:r.path,data:s})}}e.success&&e.success(n),e.complete&&e.complete()}},e}()))}(BK),function(e,t){"object"==typeof e&&(e.Texture=(BK.Texture.createTextures=function(e){if(!e)return BK.Script.log(1,1,"object.file is null"),e.fail&&e.fail({errmsg:"object.file is null"}),void(e.complete&&e.complete());if(e&&e.file){for(var t=new Array,o=0;o<e.file.length;o++)e.file[o].path&&t.push({tag:3,path:e.file[o].path,format:e.file[o].format?e.file[o].format:6,needCache:!!e.file[o].needCache&&e.file[o].needCache,isPremultiply:1});BK.Image.loadImages({file:t,success:function(t){for(var o=0;o<t.length;o++)if(0==t[o].errcode){var i=t[o].image,n=null;(n=0==BK.Misc.qqVerLessthan(a.comGlobalParam.qqVer,"7.8.0")?BK.Texture.createBitmapTexture(i.width,i.height,i.format,t[o].path):BK.Texture.createBitmapTexture(i.width,i.height,i.format))?(n.uploadData(i.buffer),t[o].texture=n):(t[o].errcode=-2,t[o].errmsg="createTexture null, failed"),delete t[o].image}else t[o].errcode=-3,t[o].errmsg="createImage null, failed";e.success&&e.success(t),e.complete&&e.complete()},fail:function(t){e.fail&&e.fail(t),e.complete&&e.complete()}})}else e.fail&&e.fail({errmsg:"object.file is null"}),e.complete&&e.complete()},BK.Texture))}(BK),function(e,t){var o;"object"==typeof e&&(e.Image=(o=BK.Image,function(){function e(){}return e.dispose=function(e){return o.dispose(e)},e.loadImage=function(e,t){if(e)return t?o.loadImage(e,t):o.loadImage(e,6);BK.Script.log(1,1,"BK.Image.loadImage failed! ")},e.loadImages=function(e){if(!e)return BK.Script.log(1,1,"object.file is null"),e.fail&&e.fail({errmsg:"object.file is null"}),void(e.complete&&e.complete());if(0==BK.Misc.qqVerLessthan(a.comGlobalParam.qqVer,"7.8.0"))if(e&&e.file){for(var t=new Array,i=0;i<e.file.length;i++)e.file[i].path&&t.push({tag:3,path:e.file[i].path,format:e.file[i].format?e.file[i].format:6,isPremultiply:e.file[i].isPremultiply?e.file[i].isPremultiply:0});var n=o.loadImageAsync(t);BK.taskManager.pushTask(n,t,function(t){e.success&&e.success(t),e.complete&&e.complete()})}else e.fail&&e.fail({errmsg:"object.file is null"}),e.complete&&e.complete();else{var r=[];if(e&&e.file)for(var i=0;i<e.file.length;i++){var s=e.file[i];if(s.path){var c=o.loadImage(s.path,e.file[i].format?e.file[i].format:6);r.push({errcode:c?0:-1,errmsg:c?"":"load image failed!",path:s.path,image:c})}}e.success&&e.success(r),e.complete&&e.complete()}},e}()),e.Image.loadImageSync=e.Image.loadImage)}(BK)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o(1),i=o(6),n=o(0),r=o(2),s=o(13),c=o(7),l=o(9),p=o(4),h=o(10),S=o(11),m=o(3),u=o(8),d=o(12),M=o(5);function C(e,t){n.CMShowLog(1,"spriteModelChange","model change!");var o=e.position,i=e.rotate;u.removeSprite(e,!0),void 0===t.scale&&"2D"===t.model&&(t.scale=r.comGlobalParam.scale,r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer?t.scale=r.drawerCommParam.scale:r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeFCard&&(t.scale=r.cardCommParam.scale)),M.reportManager.needNotifyDressReady=!0,u.loadSprite(t,o,i,!1),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO?r.comGlobalParam.aioPanelClose?h.doWaitingAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList})):h.doThinkingAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList})):r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeFCard&&h.doJumpUpAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}))}function g(e,t){var o=[],i=null;if(e.is2D()?o=t.dress:t["3DObject"]&&t["3DObject"].dress&&(o=t["3DObject"].dress,t["3DObject"].faceModel&&(i=t["3DObject"].faceModel.path)),!o||o.length<=0)return n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_DressReady,"dress is null, return"),void M.reportManager.reportErrorEvent("["+a.BKListenerCMD_SC.BKListenerCMD_SC_DressReady+"], spriteDressChange, dress data is null",M.CmReportManager.Data_Unusual_Error);if(r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&r.comGlobalParam.platform===r.CMShowPlatformString_iOS&&(p.skeleManager.spriteDressInfo=o),!e.is2D()&&e.spriteData&&e.spriteData["3DObject"]&&e.spriteData["3DObject"].dress)for(var s=e.spriteData["3DObject"].dress,c=0;c<s.length;c++){var l=m.getResPath(s[c],"dress.bin",a.CMShowResType.CMShowResTypeDress,"3D");u.removeAccessory_2Dor3D(e,"dress_"+c,l)}"3D"===t.model&&i&&u.setAccessoryByBuffer(e,i,!0);for(var h=0;h<o.length;h++)u.setAccessoryByBuffer(e,o[h],!1);if(!e.is2D()&&e.facePath&&e.facePath.length>0&&u.setAccessoryByBuffer_3D(e,e.facePath,!1,!0),e.spriteData=t,"2D"===t.model&&t.pet){var S=t.pet;if(S.role){if(e.pet){var d=e.pet;p.skeleManager.destroyingList.push(d)}u.loadPet(e,S,e.position,e.rotate,!1)}else e.pet&&(e.pet.hidden=!0,p.skeleManager.destroyingList.push(e.pet),e.pet=null,n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_DressReady,"destory pet"))}}t.addTerminalEventListener=function(){BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_SpriteIsShow,null,function(e,t,o){n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_SpriteIsShow,"is show: "+o.isShow),1===o.isShow?p.skeleManager.isSpriteShow=!0:(p.skeleManager.isSpriteShow=!1,s.clearSprite_script(),r.comGlobalParam.scale=r.comGlobalParam.originScale,c.notifySpriteStatusChanged(a.CMShowNotifyStatus.CMShowNotifyStatusHidden),l.cmActionManager.removeAllTask(a.CMShowCompletionStatus.CMShowCompletionStatusInterrupt))}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_UserOperation,null,function(e,t,o){var s=a.BKListenerCMD_SC.BKListenerCMD_SC_UserOperation;switch(n.CMShowLog(1,""+s,"data status: "+o.status),o.status){case 1:p.skeleManager.aioStatus=a.CMShowAIOStatusType.CMShowAIOStatusTypePause;for(var m=0;m<l.cmActionManager.taskArray.length;m++){var d=l.cmActionManager.taskArray[m];d.audio&&d.player&&d.playedAudio&&(d.player.stopMusic(),d.playedAudio=!1,r.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO&&l.cmActionManager.removeTaskById(d.taskId,a.CMShowCompletionStatus.CMShowCompletionStatusNone))}r.comGlobalParam.otherScriptAudio&&r.comGlobalParam.otherScriptAudio.stopMusic(),r.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO&&p.skeleManager.spriteList.length>0&&(i.startTicker(),p.skeleManager.spriteList[0]?(u.removeAccessory_2Dor3D(p.skeleManager.spriteList[0],a.CMSHOW_BUBBLE_ACCESSORY_NAME,null),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer&&r.comGlobalParam.platform===r.CMShowPlatformString_Android&&p.skeleManager.androidNeedRestore&&(p.skeleManager.drawerNoRestore=!1,p.skeleManager.restoreOldSprite(p.skeleManager.spriteList[0],!0),p.skeleManager.androidNeedRestore=!1)):(n.CMShowLog(1,""+s,"sprite[0] is undefined"),M.reportManager.reportErrorEvent("["+s+"], sprite[0] is undefined",M.CmReportManager.SkeAni_Undefined_Error))),i.stopTicker(!0);break;case 2:if(p.skeleManager.aioStatus=a.CMShowAIOStatusType.CMShowAIOStatusTypeResume,i.startTicker(),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO)return;for(m=0;m<p.skeleManager.spriteList.length;m++){var C=p.skeleManager.spriteList[m];if(u.removeAccessory_2Dor3D(C,a.CMSHOW_BUBBLE_ACCESSORY_NAME,null),h.restoreAnimationState_2Dor3D(C),r.comGlobalParam.platform===r.CMShowPlatformString_iOS&&r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeDrawer)for(var g=0;g<p.skeleManager.spriteDressInfo.length;g++)u.setAccessoryByBuffer(C,p.skeleManager.spriteDressInfo[g],!1);C.pet&&h.restoreAnimationState_2Dor3D(C.pet)}if(r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeFCard)p.skeleManager.initActionCallBack(void 0),h.doJumpUpAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}));else{for(var w=0;w<p.skeleManager.spriteList.length;w++){var f=p.skeleManager.spriteList[w];f.hidden=!1,f.pet&&(f.pet.hidden=!1)}c.notifySpriteDoAction()}}}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,null,function(e,t,o){if(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,"data: "+o+", clickPart:"+o.clickPart+", location:"+r.comGlobalParam.location),p.skeleManager.aioStatus!==a.CMShowAIOStatusType.CMShowAIOStatusTypePause){if(o.clickPart!==a.SpriteClickPart.SpriteClickPartGift||r.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO)if(o.clickPart===a.SpriteClickPart.SpriteClickPartBubble&&r.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO)c.notifyTerminalClickInfo(o.clickPart,o.apolloId,p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusJumpUp?0:1);else{if(r.comGlobalParam.location!==a.CMShowLocationType.CMShowLocationTypeAIO)return c.notifyTerminalClickInfo(o.clickPart,o.apolloId,p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusJumpUp?0:1),void(p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusJumpUp&&h.doJumpDownAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList})));if(o.apolloId&&o.apolloId.indexOf("pet")>=0){var s=m.getMasterByPetId(o.apolloId);if(!s||!s.pet)return void n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,"pet master not exist");var M=c.getPetAction(s,!1);if(!M)return void n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,"pet action is null");var C=m.cutUin(s.pet.uin)+"_"+M.actionId;s.pet.action=M,i.startTicker(),h.setAccessoryAnimationByBuffer(s.pet,M.path,C),h.setAnimation_2Dor3D(s.pet,M.actionId,C,0)}if(p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusStandUp||p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusGetDown)return;if(p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusStandUp_Down&&0===l.cmActionManager.taskArray.length)return h.doGetDownAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList})),void c.notifyChangePanelStatus(1);if(0===l.cmActionManager.taskArray.length){p.skeleManager.initActionCallBack(void 0);var g=c.getShowActionRes();if(g&&g.path)for(var w=g.path,f=0;f<w.length;f++){var y=u.findSprite(w[f].uin);if(y&&(y.showActionModel=w[f].model,y.showAction=w[f].path,y.showActionType=w[f].actionType,r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend)){var A=u.findSprite(w[f].uin+"#");A&&(A.showAction=w[f].path)}}d.hasInit3DLib()?BK.Director.ticker.setTimeout(function(){h.doStandUpAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}))},200,null):h.doStandUpAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}))}else n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,"script_on_sprite_single_clicked has other task");c.notifyChangePanelStatus(2)}}else n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ClickPart,"current aioStatus:"+p.skeleManager.aioStatus+", return")}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_PanelStatus,null,function(e,t,o){if(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_PanelStatus,"data status: "+o.status),1===o.status){if(r.comGlobalParam.aioPanelClose=!0,p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusGetDown_Down||l.cmActionManager.taskArray.length>0)return;p.skeleManager.initActionCallBack(void 0),h.doGetDownAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}))}else{if(r.comGlobalParam.aioPanelClose=!1,p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusStandUp_Down||p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusStandUp||l.cmActionManager.taskArray.length>0)return;p.skeleManager.initActionCallBack(void 0),h.doStandUpAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList}))}}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_DressReady,null,function(e,t,o){var s=a.BKListenerCMD_SC.BKListenerCMD_SC_DressReady;if(n.CMShowLog(1,""+s,"aioStatus:"+p.skeleManager.aioStatus+" location:"+r.comGlobalParam.location),!o.dressInfo)return n.CMShowLog(1,""+s,"dress info is null"),void M.reportManager.reportErrorEvent("["+s+"], dress info is null, return",M.CmReportManager.Data_Unusual_Error);for(var c=o.dressInfo,h=i.getTickerStatus(),S=0;S<c.length;S++){var d=c[S];r.comGlobalParam.qqVer&&m.versionCompare(r.comGlobalParam.qqVer,a.CMSHOW_3D_QQ_VERSION)<0&&(d.model="2D");var w=u.findSprite(d.uin);if(!w)return void n.CMShowLog(1,""+s,"ani not found, uin:"+m.cutUin(d.uin)+", return");if(i.startTicker(),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend&&r.comGlobalParam.uin!==w.uin&&w.model!==d.model)return n.CMShowLog(1,""+s,"disqualification return"),void(h&&i.stopTicker(!0));for(var f=!1,y=0;y<p.skeleManager.restoreList.length;y++)p.skeleManager.restoreList[y].uin===w.uin&&(f=!0);if(w.model===d.model||f){if(g(w,d),r.comGlobalParam.aioType!==a.CMShowAIOType.CMShowAIOTypeFriend){var A=u.findSprite(d.uin+"#");A&&g(A,d)}}else C(w,d),n.CMShowLog(1,""+s,"model change over")}BK.Director.ticker.setTimeout(function(){(1===h&&0===l.cmActionManager.taskArray.length||p.skeleManager.aioStatus===a.CMShowAIOStatusType.CMShowAIOStatusTypePause)&&(n.CMShowLog(1,""+s,"dress ready over, stop ticker."),i.stopTicker(!0),h=0)},2e3,null)}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_UserDressOrStatus,null,function(e,t,o){switch(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_UserDressOrStatus,"data type: "+o.type),o.type){case 1:break;case 2:if(r.comGlobalParam.aioType===a.CMShowAIOType.CMShowAIOTypeFriend)for(var i=0;i<o.uinList.length;i++)o.uinList[i]===r.comGlobalParam.friendUin&&c.notifyTerminalShowToast("å¥½å‹å·²å…³é—­åŽ˜ç±³ç§€åŠŸèƒ½")}for(var s,l=new Array,h=0;h<o.uinList.length;h++)for(var S=0;S<p.skeleManager.spriteList.length;S++)p.skeleManager.spriteList[S].uin===o.uinList[h]&&l.push(p.skeleManager.spriteList[S]);s=m.getUinList(l),c.getDressRes(s)}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_StopAllTask,null,function(e,t,o){if(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_StopAllTask," "),o.type){var i=o.type,s="stopAction_bid_"+l.cmActionManager.lastActionType;if(0===i){if(r.comGlobalParam.functionMap[s]&&l.cmActionManager.taskArray.length>0){var c=l.cmActionManager.taskArray[0]?l.cmActionManager.taskArray[0].taskId:-1;r.comGlobalParam.functionMap[s](c),r.comGlobalParam.aioPanelClose&&1!==l.cmActionManager.lastActionType&&(p.skeleManager.spriteStatus=a.CMShowActionStatus.CMShowActionStatusAction_Down,p.skeleManager.initActionCallBack(void 0),h.doGetDownAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList})))}}else if(p.skeleManager.isSpriteShow=!1,r.comGlobalParam.functionMap[s]&&l.cmActionManager.taskArray.length>0){c=l.cmActionManager.taskArray[0]?l.cmActionManager.taskArray[0].taskId:-1,r.comGlobalParam.functionMap[s](c);for(var m=0;m<p.skeleManager.spriteList.length;m++){var u=p.skeleManager.spriteList[m];u.pet&&p.skeleManager.destroyingList.push(u.pet),p.skeleManager.destroyingList.push(u)}p.skeleManager.spriteList.splice(0,p.skeleManager.spriteList.length)}}}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_AddBubble,null,function(e,t,o){var i=a.BKListenerCMD_SC.BKListenerCMD_SC_AddBubble;if(n.CMShowLog(1,""+i,"text:"+o.text+", uin:"+m.cutUin(o.uin)),o.uin&&String(o.uin).length>0){var s=u.findSprite(o.uin);if(!s)return n.CMShowLog(1,""+i,"cannot find skeAni"),void M.reportManager.reportErrorEvent("["+i+"] ani:"+m.cutUin(o.uin)+" is not found or undefined",M.CmReportManager.SkeAni_Undefined_Error);if(u.removeAccessory_2Dor3D(s,a.CMSHOW_BUBBLE_ACCESSORY_NAME,null),o.bubble&&s.is2D()&&(-1!==o.bubble.indexOf("/71/")||-1!==o.bubble.indexOf("/72/")||-1!==o.bubble.indexOf("/73/")||-1!==o.bubble.indexOf("/74/")||-1!==o.bubble.indexOf("/75/")))return p.skeleManager.bubbleMessage.bubblePath=o.bubble,p.skeleManager.bubbleMessage.bubbleText=o.text,p.skeleManager.bubbleMessage.hasBubble=!0,void(p.skeleManager.bubbleMessage.bubbleAni=s);u.setAccessoryWithInfo_2Dor3D(s,o.bubble,o.text,void 0)}else for(var c=0;c<p.skeleManager.spriteList.length;c++){var l=p.skeleManager.spriteList[c];if(l.position.x>=r.comGlobalParam.width/2||!l.is2D()&&l.aioposition&&l.aioposition>=0){var h=l.is2D()?o.bubble2D:o.bubble3D;return void 0===h&&(h=o.bubble),u.removeAccessory_2Dor3D(l,a.CMSHOW_BUBBLE_ACCESSORY_NAME,null),void u.setAccessoryWithInfo_2Dor3D(l,h,o.text,void 0)}}}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_DrawAreaChange,null,function(e,t,o){if(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_DrawAreaChange,"size change"),o){r.comGlobalParam.vWidth=o.width,r.comGlobalParam.vHeight=o.height;var s=i.getTickerStatus();r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&p.skeleManager.spriteList.length>0&&s&&(p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusStandUp_Down?h.doThinkingAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList,repeatCnt:1})):p.skeleManager.spriteStatus===a.CMShowActionStatus.CMShowActionStatusGetDown_Down&&h.doWaitingAction(new S.CMShowActionTask({spriteArray:p.skeleManager.spriteList,repeatCnt:1})))}}),BK.MQQ.SsoRequest.addListener(a.BKListenerCMD_SC.BKListenerCMD_SC_ScreenSizeChange,null,function(e,t,o){if(n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ScreenSizeChange,"screen size change"),o){var i=r.comGlobalParam.width;r.comGlobalParam.width=o.width,r.comGlobalParam.height=o.height,r.comGlobalParam.screenW=o.screenWidth,r.comGlobalParam.screenH=o.screenHeight,d.hasInit3DLib()&&(cm3d.onSizeChanged(r.comGlobalParam.width,r.comGlobalParam.height),p.skeleManager.calculate3DRoleHeight(1)),r.comGlobalParam.location===a.CMShowLocationType.CMShowLocationTypeAIO&&(r.comGlobalParam.scale=r.comGlobalParam.scale/r.comGlobalParam.adaptationScale,p.skeleManager.calculate2DHeightScale(),r.comGlobalParam.scale=r.comGlobalParam.scale*r.comGlobalParam.adaptationScale);for(var s=0;s<p.skeleManager.spriteList.length;s++){var l=p.skeleManager.spriteList[s];if(l.is2D()){var h=0;l.scale={x:r.comGlobalParam.scale,y:r.comGlobalParam.scale,z:r.comGlobalParam.scale},p.skeleManager.spriteList.length<3?(h=r.comGlobalParam.width/2,l.position.x>i/2?h=r.comGlobalParam.width/2+r.comGlobalParam.distance/2*r.comGlobalParam.adaptationScale:l.position.x<i/2&&(h=r.comGlobalParam.width/2-r.comGlobalParam.distance/2*r.comGlobalParam.adaptationScale)):3===p.skeleManager.spriteList.length&&(h=r.comGlobalParam.width/2,l.position.x>=3*i/4?h=3*r.comGlobalParam.width/4:l.position.x<=i/4&&(h=r.comGlobalParam.width/4)),n.CMShowLog(1,""+a.BKListenerCMD_SC.BKListenerCMD_SC_ScreenSizeChange,"positionX:"+h+" ske x:"+l.position.x+", oldWidth:"+i/2+", width:"+r.comGlobalParam.width/2),l.position={x:h,y:l.position.y,z:l.position.z},l.adjustPosition=l.position}else c.report3DSpriteRect(l)}}})}}]));
//# sourceMappingURL=cmshow_script_0.js.map
var cmshow_script_0_version = "timestamp : 2019-07-26 17:15:18, version : 4c7766a";
console.warn("cmshow_script_0.js " + cmshow_script_0_version);
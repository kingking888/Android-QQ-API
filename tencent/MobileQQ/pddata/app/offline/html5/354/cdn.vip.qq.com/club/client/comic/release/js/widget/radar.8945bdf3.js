define("widget/radar",["lib/zepto","business/router","zepto","piggy/util/uri","piggy/util/process","piggy/util/cookie","business/jsbridge","business/common","piggy/util/cacheData","piggy/util/tpl","piggy/util/report","business/comic","piggy/util/string","widget/WVUtil","piggy/util/net","business/security"],function(a,b,c){
var d=a("lib/zepto"),e=a("business/router"),f=a("business/common"),g=(a("business/comic"),a("piggy/util/cacheData"),a("piggy/util/process")),h=a("piggy/util/tpl"),i=(a("piggy/util/string"),a("business/jsbridge"),
a("piggy/util/report").getInstance("piggy/business/speedReport"),a("piggy/util/report").getInstance("business/compassReport"),{}),j={},k={comic:[1,7],light:[8,8],video:[100,300]},l="";b.init=function(a){
var b=this,c=a.container;"string"==typeof c?(c=("#"!==c[0]?"#":"")+c,c=d(c)):d.zepto.isZ(c)||(c=d(c)),c.length&&!c[0].hasInit&&(l=a.pageId||"",c[0].hasInit=!0,i.container=c,j=a,b.showRecommendList(2))},
b.showRecommendList=function(a){var b=this;a=a||2,b.getRecommendList(a,function(a){b.renderRecommendList(a)})},b.renderRecommendList=function(a){var c=this;if(a&&0==a.result&&a.data){for(var d={comic:'<label class="ui-label-s label-comic">漫画</label>',
light:'<label class="ui-label-s label-novel">轻小说</label>',video:'<label class="ui-label-s label-anmie">动画</label>'},e=0;e<a.data.length;e++){var g=c.getSearchTypeString(a.data[e].type);a.data[e].typeKey=g,
a.data[e].typeIconHtml=d[g]||"",a.data[e].nameStr=a.data[e].name.length>12?a.data[e].name.slice(0,12)+"...":a.data[e].name}var k="";j.moduleName&&(k=j.moduleName),i.container.html(h.get(m,{list:a.data,
resource_name:k},h.getInstance({action:b}))),f.asyncLoadInstance("widget/img_loader",function(a){a.getInstance().compile(document.body)})}},b.clickRefreshRecommendList=function(a){var b=this;b.showRecommendList(2),
"function"==typeof j.refreshHandler&&j.refreshHandler()},b.clickComic=function(a,b){var c=arguments.callee;if(!c.click){if(c.click=!0,b){var g=0;b.type>=k.comic[0]&&b.type<=k.comic[1]?g=1:b.type>=k.light[0]&&b.type<=k.light[1]?g=3:b.type>=k.video[0]&&b.type<=k.video[1]&&(g=2),
d(a.currentTarget).addClass("active"),setTimeout(function(){d(a.currentTarget).removeClass("active");var h={id:b.id,_cwv:1,_bid:354,pos:l};if(j.moduleName&&(h.read_params=e.getReadParam(j.moduleName)),
1===g){var i=e.createUrl("detail",h);f.openComicDetail(i)}else if(3===g);else if(2===g){var i=e.createUrl("video",h);f.openComicDetail(i)}setTimeout(function(){c.click=!1},1500)},50)}"function"==typeof j.clickedHandler&&j.clickedHandler(b.id);
}},b.getRecommendList=function(a,b){i.getNewFirstScreenInfo({type:a,category:"list"},function(a){b(a)})},b.getSearchTypeString=function(a){var b="";for(var c in k)if(a>=k[c][0]&&a<=k[c][1])return b=c;return b;
},i.getNewFirstScreenInfo=function(a,b){var c=arguments.callee,d=function(c){if(0==c.result)switch(a.category){case"radar":var d=c.data.radarInfo;b(d?{result:0,data:d}:{result:-5});break;case"list":var d=c.data.recommendList;
b(d?{result:0,data:d}:{result:-5})}else b(c)};c.cache&&1==a.type?d(c.cache):g.lockNext("radarAndList"+a.type,"comic",function(b){b.data&&b.data.radarInfo&&b.data.recommendList&&1==a.type&&(c.cache=b),d(b);
},function(b){f.sendMergeRequest({url:e.createNewUrl("vpcm/cgi-bin/coupon_coin"),data:{module:"comic_radar_svr",method:"getUserRadarInfoAndRecommendList",param:{type:a.type}},callback:function(a){b(a)}
})})};var m='<section class="mod-list-wrap ui-panel"><h2 class="ui-border-b"><span>猜你喜欢</span><span class="ui-panel-title-tips refresh-btn" onclick="<%=this.getInvoke(\'action.clickRefreshRecommendList\')%>">换一批</span></h2><ul class="ui-list ui-list-link"><% for(var i = 0, max = list.length, data; data = list[i], i < max; i++){ %><li data-id="<%=data.id%>" data-scene=\'1308336\' data-report=\'{resource_name: "<%=resource_name%>", algo_id:"<%=data.algoId || null%>"}\' onclick="<%=this.getInvoke(\'action.clickComic\', data)%>"><div class="ui-list-img"><span data-url="<%=data.coverImg%>"></span></div><div class="ui-list-info"><h4><%=data.nameStr%><%=data.typeIconHtml||\'\'%></h4><p class="classification"><%=data.categoryName%></p><%if(data.typeKey == \'comic\'){%><p><%if(data.iegComicStatus && data.iegComicStatus == 2){%>已完结<%}else{%>更新至<%=data.sectionCount%>话<%}%></p><%}else if(data.typeKey == \'video\'){%><p><%if(data.omgVideoStatus && data.omgVideoStatus == 2){%>已完结<%}else{%>更新至<%=data.sectionCount%>集<%}%></p><%}%></div><div class="ui-border-b"></div></li><% } %></ul></section>';
});
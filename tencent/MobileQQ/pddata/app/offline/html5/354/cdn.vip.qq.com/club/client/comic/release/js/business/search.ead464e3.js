define("business/search",["lib/zepto","business/comic","zepto","business/common","piggy/util/uri","piggy/util/cacheData","piggy/util/process","piggy/util/string","business/jsbridge","business/router","widget/WVUtil","piggy/util/net","business/security","piggy/util/cookie","piggy/util/tpl","piggy/util/report","business/algorithRealTimeReport","business/report","business/displayReportSecond","business/video"],function(a,b,c){
var d=a("lib/zepto"),e=a("business/comic"),f=a("business/router"),g=a("business/common"),h=a("business/jsbridge"),i=a("piggy/util/tpl"),j=a("piggy/util/string"),k=a("piggy/util/cacheData"),l=a("piggy/util/cookie"),m=a("widget/WVUtil"),n=a("piggy/util/process"),o=a("business/algorithRealTimeReport"),p=a("business/displayReportSecond"),q=a("business/video"),r=a("piggy/util/report").getInstance("business/compassReport"),s={
index:{pageId:"110",clickSearch:"10010",showResult:"20019",searchKey:"20046",all_search:"20055",for_you:"20056",clickAutoComplete:"20119",clickSearchResult:"20121",recommendForYou:"300095",clickHistorySearch:"200463",
clickInputButton:"200767"},category:{pageId:"103",clickSearch:"10024",showResult:"20020",searchKey:"20047",all_search:"20057",for_you:"20058",clickAutoComplete:"20120",clickSearchResult:"20122",recommendForYou:"300096",
clickHistorySearch:"200464"}},t={comic:[1,7],light:[8,8],video:[100,300]},u={0:"漫画",1:"动画"},v=[],w={},x=!1,y=!1,z=!1,A=!1,B=!1,C=d("#loadingContainer"),D="",E="",F=function(){};b.init=function(a,c,d){this.uin=l.get("uin")?l.get("uin").replace("o0",""):"",
this.type=a||"index",this.reportType="index",this.wrap=c||"",x=!!d.isAndroid6_2Hack,y=!!d.isIos6_2Hack,w.params=d,D=s[this.reportType].pageId,r.init({page_id:D,tbName:"dc00145",biz_id:"8001",biz_subid:"8001001",
mod:d._cfrom?d._cfrom:6,ext5:b.getSearchSystem()}),this.bindEvents(c,a,d),p.init({compassReport:r,algorithReport:o})},b.getSearchSystem=function(){return 2},w.categorySearchLeftCallback=function(){return w.isSearchOpen?void d(".ui-searchbar-cancel").trigger("click"):void h.invoke("mqq.comic.popBack",{});
},w.loadImage=function(){g.asyncLoadInstance("widget/img_loader",function(a){a.getInstance({attr:"data-searchurl"}).compile(document.body)})},b.bindEvents=function(a,b,c){var e=this,f=arguments.callee,i=parseInt(c._cfrom?c._cfrom:c.from?c.from:6);
c.pos||"";i=isNaN(i)?6:i,d(".ui-searchbar").on("click",function(a){arguments.callee;a.stopPropagation(),e.clickSearchBar(b)}),d(".ui-icon-close").on("click",function(a){var b=0;f.lastInputValue="",a.stopPropagation(),
w.lastSearchText="",w.lastSearchingText="",e.hideNoResult(),e.hideSearchResult(),e.hideSearchingResult(),d("#search_loading").hide(),d(".ui-searchbar-cancel").html("取消"),e.showSearchHistory(),e.showTotalSearchComicList(!1),
d(this).hide(),d("#search_input").val("").focus(),g.iOS&&setTimeout(function(){var a=d(window).scrollTop();d(".ui-searchbar-wrap").css({position:"absolute",top:a+b})},200),g.android,C.empty().hide(),document.body.scrollTop=document.documentElement.scrollTop=0,
d(window).unbind("scroll",w.onSearchingScrollCallback||F).unbind("scroll",w.onSearchScrollCallback||F),w.bindSearchScroll=!1,w.bindSearchingScroll=!1}),d(".ui-searchbar-cancel").on("click",function(a){
a.stopPropagation(),w.isSearchOpen=!1,g.iOS&&"category"==b&&g.compareVersion(g.QQVersion,"6.3.5")>=0&&h.invoke("mqq.ui.setTitleButtons",{left:{title:6==i?"动态":"返回",callback:w.categorySearchLeftCallback
}});d(window).scrollTop();if("取消"==d(this).html())h.invoke("mqq.ui.popBack",{});else{var c=d("#search_input").val();d(this).html("取消"),e.showSearchResult(c)}}),d("#search_input").on("input",function(a){
var b=d(this).val().trim();if(C.empty().hide(),""!==b){if(b===f.lastInputValue)return;f.lastInputValue=b,e.hideNoResult(),e.hideSearchResult(),e.hideAllSearchResult(),e.hideSearchResult(),e.showSearchingResult(b),
d(".ui-searchbar-cancel").show(),d(".ui-icon-close").show(),g.iOS||d(".ui-searchbar-cancel").html("搜索")}else f.lastInputValue=b,d(".ui-icon-close").hide(),e.hideNoResult(),e.hideAllSearchResult(),e.hideSearchingResult(),
e.hideSearchResult(),g.iOS||d(".ui-searchbar-cancel").html("取消"),e.showSearchHistory(),e.showTotalSearchComicList(!1)}).on("keyup",function(a){var b=d(this).val().trim();d("#loadingContainer").empty().hide(),
b&&13==a.keyCode&&(e.hideNoResult(),e.hideAllSearchResult(),e.hideSearchingResult(),e.hideSearchResult(),e.showSearchResult(b),d(this).blur(),g.iOS||d(".ui-searchbar-cancel").html("取消"))}).on("click",function(a){
a.stopPropagation(),d(".ui-searchbar-cancel").show(),r.send({oper_obj_type:"2",oper_obj_id:s[e.reportType].clickInputButton})}),d("#recommand_for_you .icon-refresh").off("click").on("click",function(){
e.showRecommandForYou()});var j=!1;d(window).on("touchstart",function(){j=!1}).on("touchmove",function(a){j||(j=!0,g.iOS&&d(".ui-searchbar-wrap").css("position","fixed"),d("#search_input").blur())}),g.iOS&&w.initInputPositionHandle(b);
},b.showSearchByKeyword=function(a){if(a){var b=this;d("#search_input").val(j.encodeHTML(a)),b.hideNoResult(),b.hideAllSearchResult(),b.hideSearchingResult(),b.hideSearchResult(),b.showSearchResult(a),
d("#search_input").blur(),g.iOS||d(".ui-searchbar-cancel").html("取消")}},b.clickSearchBar=function(a,b,c){var e=this,f=d("#defaultWrap"),i=d(".ui-searchbar-wrap");g.iOS&&"category"==a&&g.compareVersion(g.QQVersion,"6.3.5")>=0&&(w.isSearchOpen=!0,
h.invoke("mqq.ui.setTitleButtons",{left:{title:"返回",callback:w.categorySearchLeftCallback}})),i.show(),r.send({oper_obj_type:"1",oper_obj_id:s[e.reportType].clickSearch}),i.addClass("focus"),e.hideSearchingResult(),
e.hideSearchResult(),e.hideNoResult(),C.empty().hide(),e.showSearchHistory(),f.show(),d(e.wrap).hide(),e.showTotalSearchComicList(),g.iOS&&"category"==a&&(window.scrollTo(0,0),g.compareVersion(g.QQVersion,"6.2")>=0&&!y?(i.css("top","64px").css("position","absolute"),
f.css("margin-top","108px"),g.setTitleBarBgColor({alpha:255},function(a){})):(i.css("top","0px").css("position","absolute"),f.css("margin-top","44px")),i.removeClass("theme-default")),d("#search_input").focus();
},w.initInputPositionHandle=function(a){var b=(arguments.callee,0),c=function(){var a=d(window).scrollTop();d(".ui-searchbar-wrap").css({position:"absolute",top:a+b})};d("#search_input").on("blur",function(a){
d(".ui-searchbar-wrap").css({position:"fixed",top:0})}).on("touchend",function(){setTimeout(function(){c()},200),d(this).focus()}).on("keypress",function(a){setTimeout(function(){c()},200)})},b.getSearchingResult=function(a,c,e){
var h=["get_page",c,d.param(a)].join("_"),i="search_list";a.version=1,n.lockNext(h,i,function(a){e(a)},function(c){g.sendMergeRequest({url:f.createNewUrl("vpcm/cgi-bin/comic_comm_search"),data:{module:2==b.getSearchSystem()?"comic_new_comm_search":"comic_comm_search",
method:"getSearchList",param:a},callback:function(a){c(a)}})})},b.getTotalSearchComicList=function(a){var b={src:1,cmd:{totalsearch:{module:"comic",method:"getTotalSearchComicList",param:{}}}},c={param:JSON.stringify(b)
};g.sendRequest({url:f.createUrl("vpcm/cgi-bin/get_comic_mainpage"),data:c,callback:function(b){if(b&&b.data&&b.data.totalsearch){var c=b.data.totalsearch;c&&0==c.retCode?(c=c.retBody,a(c)):a({result:-5
})}else a({result:-6})}})},b.getRecommendForSearch=function(a){var b={recommandsearch:{module:"comic_recommend_mt_svr",method:"GetSearchRecommend",param:{filterList:E}}},c={param:JSON.stringify(b)};g.sendRequest({
url:f.createUrl("vpcm/cgi-bin/comic_common_asyn_cgi"),data:c,type:"POST",callback:function(b){if(b&&b.data&&b.data.recommandsearch){var c=b.data.recommandsearch;c&&0==c.retCode?(c=c.retBody&&c.retBody.data||{},
a(c)):a({result:-5})}else a({result:-6})}})},w.firstSearchingTpl='<%if(search){%><li class="ui-border-t" onclick="<%=this.getInvoke(\'action.clickFirstSearchingResult\')%>"><p class="ui-nowrap">搜索关键词"<em><%=search%></em>"</p></li><%}%>',
w.pageLoading='<div class="ui-loading-wrap" id="page_loading" ><p>努力加载列表中~</p><i class="ui-loading"></i> </div>',w.pageLoaded='<div class="ui-loading-wrap" id="page_loaded"><p>已加载全部内容</p></div>',b.renderSearchingResult=function(a,c){
var e=this,f=arguments.callee,h=!1,k=1e4;if(f.search!=a&&(h=!0,f.search=a),(!w.isShowSearchingResult||h)&&(w.isShowSearchingResult=1,h=!0),h)f.reloading=!0;else if(Math.abs((new Date).getTime()-f.loadTime)<k||f.reloading&&Math.abs((new Date).getTime()-f.loadTime)<k||f.isFinish)return!1;
!function(h,k){k&&(f.page=1);var l=1===f.page,m={queryString:a,typeStart:0,typeEnd:0,page:f.page,encode_type:"json",isSimpleInfo:1,searchType:l?1:0};A=!1,e.getSearchingResult(m,"searching",function(k){
if(h==f.priority&&w.lastSearchingText===a&&""!==e.bindEvents.lastInputValue){var m=k&&k.result,n=k&&k.data||{},o=n.categoryList&&n.categoryList.length||0,p=n.list&&n.list.length||0;if(0==m&&(o>0||p>0)){
f.page++,f.isFinish=!1,A=!0;var q=k.data.categoryList||[];q.forEach(function(b){b.typeName=(u[b.type]||"")+"分类",b.showName=w.highlightKeywork(a,b.name),b.totalCount=b.totalNum,b.isCategory=!0});var r=k.data.list;
a=a.replace(/([[\]\\(){}^$*+.|?])/g,"\\$1");for(var s=0;s<r.length;s++){r[s].name=j.encodeHTML(r[s].name);var t=new RegExp("("+a+")","i").exec(r[s].name);t&&t.length?r[s].showName=r[s].name.replace(t[0],"<em>"+t[0]+"</em>"):r[s].showName=r[s].name;
var v={comic:"漫画",light:"轻小说",video:"动画"},x=e.getSearchTypeString(r[s].type);r[s].typeName=v[x]||""}if(e.hideNoResult(),e.hideAllSearchResult(),w.isShowSearchingResult){var y=r;l&&(y=q.concat(r)),d("#searching").show().find("ul").append(i.get("searching_result_Tpl",{
list:y},i.getInstance({action:b,string:j}))).show(),l&&25>p||C.empty().html(w.pageLoading).show()}}else 0==m&&n.isEnd&&(f.isFinish=!1),600004==k.result&&g.showTips(k.message||"似乎进入了没有网络的异次元"),A||B?!A&&B&&(C.empty().html(w.pageLoaded).show(),
d(window).unbind("scroll",c||F),w.bindSearchingScroll=!1):(e.hideNoResult(),e.hideAllSearchResult(),C.empty().hide());n.isEnd&&(C.empty().html(w.pageLoaded).show(),d(window).unbind("scroll",c||F),w.bindSearchingScroll=!1);
}})}(f.priority=(parseInt(f.priority)||0)+1,h)},b.showSearchingResult=function(c){var e=this;arguments.callee;if(C.empty().hide(),a.async(["piggy/util/string"],function(a){d("#searching").show().find("ul").empty().append(i.get(w.firstSearchingTpl,{
search:a.encodeHTML(d("#search_input").val())},i.getInstance({action:b,string:a}))).show()}),w.lastSearchingText=c,w.lastSearchText="",e.renderSearchingResult(c),!w.bindSearchingScroll){w.bindSearchingScroll=!0;
var f=w.onSearchingScrollCallback=function(){B=!0;var a=arguments.callee;a.scrollTop=d(window).scrollTop(),a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.scrollTop==d(window).scrollTop()&&d("body").scrollTop()+d(window).height()+100>=d(document).height()&&w.isShowSearchingResult&&(c=d("#search_input").val(),
e.renderSearchingResult(c,f))},200)};d(window).bind("scroll",f)}},b.clickFirstSearchingResult=function(a){var b=d(".ui-searchbar-cancel");g.iOS&&b.html("搜索"),b.trigger("click")},b.hideNoResult=function(){
d(".error-notice,#recommand_for_you").hide()},b.hideAllSearchResult=function(){d("#all_searching,#history_search_list").hide()},w.isShowSearchingResult=0,b.hideSearchingResult=function(){d("#searching").find("ul").empty().hide(),
w.isShowSearchingResult=0},w.isShowSearchResult=0,b.hideSearchResult=function(){d("#searchResultWrap").hide().find("ul").empty().hide(),w.isShowSearchResult=0},w.highlightKeywork=function(a,b){if(a&&b){
var c=15,d=Math.max(b.indexOf(a)-c,0),e=b.slice(d);d>0&&(e="…"+e),a=a.replace(/([[\]\\(){}^$*+.|?])/g,"\\$1");var f=new RegExp(a,"gi");return e.replace(f,function(a){return"<em>"+j.encodeHTML(a)+"</em>";
})}},b.renderSearchResult=function(a,c,e){var f=this,h=arguments.callee,k=!1,l=1e4;if(h.search!=a&&(k=!0,h.search=a),(!w.isShowSearchingResult||k)&&(w.isShowSearchingResult=1,k=!0),k)h.reloading=!0;else if(Math.abs((new Date).getTime()-h.loadTime)<l||h.reloading&&Math.abs((new Date).getTime()-h.loadTime)<l||h.isFinish)return!1;
!function(k,l){l&&(h.page=1);var m=d("#search_loading"),n=1===h.page;n&&m.show();var o={queryString:a,typeStart:c[0],typeEnd:c[1],page:h.page,encode_type:"json",isSimpleInfo:0,searchType:n?1:0};w.isShowSearchResult=1,
f.getSearchingResult(o,"search",function(c){if(k==h.priority&&w.lastSearchText===a){var l=c&&c.result,q=c&&c.data||{},t=q.categoryList&&q.categoryList.length||0,v=q.list&&q.list.length||0;m.hide();var x=0;
if(0==l&&(t>0||v>0)){h.page++,h.isFinish=!1,z=!0;var y,A=c.data.categoryList||[],B=c.data.list,D=null;d(".error-notice,#searching,#recommand_for_you").hide();for(var E={comic:'<label class="ui-label-s label-comic">漫画</label>',
light:'<label class="ui-label-s label-novel">轻小说</label>',video:'<label class="ui-label-s label-anime">动画</label>'},G=0;G<B.length;G++){D=B[G],y=f.getSearchTypeString(D.type),D.typeKey=y,D.typeIconHtml=E[y]||"";
var H=[],I=!1,J=-1;D.category.forEach(function(b,c){var d=b.name;d&&""!==d.replace(/\s+/g,"")&&(d.indexOf(a)>-1&&(d=w.highlightKeywork(a,d),I=!0,J=c),H.push(d))}),D.line1=w.highlightKeywork(a,D.name,12),
-1===D.author.indexOf(a)&&I?(H=H.slice(Math.max(0,J-5)),D.line2=H.join(" | ")):D.line2=w.highlightKeywork(a,D.author),D.desc.indexOf(a)>-1?D.line3=w.highlightKeywork(a,D.desc,25):"comic"===y?D.line3=D.iegComicStatus&&2==D.iegComicStatus?"已完结":"更新至"+D.sectionCount+"话":"video"===y&&(D.line3=D.omgVideoStatus&&2==D.omgVideoStatus?"已完结":"更新至"+D.sectionCount+"话"),
D.source&&(D.line4="来自"+D.sourceName)}if(w.isShowSearchResult){var K,L=d("#searchCategoryResult"),M=d("#searchResultList"),N=d("#gap");n&&(A.length>0?(A.forEach(function(a){a.typeName=u[a.type]||"",a.isCategory=!0;
}),K=i.get("search_category_list_Tpl",{categoryList:A},i.getInstance({action:b,string:j})),L.show().find("ul").empty().html(K).show(),N.show()):(L.hide(),N.hide()));var O=parseInt(.675*d(window).width()/21),P=function(a){
return a.line3&&a.line3.length<=O?!0:!1};o.page&&1===o.page?M.show().find("ul").empty().html(i.get("search_list_Tpl",{resultList:B,isButtonFit:P,search:a,searchType:w.searchType||0},i.getInstance({action:b,
string:j}))).show():o.page&&o.page>1&&M.show().find("ul").append(i.get("search_list_Tpl",{resultList:B,isButtonFit:P,search:a,searchType:w.searchType||0},i.getInstance({action:b,string:j}))).show(),p.report(),
w.searchType=0,d("#searchResultWrap").show()}n&&25>v||C.empty().html(w.pageLoading).show(),f.loadSearchImg()}else if(0==l&&0==v&&(h.isFinish=!0),600004==c.result&&g.showTips(c.message||"似乎进入了没有网络的异次元"),
z)(!n||v>5)&&C.empty().html(w.pageLoaded).show(),d(window).unbind("scroll",e||F),w.bindSearchScroll=!1;else{C.empty().hide();var Q=d(".error-notice");""==Q.html()&&Q.html(i.get("no_result_Tpl",{})),Q.show(),
f.hideSearchResult(),f.hideSearchingResult(),x=1}if(n&&5>=v){f.showRecommandForYou(e);var N=d("#recommand_for_you .gap");0===v?N.hide():N.show()}q.isEnd&&((!n||v>5)&&C.empty().html(w.pageLoaded).show(),
d(window).unbind("scroll",e||F),w.bindSearchScroll=!1),n&&r.send({oper_obj_type:"2",oper_obj_id:s[f.reportType].searchKey,ret_id:a,ext2:x})}})}(h.priority=(parseInt(h.priority)||0)+1,k)},b.clickRead=function(a,b){
var c=arguments.callee;if(!c.clicked){c.clicked=!0,setTimeout(function(){c.clicked=!1},500),b.sectionID=b.sectionID||b.firstSectionID||"1";var d=q.isVideo(b);d?(b.pos=D,q.watch(b,function(a){a&&0!=a.result&&g.showTips(a.message||"打开阅读器失败");
},!0)):e.openCurrentProgressRead(b,function(a){a&&0!=a.result&&g.showTips(a.message||"打开阅读器失败")}),r.send({oper_obj_type:"2",oper_obj_id:"200763",ret_id:b.id}),o.send({item_id:b.id,resource_name:"search-result"
},3,d?1:2)}},b.showSearchResult=function(a,b){var c=this;arguments.callee;if(C.empty().hide(),b&&2===b.length||(b=[0,0]),z=!1,w.lastSearchText=a,w.lastTypeArray=b,w.lastSearchingText="",w.bindLoadImage||(w.bindLoadImage=!0,
d(window).bind("scroll",function(){var a=arguments.callee;w.isShowSearchResult&&(clearTimeout(a.timer),a.timer=setTimeout(function(){w.loadImage()},200))})),!w.bindSearchScroll){var e=d(window).height(),f=Math.ceil(2*e);
w.bindSearchScroll=!0;var g=w.onSearchScrollCallback=function(){var a=arguments.callee;a.scrollTop=d(window).scrollTop(),a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.scrollTop==d(window).scrollTop()&&d("body").scrollTop()+e+100+f>=d(document).height()&&w.isShowSearchResult&&c.renderSearchResult(w.lastSearchText,w.lastTypeArray,g);
},200)};d(window).bind("scroll",g)}c.renderSearchResult(a,b,g),c.addSearchHistory(a)},b.showSearchHistory=function(){var a=this,c=a.getSearchHistory();c.length&&(v=c,d("#history_search_list").show().html(i.get("search_history_Tpl",{
list:c},i.getInstance({action:b,string:j}))))},b.showTotalSearchComicList=function(a){var c=this,e=arguments.callee;a===!1&&e.done?d("#all_searching").show():c.getTotalSearchComicList(function(a){a&&0==a.result&&a.data.length&&(e.done=!0,
d("#all_searching").find("ul").html(i.get("all_search_Tpl",{list:a.data},i.getInstance({action:b,string:j}))),w.isShowSearchingResult||w.isShowSearchResult||d("#all_searching").show())})},b.showRecommandForYou=function(a,c){
function e(a){var b=1e4;return b>a?a:(a/=b,b>a?Math.round(a)+"万":(a/=b,Math.round(a)+"亿"))}var f=this,g=d("#recommand_for_you"),h=g.find("ul");C.empty().hide(),f.getRecommendForSearch(function(k){var l=k&&k.ret;
if(0==l){var m=k.list||[],n=m.length;if(n>0){E=[],m.forEach(function(a){var b=a.tags||[];E.push(a.id),a.statusText=b.slice(0,3).join(" | ")||(2===a.status?"已完结":"更新至"+a.sectionCount+"话"),a.readPicCount=e(a.readPicCount);
});var o=i.get("recommand_search_Tpl",{list:m},i.getInstance({action:b,string:j}));h.html(o);var q=function(){d("body").scrollTop()+d(window).height()>=d(document).height()&&(d(window).unbind("scroll",q),
d(window).unbind("scroll",a||F),w.bindSearchScroll=!1)};d(window).bind("scroll",q),f.recommendReport(),setTimeout(function(){w.loadImage(),p.report()},100),w.lastSearchText&&g.show().find(".mod-recommend").show();
}else c||f.showRecommandForYou(a,!0)}else c||f.showRecommandForYou(a,!0)})},b.recommendReport=function(){var a=this,b=arguments.callee,c=d("#recommand_for_you"),e=c.find("ul");if(b.bindReportCallback)d(window).trigger("scroll");else{
var f=function(){if("none"!=e.css("display")&&d("body").scrollTop()+d(window).height()>=e.offset().top){var b=s[a.reportType].recommendForYou,c=d("#img404").size()>0?0:1;e.find("li").each(function(){var a=d(this),e=a.data("id"),f=a.data("reported"),g=a.data("rule");
e&&0==f&&(a.data("reported",1),r.send({oper_obj_type:"3",oper_obj_id:b,ret_id:e,ext2:c,algo_id:g||0}))})}};d(window).on("scroll",f),b.bindReportCallback=!0}},b.getSearchHistory=function(){var a=this,b=k.get(a.uin+"_comic_search_history"),c=[];
if(b)try{c=JSON.parse(b)}catch(d){c=[]}return c},b.addSearchHistory=function(a){for(var b=this,c=!1,d=v.length,e=0;d>e;e++)if(a==v[e]){c=!0;break}if(c){var f=v.splice(e,1);v.push(f[0])}else v.length>=10&&v.shift(),
v.push(a);k.set(b.uin+"_comic_search_history",JSON.stringify(v))},b.emptySearchHistory=function(){var a=this;k.set(a.uin+"_comic_search_history",""),v=[],d("#history_search_list").html("")},b.clickDeleteHistory=function(a){
var b=this;b.emptySearchHistory()},b.clickHistorySearch=function(a,b){var c=this;w.searchType=1,c.hideAllSearchResult(),d("#search_input").val(b),d(".ui-searchbar-cancel").show(),d(".ui-icon-close").show(),
c.showSearchResult(b),r.send({oper_obj_type:"2",oper_obj_id:s[c.reportType].clickHistorySearch,ret_id:b})},b.clickSearchComic=function(a,b,c){var e=this,h=arguments.callee;if(!d(a.target).hasClass("ui-btn")){
var i=d(a.currentTarget),j=i.data("search-type");if(1308325==i.data("scene")&&(j=3),!h.click&&(h.click=!0,b)){if("clickAutoComplete"===c&&e.addSearchHistory(b.name),b.isCategory)return d(a.currentTarget).addClass("active"),
void setTimeout(function(){var i={filter:b.id,categoryType:0===b.type?1:2,sort:0,_bid:354,_wv:1027,isFold:!0,pos:D},j=f.createUrl("categoryList",i);d(a.currentTarget).removeClass("active"),g.openCommonUrl(j),
h.click=!1,r.send({oper_obj_type:"2",oper_obj_id:s[e.reportType][c],ret_id:"clickSearchComic"==c?d("#search_input").val():b.id,ext2:e.getNewReportType(b),ext3:b.source||0})},150);"for_you"!==c?r.send({
oper_obj_type:"2",oper_obj_id:s[e.reportType][c],ret_id:"clickSearchComic"==c?d("#search_input").val():b.id,ext2:e.getNewReportType(b),ext3:b.source||0}):(o.send({scene_id:1308325,item_id:b.id,algo_id:b.algoId,
resource_name:"search-recommend"},2),r.send({oper_obj_type:"2",oper_obj_id:s[e.reportType][c],ret_id:b.id,ext2:d("#img404").size()>0&&"none"!==d(".error-notice").css("display")?0:1,algo_id:b.rule||0})),
d(a.currentTarget).addClass("active"),setTimeout(function(){if(d(a.currentTarget).removeClass("active"),b.source>0)url=f.createUrl("detailOther",{id:b.id,_bid:354,_cwv:1,pos:D}),g.openComicDetail(url);else{
var c="search-result";switch(0|j){case 1:c="search-history";break;case 2:c="search-hot";break;case 3:c="search-recommend"}m.openComicDetail({id:b.id,type:b.type,pos:D,read_params:f.getReadParam(c),_wvx:3
})}setTimeout(function(){h.click=!1},1500)},50)}}},b.clickSearchComicResult=function(a,b,c){var e=this;if(b){e.getSearchTypeString(b.type);r.send({oper_obj_type:"2",oper_obj_id:s[e.reportType][c],ret_id:b.name,
ext2:e.getNewReportType(b),ext3:b.source||0}),d(a.currentTarget).addClass("active"),setTimeout(function(){d(a.currentTarget).removeClass("active"),d("#search_input").val(b.name);var c=null;for(var f in t)if(b.type>=t[f][0]&&b.type<=t[f][1]){
c=t[f];break}e.showSearchResult(b.name,c),d(".ui-searchbar-cancel").html("取消")},50)}},b.clickRecommendSearch=function(a,b,c){var e=this;if(b){c&&r.send({oper_obj_type:"2",oper_obj_id:s[e.reportType][c],
ret_id:b.id}),w.searchType=2;var f=b.name||"";e.hideAllSearchResult(),d("#search_input").val(f),d(".ui-searchbar-cancel").show(),d(".ui-icon-close").show(),e.showSearchResult(f)}},b.loadSearchImg=function(){
for(var a,b=d("[data-searchurl]"),c=0,e=0,f=d(window).scrollTop(),g=d(window).height(),h=g/2,i=0;i<b.length;i++)a=d(b[i]),c=a.offset().top||0,e=a.height(),f+g+h>=c&&c+e>=f-h&&a.attr("data-searchurl")&&(a.css("background-image",'url("'+a.attr("data-searchurl")+'")'),
a.removeAttr("data-searchurl"))},b.getSearchTypeString=function(a){var b="";for(var c in t)if(a>=t[c][0]&&a<=t[c][1])return b=c;return b},b.getNewReportType=function(a){var b=1;return a.isCategory?b=0==a.type?4:5:a.source>0?b=3:a.type>=t.video[0]&&a.type<=t.video[1]&&(b=2),
b}});
define("business/pay",["lib/zepto","business/router","zepto","piggy/util/uri","piggy/util/process","piggy/util/cookie","business/jsbridge","business/common","piggy/util/cacheData","piggy/util/tpl","piggy/util/report","piggy/util/string"],function(a,b,c){
var d=a("lib/zepto"),e=a("business/router"),f=a("business/common"),g=a("piggy/util/cacheData"),h=a("piggy/util/process"),i=(a("piggy/util/string"),a("business/jsbridge")),j=(a("piggy/util/cookie"),0);b.closePayWebview=function(){
i.invoke("mqq.comic.closeCurrentWebview",{},function(a){a.result=a.code,delete a.code})},b.setAutoPay=function(a,b){var c={};c.comicID=String(a.id),c.autoPayStatus=a.status,i.invoke("mqq.comic.setAutoPayStatus",c,function(a){
a.result=a.code,delete a.code,b&&b(a)})},b.getSectionPayInfo=function(a,b){var c={src:1,cmd:{payinfo:{module:"comic",method:"getSectionPayInfo",param:{comicID:a.id,sectionList:a.list,page:a.page||0}}}},d={
param:JSON.stringify(c)};f.sendRequest({type:"POST",url:e.createUrl("vpcm/cgi-bin/comic_pay"),data:d,callback:function(a){if(a&&a.data&&a.data.payinfo){var c=a.data.payinfo;c&&0==c.retCode?(c=c.retBody,
b(c)):b({result:-5})}else b({result:-6})}})},b.payForSection=function(a,b){var c={src:1,cmd:{pay:{module:"comic",method:"payForSection",param:{comicID:a.id,sectionList:a.list,isAutoPay:a.isAutoPay||0,coupon:a.coupon,
isDown:a.isDown||0,mod:String(a.mod||"6"),land_page:String(a.land_page||"NULL"),obj_ownerid:String(a.obj_ownerid||"NULL"),detailpage_from:String(a.detailpage_from||"NULL_NULL_NULL_NULL~NULL_NULL_NULL_NULL"),
read_params:String(a.read_params||"NULL"),realtime_params:String(a.realtime_params||"NULL")}}}},d={param:JSON.stringify(c)};f.sendRequest({url:e.createUrl("vpcm/cgi-bin/comic_pay"),data:d,callback:function(a){
if(a&&a.data&&a.data.pay){var c=a.data.pay;c&&0==c.retCode?(c=c.retBody,b(c)):b({result:-5})}else b({result:-6})}})},b.getChargeList=function(a){var b={src:1,cmd:{charge:{module:"comic",method:"getChargeList",
param:{}}}},c={param:JSON.stringify(b)};f.sendRequest({url:e.createUrl("vpcm/cgi-bin/comic_pay"),data:c,callback:function(b){if(b&&b.data&&b.data.charge){var c=b.data.charge;c&&0==c.retCode?(c=c.retBody,
a(c)):a({result:-5})}else a({result:-6})}})},b.getIOSPayItem=function(){return[{couponCount:100,productId:"com.tencent.mqq.comiccoin.consumable.100",price:100},{couponCount:600,productId:"com.tencent.mqq.comiccoin.consumable.600",
price:600},{couponCount:1200,productId:"com.tencent.mqq.comiccoin.consumable.1200",price:1200},{couponCount:5e3,productId:"com.tencent.mqq.comiccoin.consumable.5000",price:5e3},{couponCount:9800,productId:"com.tencent.mqq.comiccoin.consumable.9800",
price:9800}]},b.getCouponList=function(a,b){f.sendMergeRequest({url:e.createNewUrl("vpcm/cgi-bin/coupon_coin"),data:{module:"comic",method:"getCouponList",param:{type:a.type||1,version:1}},callback:function(a){
a&&0==a.result&&a.data&&a.data.coupon&&(j=a.data.offerId),a&&0==a.result&&a.data&&a.data.coupon&&a.data.coupon.length>0&&a.data.coupon.forEach(function(b){b.count==a.data.rcPrice&&(b.isRecommend=!0)}),
b(a)}})},b.charge=function(a,b){var c="_";if(c=Date.now(),f.iOS)i.invoke("mqq.pay.pay",{apple_pay_source:"qq_comic",qq_product_id:0,qq_product_name:"点券",app_id:j||a.offerId,pf:"qq_m_qq-1-iap-1-"+a.aid,
pfkey:"pfKey",product_id:a.productId,product_type:0,quantity:1,is_deposit_game_coin:1,pay_item:String(a.couponCount||a.count||0),var_item:"qq_comic"},function(a){0==a&&i.dispatchEvent("couponPaySuccess",{}),
b&&b({result:a,type:0})});else{var g={offerId:j||a.offerId,userId:e.getUserId(),zoneId:"1",acctType:"common",saveValue:String(a.count),isCanChange:a.isCanChange||!1,remark:a.remark||"",aid:a.aid,numberVisible:!0,
discountId:a.discountId||"",other:a.other||""};i.invoke("mqq.tenpay.rechargeGameCurrency",g,function(a){"undefined"!=typeof a.resultCode?(a.result=a.resultCode,delete a.resultCode):a.result=-2,0==a.result&&i.dispatchEvent("couponPaySuccess",{}),
a=d.extend(a,{type:0}),b&&b(a)})}},b.getUserInfo=function(a){var b=600,c=600,d="getUserInfo",i=null,j=null;return g.getWithListStruct({},[d],["comic/getUserInfo",e.getUserId()].join("_"),function(a,b,c){
h.lockNext(a,"comic/getUserInfo",function(a){c(a&&0==a.result&&a.data?{result:0,data:{getUserInfo:a.data}}:a)},function(a){var b={src:1,cmd:{userinfo:{module:"comic",method:"getUserInfo",param:{}}}},c={
param:JSON.stringify(b)};f.sendRequest({data:c,callback:function(b){if(b&&b.data&&b.data.userinfo){var c=b.data.userinfo;c&&0==c.retCode?(c=c.retBody,a(c)):a({result:-5})}else a({result:-6})}})})},function(b){
b&&b.data&&b.data.getUserInfo&&(b.data=b.data.getUserInfo),a(b)},"undefined"==typeof i||null===i?b:i,"undefined"==typeof j||null===j?c:j)},b.getAccountInfo=function(a){var b={src:1,cmd:{userinfo:{module:"comic",
method:"getAccountInfo",param:{}}}},c={param:JSON.stringify(b)};f.sendRequest({url:e.createUrl("vpcm/cgi-bin/comic_pay"),data:c,callback:function(b){if(b&&b.data&&b.data.userinfo){var c=b.data.userinfo;
c&&0==c.retCode?(c=c.retBody,a(c)):a({result:-5})}else a({result:-5})}})},b.getAutoPayStatus=function(a){var b={src:1,cmd:{autopay:{module:"comic",method:"getAutoPayStatus",param:{}}}},c={param:JSON.stringify(b)
};f.sendRequest({url:e.createUrl("vpcm/cgi-bin/comic_pay"),data:c,callback:function(b){if(b&&b.data&&b.data.autopay){var c=b.data.autopay;c&&0==c.retCode?(c=c.retBody,a(c)):a({result:-5})}else a({result:-5
})}})},b.setAutoPayStatus=function(a,b){var c={src:1,cmd:{autopay:{module:"comic",method:"setAutoPayStatus",param:{isAutoPay:a.isAutoPay}}}},d={param:JSON.stringify(c)};f.sendRequest({url:e.createUrl("vpcm/cgi-bin/comic_pay"),
data:d,callback:function(a){if(a&&a.data&&a.data.autopay){var c=a.data.autopay;c&&0==c.retCode?(c=c.retBody,b(c)):b({result:-5})}else b({result:-5})}})},b.getComicSectionPayStatus=function(a,b){var c={};
c.comicID=String(a.id),c.comicSectionIds=a.list,i.invoke("mqq.comic.getComicSectionPayStatus",c,function(a){a.result=a.code,delete a.code,b&&b(a)})},b.getPayImgUrl=function(a,b){var c="";return c=window.location.protocol+"//cdn.vip.qq.com/club/mobile/profile/comic_center/"+a+"/section/big_"+b+".jpg?max_age=31536000";
}});
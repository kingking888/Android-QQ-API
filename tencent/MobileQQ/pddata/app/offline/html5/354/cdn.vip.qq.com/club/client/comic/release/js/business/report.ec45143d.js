define("business/report",["lib/zepto","piggy/util/net","business/router","zepto","piggy/util/uri","piggy/util/process","piggy/util/cookie","business/jsbridge","business/common","piggy/util/cacheData","piggy/util/tpl","piggy/util/report"],function(a,b,c){
var d=a("lib/zepto"),e=a("piggy/util/net"),f=a("business/router"),g=a("business/jsbridge"),h={};a("business/common");h.safeMatch=function(a,b,c){var d=a.match(b||"");return c=isNaN(c)?0:c,d?d[c]:""};var i={
tbName:"dc00145",imei:"",domain:"",domain_id:"",domain_ver:"",device_type:"",mqq_ver:"",mqq_sub_ver:"",net_type:"",res:"",src:"",ext7:seajs.pageVersion||0};b.baseData=i,b.init=function(a){var b="pc",c=101,d="",e="",j="",k="",l="",m="unknow",n=navigator.userAgent.toLowerCase();
if(n.indexOf("ipad")>-1?(b="ios",c=212,d="i"+h.safeMatch(n,/os\s[\d_]+/,0),e="ipad"):n.indexOf("iphone")>-1?(b="ios",c=211,d="i"+h.safeMatch(n,/os\s[\d_]+/,0),e="iphone"):n.indexOf("ipod")>-1?(b="ios",
c=213,d="i"+h.safeMatch(n,/os\s[\d_]+/,0),e="ipod"):-1!=n.indexOf("macintosh")||-1!=n.indexOf("mac os x")?(c="mac os",e="mac"):n.indexOf("android")>-1?(b="android",c=201,d=h.safeMatch(n,/android\s[\d\.]+/,0)):n.indexOf("windows phone")>-1?(b="windows phone",
c=240,d=h.safeMatch(n,/windows phone \d+/,0)):n.indexOf("nt 6.1")>-1?d="windows 7":n.indexOf("nt 6.0")>-1?d="windows vista":n.indexOf("nt 5.2")>-1?d="windows 2003":n.indexOf("nt 5.1")>-1?d="windows xp":n.indexOf("nt 5.0")>-1?d="windows 2000":-1!=n.indexOf("windows")||-1!=n.indexOf("win32")?d="windows":n.indexOf("series")>-1?(b="Series40",
c=230):n.indexOf("symbianos")>-1?(b="Series60",c=230):n.indexOf("blackberry")>-1?(b="blackberry",c=250,d=h.safeMatch(n,/blackberry\s[\d_]+/,0)):d=n.indexOf("playbook")>-1?"PlayBook"+h.safeMatch(n,/RIM Tablet OS\s[\d_]+/,0):-1!=n.indexOf("linux")?"linux":"other",
n.indexOf("msie")>-1?(j="ie",n.indexOf("qqbrowser")>-1?(l=n.match(/qqbrowser[\/\s]([\d\.]+)/),k="qqbrowser_ie "+parseInt(l&&l[1])):n.indexOf("se 2.x metasr 1.0.")>-1?k="SouGou_ie":n.indexOf("maxthon")>-1?k="maxthon_ie":(l=n.match(/msie\s([\d\.]+)/),
k="ie "+parseInt(l&&l[1]))):n.indexOf("opera")>-1?(j="opera",l=n.match(/opera[\/\s]([\d\.]+)/),k="opera "+parseFloat(l&&l[1])):n.indexOf("firefox")>-1?(j="firefox",l=n.match(/firefox\/([\d\.]+)/),k="firefox "+parseInt(l&&l[1])):n.indexOf("chrome")>-1?(j="chrome",
n.indexOf("qqbrowser")>-1?(l=n.match(/opera[\/\s]([\d\.]+)/),k="qqbrowser_webkit "+parseInt(l&&l[1])):n.indexOf("se 2.x metasr 1.0.")>-1?k="SouGou_webkit":n.indexOf("maxthon")>-1?k="maxthon_webkit":(l=n.match(/chrome\/([\d\.]+)/),
k="chrome "+parseInt(l&&l[1]))):n.indexOf("safari")>-1?(j="safari",l=n.match(/version\/([\d\.]+)/),k="safari "+parseInt(l&&l[1])):(j="other",k="other"),i.domain=b,i.domain_id=c,i.domain_ver=d,i.device_type=e,
i.src=f.getParams("ADTAG"),i.res=screen.width+"x"+screen.height,setTimeout(function(){g.invoke("mqq.device.isMobileQQ",function(a){a?(g.invoke("mqq.device.getNetworkType",function(a){switch(a){case 1:m="WiFi";
break;case 2:m="2G";break;case 3:m="3G";break;case 4:m="4G";break;default:m="unknow"}i.net_type=m}),g.invoke("mqq.QQVersion",null,function(a){i.mqq_ver=a}),g.invoke("mqq.device.getDeviceInfo",function(a){
i.imei=a&&a.identifier?a.identifier:""})):i.net_type=m})},0),a)for(var o in a)"undefined"!=typeof i[o]&&(i[a[o]]=i[o],delete i[o])},h.reportByCgi=function(a){e.ajax({url:window.location.protocol+"//report.vip.qq.com/cgi-bin/report",
data:a,cache:!1,dataType:"json",timeout:15e3,plugins:{"piggy/business/cgiReport":["tbName","ecode"]},xhrFields:{withCredentials:!0},success:function(a){},error:function(a,b,c){}})},h.reportBatch=function(a,b){
e.ajax({url:window.location.protocol+"//report.vip.qq.com/cgi-bin/report_batch?"+d.param(a),data:JSON.stringify(b),type:"POST",cache:!1,dataType:"json",timeout:15e3,plugins:{"piggy/business/cgiReport":["tbName","ecode"]
},xhrFields:{withCredentials:!0},success:function(a){},error:function(a,b,c){}})},h.reportByMqq=function(a){var b=String(a.type);delete a.type,delete a.tbName,mqq.data.pbReport(String(b),d.param(a))},b.send=function(a,b){
var c=this,e=c.send;if(b=b||a&&a.notBatch,a&&a.notBatch&&delete a.notBatch,d.isArray(a)||(a=[a]),a=a.filter(function(a){return h.formatData(a),!!a.tbName}),b){var f=h.getCommonData(a);h.reportBatch(f,a);
}else e.sendList=e.sendList||[],e.sendList=e.sendList.concat(a),e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(function(){var a=h.getCommonData(e.sendList);h.reportBatch(a,e.sendList),e.timeout=null,
e.sendList=[]},0)},h.formatData=function(a){var b;if(d.isPlainObject(a))for(b in a)if(a.hasOwnProperty(b))switch(b){case"uin":case"imp_date":a[b]=parseInt(a[b]);break;default:a[b]=String(a[b])}},h.getCommonData=function(a){
if(1===a.length)return i;var b=d.extend({},a[0]);return a.forEach(function(a){Object.keys(b).forEach(function(c){b[c]!==a[c]&&b.hasOwnProperty(c)&&delete b[c]})}),a.forEach(function(a){Object.keys(b).forEach(function(b){
a.hasOwnProperty(b)&&"tbName"!==b&&delete a[b]})}),d.extend({},i,b)},b.init()});
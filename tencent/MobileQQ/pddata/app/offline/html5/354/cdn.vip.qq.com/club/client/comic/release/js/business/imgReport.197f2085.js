!function(a,b){var c,d,e=navigator.userAgent.toLowerCase(),f=/V1_AND_SQI?_([\d\.]+)(.*? QQ\/([\d\.]+))?/i,g=/(iPad|iPhone|iPod).*? (IPad)?QQ\/([\d\.]+)/i,h={isX5:"",id:"",subid:"",net:"",page:"",plat:"",
uin:"",rtime:"",bath:[],key:"",time:""},i={timeout:5e3,imgReg:[".qpic.cn/","ugc.qpic.cn/manhua_cover/"]},j=[],k=[],l={},m={};!function(){if(e.indexOf("tbs")>-1){var a=e.match(/tbs\/([\d\.]+)/);a=parseInt(a&&a[1]),
h.isX5=a>=36541?0:1}else h.isX5=2;h.page=location.href.split("?")[0],f.test(e)?h.plat=1:g.test(e)?h.plat=2:h.plat=3,h.isX5>0&&(b.body.addEventListener("load",function(a){var b=a.target;if(b&&"IMG"===b.tagName){
var c=b.src.split("?")[0];m.imageFilter(c)&&"undefined"==typeof l[c]&&(l[c]=j.length,j.push({path:c,type:1}))}},!0),b.body.addEventListener("error",function(a){var b=a.target;if(b&&"IMG"===b.tagName){var c=b.src.split("?")[0];
m.imageFilter(c)&&"undefined"==typeof l[c]&&(l[c]=j.length,j.push({path:c,type:0}))}},!0))}(),m.imageFilter=function(a){return/\.(jpg|png|jpeg|gif|bmp)($|[?#])/i.test(a)||/\.qpic\.cn\//i.test(a)||/ugc\.qpic\.cn\/manhua_cover\//i.test(a)?!0:!1;
},m.getCookie=function(a){if(b.cookie&&""!=b.cookie)for(var c,d=b.cookie.split("; "),e=0,f=d.length,a=encodeURIComponent(a);f>e;e++)if(c=d[e].split("="),a==c[0])return decodeURIComponent(c[1]||"");return null;
},m.getUin=function(){var a=m.getCookie("uin")||0;return a=a?String(a).replace(/^o0*/g,""):""},m.getNetworkType=function(a){function b(a){return a=String(a).toLowerCase(),a.indexOf("2g")>=0?2:a.indexOf("3g")>=0?3:a.indexOf("4g")>=0?4:a.indexOf("wifi")>=0?1:0;
}try{if(mqq&&mqq.device&&"function"==typeof mqq.device.getNetworkType&&mqq.support&&mqq.support("mqq.device.getNetworkType"))mqq.device.getNetworkType(function(b){-1==b&&(b=0),a(b)});else{var c=navigator.connection&&navigator.connection.type?navigator.connection.type:"unknown";
a(b(c))}}catch(d){a(0)}},m.getNowFormat=function(){function a(a){return a>9?a:"0"+a}var b=new Date,c=String(a(b.getDate())),d=String(a(b.getMonth()+1)),e=String(b.getFullYear()),f=String(a(b.getHours())),g=String(a(b.getMinutes())),h=String(a(b.getSeconds()));
return e+d+c+f+g+h},m.copyObj=function(a){var b={};for(var c in a)b[c]=a[c];return b},m.getImgResource=function(){if("object"==typeof a.performance&&"function"==typeof a.performance.getEntriesByType){var b=a.performance.getEntriesByType("resource"),d=[],e=[];
for(var f in b)m.imageFilter(b[f].name)&&d.push(b[f]);if(!d.length)return!1;if(c){if(d[d.length-1].name==c)return!1;for(var g in d)if(d[g].name==c){e=d.splice(parseInt(g)+1);break}}else e=d;return c=e[e.length-1].name,
e}return!1},m.reportNewX5Data=function(){h.key="path,type,duration,dnsTime,connectTime,errorType,httpCode,isCache,contentType,contentLength,decodeStatus,startTime,redirectStart,redirectEnd,fetchStart,domainLookupStart,domainLookupEnd,connectStart,connectEnd,secureConnectionStart,requestStart,responseStart,responseEnd";
var a=m.getImgResource();if(!a)return m.nextReport(),!1;var b=m.copyObj(h);b.list=[];for(var c in a){var d=[];d[0]=a[c].name.split("?")[0],d[1]=!/image/i.test(a[c].x5ContentType)||200!=a[c].x5HttpStatusCode&&304!=a[c].x5HttpStatusCode||2==a[c].x5ImgDecodeStatus?0:1,
d[2]=m.getTimeNumber(a[c].duration,!0),d[3]=(a[c].domainLookupEnd-a[c].domainLookupStart).toFixed(0),d[4]=(a[c].connectEnd-a[c].connectStart).toFixed(0),d[5]=a[c].x5ErrorCode||"",d[6]=a[c].x5HttpStatusCode||"",
d[7]=a[c].x5LoadFromLocalCache?1:0,a[c].x5ContentType?a[c].x5ContentType.indexOf("jpg")>=0||a[c].x5ContentType.indexOf("jpeg")>=0?d[8]=1:a[c].x5ContentType.indexOf("png")>=0?d[8]=2:a[c].x5ContentType.indexOf("gif")>=0?d[8]=3:a[c].x5ContentType.indexOf("webp")>=0?d[8]=4:d[8]=5:d[8]=0,
d[9]=a[c].x5ContentLength||"",d[10]=a[c].x5ImgDecodeStatus||"",d[11]=a[c].startTime,d[12]=a[c].redirectStart,d[13]=a[c].redirectEnd,d[14]=a[c].fetchStart,d[15]=a[c].domainLookupStart,d[16]=a[c].domainLookupEnd,
d[17]=a[c].connectStart,d[18]=a[c].connectEnd,d[19]=a[c].secureConnectionStart,d[20]=a[c].requestStart,d[21]=a[c].responseStart,d[22]=a[c].responseEnd,b.list.push(d.join(","))}b.bath="",m.send(b)},m.reportNoNewX5Data=function(){
h.key="path,type";var a=m.getImgResource();if(a){h.key="path,type,duration,startTime,redirectStart,redirectEnd,fetchStart,domainLookupStart,domainLookupEnd,connectStart,connectEnd,secureConnectionStart,requestStart,responseStart,responseEnd";
for(var b in a){var c=a[b].name.split("?")[0],d={path:c,duration:m.getTimeNumber(a[b].duration,!0),startTime:m.getTimeNumber(a[b].startTime),redirectStart:m.getTimeNumber(a[b].redirectStart),redirectEnd:m.getTimeNumber(a[b].redirectEnd),
fetchStart:m.getTimeNumber(a[b].fetchStart),domainLookupStart:m.getTimeNumber(a[b].domainLookupStart),domainLookupEnd:m.getTimeNumber(a[b].domainLookupEnd),connectStart:m.getTimeNumber(a[b].connectStart),
connectEnd:m.getTimeNumber(a[b].connectEnd),secureConnectionStart:m.getTimeNumber(a[b].secureConnectionStart),requestStart:m.getTimeNumber(a[b].requestStart),responseStart:m.getTimeNumber(a[b].responseStart),
responseEnd:m.getTimeNumber(a[b].responseEnd)};"undefined"!=typeof l[c]?(d.type=j[l[c]].type,j[l[c]]=d):(d.type=1,j.push(d))}}if(!j.length)return m.nextReport(),!1;var e=j;j=[];var f=m.copyObj(h);f.list=[];
for(var g in e){var i=[],k=h.key.split(",");for(var n in k)i[n]=e[g][k[n]];f.list.push(i.join(","))}f.bath="",m.send(f)},m.getTimeNumber=function(a,b){return"undefined"==typeof a||""==a||isNaN(a)?"":b?parseInt(a):a;
},m.send=function(b){b.time=+new Date-d,b.rtime=m.getNowFormat(),b.list=JSON.stringify(b.list),m.post({url:a.location.protocol+"//imo.vip.qq.com/report",data:b,success:function(a){console.log(a),m.nextReport();
},error:function(a){console.log("error:"+a),k.push(b),m.nextReport()}})},m.post=function(a){a.error=a.error||function(){},a.success=a.success||function(){};var b=a.data||{},c=[];for(var d in b)c.push(d+"="+encodeURIComponent(b[d]));
var e=new XMLHttpRequest;e.open("POST",a.url,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.withCredentials=!0,e.timeout=1e4,e.onload=function(b){200==this.status||304==this.status?a.success(this.responseText):a.error();
},e.ontimeout=a.error,e.onerror=a.error,e.onabort=a.error,e.send(c.join("&"))},m.nextReport=function(){var a=arguments.callee;a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){m.reportFn()},i.timeout);
},m.reportFn=function(){return 0==h.isX5?m.reportNewX5Data:m.reportNoNewX5Data}(),a.imgReport={init:function(a){h.id=a.id||0,h.subid=a.subid||0,d=a.pageLoadTime||+new Date,h.uin=m.getUin(),setTimeout(function(){
m.getNetworkType(function(a){h.net=a})},0),m.nextReport()}}}(window,document),"function"==typeof define&&define("business/imgReport",[],function(){return imgReport});
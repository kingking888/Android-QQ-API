define("business/compassReport",["lib/zepto","business/report","zepto","piggy/util/net","business/router","business/jsbridge","business/common","piggy/util/cacheData","piggy/util/uri","piggy/util/cookie","piggy/util/tpl","piggy/util/report","piggy/util/process"],function(a,b,c){
var d,e,f=a("lib/zepto"),g=a("business/report")||{},h=a("piggy/util/cacheData"),i=a("piggy/util/uri"),j=a("business/jsbridge"),k=a("business/common"),l=a("business/router"),m=l.getParams(),n=h.get("oper_path")||{
page_id:"NULL",oper_obj_id:"NULL",ses_id:"NULL",ext4:"NULL"},o=h.get("pageIdMap")||{},p={},q="~",r={tbName:"dc00145",biz_id:"8001",biz_subid:"8001001",mod:m._cfrom?m._cfrom:m.from?m.from:6},s={},t=m.algo_id||"0";
!function(){document.addEventListener("click",function(a){p.oper_obj_id="NULL",h.set("oper_path",p)},!0),k.bindPageVisibleEvent(function(a){a.hidden||(h.set("oper_path",""),b.isDetailPage(p.page_id)&&h.set("detailpage_from",""),
b.isNewIndexPage(p.page_id)&&h.set("algo_id",""))})}();var u={};b.init=function(a){u=a},c.exports=b=g;var v=b.send;v&&"function"==typeof v&&(b.send=function(a,c){a=f.extend(!0,{},u,a);var d=a&&a.resource_name&&String(l.resourceIdConfig[a.resource_name]||"");
if(d&&"string"==typeof d){if(/98765$/.test(d)){var e=String(a.page_id);d+=a.resource_id||("3039"===e||"3040"===e?a.ext5:"")}a.is_new=String(d)||""}b.cachePath(a),b.cachePageId(a.page_id);var h=f.extend({},r,a);
a.report_path===!0&&(k.iOS||k.isComicWebView)?(delete h.report_path,b.getReportInfo(function(a){f.extend(h,a),window.DETAILPAGE_FROM=h.detailpage_from,window.LAND_PAGE=h.land_page,window.OBJ_OWNERID=h.obj_ownerid,
v.apply(g,[h,c])},!0)):v.apply(g,[h,c])}),b.cachePageId=function(a){var c=location.pathname,d=c.substring(c.lastIndexOf("/")+1,c.indexOf(".html"));"NULL"===b.getPageId()&&(o[d]=a,h.set("pageIdMap",o)),
j.invoke("mqq.data.writeH5Data",{callid:"id_"+Date.now(),host:"qq.com",path:"qqcomic",key:["pageId",d].join("_"),data:a},function(a){})},b.cachePath=function(a){p={page_id:a.page_id,oper_obj_id:a.oper_obj_id,
ses_id:a.ses_id,ext4:a.ext4},h.set("oper_path",p),h.set("algo_id",a.algo_id||t),b.isDetailPage(a.page_id)&&h.set("detailpage_from",b.getDetailPageFrom())},b.getPath=function(a){return a===!0?h.get("detailpage_from")||"NULL_NULL_NULL_NULL~NULL_NULL_NULL_NULL":b.getDetailPageFrom();
},s.returnNull=function(a){return"undefined"==typeof a?"NULL":a},b.getReportInfo=function(a,c){arguments.callee;!d&&k.compareVersion(k.QQVersion,"6.5.8")>=0?k.getWebViewTypeIsComic(function(c){c?j.invoke("mqq.comic.getReporterInfo",{},function(c){
var e=c&&c.data||{};b.getPageId(e.land_page,function(c){d={from:r.mod,obj_pos:m.pos||"",land_page:e.land_page?c:"NULL",algo_id:e.algo_id||t,obj_ownerid:e.obj_ownerid||m.obj_ownerid||"NULL"},d.detailpage_from=b.getDetailPageFrom(),
a&&a(d)})}):a&&setTimeout(function(){d=d||{land_page:"NULL",algo_id:t,obj_ownerid:m.obj_ownerid||"NULL"},d.detailpage_from=b.getDetailPageFrom(),a(d)})}):a&&setTimeout(function(){d=d||{land_page:"NULL",
algo_id:t,obj_ownerid:m.obj_ownerid||"NULL"},d.detailpage_from=b.getDetailPageFrom(),a(d)})},b.getPageId=function(a,b){var c=a?i.parseUrl(a).pathname:location.pathname,d=c.substring(c.lastIndexOf("/")+1,c.indexOf(".html"));
return o[d]?b&&b(o[d]):j.invoke("mqq.data.readH5Data",{callid:"id_"+Date.now(),host:"qq.com",path:"qqcomic",key:["pageId",d].join("_")},function(a){a&&a.response&&a.response.data?b&&b(a.response.data):b&&b("NULL");
}),o[d]||"NULL"},b.createPath=function(a,c){return b.createCurrentPath(a)+q+b.createCurrentPath(c)},b.createCurrentPath=function(a){return[s.returnNull(a.page_id),s.returnNull(a.oper_obj_id),s.returnNull(a.ses_id),s.returnNull(a.ext4),s.returnNull(a.ext8)].join("_");
},b.getDetailPageFrom=function(){if(!e&&b.isDetailPage(p.page_id)){var a=m.detailpage_from||"NULL_NULL_NULL_NULL_NULL~NULL_NULL_NULL_NULL_NULL",c=m.prepage||b.createCurrentPath(n),d=a.split(q)[1];e=c+q+d;
}return encodeURIComponent(e)||"NULL_NULL_NULL_NULL_NULL~NULL_NULL_NULL_NULL_NULL"},b.isDetailPage=function(a){return 102==a||120==a},b.isNewIndexPage=function(a){return 3039==a}});
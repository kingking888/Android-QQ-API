define("piggy/business/cgiReport",["zepto","../util/net","../util/uri"],function(a,b,c){var d=c.exports,e={},f=a("zepto"),g=a("../util/net");a("../util/uri");e.config={rate:1},e.platform=function(){var a=navigator.userAgent.toLowerCase(),b=navigator.userAgent;
return e.is_mqq=!1,(/(iPad|iPhone|iPod).*? (IPad)?QQ\/([\d\.]+)/.test(b)||/\bV1_AND_SQI?_([\d\.]+)(.*? QQ\/([\d\.]+))?/.test(b))&&(e.is_mqq=!0),/android/.test(a)?"android":/iphone|ipad|ipod|itouch/.test(a)?"ios":"unknown";
}(),d.getPluginHandlers=function(a){var b=this,c=a;c="string"===f.type(c)?{filter:c}:f.isArray(c)?{filter:c[0],code:c[1]||0}:c||{};var d=(new Date).getTime();return{ajaxSuccess:function(a,e,g,h){var i=1,j=0,k="function"==typeof e.getDuration?e.getDuration():(new Date).getTime()-d;
if(c.code){for(var l=String(c.code).split("."),m=0,n=l.length;n>m&&h;)h=h[l[m++]];(m!=n||h)&&(i=3,j=h||0)}b.send(f.extend(!0,{},c,{url:g.url,type:i,code:j,time:k}))},ajaxError:function(a,e,g,h){if("abort"!=h){
var i,j,k="function"==typeof e.getDuration?e.getDuration():(new Date).getTime()-d;"timeout"==h?(i=2,j=3):"parsererror"==h?(i=2,j=1):e.status>=400&&e.status<500?(i=2,j=7):e.status>=500&&e.status<600?(i=2,
j=8):(i=2,j=0),b.send(f.extend(!0,{},c,{url:g.url,type:i,code:j,time:k}))}else{var i,j,k="function"==typeof e.getDuration?e.getDuration():(new Date).getTime()-d;i=3,j=9,b.send(f.extend(!0,{},c,{url:g.url,
type:i,code:j,time:k}))}}}},e.mergeNameList=["cgi","type","code","time"],e.send=function(a){var b=arguments.callee,c=2e3;if(b.mapping||(b.mapping={}),a){var d=JSON.stringify({domain:a.domain,uin:a.uin,
rate:a.rate});b.mapping[d]||(b.mapping[d]=[]),b.mapping[d].push(a)}else for(var d in b.mapping)if(b.mapping.hasOwnProperty(d)){if(b.mapping[d]&&b.mapping[d].length>0){for(var a,h=f.extend({key:e.mergeNameList.join(","),
platform:e.platform,expansion1:e.is_mqq?"ismqq":""},JSON.parse(d)),i=b.mapping[d].splice(0,10),j=0,k=i.length;a=i[j],k>j;j++)for(var l,m=0,n=e.mergeNameList.length;l=e.mergeNameList[m],n>m;m++)h[[j+1,m+1].join("_")]=a[l];
g.ping("https://report.huatuo.qq.com/code.cgi?"+f.param(h));break}delete b.mapping[d]}return b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){b.call(this)},c),!0},d.send=function(a){if(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/.test(decodeURIComponent(a.url))){
if(Math.random()<1/(a.rate||e.config.rate)){var b=RegExp.$4||"",c=RegExp.$5||"",d=RegExp.$6||"",f=a.filter?","+String(a.filter||"").replace(" ","")+",":"";e.send.call(this,{domain:b,cgi:c+(f?d.replace(/([\?\&])([^\=\&\#]*)(\=[^\&\#]*)?/g,function(a,b,c){
return-1!=f.indexOf(","+c+",")?a||"":"?"==b?"?":""}).replace(/^\?+$/,"").replace(/^\?&/,"?"):""),type:a.type||e.config.type||0,code:a.code||e.config.code||0,time:a.time||e.config.time||0,rate:1,uin:a.uin||e.config.uin||0
})}return!0}return!1}}),define("piggy/business/router",["zepto","../util/uri","../jsBridge/common","../util/net","../util/process"],function(a,b,c){var d={},e=a("zepto"),f=a("../util/uri"),g=a("../jsBridge/common"),h=a("../util/process"),i=(a("../util/net"),
c.exports={});d.params={uin:null,tt:"iphoneqq"==g.getClient()?2:1,sid:null,ADTAG:null},d.initConfig={nlogId:null},i.init=function(a){e.extend(d.initConfig,a||{})},i.ready=function(b,c){h.lockNext("ready","business/router",function(e){
c?a.async(c,function(){b.apply(null,[i.getParams()].concat(Array.prototype.slice.apply(arguments))),a.async("fastclick",function(a){a(document.body)}),a.async("badjs",function(a){a.init(d.initConfig.nlogId||270);
})}):b(i.getParams())},function(a){a(d.params)})},i.redirect=function(a,b){g.openUrl({url:this.createUrl(a,b),target:1,style:1})},i.update=function(a){window.location.replace(window.location.href.split("?")[0]+"?"+e.param(e.extend(!0,{},this.getParams(),a)));
},i.createUrl=function(a,b){var c=f.parseQueryString(window.location.search),g={};for(var h in d.params)d.params.hasOwnProperty(h)&&("undefined"!=typeof c[h]&&null!==typeof c[h]?g[h]=c[h]:null!==d.params[h]&&(g[h]=d.params[h]));
if(-1===a.indexOf("://")){if(0===a.indexOf("center/"))return a.substr("center/".length)+".html?"+e.param(e.extend(!0,{},g,b));if(0===a.indexOf("challenge/"))return a.substr("challenge/".length)+".html?"+e.param(e.extend(!0,{},g,b));
var i="gamecenter.qq.com";return"3g.qq.com"==window.location.hostname.split(".").slice(-3).join(".")&&(i=window.location.host),-1!=a.indexOf("gc_gamegift_fcgi")&&(i=-1!=window.location.host.indexOf("gamecentertest.cs0309.3g.qq.com")?"gamecentertest.cs0309.3g.qq.com":-1!=window.location.host.indexOf("gconlytest.cs0309.3g.qq.com")?"gconlytest.cs0309.3g.qq.com":-1!=window.location.host.indexOf("gcpre.cs0309.3g.qq.com")?"gcpre.cs0309.3g.qq.com":"gift.gamecenter.qq.com"),
"http://"+i+a+"?"+e.param(e.extend(!0,{},g,b))}if(/^(.+?)(\?(?:[^#]*))?(#(?:.*))?$/.test(a)){var j=RegExp.$1,k=RegExp.$2.replace(/\{([\d\w]+)\}/g,function(a,b){return"undefined"!=typeof g[b]?g[b].toString():a;
}),l=RegExp.$3,m=f.parseQueryString(k);return m.uin=1*m.uin||0,j+"?"+e.param(e.extend(!0,{},m,b))+l}return a},i.getUserId=function(a){for(var b=e.extend(!0,{},d.params,f.parseQueryString(window.location.search)),c=b.sid||a||"",g=5381,h=0,i=c.length;i>h;++h)g+=(g<<5)+c.charAt(h).charCodeAt();
return 2147483647&g},i.getParams=function(a){var b,c=arguments.callee;if(b=c.params?c.params:c.params=f.parseQueryString(window.location.search),a)for(var d=a.split("."),e=0,g=d.length;g>e;e++){if(!b.hasOwnProperty(d[e])){
var h=h;return h}b=b[d[e]]}return b}}),define("piggy/business/security",["../util/cookie","zepto","../util/uri"],function(a,b,c){var d=b,e=a("../util/cookie"),f=a("../util/uri");d.getCSRFToken=function(a){
var b=5381,c=e.get("skey");if(c=c||a.skey){for(var d=0,f=c.length;f>d;d++)b+=(b<<5)+c.charCodeAt(d);return 2147483647&b}return!1},d.getPluginHandlers=function(a){var b=this;return{ajaxSend:function(c,d,e){
var g=f.parseUrl(e.url);g.hostname&&"qq.com"!=g.hostname.split(".").slice(-2).join(".")||(g.search+=(g.search.indexOf("?")>=0?"&":"?")+"g_tk="+b.getCSRFToken(a),e.url=f.getUri(g))}}}}),define("piggy/business/speedReport",[],function(a,b,c){
var d=c.exports;d.send=function(a){if(!(a&&a.buzId&&a.siteId&&a.pageId))return void console.log("input param error");var b=1*a.delay||5,c=window._timePoints||[],d=c[0],e=[],f=a||{};a.num||0;setTimeout(function(){
window._timePoints[2]||(window._timePoints[2]=Date.now());var a=0==window.location.protocol.indexOf("https")?"https://huatuospeed.huatuo.qq.com/":"http://isdspeed.qq.com/";e.push(a+"cgi-bin/r.cgi?flag1="+f.buzId+"&flag2="+f.siteId+"&flag3="+f.pageId);
for(var b=1;b<c.length;b++){var g=b,h=c[b];h&&e.push(g+"="+(h-d))}var i=new Image;i.src=e.join("&")},1e3*b)}}),define("piggy/jsBridge/common",["../util/net","zepto","../util/process"],function(a,b,c){var d={},e=a("../util/net"),f=a("../util/process");
d.invokeByCommonAPI=function(a,b,c){for(var d=a.split("."),e=window,f=d.length-1,g=0;f>g;g++){if(!(d[g]in e))return c({result:1,message:"namespace no exist: "+d[g]+", "+a}),!1;e=e[d[g]]}if("function"!=typeof e[d[f]])return c({
result:2,message:"method no exist: "+d[f]+", "+a}),!1;try{var h=e[d[f]].apply(e,b)}catch(i){return c({result:3,message:"call error: error["+JSON.stringify(i)+"] method["+a+"] paramsList["+JSON.stringify(b)+"]"
}),!1}return c({result:0,data:h}),!0},d.isAsyncApi=function(){var a=arguments.callee;return"undefined"==typeof a.isAsyncApi?window.QQApi&&"function"==typeof window.QQApi.getClass?a.isAsyncApi=!1:a.isAsyncApi=!0:a.isAsyncApi;
},d.loadLibrary=function(a){var b=arguments.callee,c=this,g=seajs.data.base+"lib/qqapi.js";b.isLoaded?"function"==typeof a&&a.call(c):f.lockNext(g,"url",function(){"function"==typeof a&&a.call(c)},function(a){
d.isAsyncApi(),e.getScript(g,function(){b.isLoaded=!0,"androidqq"==c.getClient()&&(JsBridge.restoreApis({QQApi:["getAppsVerionCodeBatch","launchAppWithTokens"]},"4.6"),"gameCenter"==c.getWebView()&&(JsBridge.restoreApis({
GCApi:["setClientWebviewPull","showWarningToast","getReportPublicHighData","getReportPublicData","getSid","getUin","getOpenidBatch","getVersionName","startToAuthorized"]},"4.6"),JsBridge.restoreApis({q_download:["registerDownloadCallBackListener","getQueryDownloadAction","doGCDownloadAction","doDownloadAction","getDownloadVersion","checkUpdate"]
},"4.6"))),/PA/.test(window.navigator.userAgent)&&window.q_download&&(window.q_download.doGCDownloadAction=null),a()})})},b._invokeByCommonAPI=function(b,c,e){/[?&]_simulator=([\w]+)/.test(window.location.href)?a.async("./simulator/"+RegExp.$1,function(a){
a._invokeByCommonAPI.call(this,b,c,e||function(){})}):d.loadLibrary.call(this,function(){d.invokeByCommonAPI.call(this,b,c,e||function(){})})},b.getClient=function(){return/[?&]_client=(iphoneqq|androidqq)/.test(window.location.href)?RegExp.$1:-1!=window.navigator.userAgent.toLowerCase().indexOf("android")?"androidqq":"iphoneqq";
},b.getPlatform=function(){return-1!=window.navigator.userAgent.toLowerCase().indexOf("android")?"android":-1!=window.navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=window.navigator.userAgent.toLowerCase().indexOf("ipad")?"ios":"unkown";
},b.getWebView=function(){return/[?&]_webview=(gameCenter|default)/.test(window.location.href)?RegExp.$1:"undefined"!=typeof GCApi&&GCApi.getClass?"gameCenter":"iphoneqq"==this.getClient()?"gameCenter":/\bV1_AND_SQ_.+gamecenter/.test(window.navigator.userAgent)?"gameCenter":"default";
},d.completeUrl=function(a){return a.match(/\w+:\/\//)||(a=0==a.indexOf("/")?"http://"+location.host+a:location.href.replace(/[^\/]*$/,"")+a),a},b.openUrl=function(a){"androidqq"==this.getClient()&&"gameCenter"==this.getWebView()?this.compareVersion("4.7",function(b){
b&&0==b.result&&b.data>=0?this._invokeByCommonAPI("mqq.ui.openUrl",[{url:d.completeUrl(a.url)||"",target:a.target||0,style:1}],function(b){0!=b.result&&(location.href=a.url)}):location.href=a.url}):this._invokeByCommonAPI("mqq.ui.openUrl",[{
url:d.completeUrl(a.url)||"",target:a.target||0,style:1}],function(b){0!=b.result&&(location.href=a.url)})},b.getQQVersion=function(a){"iphoneqq"==this.getClient()?b._invokeByCommonAPI("iOSQQApi.device.qqVersion",[],function(b){
a(0==b.result?{result:0,data:String(b.data).split(".").slice(0,3).join(".")}:b)}):d.isAsyncApi()?b._invokeByCommonAPI("GCApi.getReportPublicHighData",[function(c){var d=c.split("|");d.length>3?a({result:0,
data:d[3]}):b._invokeByCommonAPI("mqq.device.getClientInfo",[function(b){a({result:0,data:b.qqVersion})}],function(b){0!=b.result&&a(b)})}],function(c){0!=c.result&&(1==c.result||2==c.result?b._invokeByCommonAPI("mqq.device.getClientInfo",[function(b){
a({result:0,data:b.qqVersion})}],function(b){0!=b.result&&a(b)}):a(c))}):b._invokeByCommonAPI("GCApi.getReportPublicHighData",[],function(b){if(0==b.result){var c=b.data.split("|");a(c.length>3?{result:0,
data:c[3]}:{result:-1,message:"getQQVersion error"})}else a(b)})},b.getSystemVersion=function(a){"iphoneqq"==this.getClient()?this._invokeByCommonAPI("iOSQQApi.device.systemVersion",[],function(b){a(0==b.result?{
result:0,data:b.data}:b)}):d.isAsyncApi()?b._invokeByCommonAPI("GCApi.getReportPublicHighData",[function(c){var d=c.split("|");d.length>2?a({result:0,data:d[2]}):b._invokeByCommonAPI("mqq.device.getDeviceInfo",[function(b){
a({result:0,data:b.systemVersion})}],function(b){0!=b.result&&a(b)})}],function(c){0!=c.result&&(1==c.result||2==c.result?b._invokeByCommonAPI("mqq.device.getDeviceInfo",[function(b){a({result:0,data:b.systemVersion
})}],function(b){0!=b.result&&a(b)}):a(c))}):b._invokeByCommonAPI("GCApi.getReportPublicHighData",[],function(b){if(0==b.result){var c=b.data.split("|");a(c.length>2?{result:0,data:c[2]}:{result:-1,message:"getSystemVersion error"
})}})},b.getDeviceModel=function(a){"iphoneqq"==this.getClient()?this._invokeByCommonAPI("iOSQQApi.device.model",[],function(b){a(0==b.result?{result:0,data:b.data}:b)}):d.isAsyncApi()?b._invokeByCommonAPI("GCApi.getReportPublicData",[function(c){
var d=c.split("|");d.length>3?a({result:0,data:d[3]}):b._invokeByCommonAPI("mqq.device.getDeviceInfo",[function(b){a({result:0,data:b.model})}],function(b){0!=b.result&&a(b)})}],function(c){0!=c.result&&(1==c.result||2==c.result?b._invokeByCommonAPI("mqq.device.getDeviceInfo",[function(b){
a({result:0,data:b.model})}],function(b){0!=b.result&&a(b)}):a(c))}):b._invokeByCommonAPI("GCApi.getReportPublicData",[],function(b){if(0==b.result){var c=b.data.split("|");a(c.length>3?{result:0,data:c[3]
}:{result:-1,message:"getSystemVersion error"})}})},b.setTitle=function(a){document.title=a,"iphoneqq"==this.getClient()&&b._invokeByCommonAPI("iOSQQApi._invokeClientMethod",["nav","refreshTitle"])},b.getNetworkType=function(a){
var c=["none","wifi","2g","3g","unkown"];"iphoneqq"==this.getClient()?b._invokeByCommonAPI("iOSQQApi.device.networkStatus",[],function(b){a(0==b.result?{result:0,data:c[b.data||0]}:b)}):d.isAsyncApi()?b._invokeByCommonAPI("GCApi.getReportPublicHighData",[function(d){
var e=d.split("|");if(e.length>1){var f="cmnet"!=e[1]||"null"!=e[0]&&null!==e[0]?e[1]:"none";a({result:0,data:f})}else b._invokeByCommonAPI("mqq.device.getNetworkType",[function(b){a({result:0,data:c[b]
})}],function(b){0!=b.result&&a(b)})}],function(d){0!=d.result&&(1==d.result||2==d.result?b._invokeByCommonAPI("mqq.device.getNetworkType",[function(b){a({result:0,data:c[b]})}],function(b){0!=b.result&&a(b);
}):a(d))}):b._invokeByCommonAPI("GCApi.getReportPublicHighData",[],function(b){if(0==b.result){var c=b.data.split("|");if(c.length>1){var d="cmnet"!=c[1]||"null"!=c[0]&&null!==c[0]?c[1]:"none";a({result:0,
data:d})}else a({result:-1,message:"getNetworkType error"})}})},b.setClientWebviewPull=function(a,c){"androidqq"==b.getClient()?b._invokeByCommonAPI("GCApi.setClientWebviewPull",[a],function(a){c(a)}):c({
result:4,message:"no support"})},b.getUserInfo=function(a){"iphoneqq"==this.getClient()?this._invokeByCommonAPI("iOSQQApi.data.userInfo",[],function(b){a(b)}):d.isAsyncApi()?this._invokeByCommonAPI("GCApi.getUin",[function(c){
var d=parseInt(c)||0;b._invokeByCommonAPI("GCApi.getSid",[function(b){a({result:0,data:{uin:d,sid:b}})}],function(b){0!=b.result&&a(b)})}],function(b){0!=b.result&&a(b)}):this._invokeByCommonAPI("GCApi.getUin",[],function(c){
if(0==c.result){var d=parseInt(c.data)||0;b._invokeByCommonAPI("GCApi.getSid",[],function(b){a(0==b.result?{result:0,data:{uin:d,sid:b.data}}:{result:0,data:{uin:d,sid:0}})})}else a(c)})},d.getPageWidth=function(){
return document.documentElement.clientWidth},d.getPageHeight=function(){return window.screen.height*(document.documentElement.clientWidth/window.screen.width)},b.getPageSize=function(a){window.screen.width?a(d.getPageWidth(),d.getPageHeight()):setTimeout($.proxy(function(){
this.getPageSize(a)},this),50)},b.closeWebview=function(a){var b=this;"androidqq"==b.getClient()?b.compareVersion("4.6",function(c){c&&0==c.result&&c.data>=0?(alert("here"),b._invokeByCommonAPI("mqq.ui.popBack",[],function(b){
a(b&&0==b.result?{result:0,message:"success"}:{result:-1,message:"no such method"})})):a({result:-1,message:"no such method"})}):b._invokeByCommonAPI("mqq.ui.popBack",[],function(b){a(b&&0==b.result?{result:0,
message:"success"}:{result:-1,message:"no such method"})})},d.compareVersion=function(a,b){a=String(a).split("."),b=String(b).split(".");try{for(var c=0,d=Math.max(a.length,b.length);d>c;c++){var e=isFinite(a[c])&&Number(a[c])||0,f=isFinite(b[c])&&Number(b[c])||0;
if(f>e)return-1;if(e>f)return 1}}catch(g){return-1}return 0},b.compareVersion=function(a,b){this.getQQVersion(function(c){b(c&&0==c.result&&c.data?{result:0,data:d.compareVersion(c.data,a)}:{result:-1,
message:"get QQ version error"})})}}),define("piggy/util/cacheData",[],function(a,b,c){var d={};d.sn="gamecenter_",d.getName=function(a,b){return d.sn+"/"+a.replace(/\//g,"//")+(b?"/"+b.replace(/\//g,"//"):"");
},d.getLocalStorage=function(a){try{var b=window.localStorage.getItem(d.getName(a)),c=JSON.parse(window.localStorage.getItem(d.getName(a,"info")));return null!==b&&window.localStorage.setItem(d.getName(a,"info"),JSON.stringify({
time:c&&parseInt(c.time)||(new Date).getTime(),count:(c&&parseInt(c.count)||0)+1})),JSON.parse(b)}catch(e){return null}},d.setLocalStorage=function(a,b){var c=JSON.stringify(b);try{window.localStorage.setItem(d.getName(a),c),
window.localStorage.setItem(d.getName(a,"info"),JSON.stringify({time:(new Date).getTime(),count:0}))}catch(e){try{return localStorage.clear(),window.localStorage.setItem(d.getName(a),c),window.localStorage.setItem(d.getName(a,"info"),JSON.stringify({
time:(new Date).getTime(),count:0})),!0}catch(e){return!1}}return!0},d.getLocalStorageTime=function(a){try{var b=JSON.parse(window.localStorage.getItem(d.getName(a,"info")));return b&&parseInt(b.time)||0;
}catch(c){return 0}},d.getLocalStorageCount=function(a){try{var b=JSON.parse(window.localStorage.getItem(d.getName(a,"info")));return b&&parseInt(b.count)||0}catch(c){return 0}},d.setLocalStorageInfo=function(a,b,c){
if(0===d.getLocalStorageTime.call(this,a))return!1;try{window.localStorage.setItem(d.getName(a,"info"),JSON.stringify({time:new Date(b).getTime()||0,count:parseInt(c)||0}))}catch(e){return!1}return!0},
d.getSessionStorage=function(a){try{var b=window.sessionStorage.getItem(d.getName(a)),c=JSON.parse(window.sessionStorage.getItem(d.getName(a,"info")));return window.sessionStorage.setItem(d.getName(a,"info"),JSON.stringify({
time:c&&parseInt(c.time)||(new Date).getTime(),count:(c&&parseInt(c.count)||0)+1})),JSON.parse(b)}catch(e){return null}},d.setSessionStorage=function(a,b){var c=JSON.stringify(b);try{window.sessionStorage.setItem(d.getName(a),c),
window.sessionStorage.setItem(d.getName(a,"info"),JSON.stringify({time:(new Date).getTime(),count:0}))}catch(e){return!1}return!0},d.getSessionStorageTime=function(a){try{var b=JSON.parse(window.sessionStorage.getItem(d.getName(a,"info")));
return b&&parseInt(b.time)||0}catch(c){return 0}},d.getSessionStorageCount=function(a){try{var b=JSON.parse(window.sessionStorage.getItem(d.getName(a,"info")));return b&&parseInt(b.count)||0}catch(c){return 0;
}},d.setSessionStorageInfo=function(a,b,c){if(0===d.getSessionStorageTime.call(this,a))return!1;try{window.sessionStorage.setItem(d.getName(a,"info"),JSON.stringify({time:new Date(b).getTime()||0,count:parseInt(c)||0
}))}catch(e){return!1}return!0},d.memoryCache={},d.getMemory=function(a){var b=d.memoryCache[d.getName(a)],c=b&&b.value;b&&b.time,b&&b.count;return"undefined"==typeof b?null:(null!==b&&(b.count=(parseInt(b.count)||0)+1),
c)},d.setMemory=function(a,b){return d.memoryCache[d.getName(a)]={value:b,time:(new Date).getTime(),count:0},!0},d.getMemoryTime=function(a){var b=d.memoryCache[d.getName(a)];return b&&parseInt(b.time)||0;
},d.getMemoryCount=function(a){var b=d.memoryCache[d.getName(a)];return b&&parseInt(b.count)||0},d.setMemoryInfo=function(a,b,c){return d.memoryCache[d.getName(a)]?(d.memoryCache[d.getName(a)].time=new Date(b).getTime()||0,
d.memoryCache[d.getName(a)].count=parseInt(c)||0,!0):!1},b.getCacheMode=function(a){switch(a===!1?"memory":a){case"memory":return"memory";case"sessionStorage":return window.sessionStorage?"sessionStorage":"memory";
default:return window.localStorage?"localStorage":"memory"}},b.get=function(a,b){switch(this.getCacheMode(b)){case"localStorage":return d.getLocalStorage.call(this,a);case"sessionStorage":return d.getSessionStorage.call(this,a);
case"memory":return d.getMemory.call(this,a)}},b.set=function(a,b,c){switch(this.getCacheMode(c)){case"localStorage":return d.setLocalStorage.call(this,a,b);case"sessionStorage":return d.setSessionStorage.call(this,a,b);
case"memory":return d.setMemory.call(this,a,b)}},b.isExpire=function(a,b,c,e){var f=0,g=0;switch(this.getCacheMode(e)){case"localStorage":f=d.getLocalStorageTime.call(this,a),g=d.getLocalStorageCount.call(this,a);
break;case"sessionStorage":f=d.getSessionStorageTime.call(this,a),g=d.getSessionStorageCount.call(this,a);break;case"memory":f=d.getMemoryTime.call(this,a),g=d.getMemoryCount.call(this,a)}return 0===f?!0:Math.abs((new Date).getTime()-f)>1e3*b?!0:g>c?!0:!1;
},b.setInfo=function(a,b,c,e){switch(this.getCacheMode(e)){case"localStorage":return d.setLocalStorageInfo.call(this,a,b,c);case"sessionStorage":return d.setSessionStorageInfo.call(this,a,b,c);case"memory":
return d.setMemoryInfo.call(this,a,b,c)}},b.getWithListStruct=function(a,b,c,d,e,f,g,h){var i=arguments.callee,j=this,k=c+"_list_"+JSON.stringify(a),l=2;if(i.listData||(i.listData={}),"string"==typeof b){
var m=b.split("to"),n=parseInt(m[0])||0,o=parseInt(m[1])||0;if(n>=o||0>n)return e({result:-1,message:"error params: start["+m[0]+"] end["+m[1]+"]"}),!0;if(f===!0||j.isExpire(k,parseInt(f)||Number.MAX_VALUE,Number.MAX_VALUE,h)&&!i.listData[k])g!==!1?d([n,o].join("to"),a,function(l){
if(l&&0==l.result&&l.data&&l.data.list){var m=l.data.list,p=l.data.index;(!i.listData[k]||g!==!0&&0==n)&&(i.listData[k]=m),j.set(k,m,h);var q=m.slice(n,o),r=[];if(p)for(var s=0,t=q.length;t>s;s++)p.hasOwnProperty(q[s])?j.set(c+"__"+q[s],p[q[s]],h):r.push(q[s]);else r=q;
if(r.length>0)i.call(j,a,r,c,d,function(a){for(var b=[],c=a&&a.data||{},d=q.length-1;d>=0;d--)c.hasOwnProperty(q[d])?b.unshift(c[q[d]]):p.hasOwnProperty(q[d])&&b.unshift(p[q[d]]);e({result:a&&a.result,
message:a&&a.message||"",count:m.length,data:b})},f,"function"==typeof g?function(){}:g,h);else{for(var u=[],s=q.length-1;s>=0;s--)u.unshift(p[q[s]]);e({result:0,count:m.length,data:u})}}else i.call(j,a,b,c,d,function(a){
e({result:l&&l.result||-1,message:l&&l.message||"error data",count:parseInt(a&&a.count)||0,data:a&&a.data||[]})},!1,!1,h)},g===!0):e({result:-1,message:"expire and no update"});else{var p=i&&i.listData&&i.listData[k],q=p&&"undefined"!=typeof p.length?parseInt(p.length)||0:-1,r=g===!0||"function"==typeof g||j.isExpire(k,parseInt(g)||Number.MAX_VALUE,(parseInt(g)||0)>0?l-1:Number.MAX_VALUE,h)&&g!==!1;
if(0>q?(p=j.get(k,h),q=p&&"undefined"!=typeof p.length?parseInt(p.length)||0:-1,q>=0&&(i.listData[k]=p)):j.get(k,h),q>=0){if(n>=q&&q>0)return e({result:-1,message:"error params: start["+n+"] total["+q+"]"
}),!0;var s=p.slice(n,o);i.call(j,a,s,c,d,function(k){var l=[];if(k&&k.data)for(var m=s.length-1;m>=0;m--)k.data.hasOwnProperty(s[m])&&l.unshift(k.data[s[m]]);e({result:k&&k.result,message:k&&k.message||"",
count:p.length,data:l}),"function"==typeof f&&g!==!1?i.call(j,a,b,c,d,f,!0,g,h):r&&i.call(j,a,b,c,d,"function"==typeof g?g:function(){},!0,!0,h)},"function"==typeof f?null:f,r?null:g,h)}else i.call(j,a,b,c,d,e,!0,g,h);
}}else{if(!(b.length>=0))return e(0!=b.length?{result:-1,message:"error "}:{result:0,data:{}}),!0;if(f===!0)g!==!1?d(b,a,function(f){if(f&&0==f.result&&f.data){for(var g={},k=0,l=b.length;l>k;k++)f.data.hasOwnProperty(b[k])&&j.set(c+"__"+b[k],g[b[k]]=f.data[b[k]],h);
e({result:0,data:g,coldLaunch:f.coldLaunch||0})}else i.call(j,a,b,c,d,function(a){e({result:f&&f.result,message:f&&f.message,data:a&&a.data,coldLaunch:f.coldLaunch||0})},!1,!1,h)},g===!0):e({result:-1,
message:"expire and no update"});else{for(var t={},u=[],v=[],w=0,x=b.length;x>w;w++)j.isExpire(c+"__"+b[w],parseInt(f)||Number.MAX_VALUE,Number.MAX_VALUE,h)?u.push(b[w]):(t[b[w]]=j.get(c+"__"+b[w],h),(g===!0||"function"==typeof g||j.isExpire(c+"__"+b[w],parseInt(g)||Number.MAX_VALUE,(parseInt(g)||0)>0?l:Number.MAX_VALUE,h)&&g!==!1||"function"==typeof f&&g!==!1)&&v.push(b[w]));
u.length>0?i.call(j,a,u.concat(v),c,d,function(a){if(a&&a.data){for(var b=0,c=u.length;c>b;b++)a.data.hasOwnProperty(u[b])&&(t[u[b]]=a.data[u[b]]);e({result:a&&a.result,message:a&&a.message||"",data:t,
coldLaunch:a.coldLaunch||0})}else e({result:a&&a.result||-1,message:a&&a.message||"error data"})},!0,g,h):(e({result:0,data:t,coldLaunch:0}),v.length>0&&("function"==typeof f?i.call(j,a,v,c,d,f,!0,g,h):i.call(j,a,v,c,d,"function"==typeof g?g:function(){},!0,!0,h)));
}}},b.isListSet=function(a,b){var c=this,d=b+"_list_"+JSON.stringify(a);return c.get(d)?!0:!1}}),define("piggy/util/cookie",["zepto"],function(a,b,c){var d=a("zepto"),e=b,f={};f.param={},e.set=function(a,b,c){
if(""==a)return!1;if(c=d.extend(!0,d.extend(!0,{},f.param),c),("undefined"==typeof b||null==b)&&(b=""),"number"==typeof c.expires){var e=c.expires;c.expires=new Date,c.expires.setTime(c.expires.getTime()+1e3*e);
}return document.cookie=[encodeURIComponent(a),"=",encodeURIComponent(b),c.domain?"; domain="+c.domain:"",c.path?"; path="+c.path:"",c.expires?"; expires="+c.expires.toUTCString():"",c.secure?"; secure":""].join(""),
!0},e.get=function(a){if(document.cookie&&""!=document.cookie)for(var b,c=document.cookie.split("; "),d=0,e=c.length,a=encodeURIComponent(a);e>d;d++)if(b=c[d].split("="),a==b[0])return decodeURIComponent(b[1]||"");
return null},e.clear=function(a,b){return e.set(a,null,d.extend(!0,{expires:-1},b))},e.isExist=function(a){return null!==e.get(a)},e.init=function(a,b){return b?f.param=a:d.extend(!0,f.param,a)}}),define("piggy/util/net",["zepto"],function(a,b){
var c=a("zepto");b.init=function(a,b){b?c.ajaxSettings=a:c.ajaxSettings=c.extend(!0,c.ajaxSettings,a)},b.ajax=function(b){var d=c.extend(!0,{},b.plugins,c.ajaxSettings.plugins);if(d){var e=b.context||c.ajaxSettings.context;
e?e instanceof c||(e=b.context=c(e)):e=b.context=c(window.document.createElement("span"));var f,g=["abort","getAllResponseHeaders","getResponseHeader","open","overrideMimeType","send","setRequestHeader","init","openRequest","sendAsBinary"],h=["withCredentials"],i=["readyState","response","responseText","responseType","responseXML","status","statusText"],j=["abort","error","load","loadend","loadstart","progress","progress","timeout","readystatechange"];
b.xhr=function(a){for(var b=function(){},c=0,d=0,e=0,k=g.length;k>e;e++)"undefined"!=typeof a[g[e]]&&(b.prototype[g[e]]=function(b){return function(){return b&&b.apply?b.apply(a,Array.prototype.slice.call(arguments,0)):void 0;
}}(a[g[e]]));return b.prototype.open=function(){for(var b=0,c=j.length;c>b;b++)!function(b){a[b]=function(){if("onreadystatechange"===b&&4==a.readyState&&(d=(new Date).getTime()),"onabort"===b&&(d=(new Date).getTime()),
"function"==typeof f[b]){for(var c=0,e=i.length;e>c;c++)try{"undefined"!=typeof a[i[c]]&&(f[i[c]]=a[i[c]])}catch(g){}return f[b].apply(f,Array.prototype.slice.call(arguments,0))}}}("on"+j[b]);return a.open.apply(a,Array.prototype.slice.call(arguments,0));
},b.prototype.send=function(){for(var b=0,d=h.length;d>b;b++)"undefined"!=typeof f[h[b]]&&(a[h[b]]=f[h[b]]);return c=(new Date).getTime(),a.send.apply(a,Array.prototype.slice.call(arguments,0))},b.prototype.getDuration=function(){
return c?(d||(new Date).getTime())-c:0},f=new b,function(){return f}}((b.xhr||c.ajaxSettings.xhr)());var k=[];for(var l in d)d.hasOwnProperty(l)&&k.push(l);return a.async(k,function(){for(var a,g=0,h=k.length;h>g;g++)if(arguments[g]){
a=arguments[g].getPluginHandlers.call(arguments[g],d[k[g]],b);for(var i in a)a.hasOwnProperty(i)&&e.on(i,a[i])}c(e).trigger(c.Event("ajaxStart"),[f,b]),c.ajax(b)}),f}return c.ajax(b)},b.get=function(a,b,d,e,f){
var g={};return g="function"==typeof b?{url:a,success:b,dataType:d}:{url:a,data:b,success:d,dataType:e},this.ajax(c.extend(!0,g,f))},b.post=function(a,b,d,e,f){return this.get(a,b,d,e,c.extend(!0,{type:"POST"
},f))},b.getJSON=function(a,b,c,d){return this.get(a,b,c,"json",d)},b.getScript=function(a,b,c){var d=function(){var e=document.createElement("script");e.async="async",e.src=a,c&&(e.crossOrigin="anonymous",
e.onerror=function(){c=!1,d()}),e.onload=function(){b&&b(c)},document.getElementsByTagName("head")[0].appendChild(e)};d()},b.ping=function(a){var b=arguments.callee,c="ping_"+(b.priority=(parseInt(b.priority)||0)+1),d=window[c]=new Image;
d.src=a,d.onerror=d.onload=function(){d.onerror=d.onload=null,d=null,delete window[c]}}}),define("piggy/util/process",[],function(a,b,c){var d={};d.lockCount={},d.callback={},d.process={},b.lockNext=function(a,b,c,e,f){
var g="next&"+escape(b||"default")+"&"+escape(a);d.lockCount[g]?(d.callback[g].push(c),d.lockCount[g]++):(d.lockCount[g]=1,d.callback[g]=[c],e.call(f||null,function(){for(var a=null;a=d.callback[g].shift();)a.apply(f||null,Array.prototype.slice.call(arguments,0));
d.lockCount[g]=0}))},d.lockMultiple=function(a,b,c,e,f){var g="single&"+escape(c||"default")+"&"+escape(b);if(a&&(d.lockCount[g]?(d.lockCount[g]++,d.callback[g].push(e),d.process[g].push(f)):(d.lockCount[g]=1,
d.callback[g]=[e],d.process[g]=[f])),!a||d.lockCount[g]<=1){var f=d.process[g].shift();"function"==typeof f&&f.call(null,function(a){d.lockCount[g]--;var e=d.callback[g].shift();"function"==typeof e&&e.apply(null,Array.prototype.slice.call(arguments,0)),
d.lockMultiple(!1,b,c)})}},b.lockMultiple=function(a,b,c,e){d.lockMultiple.call(this,!0,a,b,c,e)},b.lockResult=function(a,b){var c=[],d=null;d=b(function(){c.push(Array.prototype.slice.call(arguments,0)),
null!==d&&c.length>=d&&(d=null,a.apply(null,c))}),null!==d&&c.length>=d&&(d=null,a.apply(null,c))}}),define("piggy/util/report",["zepto","./process"],function(a,b,c){var d=c.exports,e=a("zepto"),f=a("./process");
d.send=function(b,c){f.lockNext(b,"util/report",function(a){a&&"function"==typeof a.send&&a.send(c)},function(c){a.async(b,function(a){c(a)})})},d.getInstance=function(a){var b,c=this;return{init:function(a){
b=a},send:function(d){c.send(a,e.extend(!0,{},b,d))}}}}),define("piggy/util/string",[],function(a,b,c){b.encodeHTML=function(a){if("string"==typeof a){for(var b=["&","&amp;","<","&lt;",">","&gt;",'"',"&quot;"],c=0;c<b.length;c+=2)a=a.replace(new RegExp(b[c],"g"),b[1+c]);
return a}return a}}),define("piggy/util/time",["./cacheData","./net","zepto","./process"],function(a,b,c){var d=b,e={},f=a("./cacheData"),g=a("./net"),h=a("./process");d.getLeftSecond=function(a,b){f.isExpire("time/interval",3600)?h.lockNext("interval","time/getLeftSecond",function(c){
c&&c.data&&parseInt(c.data)>0?b({result:0,data:(parseInt(a)||0)-(new Date).getTime()/1e3-(parseInt(f.get("time/interval"))||0)},a):b({result:c.result,message:c.message},a)},function(a){g.ajax({url:window.location.protocol+"//report.vip.qq.com/cgi-bin/get_svr_time",
data:{time:(new Date).getTime()},cache:!1,dataType:"json",timeout:1e4,success:function(b,c,d){b&&0==b.ecode&&b.svrTime&&parseInt(b.svrTime)>0?(b.data=b.svrTime,b.result=0,e.setServerTime(b.data),a(b)):a({
result:-1,message:"error data"})},error:function(b,c,d){a({result:-1,message:[c,d]})}})}):b({result:0,data:(parseInt(a)||0)-(new Date).getTime()/1e3-(parseInt(f.get("time/interval"))||0)},a)},e.setServerTime=function(a){
var b=parseInt(a)||0;if(b>0){var c=parseInt(f.get("time/interval"))||0,d=b-(new Date).getTime()/1e3;0==c||Math.abs(c-d)>60?f.set("time/interval",d):f.set("time/interval",c)}},d.getPluginHandlers=function(a){
var b=this,c=0;return{ajaxSend:function(b,d,e){a instanceof RegExp&&a.test(e.url)&&(c=(new Date).getTime())},ajaxSuccess:function(a,d,f,g){if(200==d.status&&(new Date).getTime()-c<1e4)try{var h=Date.parse(d.getResponseHeader("Date"))/1e3;
e.setServerTime.call(b,h)}catch(i){}}}}}),define("piggy/util/tpl",[],function(a,b,c){var d={};d.cache={},b.get=function(a,b,c){var e=/[^\w\-\.:]/.test(a)?function(a,b){var c,d=[],f=[];for(c in a)d.push(c),
f.push(a[c]);return new Function(d,e.code).apply(b||a,f)}:d.cache[a]=d.cache[a]||this.get(document.getElementById(a).innerHTML);return e.code=e.code||"var $parts=[]; $parts.push('"+a.replace(/\\/g,"\\\\").replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/(^|%>)[^\t]*/g,function(a){
return a.replace(/'/g,"\\'")}).replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("$parts.push('")+"'); return $parts.join('');",b?e(b,c):e},b.getInstance=function(a){var b=arguments.callee,c=this;
return"string"==typeof b.methodName&&b.methodName||(b.methodName="tplInvoke_"+(new Date).getTime(),window[b.methodName]=function(a,c,d){var e=String(window[b.methodName].list[d].method).split("."),f=window[b.methodName].list[d].instance,g={
originalEvent:c};for(var h in c)/^([A-Z]|returnValue$|layer[XY]$)/.test(h)||"undefined"==typeof c[h]||(g[h]=c[h]);g.currentTarget=a;for(var h=0,i=e.length-1;i>h;h++)f=f[e[h]];return f[e[h]].apply(f,[].concat([g],window[b.methodName].list[d].paramList));
},window[b.methodName].list=[]),{getInvoke:function(c){return"window."+b.methodName+"(this, event, "+(window[b.methodName].list.push({instance:a,method:c,paramList:Array.prototype.slice.call(arguments,1)
})-1)+")"},getData:function(b){for(var c=String(b).split("."),d=a,e=0,f=c.length;f>e;e++)d=d[c[e]];return"function"==typeof d?d.apply(a,Array.prototype.slice.call(arguments,1)):d},getContent:function(a,b,d){
return c.get(a,b,d)}}}}),define("piggy/util/uri",[],function(a,b,c){b.getRealPath=function(a,b){var c=0,d=[],e=b||window.location.href;a=(a+"").replace("\\","/"),-1!==a.indexOf("://")&&(c=1),c||(a=e.substring(0,e.lastIndexOf("/")+1)+a),
d=a.split("/"),a=[];for(var f in d)"."!=d[f]&&(".."==d[f]?a.length>3&&a.pop():(a.length<2||""!==d[f])&&a.push(d[f]));return a.join("/")},b.parseUrl=function(a){if(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/.test(a)){
var b=RegExp.$4.split(":");return{protocol:RegExp.$1,host:RegExp.$4,hostname:b[0],port:b[1]||"",pathname:RegExp.$5,search:RegExp.$6,hash:RegExp.$8,href:a}}return null},b.getUri=function(a){var b="";return a.hash&&(b=0==a.hash.indexOf("#")?a.hash:"#"+a.hash),
a.search&&(b=(0==a.search.indexOf("?")?a.search:"?"+a.search)+b),a.pathname?(b=a.pathname+b,a.host&&0==b.indexOf("/")?(b=a.host+b,a.protocol&&(b=a.protocol+"//"+b),b):b):b},b.parseQueryString=function(a){
var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=String(a).replace(/^[\?&#]/,"").replace(/&$/,"").split("&"),r=q.length,s=function(a){try{return decodeURIComponent(a.replace(/\+/g,"%20"))}catch(b){return""}},t={};for(b=0;r>b;b++){
for(k=q[b].split("="),l=s(k[0]),m=k.length<2?"":s(k[1]);" "===l.charAt(0);)l=l.slice(1);if(l.indexOf("\x00")>-1&&(l=l.slice(0,l.indexOf("\x00"))),l&&"["!==l.charAt(0)){for(o=[],n=0,c=0;c<l.length;c++)if("["!==l.charAt(c)||n){
if("]"===l.charAt(c)&&n&&(o.length||o.push(l.slice(0,n-1)),o.push(l.substr(n,c-n)),n=0,"["!==l.charAt(c+1)))break}else n=c+1;for(o.length||(o=[l]),c=0;c<o[0].length&&(j=o[0].charAt(c),(" "===j||"."===j||"["===j)&&(o[0]=o[0].substr(0,c)+"_"+o[0].substr(c+1)),
"["!==j);c++);for(g=t,c=0,p=o.length;p>c;c++)if(l=o[c].replace(/^['"]/,"").replace(/['"]$/,""),h=c!==o.length-1,f=g,""!==l&&" "!==l||0===c)g[l]===i&&(g[l]={}),g=g[l];else{d=-1;for(e in g)g.hasOwnProperty(e)&&+e>d&&e.match(/^\d+$/g)&&(d=+e);
l=d+1}f[l]=m}}return t}});